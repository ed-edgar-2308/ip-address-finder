(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))f(_);new MutationObserver(_=>{for(const T of _)if(T.type==="childList")for(const x of T.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&f(x)}).observe(document,{childList:!0,subtree:!0});function l(_){const T={};return _.integrity&&(T.integrity=_.integrity),_.referrerPolicy&&(T.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?T.credentials="include":_.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function f(_){if(_.ep)return;_.ep=!0;const T=l(_);fetch(_.href,T)}})();var Tb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Eb(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var J0={exports:{}},rp={},Q0={exports:{}},At={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nc=Symbol.for("react.element"),kb=Symbol.for("react.portal"),Ib=Symbol.for("react.fragment"),Cb=Symbol.for("react.strict_mode"),Pb=Symbol.for("react.profiler"),Ab=Symbol.for("react.provider"),zb=Symbol.for("react.context"),Mb=Symbol.for("react.forward_ref"),Db=Symbol.for("react.suspense"),Lb=Symbol.for("react.memo"),Rb=Symbol.for("react.lazy"),z_=Symbol.iterator;function Fb(i){return i===null||typeof i!="object"?null:(i=z_&&i[z_]||i["@@iterator"],typeof i=="function"?i:null)}var ev={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tv=Object.assign,iv={};function Vl(i,s,l){this.props=i,this.context=s,this.refs=iv,this.updater=l||ev}Vl.prototype.isReactComponent={};Vl.prototype.setState=function(i,s){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,s,"setState")};Vl.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function rv(){}rv.prototype=Vl.prototype;function ig(i,s,l){this.props=i,this.context=s,this.refs=iv,this.updater=l||ev}var rg=ig.prototype=new rv;rg.constructor=ig;tv(rg,Vl.prototype);rg.isPureReactComponent=!0;var M_=Array.isArray,nv=Object.prototype.hasOwnProperty,ng={current:null},sv={key:!0,ref:!0,__self:!0,__source:!0};function ov(i,s,l){var f,_={},T=null,x=null;if(s!=null)for(f in s.ref!==void 0&&(x=s.ref),s.key!==void 0&&(T=""+s.key),s)nv.call(s,f)&&!sv.hasOwnProperty(f)&&(_[f]=s[f]);var d=arguments.length-2;if(d===1)_.children=l;else if(1<d){for(var U=Array(d),ee=0;ee<d;ee++)U[ee]=arguments[ee+2];_.children=U}if(i&&i.defaultProps)for(f in d=i.defaultProps,d)_[f]===void 0&&(_[f]=d[f]);return{$$typeof:Nc,type:i,key:T,ref:x,props:_,_owner:ng.current}}function Bb(i,s){return{$$typeof:Nc,type:i.type,key:s,ref:i.ref,props:i.props,_owner:i._owner}}function sg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Nc}function Ob(i){var s={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(l){return s[l]})}var D_=/\/+/g;function Cf(i,s){return typeof i=="object"&&i!==null&&i.key!=null?Ob(""+i.key):s.toString(36)}function yd(i,s,l,f,_){var T=typeof i;(T==="undefined"||T==="boolean")&&(i=null);var x=!1;if(i===null)x=!0;else switch(T){case"string":case"number":x=!0;break;case"object":switch(i.$$typeof){case Nc:case kb:x=!0}}if(x)return x=i,_=_(x),i=f===""?"."+Cf(x,0):f,M_(_)?(l="",i!=null&&(l=i.replace(D_,"$&/")+"/"),yd(_,s,l,"",function(ee){return ee})):_!=null&&(sg(_)&&(_=Bb(_,l+(!_.key||x&&x.key===_.key?"":(""+_.key).replace(D_,"$&/")+"/")+i)),s.push(_)),1;if(x=0,f=f===""?".":f+":",M_(i))for(var d=0;d<i.length;d++){T=i[d];var U=f+Cf(T,d);x+=yd(T,s,l,U,_)}else if(U=Fb(i),typeof U=="function")for(i=U.call(i),d=0;!(T=i.next()).done;)T=T.value,U=f+Cf(T,d++),x+=yd(T,s,l,U,_);else if(T==="object")throw s=String(i),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return x}function ed(i,s,l){if(i==null)return i;var f=[],_=0;return yd(i,f,"","",function(T){return s.call(l,T,_++)}),f}function Nb(i){if(i._status===-1){var s=i._result;s=s(),s.then(function(l){(i._status===0||i._status===-1)&&(i._status=1,i._result=l)},function(l){(i._status===0||i._status===-1)&&(i._status=2,i._result=l)}),i._status===-1&&(i._status=0,i._result=s)}if(i._status===1)return i._result.default;throw i._result}var Rr={current:null},_d={transition:null},Vb={ReactCurrentDispatcher:Rr,ReactCurrentBatchConfig:_d,ReactCurrentOwner:ng};At.Children={map:ed,forEach:function(i,s,l){ed(i,function(){s.apply(this,arguments)},l)},count:function(i){var s=0;return ed(i,function(){s++}),s},toArray:function(i){return ed(i,function(s){return s})||[]},only:function(i){if(!sg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};At.Component=Vl;At.Fragment=Ib;At.Profiler=Pb;At.PureComponent=ig;At.StrictMode=Cb;At.Suspense=Db;At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vb;At.cloneElement=function(i,s,l){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var f=tv({},i.props),_=i.key,T=i.ref,x=i._owner;if(s!=null){if(s.ref!==void 0&&(T=s.ref,x=ng.current),s.key!==void 0&&(_=""+s.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(U in s)nv.call(s,U)&&!sv.hasOwnProperty(U)&&(f[U]=s[U]===void 0&&d!==void 0?d[U]:s[U])}var U=arguments.length-2;if(U===1)f.children=l;else if(1<U){d=Array(U);for(var ee=0;ee<U;ee++)d[ee]=arguments[ee+2];f.children=d}return{$$typeof:Nc,type:i.type,key:_,ref:T,props:f,_owner:x}};At.createContext=function(i){return i={$$typeof:zb,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Ab,_context:i},i.Consumer=i};At.createElement=ov;At.createFactory=function(i){var s=ov.bind(null,i);return s.type=i,s};At.createRef=function(){return{current:null}};At.forwardRef=function(i){return{$$typeof:Mb,render:i}};At.isValidElement=sg;At.lazy=function(i){return{$$typeof:Rb,_payload:{_status:-1,_result:i},_init:Nb}};At.memo=function(i,s){return{$$typeof:Lb,type:i,compare:s===void 0?null:s}};At.startTransition=function(i){var s=_d.transition;_d.transition={};try{i()}finally{_d.transition=s}};At.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};At.useCallback=function(i,s){return Rr.current.useCallback(i,s)};At.useContext=function(i){return Rr.current.useContext(i)};At.useDebugValue=function(){};At.useDeferredValue=function(i){return Rr.current.useDeferredValue(i)};At.useEffect=function(i,s){return Rr.current.useEffect(i,s)};At.useId=function(){return Rr.current.useId()};At.useImperativeHandle=function(i,s,l){return Rr.current.useImperativeHandle(i,s,l)};At.useInsertionEffect=function(i,s){return Rr.current.useInsertionEffect(i,s)};At.useLayoutEffect=function(i,s){return Rr.current.useLayoutEffect(i,s)};At.useMemo=function(i,s){return Rr.current.useMemo(i,s)};At.useReducer=function(i,s,l){return Rr.current.useReducer(i,s,l)};At.useRef=function(i){return Rr.current.useRef(i)};At.useState=function(i){return Rr.current.useState(i)};At.useSyncExternalStore=function(i,s,l){return Rr.current.useSyncExternalStore(i,s,l)};At.useTransition=function(){return Rr.current.useTransition()};At.version="18.2.0";Q0.exports=At;var zl=Q0.exports;const Ub=Eb(zl);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jb=zl,$b=Symbol.for("react.element"),qb=Symbol.for("react.fragment"),Zb=Object.prototype.hasOwnProperty,Hb=jb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Gb={key:!0,ref:!0,__self:!0,__source:!0};function av(i,s,l){var f,_={},T=null,x=null;l!==void 0&&(T=""+l),s.key!==void 0&&(T=""+s.key),s.ref!==void 0&&(x=s.ref);for(f in s)Zb.call(s,f)&&!Gb.hasOwnProperty(f)&&(_[f]=s[f]);if(i&&i.defaultProps)for(f in s=i.defaultProps,s)_[f]===void 0&&(_[f]=s[f]);return{$$typeof:$b,type:i,key:T,ref:x,props:_,_owner:Hb.current}}rp.Fragment=qb;rp.jsx=av;rp.jsxs=av;J0.exports=rp;var Mr=J0.exports,nm={},lv={exports:{}},cn={},uv={exports:{}},cv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function s(Ze,ct){var ht=Ze.length;Ze.push(ct);e:for(;0<ht;){var It=ht-1>>>1,zt=Ze[It];if(0<_(zt,ct))Ze[It]=ct,Ze[ht]=zt,ht=It;else break e}}function l(Ze){return Ze.length===0?null:Ze[0]}function f(Ze){if(Ze.length===0)return null;var ct=Ze[0],ht=Ze.pop();if(ht!==ct){Ze[0]=ht;e:for(var It=0,zt=Ze.length,Br=zt>>>1;It<Br;){var Pi=2*(It+1)-1,Wr=Ze[Pi],Ri=Pi+1,Ui=Ze[Ri];if(0>_(Wr,ht))Ri<zt&&0>_(Ui,Wr)?(Ze[It]=Ui,Ze[Ri]=ht,It=Ri):(Ze[It]=Wr,Ze[Pi]=ht,It=Pi);else if(Ri<zt&&0>_(Ui,ht))Ze[It]=Ui,Ze[Ri]=ht,It=Ri;else break e}}return ct}function _(Ze,ct){var ht=Ze.sortIndex-ct.sortIndex;return ht!==0?ht:Ze.id-ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;i.unstable_now=function(){return T.now()}}else{var x=Date,d=x.now();i.unstable_now=function(){return x.now()-d}}var U=[],ee=[],de=1,H=null,G=3,Me=!1,xe=!1,we=!1,at=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(Ze){for(var ct=l(ee);ct!==null;){if(ct.callback===null)f(ee);else if(ct.startTime<=Ze)f(ee),ct.sortIndex=ct.expirationTime,s(U,ct);else break;ct=l(ee)}}function ke(Ze){if(we=!1,ue(Ze),!xe)if(l(U)!==null)xe=!0,xr(qe);else{var ct=l(ee);ct!==null&&dn(ke,ct.startTime-Ze)}}function qe(Ze,ct){xe=!1,we&&(we=!1,ae(et),et=-1),Me=!0;var ht=G;try{for(ue(ct),H=l(U);H!==null&&(!(H.expirationTime>ct)||Ze&&!Zt());){var It=H.callback;if(typeof It=="function"){H.callback=null,G=H.priorityLevel;var zt=It(H.expirationTime<=ct);ct=i.unstable_now(),typeof zt=="function"?H.callback=zt:H===l(U)&&f(U),ue(ct)}else f(U);H=l(U)}if(H!==null)var Br=!0;else{var Pi=l(ee);Pi!==null&&dn(ke,Pi.startTime-ct),Br=!1}return Br}finally{H=null,G=ht,Me=!1}}var Je=!1,Ge=null,et=-1,Rt=5,xt=-1;function Zt(){return!(i.unstable_now()-xt<Rt)}function Ot(){if(Ge!==null){var Ze=i.unstable_now();xt=Ze;var ct=!0;try{ct=Ge(!0,Ze)}finally{ct?si():(Je=!1,Ge=null)}}else Je=!1}var si;if(typeof ie=="function")si=function(){ie(Ot)};else if(typeof MessageChannel<"u"){var sr=new MessageChannel,Pn=sr.port2;sr.port1.onmessage=Ot,si=function(){Pn.postMessage(null)}}else si=function(){at(Ot,0)};function xr(Ze){Ge=Ze,Je||(Je=!0,si())}function dn(Ze,ct){et=at(function(){Ze(i.unstable_now())},ct)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ze){Ze.callback=null},i.unstable_continueExecution=function(){xe||Me||(xe=!0,xr(qe))},i.unstable_forceFrameRate=function(Ze){0>Ze||125<Ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Rt=0<Ze?Math.floor(1e3/Ze):5},i.unstable_getCurrentPriorityLevel=function(){return G},i.unstable_getFirstCallbackNode=function(){return l(U)},i.unstable_next=function(Ze){switch(G){case 1:case 2:case 3:var ct=3;break;default:ct=G}var ht=G;G=ct;try{return Ze()}finally{G=ht}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ze,ct){switch(Ze){case 1:case 2:case 3:case 4:case 5:break;default:Ze=3}var ht=G;G=Ze;try{return ct()}finally{G=ht}},i.unstable_scheduleCallback=function(Ze,ct,ht){var It=i.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?It+ht:It):ht=It,Ze){case 1:var zt=-1;break;case 2:zt=250;break;case 5:zt=1073741823;break;case 4:zt=1e4;break;default:zt=5e3}return zt=ht+zt,Ze={id:de++,callback:ct,priorityLevel:Ze,startTime:ht,expirationTime:zt,sortIndex:-1},ht>It?(Ze.sortIndex=ht,s(ee,Ze),l(U)===null&&Ze===l(ee)&&(we?(ae(et),et=-1):we=!0,dn(ke,ht-It))):(Ze.sortIndex=zt,s(U,Ze),xe||Me||(xe=!0,xr(qe))),Ze},i.unstable_shouldYield=Zt,i.unstable_wrapCallback=function(Ze){var ct=G;return function(){var ht=G;G=ct;try{return Ze.apply(this,arguments)}finally{G=ht}}}})(cv);uv.exports=cv;var Wb=uv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hv=zl,un=Wb;function Re(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,l=1;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dv=new Set,wc={};function Ea(i,s){Ml(i,s),Ml(i+"Capture",s)}function Ml(i,s){for(wc[i]=s,i=0;i<s.length;i++)dv.add(s[i])}var Os=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sm=Object.prototype.hasOwnProperty,Kb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,L_={},R_={};function Xb(i){return sm.call(R_,i)?!0:sm.call(L_,i)?!1:Kb.test(i)?R_[i]=!0:(L_[i]=!0,!1)}function Yb(i,s,l,f){if(l!==null&&l.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return f?!1:l!==null?!l.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Jb(i,s,l,f){if(s===null||typeof s>"u"||Yb(i,s,l,f))return!0;if(f)return!1;if(l!==null)switch(l.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Fr(i,s,l,f,_,T,x){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=f,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=i,this.type=s,this.sanitizeURL=T,this.removeEmptyString=x}var nr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){nr[i]=new Fr(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];nr[s]=new Fr(s,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){nr[i]=new Fr(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){nr[i]=new Fr(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){nr[i]=new Fr(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){nr[i]=new Fr(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){nr[i]=new Fr(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){nr[i]=new Fr(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){nr[i]=new Fr(i,5,!1,i.toLowerCase(),null,!1,!1)});var og=/[\-:]([a-z])/g;function ag(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(og,ag);nr[s]=new Fr(s,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(og,ag);nr[s]=new Fr(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(og,ag);nr[s]=new Fr(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){nr[i]=new Fr(i,1,!1,i.toLowerCase(),null,!1,!1)});nr.xlinkHref=new Fr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){nr[i]=new Fr(i,1,!1,i.toLowerCase(),null,!0,!0)});function lg(i,s,l,f){var _=nr.hasOwnProperty(s)?nr[s]:null;(_!==null?_.type!==0:f||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Jb(s,l,_,f)&&(l=null),f||_===null?Xb(s)&&(l===null?i.removeAttribute(s):i.setAttribute(s,""+l)):_.mustUseProperty?i[_.propertyName]=l===null?_.type===3?!1:"":l:(s=_.attributeName,f=_.attributeNamespace,l===null?i.removeAttribute(s):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,f?i.setAttributeNS(f,s,l):i.setAttribute(s,l))))}var js=hv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,td=Symbol.for("react.element"),pl=Symbol.for("react.portal"),fl=Symbol.for("react.fragment"),ug=Symbol.for("react.strict_mode"),om=Symbol.for("react.profiler"),pv=Symbol.for("react.provider"),fv=Symbol.for("react.context"),cg=Symbol.for("react.forward_ref"),am=Symbol.for("react.suspense"),lm=Symbol.for("react.suspense_list"),hg=Symbol.for("react.memo"),So=Symbol.for("react.lazy"),mv=Symbol.for("react.offscreen"),F_=Symbol.iterator;function Qu(i){return i===null||typeof i!="object"?null:(i=F_&&i[F_]||i["@@iterator"],typeof i=="function"?i:null)}var gi=Object.assign,Pf;function lc(i){if(Pf===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);Pf=s&&s[1]||""}return`
`+Pf+i}var Af=!1;function zf(i,s){if(!i||Af)return"";Af=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(ee){var f=ee}Reflect.construct(i,[],s)}else{try{s.call()}catch(ee){f=ee}i.call(s.prototype)}else{try{throw Error()}catch(ee){f=ee}i()}}catch(ee){if(ee&&f&&typeof ee.stack=="string"){for(var _=ee.stack.split(`
`),T=f.stack.split(`
`),x=_.length-1,d=T.length-1;1<=x&&0<=d&&_[x]!==T[d];)d--;for(;1<=x&&0<=d;x--,d--)if(_[x]!==T[d]){if(x!==1||d!==1)do if(x--,d--,0>d||_[x]!==T[d]){var U=`
`+_[x].replace(" at new "," at ");return i.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",i.displayName)),U}while(1<=x&&0<=d);break}}}finally{Af=!1,Error.prepareStackTrace=l}return(i=i?i.displayName||i.name:"")?lc(i):""}function Qb(i){switch(i.tag){case 5:return lc(i.type);case 16:return lc("Lazy");case 13:return lc("Suspense");case 19:return lc("SuspenseList");case 0:case 2:case 15:return i=zf(i.type,!1),i;case 11:return i=zf(i.type.render,!1),i;case 1:return i=zf(i.type,!0),i;default:return""}}function um(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case fl:return"Fragment";case pl:return"Portal";case om:return"Profiler";case ug:return"StrictMode";case am:return"Suspense";case lm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case fv:return(i.displayName||"Context")+".Consumer";case pv:return(i._context.displayName||"Context")+".Provider";case cg:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case hg:return s=i.displayName||null,s!==null?s:um(i.type)||"Memo";case So:s=i._payload,i=i._init;try{return um(i(s))}catch{}}return null}function e2(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return um(s);case 8:return s===ug?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Bo(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function gv(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function t2(i){var s=gv(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),f=""+i[s];if(!i.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,T=l.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return _.call(this)},set:function(x){f=""+x,T.call(this,x)}}),Object.defineProperty(i,s,{enumerable:l.enumerable}),{getValue:function(){return f},setValue:function(x){f=""+x},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function id(i){i._valueTracker||(i._valueTracker=t2(i))}function yv(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var l=s.getValue(),f="";return i&&(f=gv(i)?i.checked?"true":"false":i.value),i=f,i!==l?(s.setValue(i),!0):!1}function Md(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function cm(i,s){var l=s.checked;return gi({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??i._wrapperState.initialChecked})}function B_(i,s){var l=s.defaultValue==null?"":s.defaultValue,f=s.checked!=null?s.checked:s.defaultChecked;l=Bo(s.value!=null?s.value:l),i._wrapperState={initialChecked:f,initialValue:l,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function _v(i,s){s=s.checked,s!=null&&lg(i,"checked",s,!1)}function hm(i,s){_v(i,s);var l=Bo(s.value),f=s.type;if(l!=null)f==="number"?(l===0&&i.value===""||i.value!=l)&&(i.value=""+l):i.value!==""+l&&(i.value=""+l);else if(f==="submit"||f==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?dm(i,s.type,l):s.hasOwnProperty("defaultValue")&&dm(i,s.type,Bo(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function O_(i,s,l){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var f=s.type;if(!(f!=="submit"&&f!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,l||s===i.value||(i.value=s),i.defaultValue=s}l=i.name,l!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,l!==""&&(i.name=l)}function dm(i,s,l){(s!=="number"||Md(i.ownerDocument)!==i)&&(l==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+l&&(i.defaultValue=""+l))}var uc=Array.isArray;function El(i,s,l,f){if(i=i.options,s){s={};for(var _=0;_<l.length;_++)s["$"+l[_]]=!0;for(l=0;l<i.length;l++)_=s.hasOwnProperty("$"+i[l].value),i[l].selected!==_&&(i[l].selected=_),_&&f&&(i[l].defaultSelected=!0)}else{for(l=""+Bo(l),s=null,_=0;_<i.length;_++){if(i[_].value===l){i[_].selected=!0,f&&(i[_].defaultSelected=!0);return}s!==null||i[_].disabled||(s=i[_])}s!==null&&(s.selected=!0)}}function pm(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Re(91));return gi({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function N_(i,s){var l=s.value;if(l==null){if(l=s.children,s=s.defaultValue,l!=null){if(s!=null)throw Error(Re(92));if(uc(l)){if(1<l.length)throw Error(Re(93));l=l[0]}s=l}s==null&&(s=""),l=s}i._wrapperState={initialValue:Bo(l)}}function vv(i,s){var l=Bo(s.value),f=Bo(s.defaultValue);l!=null&&(l=""+l,l!==i.value&&(i.value=l),s.defaultValue==null&&i.defaultValue!==l&&(i.defaultValue=l)),f!=null&&(i.defaultValue=""+f)}function V_(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function xv(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fm(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?xv(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var rd,wv=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,l,f,_){MSApp.execUnsafeLocalFunction(function(){return i(s,l,f,_)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(rd=rd||document.createElement("div"),rd.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=rd.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function bc(i,s){if(s){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=s;return}}i.textContent=s}var dc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i2=["Webkit","ms","Moz","O"];Object.keys(dc).forEach(function(i){i2.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),dc[s]=dc[i]})});function bv(i,s,l){return s==null||typeof s=="boolean"||s===""?"":l||typeof s!="number"||s===0||dc.hasOwnProperty(i)&&dc[i]?(""+s).trim():s+"px"}function Sv(i,s){i=i.style;for(var l in s)if(s.hasOwnProperty(l)){var f=l.indexOf("--")===0,_=bv(l,s[l],f);l==="float"&&(l="cssFloat"),f?i.setProperty(l,_):i[l]=_}}var r2=gi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mm(i,s){if(s){if(r2[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Re(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Re(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Re(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Re(62))}}function gm(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ym=null;function dg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var _m=null,kl=null,Il=null;function U_(i){if(i=jc(i)){if(typeof _m!="function")throw Error(Re(280));var s=i.stateNode;s&&(s=lp(s),_m(i.stateNode,i.type,s))}}function Tv(i){kl?Il?Il.push(i):Il=[i]:kl=i}function Ev(){if(kl){var i=kl,s=Il;if(Il=kl=null,U_(i),s)for(i=0;i<s.length;i++)U_(s[i])}}function kv(i,s){return i(s)}function Iv(){}var Mf=!1;function Cv(i,s,l){if(Mf)return i(s,l);Mf=!0;try{return kv(i,s,l)}finally{Mf=!1,(kl!==null||Il!==null)&&(Iv(),Ev())}}function Sc(i,s){var l=i.stateNode;if(l===null)return null;var f=lp(l);if(f===null)return null;l=f[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(Re(231,s,typeof l));return l}var vm=!1;if(Os)try{var ec={};Object.defineProperty(ec,"passive",{get:function(){vm=!0}}),window.addEventListener("test",ec,ec),window.removeEventListener("test",ec,ec)}catch{vm=!1}function n2(i,s,l,f,_,T,x,d,U){var ee=Array.prototype.slice.call(arguments,3);try{s.apply(l,ee)}catch(de){this.onError(de)}}var pc=!1,Dd=null,Ld=!1,xm=null,s2={onError:function(i){pc=!0,Dd=i}};function o2(i,s,l,f,_,T,x,d,U){pc=!1,Dd=null,n2.apply(s2,arguments)}function a2(i,s,l,f,_,T,x,d,U){if(o2.apply(this,arguments),pc){if(pc){var ee=Dd;pc=!1,Dd=null}else throw Error(Re(198));Ld||(Ld=!0,xm=ee)}}function ka(i){var s=i,l=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,s.flags&4098&&(l=s.return),i=s.return;while(i)}return s.tag===3?l:null}function Pv(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function j_(i){if(ka(i)!==i)throw Error(Re(188))}function l2(i){var s=i.alternate;if(!s){if(s=ka(i),s===null)throw Error(Re(188));return s!==i?null:i}for(var l=i,f=s;;){var _=l.return;if(_===null)break;var T=_.alternate;if(T===null){if(f=_.return,f!==null){l=f;continue}break}if(_.child===T.child){for(T=_.child;T;){if(T===l)return j_(_),i;if(T===f)return j_(_),s;T=T.sibling}throw Error(Re(188))}if(l.return!==f.return)l=_,f=T;else{for(var x=!1,d=_.child;d;){if(d===l){x=!0,l=_,f=T;break}if(d===f){x=!0,f=_,l=T;break}d=d.sibling}if(!x){for(d=T.child;d;){if(d===l){x=!0,l=T,f=_;break}if(d===f){x=!0,f=T,l=_;break}d=d.sibling}if(!x)throw Error(Re(189))}}if(l.alternate!==f)throw Error(Re(190))}if(l.tag!==3)throw Error(Re(188));return l.stateNode.current===l?i:s}function Av(i){return i=l2(i),i!==null?zv(i):null}function zv(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=zv(i);if(s!==null)return s;i=i.sibling}return null}var Mv=un.unstable_scheduleCallback,$_=un.unstable_cancelCallback,u2=un.unstable_shouldYield,c2=un.unstable_requestPaint,Ci=un.unstable_now,h2=un.unstable_getCurrentPriorityLevel,pg=un.unstable_ImmediatePriority,Dv=un.unstable_UserBlockingPriority,Rd=un.unstable_NormalPriority,d2=un.unstable_LowPriority,Lv=un.unstable_IdlePriority,np=null,os=null;function p2(i){if(os&&typeof os.onCommitFiberRoot=="function")try{os.onCommitFiberRoot(np,i,void 0,(i.current.flags&128)===128)}catch{}}var Un=Math.clz32?Math.clz32:g2,f2=Math.log,m2=Math.LN2;function g2(i){return i>>>=0,i===0?32:31-(f2(i)/m2|0)|0}var nd=64,sd=4194304;function cc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Fd(i,s){var l=i.pendingLanes;if(l===0)return 0;var f=0,_=i.suspendedLanes,T=i.pingedLanes,x=l&268435455;if(x!==0){var d=x&~_;d!==0?f=cc(d):(T&=x,T!==0&&(f=cc(T)))}else x=l&~_,x!==0?f=cc(x):T!==0&&(f=cc(T));if(f===0)return 0;if(s!==0&&s!==f&&!(s&_)&&(_=f&-f,T=s&-s,_>=T||_===16&&(T&4194240)!==0))return s;if(f&4&&(f|=l&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=f;0<s;)l=31-Un(s),_=1<<l,f|=i[l],s&=~_;return f}function y2(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _2(i,s){for(var l=i.suspendedLanes,f=i.pingedLanes,_=i.expirationTimes,T=i.pendingLanes;0<T;){var x=31-Un(T),d=1<<x,U=_[x];U===-1?(!(d&l)||d&f)&&(_[x]=y2(d,s)):U<=s&&(i.expiredLanes|=d),T&=~d}}function wm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Rv(){var i=nd;return nd<<=1,!(nd&4194240)&&(nd=64),i}function Df(i){for(var s=[],l=0;31>l;l++)s.push(i);return s}function Vc(i,s,l){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-Un(s),i[s]=l}function v2(i,s){var l=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var f=i.eventTimes;for(i=i.expirationTimes;0<l;){var _=31-Un(l),T=1<<_;s[_]=0,f[_]=-1,i[_]=-1,l&=~T}}function fg(i,s){var l=i.entangledLanes|=s;for(i=i.entanglements;l;){var f=31-Un(l),_=1<<f;_&s|i[f]&s&&(i[f]|=s),l&=~_}}var qt=0;function Fv(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Bv,mg,Ov,Nv,Vv,bm=!1,od=[],Po=null,Ao=null,zo=null,Tc=new Map,Ec=new Map,Eo=[],x2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function q_(i,s){switch(i){case"focusin":case"focusout":Po=null;break;case"dragenter":case"dragleave":Ao=null;break;case"mouseover":case"mouseout":zo=null;break;case"pointerover":case"pointerout":Tc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ec.delete(s.pointerId)}}function tc(i,s,l,f,_,T){return i===null||i.nativeEvent!==T?(i={blockedOn:s,domEventName:l,eventSystemFlags:f,nativeEvent:T,targetContainers:[_]},s!==null&&(s=jc(s),s!==null&&mg(s)),i):(i.eventSystemFlags|=f,s=i.targetContainers,_!==null&&s.indexOf(_)===-1&&s.push(_),i)}function w2(i,s,l,f,_){switch(s){case"focusin":return Po=tc(Po,i,s,l,f,_),!0;case"dragenter":return Ao=tc(Ao,i,s,l,f,_),!0;case"mouseover":return zo=tc(zo,i,s,l,f,_),!0;case"pointerover":var T=_.pointerId;return Tc.set(T,tc(Tc.get(T)||null,i,s,l,f,_)),!0;case"gotpointercapture":return T=_.pointerId,Ec.set(T,tc(Ec.get(T)||null,i,s,l,f,_)),!0}return!1}function Uv(i){var s=ma(i.target);if(s!==null){var l=ka(s);if(l!==null){if(s=l.tag,s===13){if(s=Pv(l),s!==null){i.blockedOn=s,Vv(i.priority,function(){Ov(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function vd(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var l=Sm(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(l===null){l=i.nativeEvent;var f=new l.constructor(l.type,l);ym=f,l.target.dispatchEvent(f),ym=null}else return s=jc(l),s!==null&&mg(s),i.blockedOn=l,!1;s.shift()}return!0}function Z_(i,s,l){vd(i)&&l.delete(s)}function b2(){bm=!1,Po!==null&&vd(Po)&&(Po=null),Ao!==null&&vd(Ao)&&(Ao=null),zo!==null&&vd(zo)&&(zo=null),Tc.forEach(Z_),Ec.forEach(Z_)}function ic(i,s){i.blockedOn===s&&(i.blockedOn=null,bm||(bm=!0,un.unstable_scheduleCallback(un.unstable_NormalPriority,b2)))}function kc(i){function s(_){return ic(_,i)}if(0<od.length){ic(od[0],i);for(var l=1;l<od.length;l++){var f=od[l];f.blockedOn===i&&(f.blockedOn=null)}}for(Po!==null&&ic(Po,i),Ao!==null&&ic(Ao,i),zo!==null&&ic(zo,i),Tc.forEach(s),Ec.forEach(s),l=0;l<Eo.length;l++)f=Eo[l],f.blockedOn===i&&(f.blockedOn=null);for(;0<Eo.length&&(l=Eo[0],l.blockedOn===null);)Uv(l),l.blockedOn===null&&Eo.shift()}var Cl=js.ReactCurrentBatchConfig,Bd=!0;function S2(i,s,l,f){var _=qt,T=Cl.transition;Cl.transition=null;try{qt=1,gg(i,s,l,f)}finally{qt=_,Cl.transition=T}}function T2(i,s,l,f){var _=qt,T=Cl.transition;Cl.transition=null;try{qt=4,gg(i,s,l,f)}finally{qt=_,Cl.transition=T}}function gg(i,s,l,f){if(Bd){var _=Sm(i,s,l,f);if(_===null)$f(i,s,f,Od,l),q_(i,f);else if(w2(_,i,s,l,f))f.stopPropagation();else if(q_(i,f),s&4&&-1<x2.indexOf(i)){for(;_!==null;){var T=jc(_);if(T!==null&&Bv(T),T=Sm(i,s,l,f),T===null&&$f(i,s,f,Od,l),T===_)break;_=T}_!==null&&f.stopPropagation()}else $f(i,s,f,null,l)}}var Od=null;function Sm(i,s,l,f){if(Od=null,i=dg(f),i=ma(i),i!==null)if(s=ka(i),s===null)i=null;else if(l=s.tag,l===13){if(i=Pv(s),i!==null)return i;i=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return Od=i,null}function jv(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(h2()){case pg:return 1;case Dv:return 4;case Rd:case d2:return 16;case Lv:return 536870912;default:return 16}default:return 16}}var Io=null,yg=null,xd=null;function $v(){if(xd)return xd;var i,s=yg,l=s.length,f,_="value"in Io?Io.value:Io.textContent,T=_.length;for(i=0;i<l&&s[i]===_[i];i++);var x=l-i;for(f=1;f<=x&&s[l-f]===_[T-f];f++);return xd=_.slice(i,1<f?1-f:void 0)}function wd(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function ad(){return!0}function H_(){return!1}function hn(i){function s(l,f,_,T,x){this._reactName=l,this._targetInst=_,this.type=f,this.nativeEvent=T,this.target=x,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(l=i[d],this[d]=l?l(T):T[d]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ad:H_,this.isPropagationStopped=H_,this}return gi(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=ad)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=ad)},persist:function(){},isPersistent:ad}),s}var Ul={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_g=hn(Ul),Uc=gi({},Ul,{view:0,detail:0}),E2=hn(Uc),Lf,Rf,rc,sp=gi({},Uc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==rc&&(rc&&i.type==="mousemove"?(Lf=i.screenX-rc.screenX,Rf=i.screenY-rc.screenY):Rf=Lf=0,rc=i),Lf)},movementY:function(i){return"movementY"in i?i.movementY:Rf}}),G_=hn(sp),k2=gi({},sp,{dataTransfer:0}),I2=hn(k2),C2=gi({},Uc,{relatedTarget:0}),Ff=hn(C2),P2=gi({},Ul,{animationName:0,elapsedTime:0,pseudoElement:0}),A2=hn(P2),z2=gi({},Ul,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),M2=hn(z2),D2=gi({},Ul,{data:0}),W_=hn(D2),L2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},R2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},F2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function B2(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=F2[i])?!!s[i]:!1}function vg(){return B2}var O2=gi({},Uc,{key:function(i){if(i.key){var s=L2[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=wd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?R2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vg,charCode:function(i){return i.type==="keypress"?wd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?wd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),N2=hn(O2),V2=gi({},sp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),K_=hn(V2),U2=gi({},Uc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vg}),j2=hn(U2),$2=gi({},Ul,{propertyName:0,elapsedTime:0,pseudoElement:0}),q2=hn($2),Z2=gi({},sp,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),H2=hn(Z2),G2=[9,13,27,32],xg=Os&&"CompositionEvent"in window,fc=null;Os&&"documentMode"in document&&(fc=document.documentMode);var W2=Os&&"TextEvent"in window&&!fc,qv=Os&&(!xg||fc&&8<fc&&11>=fc),X_=" ",Y_=!1;function Zv(i,s){switch(i){case"keyup":return G2.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hv(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ml=!1;function K2(i,s){switch(i){case"compositionend":return Hv(s);case"keypress":return s.which!==32?null:(Y_=!0,X_);case"textInput":return i=s.data,i===X_&&Y_?null:i;default:return null}}function X2(i,s){if(ml)return i==="compositionend"||!xg&&Zv(i,s)?(i=$v(),xd=yg=Io=null,ml=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return qv&&s.locale!=="ko"?null:s.data;default:return null}}var Y2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J_(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Y2[i.type]:s==="textarea"}function Gv(i,s,l,f){Tv(f),s=Nd(s,"onChange"),0<s.length&&(l=new _g("onChange","change",null,l,f),i.push({event:l,listeners:s}))}var mc=null,Ic=null;function J2(i){nx(i,0)}function op(i){var s=_l(i);if(yv(s))return i}function Q2(i,s){if(i==="change")return s}var Wv=!1;if(Os){var Bf;if(Os){var Of="oninput"in document;if(!Of){var Q_=document.createElement("div");Q_.setAttribute("oninput","return;"),Of=typeof Q_.oninput=="function"}Bf=Of}else Bf=!1;Wv=Bf&&(!document.documentMode||9<document.documentMode)}function e0(){mc&&(mc.detachEvent("onpropertychange",Kv),Ic=mc=null)}function Kv(i){if(i.propertyName==="value"&&op(Ic)){var s=[];Gv(s,Ic,i,dg(i)),Cv(J2,s)}}function eS(i,s,l){i==="focusin"?(e0(),mc=s,Ic=l,mc.attachEvent("onpropertychange",Kv)):i==="focusout"&&e0()}function tS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return op(Ic)}function iS(i,s){if(i==="click")return op(s)}function rS(i,s){if(i==="input"||i==="change")return op(s)}function nS(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var $n=typeof Object.is=="function"?Object.is:nS;function Cc(i,s){if($n(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var l=Object.keys(i),f=Object.keys(s);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var _=l[f];if(!sm.call(s,_)||!$n(i[_],s[_]))return!1}return!0}function t0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function i0(i,s){var l=t0(i);i=0;for(var f;l;){if(l.nodeType===3){if(f=i+l.textContent.length,i<=s&&f>=s)return{node:l,offset:s-i};i=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=t0(l)}}function Xv(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Xv(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Yv(){for(var i=window,s=Md();s instanceof i.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)i=s.contentWindow;else break;s=Md(i.document)}return s}function wg(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function sS(i){var s=Yv(),l=i.focusedElem,f=i.selectionRange;if(s!==l&&l&&l.ownerDocument&&Xv(l.ownerDocument.documentElement,l)){if(f!==null&&wg(l)){if(s=f.start,i=f.end,i===void 0&&(i=s),"selectionStart"in l)l.selectionStart=s,l.selectionEnd=Math.min(i,l.value.length);else if(i=(s=l.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var _=l.textContent.length,T=Math.min(f.start,_);f=f.end===void 0?T:Math.min(f.end,_),!i.extend&&T>f&&(_=f,f=T,T=_),_=i0(l,T);var x=i0(l,f);_&&x&&(i.rangeCount!==1||i.anchorNode!==_.node||i.anchorOffset!==_.offset||i.focusNode!==x.node||i.focusOffset!==x.offset)&&(s=s.createRange(),s.setStart(_.node,_.offset),i.removeAllRanges(),T>f?(i.addRange(s),i.extend(x.node,x.offset)):(s.setEnd(x.node,x.offset),i.addRange(s)))}}for(s=[],i=l;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<s.length;l++)i=s[l],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var oS=Os&&"documentMode"in document&&11>=document.documentMode,gl=null,Tm=null,gc=null,Em=!1;function r0(i,s,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Em||gl==null||gl!==Md(f)||(f=gl,"selectionStart"in f&&wg(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),gc&&Cc(gc,f)||(gc=f,f=Nd(Tm,"onSelect"),0<f.length&&(s=new _g("onSelect","select",null,s,l),i.push({event:s,listeners:f}),s.target=gl)))}function ld(i,s){var l={};return l[i.toLowerCase()]=s.toLowerCase(),l["Webkit"+i]="webkit"+s,l["Moz"+i]="moz"+s,l}var yl={animationend:ld("Animation","AnimationEnd"),animationiteration:ld("Animation","AnimationIteration"),animationstart:ld("Animation","AnimationStart"),transitionend:ld("Transition","TransitionEnd")},Nf={},Jv={};Os&&(Jv=document.createElement("div").style,"AnimationEvent"in window||(delete yl.animationend.animation,delete yl.animationiteration.animation,delete yl.animationstart.animation),"TransitionEvent"in window||delete yl.transitionend.transition);function ap(i){if(Nf[i])return Nf[i];if(!yl[i])return i;var s=yl[i],l;for(l in s)if(s.hasOwnProperty(l)&&l in Jv)return Nf[i]=s[l];return i}var Qv=ap("animationend"),ex=ap("animationiteration"),tx=ap("animationstart"),ix=ap("transitionend"),rx=new Map,n0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function No(i,s){rx.set(i,s),Ea(s,[i])}for(var Vf=0;Vf<n0.length;Vf++){var Uf=n0[Vf],aS=Uf.toLowerCase(),lS=Uf[0].toUpperCase()+Uf.slice(1);No(aS,"on"+lS)}No(Qv,"onAnimationEnd");No(ex,"onAnimationIteration");No(tx,"onAnimationStart");No("dblclick","onDoubleClick");No("focusin","onFocus");No("focusout","onBlur");No(ix,"onTransitionEnd");Ml("onMouseEnter",["mouseout","mouseover"]);Ml("onMouseLeave",["mouseout","mouseover"]);Ml("onPointerEnter",["pointerout","pointerover"]);Ml("onPointerLeave",["pointerout","pointerover"]);Ea("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ea("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ea("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ea("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ea("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ea("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uS=new Set("cancel close invalid load scroll toggle".split(" ").concat(hc));function s0(i,s,l){var f=i.type||"unknown-event";i.currentTarget=l,a2(f,s,void 0,i),i.currentTarget=null}function nx(i,s){s=(s&4)!==0;for(var l=0;l<i.length;l++){var f=i[l],_=f.event;f=f.listeners;e:{var T=void 0;if(s)for(var x=f.length-1;0<=x;x--){var d=f[x],U=d.instance,ee=d.currentTarget;if(d=d.listener,U!==T&&_.isPropagationStopped())break e;s0(_,d,ee),T=U}else for(x=0;x<f.length;x++){if(d=f[x],U=d.instance,ee=d.currentTarget,d=d.listener,U!==T&&_.isPropagationStopped())break e;s0(_,d,ee),T=U}}}if(Ld)throw i=xm,Ld=!1,xm=null,i}function ri(i,s){var l=s[Am];l===void 0&&(l=s[Am]=new Set);var f=i+"__bubble";l.has(f)||(sx(s,i,2,!1),l.add(f))}function jf(i,s,l){var f=0;s&&(f|=4),sx(l,i,f,s)}var ud="_reactListening"+Math.random().toString(36).slice(2);function Pc(i){if(!i[ud]){i[ud]=!0,dv.forEach(function(l){l!=="selectionchange"&&(uS.has(l)||jf(l,!1,i),jf(l,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[ud]||(s[ud]=!0,jf("selectionchange",!1,s))}}function sx(i,s,l,f){switch(jv(s)){case 1:var _=S2;break;case 4:_=T2;break;default:_=gg}l=_.bind(null,s,l,i),_=void 0,!vm||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(_=!0),f?_!==void 0?i.addEventListener(s,l,{capture:!0,passive:_}):i.addEventListener(s,l,!0):_!==void 0?i.addEventListener(s,l,{passive:_}):i.addEventListener(s,l,!1)}function $f(i,s,l,f,_){var T=f;if(!(s&1)&&!(s&2)&&f!==null)e:for(;;){if(f===null)return;var x=f.tag;if(x===3||x===4){var d=f.stateNode.containerInfo;if(d===_||d.nodeType===8&&d.parentNode===_)break;if(x===4)for(x=f.return;x!==null;){var U=x.tag;if((U===3||U===4)&&(U=x.stateNode.containerInfo,U===_||U.nodeType===8&&U.parentNode===_))return;x=x.return}for(;d!==null;){if(x=ma(d),x===null)return;if(U=x.tag,U===5||U===6){f=T=x;continue e}d=d.parentNode}}f=f.return}Cv(function(){var ee=T,de=dg(l),H=[];e:{var G=rx.get(i);if(G!==void 0){var Me=_g,xe=i;switch(i){case"keypress":if(wd(l)===0)break e;case"keydown":case"keyup":Me=N2;break;case"focusin":xe="focus",Me=Ff;break;case"focusout":xe="blur",Me=Ff;break;case"beforeblur":case"afterblur":Me=Ff;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Me=G_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Me=I2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Me=j2;break;case Qv:case ex:case tx:Me=A2;break;case ix:Me=q2;break;case"scroll":Me=E2;break;case"wheel":Me=H2;break;case"copy":case"cut":case"paste":Me=M2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Me=K_}var we=(s&4)!==0,at=!we&&i==="scroll",ae=we?G!==null?G+"Capture":null:G;we=[];for(var ie=ee,ue;ie!==null;){ue=ie;var ke=ue.stateNode;if(ue.tag===5&&ke!==null&&(ue=ke,ae!==null&&(ke=Sc(ie,ae),ke!=null&&we.push(Ac(ie,ke,ue)))),at)break;ie=ie.return}0<we.length&&(G=new Me(G,xe,null,l,de),H.push({event:G,listeners:we}))}}if(!(s&7)){e:{if(G=i==="mouseover"||i==="pointerover",Me=i==="mouseout"||i==="pointerout",G&&l!==ym&&(xe=l.relatedTarget||l.fromElement)&&(ma(xe)||xe[Ns]))break e;if((Me||G)&&(G=de.window===de?de:(G=de.ownerDocument)?G.defaultView||G.parentWindow:window,Me?(xe=l.relatedTarget||l.toElement,Me=ee,xe=xe?ma(xe):null,xe!==null&&(at=ka(xe),xe!==at||xe.tag!==5&&xe.tag!==6)&&(xe=null)):(Me=null,xe=ee),Me!==xe)){if(we=G_,ke="onMouseLeave",ae="onMouseEnter",ie="mouse",(i==="pointerout"||i==="pointerover")&&(we=K_,ke="onPointerLeave",ae="onPointerEnter",ie="pointer"),at=Me==null?G:_l(Me),ue=xe==null?G:_l(xe),G=new we(ke,ie+"leave",Me,l,de),G.target=at,G.relatedTarget=ue,ke=null,ma(de)===ee&&(we=new we(ae,ie+"enter",xe,l,de),we.target=ue,we.relatedTarget=at,ke=we),at=ke,Me&&xe)t:{for(we=Me,ae=xe,ie=0,ue=we;ue;ue=dl(ue))ie++;for(ue=0,ke=ae;ke;ke=dl(ke))ue++;for(;0<ie-ue;)we=dl(we),ie--;for(;0<ue-ie;)ae=dl(ae),ue--;for(;ie--;){if(we===ae||ae!==null&&we===ae.alternate)break t;we=dl(we),ae=dl(ae)}we=null}else we=null;Me!==null&&o0(H,G,Me,we,!1),xe!==null&&at!==null&&o0(H,at,xe,we,!0)}}e:{if(G=ee?_l(ee):window,Me=G.nodeName&&G.nodeName.toLowerCase(),Me==="select"||Me==="input"&&G.type==="file")var qe=Q2;else if(J_(G))if(Wv)qe=rS;else{qe=tS;var Je=eS}else(Me=G.nodeName)&&Me.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(qe=iS);if(qe&&(qe=qe(i,ee))){Gv(H,qe,l,de);break e}Je&&Je(i,G,ee),i==="focusout"&&(Je=G._wrapperState)&&Je.controlled&&G.type==="number"&&dm(G,"number",G.value)}switch(Je=ee?_l(ee):window,i){case"focusin":(J_(Je)||Je.contentEditable==="true")&&(gl=Je,Tm=ee,gc=null);break;case"focusout":gc=Tm=gl=null;break;case"mousedown":Em=!0;break;case"contextmenu":case"mouseup":case"dragend":Em=!1,r0(H,l,de);break;case"selectionchange":if(oS)break;case"keydown":case"keyup":r0(H,l,de)}var Ge;if(xg)e:{switch(i){case"compositionstart":var et="onCompositionStart";break e;case"compositionend":et="onCompositionEnd";break e;case"compositionupdate":et="onCompositionUpdate";break e}et=void 0}else ml?Zv(i,l)&&(et="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(et="onCompositionStart");et&&(qv&&l.locale!=="ko"&&(ml||et!=="onCompositionStart"?et==="onCompositionEnd"&&ml&&(Ge=$v()):(Io=de,yg="value"in Io?Io.value:Io.textContent,ml=!0)),Je=Nd(ee,et),0<Je.length&&(et=new W_(et,i,null,l,de),H.push({event:et,listeners:Je}),Ge?et.data=Ge:(Ge=Hv(l),Ge!==null&&(et.data=Ge)))),(Ge=W2?K2(i,l):X2(i,l))&&(ee=Nd(ee,"onBeforeInput"),0<ee.length&&(de=new W_("onBeforeInput","beforeinput",null,l,de),H.push({event:de,listeners:ee}),de.data=Ge))}nx(H,s)})}function Ac(i,s,l){return{instance:i,listener:s,currentTarget:l}}function Nd(i,s){for(var l=s+"Capture",f=[];i!==null;){var _=i,T=_.stateNode;_.tag===5&&T!==null&&(_=T,T=Sc(i,l),T!=null&&f.unshift(Ac(i,T,_)),T=Sc(i,s),T!=null&&f.push(Ac(i,T,_))),i=i.return}return f}function dl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function o0(i,s,l,f,_){for(var T=s._reactName,x=[];l!==null&&l!==f;){var d=l,U=d.alternate,ee=d.stateNode;if(U!==null&&U===f)break;d.tag===5&&ee!==null&&(d=ee,_?(U=Sc(l,T),U!=null&&x.unshift(Ac(l,U,d))):_||(U=Sc(l,T),U!=null&&x.push(Ac(l,U,d)))),l=l.return}x.length!==0&&i.push({event:s,listeners:x})}var cS=/\r\n?/g,hS=/\u0000|\uFFFD/g;function a0(i){return(typeof i=="string"?i:""+i).replace(cS,`
`).replace(hS,"")}function cd(i,s,l){if(s=a0(s),a0(i)!==s&&l)throw Error(Re(425))}function Vd(){}var km=null,Im=null;function Cm(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Pm=typeof setTimeout=="function"?setTimeout:void 0,dS=typeof clearTimeout=="function"?clearTimeout:void 0,l0=typeof Promise=="function"?Promise:void 0,pS=typeof queueMicrotask=="function"?queueMicrotask:typeof l0<"u"?function(i){return l0.resolve(null).then(i).catch(fS)}:Pm;function fS(i){setTimeout(function(){throw i})}function qf(i,s){var l=s,f=0;do{var _=l.nextSibling;if(i.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(f===0){i.removeChild(_),kc(s);return}f--}else l!=="$"&&l!=="$?"&&l!=="$!"||f++;l=_}while(l);kc(s)}function Mo(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function u0(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return i;s--}else l==="/$"&&s++}i=i.previousSibling}return null}var jl=Math.random().toString(36).slice(2),ns="__reactFiber$"+jl,zc="__reactProps$"+jl,Ns="__reactContainer$"+jl,Am="__reactEvents$"+jl,mS="__reactListeners$"+jl,gS="__reactHandles$"+jl;function ma(i){var s=i[ns];if(s)return s;for(var l=i.parentNode;l;){if(s=l[Ns]||l[ns]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(i=u0(i);i!==null;){if(l=i[ns])return l;i=u0(i)}return s}i=l,l=i.parentNode}return null}function jc(i){return i=i[ns]||i[Ns],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function _l(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Re(33))}function lp(i){return i[zc]||null}var zm=[],vl=-1;function Vo(i){return{current:i}}function ni(i){0>vl||(i.current=zm[vl],zm[vl]=null,vl--)}function Qt(i,s){vl++,zm[vl]=i.current,i.current=s}var Oo={},vr=Vo(Oo),Zr=Vo(!1),xa=Oo;function Dl(i,s){var l=i.type.contextTypes;if(!l)return Oo;var f=i.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===s)return f.__reactInternalMemoizedMaskedChildContext;var _={},T;for(T in l)_[T]=s[T];return f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=_),_}function Hr(i){return i=i.childContextTypes,i!=null}function Ud(){ni(Zr),ni(vr)}function c0(i,s,l){if(vr.current!==Oo)throw Error(Re(168));Qt(vr,s),Qt(Zr,l)}function ox(i,s,l){var f=i.stateNode;if(s=s.childContextTypes,typeof f.getChildContext!="function")return l;f=f.getChildContext();for(var _ in f)if(!(_ in s))throw Error(Re(108,e2(i)||"Unknown",_));return gi({},l,f)}function jd(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Oo,xa=vr.current,Qt(vr,i),Qt(Zr,Zr.current),!0}function h0(i,s,l){var f=i.stateNode;if(!f)throw Error(Re(169));l?(i=ox(i,s,xa),f.__reactInternalMemoizedMergedChildContext=i,ni(Zr),ni(vr),Qt(vr,i)):ni(Zr),Qt(Zr,l)}var Ds=null,up=!1,Zf=!1;function ax(i){Ds===null?Ds=[i]:Ds.push(i)}function yS(i){up=!0,ax(i)}function Uo(){if(!Zf&&Ds!==null){Zf=!0;var i=0,s=qt;try{var l=Ds;for(qt=1;i<l.length;i++){var f=l[i];do f=f(!0);while(f!==null)}Ds=null,up=!1}catch(_){throw Ds!==null&&(Ds=Ds.slice(i+1)),Mv(pg,Uo),_}finally{qt=s,Zf=!1}}return null}var xl=[],wl=0,$d=null,qd=0,bn=[],Sn=0,wa=null,Ls=1,Rs="";function pa(i,s){xl[wl++]=qd,xl[wl++]=$d,$d=i,qd=s}function lx(i,s,l){bn[Sn++]=Ls,bn[Sn++]=Rs,bn[Sn++]=wa,wa=i;var f=Ls;i=Rs;var _=32-Un(f)-1;f&=~(1<<_),l+=1;var T=32-Un(s)+_;if(30<T){var x=_-_%5;T=(f&(1<<x)-1).toString(32),f>>=x,_-=x,Ls=1<<32-Un(s)+_|l<<_|f,Rs=T+i}else Ls=1<<T|l<<_|f,Rs=i}function bg(i){i.return!==null&&(pa(i,1),lx(i,1,0))}function Sg(i){for(;i===$d;)$d=xl[--wl],xl[wl]=null,qd=xl[--wl],xl[wl]=null;for(;i===wa;)wa=bn[--Sn],bn[Sn]=null,Rs=bn[--Sn],bn[Sn]=null,Ls=bn[--Sn],bn[Sn]=null}var ln=null,an=null,ui=!1,Vn=null;function ux(i,s){var l=Tn(5,null,null,0);l.elementType="DELETED",l.stateNode=s,l.return=i,s=i.deletions,s===null?(i.deletions=[l],i.flags|=16):s.push(l)}function d0(i,s){switch(i.tag){case 5:var l=i.type;return s=s.nodeType!==1||l.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,ln=i,an=Mo(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,ln=i,an=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(l=wa!==null?{id:Ls,overflow:Rs}:null,i.memoizedState={dehydrated:s,treeContext:l,retryLane:1073741824},l=Tn(18,null,null,0),l.stateNode=s,l.return=i,i.child=l,ln=i,an=null,!0):!1;default:return!1}}function Mm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Dm(i){if(ui){var s=an;if(s){var l=s;if(!d0(i,s)){if(Mm(i))throw Error(Re(418));s=Mo(l.nextSibling);var f=ln;s&&d0(i,s)?ux(f,l):(i.flags=i.flags&-4097|2,ui=!1,ln=i)}}else{if(Mm(i))throw Error(Re(418));i.flags=i.flags&-4097|2,ui=!1,ln=i}}}function p0(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;ln=i}function hd(i){if(i!==ln)return!1;if(!ui)return p0(i),ui=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!Cm(i.type,i.memoizedProps)),s&&(s=an)){if(Mm(i))throw cx(),Error(Re(418));for(;s;)ux(i,s),s=Mo(s.nextSibling)}if(p0(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Re(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"){if(s===0){an=Mo(i.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++}i=i.nextSibling}an=null}}else an=ln?Mo(i.stateNode.nextSibling):null;return!0}function cx(){for(var i=an;i;)i=Mo(i.nextSibling)}function Ll(){an=ln=null,ui=!1}function Tg(i){Vn===null?Vn=[i]:Vn.push(i)}var _S=js.ReactCurrentBatchConfig;function On(i,s){if(i&&i.defaultProps){s=gi({},s),i=i.defaultProps;for(var l in i)s[l]===void 0&&(s[l]=i[l]);return s}return s}var Zd=Vo(null),Hd=null,bl=null,Eg=null;function kg(){Eg=bl=Hd=null}function Ig(i){var s=Zd.current;ni(Zd),i._currentValue=s}function Lm(i,s,l){for(;i!==null;){var f=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,f!==null&&(f.childLanes|=s)):f!==null&&(f.childLanes&s)!==s&&(f.childLanes|=s),i===l)break;i=i.return}}function Pl(i,s){Hd=i,Eg=bl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&s&&(qr=!0),i.firstContext=null)}function In(i){var s=i._currentValue;if(Eg!==i)if(i={context:i,memoizedValue:s,next:null},bl===null){if(Hd===null)throw Error(Re(308));bl=i,Hd.dependencies={lanes:0,firstContext:i}}else bl=bl.next=i;return s}var ga=null;function Cg(i){ga===null?ga=[i]:ga.push(i)}function hx(i,s,l,f){var _=s.interleaved;return _===null?(l.next=l,Cg(s)):(l.next=_.next,_.next=l),s.interleaved=l,Vs(i,f)}function Vs(i,s){i.lanes|=s;var l=i.alternate;for(l!==null&&(l.lanes|=s),l=i,i=i.return;i!==null;)i.childLanes|=s,l=i.alternate,l!==null&&(l.childLanes|=s),l=i,i=i.return;return l.tag===3?l.stateNode:null}var To=!1;function Pg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dx(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Fs(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function Do(i,s,l){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,Lt&2){var _=f.pending;return _===null?s.next=s:(s.next=_.next,_.next=s),f.pending=s,Vs(i,l)}return _=f.interleaved,_===null?(s.next=s,Cg(f)):(s.next=_.next,_.next=s),f.interleaved=s,Vs(i,l)}function bd(i,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194240)!==0)){var f=s.lanes;f&=i.pendingLanes,l|=f,s.lanes=l,fg(i,l)}}function f0(i,s){var l=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var _=null,T=null;if(l=l.firstBaseUpdate,l!==null){do{var x={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};T===null?_=T=x:T=T.next=x,l=l.next}while(l!==null);T===null?_=T=s:T=T.next=s}else _=T=s;l={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:T,shared:f.shared,effects:f.effects},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=s:i.next=s,l.lastBaseUpdate=s}function Gd(i,s,l,f){var _=i.updateQueue;To=!1;var T=_.firstBaseUpdate,x=_.lastBaseUpdate,d=_.shared.pending;if(d!==null){_.shared.pending=null;var U=d,ee=U.next;U.next=null,x===null?T=ee:x.next=ee,x=U;var de=i.alternate;de!==null&&(de=de.updateQueue,d=de.lastBaseUpdate,d!==x&&(d===null?de.firstBaseUpdate=ee:d.next=ee,de.lastBaseUpdate=U))}if(T!==null){var H=_.baseState;x=0,de=ee=U=null,d=T;do{var G=d.lane,Me=d.eventTime;if((f&G)===G){de!==null&&(de=de.next={eventTime:Me,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var xe=i,we=d;switch(G=s,Me=l,we.tag){case 1:if(xe=we.payload,typeof xe=="function"){H=xe.call(Me,H,G);break e}H=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=we.payload,G=typeof xe=="function"?xe.call(Me,H,G):xe,G==null)break e;H=gi({},H,G);break e;case 2:To=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,G=_.effects,G===null?_.effects=[d]:G.push(d))}else Me={eventTime:Me,lane:G,tag:d.tag,payload:d.payload,callback:d.callback,next:null},de===null?(ee=de=Me,U=H):de=de.next=Me,x|=G;if(d=d.next,d===null){if(d=_.shared.pending,d===null)break;G=d,d=G.next,G.next=null,_.lastBaseUpdate=G,_.shared.pending=null}}while(!0);if(de===null&&(U=H),_.baseState=U,_.firstBaseUpdate=ee,_.lastBaseUpdate=de,s=_.shared.interleaved,s!==null){_=s;do x|=_.lane,_=_.next;while(_!==s)}else T===null&&(_.shared.lanes=0);Sa|=x,i.lanes=x,i.memoizedState=H}}function m0(i,s,l){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var f=i[s],_=f.callback;if(_!==null){if(f.callback=null,f=l,typeof _!="function")throw Error(Re(191,_));_.call(f)}}}var px=new hv.Component().refs;function Rm(i,s,l,f){s=i.memoizedState,l=l(f,s),l=l==null?s:gi({},s,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var cp={isMounted:function(i){return(i=i._reactInternals)?ka(i)===i:!1},enqueueSetState:function(i,s,l){i=i._reactInternals;var f=Lr(),_=Ro(i),T=Fs(f,_);T.payload=s,l!=null&&(T.callback=l),s=Do(i,T,_),s!==null&&(jn(s,i,_,f),bd(s,i,_))},enqueueReplaceState:function(i,s,l){i=i._reactInternals;var f=Lr(),_=Ro(i),T=Fs(f,_);T.tag=1,T.payload=s,l!=null&&(T.callback=l),s=Do(i,T,_),s!==null&&(jn(s,i,_,f),bd(s,i,_))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var l=Lr(),f=Ro(i),_=Fs(l,f);_.tag=2,s!=null&&(_.callback=s),s=Do(i,_,f),s!==null&&(jn(s,i,f,l),bd(s,i,f))}};function g0(i,s,l,f,_,T,x){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,T,x):s.prototype&&s.prototype.isPureReactComponent?!Cc(l,f)||!Cc(_,T):!0}function fx(i,s,l){var f=!1,_=Oo,T=s.contextType;return typeof T=="object"&&T!==null?T=In(T):(_=Hr(s)?xa:vr.current,f=s.contextTypes,T=(f=f!=null)?Dl(i,_):Oo),s=new s(l,T),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=cp,i.stateNode=s,s._reactInternals=i,f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=_,i.__reactInternalMemoizedMaskedChildContext=T),s}function y0(i,s,l,f){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,f),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,f),s.state!==i&&cp.enqueueReplaceState(s,s.state,null)}function Fm(i,s,l,f){var _=i.stateNode;_.props=l,_.state=i.memoizedState,_.refs=px,Pg(i);var T=s.contextType;typeof T=="object"&&T!==null?_.context=In(T):(T=Hr(s)?xa:vr.current,_.context=Dl(i,T)),_.state=i.memoizedState,T=s.getDerivedStateFromProps,typeof T=="function"&&(Rm(i,s,T,l),_.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(s=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),s!==_.state&&cp.enqueueReplaceState(_,_.state,null),Gd(i,l,_,f),_.state=i.memoizedState),typeof _.componentDidMount=="function"&&(i.flags|=4194308)}function nc(i,s,l){if(i=l.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Re(309));var f=l.stateNode}if(!f)throw Error(Re(147,i));var _=f,T=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===T?s.ref:(s=function(x){var d=_.refs;d===px&&(d=_.refs={}),x===null?delete d[T]:d[T]=x},s._stringRef=T,s)}if(typeof i!="string")throw Error(Re(284));if(!l._owner)throw Error(Re(290,i))}return i}function dd(i,s){throw i=Object.prototype.toString.call(s),Error(Re(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function _0(i){var s=i._init;return s(i._payload)}function mx(i){function s(ae,ie){if(i){var ue=ae.deletions;ue===null?(ae.deletions=[ie],ae.flags|=16):ue.push(ie)}}function l(ae,ie){if(!i)return null;for(;ie!==null;)s(ae,ie),ie=ie.sibling;return null}function f(ae,ie){for(ae=new Map;ie!==null;)ie.key!==null?ae.set(ie.key,ie):ae.set(ie.index,ie),ie=ie.sibling;return ae}function _(ae,ie){return ae=Fo(ae,ie),ae.index=0,ae.sibling=null,ae}function T(ae,ie,ue){return ae.index=ue,i?(ue=ae.alternate,ue!==null?(ue=ue.index,ue<ie?(ae.flags|=2,ie):ue):(ae.flags|=2,ie)):(ae.flags|=1048576,ie)}function x(ae){return i&&ae.alternate===null&&(ae.flags|=2),ae}function d(ae,ie,ue,ke){return ie===null||ie.tag!==6?(ie=Jf(ue,ae.mode,ke),ie.return=ae,ie):(ie=_(ie,ue),ie.return=ae,ie)}function U(ae,ie,ue,ke){var qe=ue.type;return qe===fl?de(ae,ie,ue.props.children,ke,ue.key):ie!==null&&(ie.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===So&&_0(qe)===ie.type)?(ke=_(ie,ue.props),ke.ref=nc(ae,ie,ue),ke.return=ae,ke):(ke=Cd(ue.type,ue.key,ue.props,null,ae.mode,ke),ke.ref=nc(ae,ie,ue),ke.return=ae,ke)}function ee(ae,ie,ue,ke){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==ue.containerInfo||ie.stateNode.implementation!==ue.implementation?(ie=Qf(ue,ae.mode,ke),ie.return=ae,ie):(ie=_(ie,ue.children||[]),ie.return=ae,ie)}function de(ae,ie,ue,ke,qe){return ie===null||ie.tag!==7?(ie=va(ue,ae.mode,ke,qe),ie.return=ae,ie):(ie=_(ie,ue),ie.return=ae,ie)}function H(ae,ie,ue){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=Jf(""+ie,ae.mode,ue),ie.return=ae,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case td:return ue=Cd(ie.type,ie.key,ie.props,null,ae.mode,ue),ue.ref=nc(ae,null,ie),ue.return=ae,ue;case pl:return ie=Qf(ie,ae.mode,ue),ie.return=ae,ie;case So:var ke=ie._init;return H(ae,ke(ie._payload),ue)}if(uc(ie)||Qu(ie))return ie=va(ie,ae.mode,ue,null),ie.return=ae,ie;dd(ae,ie)}return null}function G(ae,ie,ue,ke){var qe=ie!==null?ie.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return qe!==null?null:d(ae,ie,""+ue,ke);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case td:return ue.key===qe?U(ae,ie,ue,ke):null;case pl:return ue.key===qe?ee(ae,ie,ue,ke):null;case So:return qe=ue._init,G(ae,ie,qe(ue._payload),ke)}if(uc(ue)||Qu(ue))return qe!==null?null:de(ae,ie,ue,ke,null);dd(ae,ue)}return null}function Me(ae,ie,ue,ke,qe){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return ae=ae.get(ue)||null,d(ie,ae,""+ke,qe);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case td:return ae=ae.get(ke.key===null?ue:ke.key)||null,U(ie,ae,ke,qe);case pl:return ae=ae.get(ke.key===null?ue:ke.key)||null,ee(ie,ae,ke,qe);case So:var Je=ke._init;return Me(ae,ie,ue,Je(ke._payload),qe)}if(uc(ke)||Qu(ke))return ae=ae.get(ue)||null,de(ie,ae,ke,qe,null);dd(ie,ke)}return null}function xe(ae,ie,ue,ke){for(var qe=null,Je=null,Ge=ie,et=ie=0,Rt=null;Ge!==null&&et<ue.length;et++){Ge.index>et?(Rt=Ge,Ge=null):Rt=Ge.sibling;var xt=G(ae,Ge,ue[et],ke);if(xt===null){Ge===null&&(Ge=Rt);break}i&&Ge&&xt.alternate===null&&s(ae,Ge),ie=T(xt,ie,et),Je===null?qe=xt:Je.sibling=xt,Je=xt,Ge=Rt}if(et===ue.length)return l(ae,Ge),ui&&pa(ae,et),qe;if(Ge===null){for(;et<ue.length;et++)Ge=H(ae,ue[et],ke),Ge!==null&&(ie=T(Ge,ie,et),Je===null?qe=Ge:Je.sibling=Ge,Je=Ge);return ui&&pa(ae,et),qe}for(Ge=f(ae,Ge);et<ue.length;et++)Rt=Me(Ge,ae,et,ue[et],ke),Rt!==null&&(i&&Rt.alternate!==null&&Ge.delete(Rt.key===null?et:Rt.key),ie=T(Rt,ie,et),Je===null?qe=Rt:Je.sibling=Rt,Je=Rt);return i&&Ge.forEach(function(Zt){return s(ae,Zt)}),ui&&pa(ae,et),qe}function we(ae,ie,ue,ke){var qe=Qu(ue);if(typeof qe!="function")throw Error(Re(150));if(ue=qe.call(ue),ue==null)throw Error(Re(151));for(var Je=qe=null,Ge=ie,et=ie=0,Rt=null,xt=ue.next();Ge!==null&&!xt.done;et++,xt=ue.next()){Ge.index>et?(Rt=Ge,Ge=null):Rt=Ge.sibling;var Zt=G(ae,Ge,xt.value,ke);if(Zt===null){Ge===null&&(Ge=Rt);break}i&&Ge&&Zt.alternate===null&&s(ae,Ge),ie=T(Zt,ie,et),Je===null?qe=Zt:Je.sibling=Zt,Je=Zt,Ge=Rt}if(xt.done)return l(ae,Ge),ui&&pa(ae,et),qe;if(Ge===null){for(;!xt.done;et++,xt=ue.next())xt=H(ae,xt.value,ke),xt!==null&&(ie=T(xt,ie,et),Je===null?qe=xt:Je.sibling=xt,Je=xt);return ui&&pa(ae,et),qe}for(Ge=f(ae,Ge);!xt.done;et++,xt=ue.next())xt=Me(Ge,ae,et,xt.value,ke),xt!==null&&(i&&xt.alternate!==null&&Ge.delete(xt.key===null?et:xt.key),ie=T(xt,ie,et),Je===null?qe=xt:Je.sibling=xt,Je=xt);return i&&Ge.forEach(function(Ot){return s(ae,Ot)}),ui&&pa(ae,et),qe}function at(ae,ie,ue,ke){if(typeof ue=="object"&&ue!==null&&ue.type===fl&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case td:e:{for(var qe=ue.key,Je=ie;Je!==null;){if(Je.key===qe){if(qe=ue.type,qe===fl){if(Je.tag===7){l(ae,Je.sibling),ie=_(Je,ue.props.children),ie.return=ae,ae=ie;break e}}else if(Je.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===So&&_0(qe)===Je.type){l(ae,Je.sibling),ie=_(Je,ue.props),ie.ref=nc(ae,Je,ue),ie.return=ae,ae=ie;break e}l(ae,Je);break}else s(ae,Je);Je=Je.sibling}ue.type===fl?(ie=va(ue.props.children,ae.mode,ke,ue.key),ie.return=ae,ae=ie):(ke=Cd(ue.type,ue.key,ue.props,null,ae.mode,ke),ke.ref=nc(ae,ie,ue),ke.return=ae,ae=ke)}return x(ae);case pl:e:{for(Je=ue.key;ie!==null;){if(ie.key===Je)if(ie.tag===4&&ie.stateNode.containerInfo===ue.containerInfo&&ie.stateNode.implementation===ue.implementation){l(ae,ie.sibling),ie=_(ie,ue.children||[]),ie.return=ae,ae=ie;break e}else{l(ae,ie);break}else s(ae,ie);ie=ie.sibling}ie=Qf(ue,ae.mode,ke),ie.return=ae,ae=ie}return x(ae);case So:return Je=ue._init,at(ae,ie,Je(ue._payload),ke)}if(uc(ue))return xe(ae,ie,ue,ke);if(Qu(ue))return we(ae,ie,ue,ke);dd(ae,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,ie!==null&&ie.tag===6?(l(ae,ie.sibling),ie=_(ie,ue),ie.return=ae,ae=ie):(l(ae,ie),ie=Jf(ue,ae.mode,ke),ie.return=ae,ae=ie),x(ae)):l(ae,ie)}return at}var Rl=mx(!0),gx=mx(!1),$c={},as=Vo($c),Mc=Vo($c),Dc=Vo($c);function ya(i){if(i===$c)throw Error(Re(174));return i}function Ag(i,s){switch(Qt(Dc,s),Qt(Mc,i),Qt(as,$c),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:fm(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=fm(s,i)}ni(as),Qt(as,s)}function Fl(){ni(as),ni(Mc),ni(Dc)}function yx(i){ya(Dc.current);var s=ya(as.current),l=fm(s,i.type);s!==l&&(Qt(Mc,i),Qt(as,l))}function zg(i){Mc.current===i&&(ni(as),ni(Mc))}var fi=Vo(0);function Wd(i){for(var s=i;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Hf=[];function Mg(){for(var i=0;i<Hf.length;i++)Hf[i]._workInProgressVersionPrimary=null;Hf.length=0}var Sd=js.ReactCurrentDispatcher,Gf=js.ReactCurrentBatchConfig,ba=0,mi=null,Ni=null,Wi=null,Kd=!1,yc=!1,Lc=0,vS=0;function gr(){throw Error(Re(321))}function Dg(i,s){if(s===null)return!1;for(var l=0;l<s.length&&l<i.length;l++)if(!$n(i[l],s[l]))return!1;return!0}function Lg(i,s,l,f,_,T){if(ba=T,mi=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Sd.current=i===null||i.memoizedState===null?SS:TS,i=l(f,_),yc){T=0;do{if(yc=!1,Lc=0,25<=T)throw Error(Re(301));T+=1,Wi=Ni=null,s.updateQueue=null,Sd.current=ES,i=l(f,_)}while(yc)}if(Sd.current=Xd,s=Ni!==null&&Ni.next!==null,ba=0,Wi=Ni=mi=null,Kd=!1,s)throw Error(Re(300));return i}function Rg(){var i=Lc!==0;return Lc=0,i}function rs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wi===null?mi.memoizedState=Wi=i:Wi=Wi.next=i,Wi}function Cn(){if(Ni===null){var i=mi.alternate;i=i!==null?i.memoizedState:null}else i=Ni.next;var s=Wi===null?mi.memoizedState:Wi.next;if(s!==null)Wi=s,Ni=i;else{if(i===null)throw Error(Re(310));Ni=i,i={memoizedState:Ni.memoizedState,baseState:Ni.baseState,baseQueue:Ni.baseQueue,queue:Ni.queue,next:null},Wi===null?mi.memoizedState=Wi=i:Wi=Wi.next=i}return Wi}function Rc(i,s){return typeof s=="function"?s(i):s}function Wf(i){var s=Cn(),l=s.queue;if(l===null)throw Error(Re(311));l.lastRenderedReducer=i;var f=Ni,_=f.baseQueue,T=l.pending;if(T!==null){if(_!==null){var x=_.next;_.next=T.next,T.next=x}f.baseQueue=_=T,l.pending=null}if(_!==null){T=_.next,f=f.baseState;var d=x=null,U=null,ee=T;do{var de=ee.lane;if((ba&de)===de)U!==null&&(U=U.next={lane:0,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null}),f=ee.hasEagerState?ee.eagerState:i(f,ee.action);else{var H={lane:de,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null};U===null?(d=U=H,x=f):U=U.next=H,mi.lanes|=de,Sa|=de}ee=ee.next}while(ee!==null&&ee!==T);U===null?x=f:U.next=d,$n(f,s.memoizedState)||(qr=!0),s.memoizedState=f,s.baseState=x,s.baseQueue=U,l.lastRenderedState=f}if(i=l.interleaved,i!==null){_=i;do T=_.lane,mi.lanes|=T,Sa|=T,_=_.next;while(_!==i)}else _===null&&(l.lanes=0);return[s.memoizedState,l.dispatch]}function Kf(i){var s=Cn(),l=s.queue;if(l===null)throw Error(Re(311));l.lastRenderedReducer=i;var f=l.dispatch,_=l.pending,T=s.memoizedState;if(_!==null){l.pending=null;var x=_=_.next;do T=i(T,x.action),x=x.next;while(x!==_);$n(T,s.memoizedState)||(qr=!0),s.memoizedState=T,s.baseQueue===null&&(s.baseState=T),l.lastRenderedState=T}return[T,f]}function _x(){}function vx(i,s){var l=mi,f=Cn(),_=s(),T=!$n(f.memoizedState,_);if(T&&(f.memoizedState=_,qr=!0),f=f.queue,Fg(bx.bind(null,l,f,i),[i]),f.getSnapshot!==s||T||Wi!==null&&Wi.memoizedState.tag&1){if(l.flags|=2048,Fc(9,wx.bind(null,l,f,_,s),void 0,null),Ki===null)throw Error(Re(349));ba&30||xx(l,s,_)}return _}function xx(i,s,l){i.flags|=16384,i={getSnapshot:s,value:l},s=mi.updateQueue,s===null?(s={lastEffect:null,stores:null},mi.updateQueue=s,s.stores=[i]):(l=s.stores,l===null?s.stores=[i]:l.push(i))}function wx(i,s,l,f){s.value=l,s.getSnapshot=f,Sx(s)&&Tx(i)}function bx(i,s,l){return l(function(){Sx(s)&&Tx(i)})}function Sx(i){var s=i.getSnapshot;i=i.value;try{var l=s();return!$n(i,l)}catch{return!0}}function Tx(i){var s=Vs(i,1);s!==null&&jn(s,i,1,-1)}function v0(i){var s=rs();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rc,lastRenderedState:i},s.queue=i,i=i.dispatch=bS.bind(null,mi,i),[s.memoizedState,i]}function Fc(i,s,l,f){return i={tag:i,create:s,destroy:l,deps:f,next:null},s=mi.updateQueue,s===null?(s={lastEffect:null,stores:null},mi.updateQueue=s,s.lastEffect=i.next=i):(l=s.lastEffect,l===null?s.lastEffect=i.next=i:(f=l.next,l.next=i,i.next=f,s.lastEffect=i)),i}function Ex(){return Cn().memoizedState}function Td(i,s,l,f){var _=rs();mi.flags|=i,_.memoizedState=Fc(1|s,l,void 0,f===void 0?null:f)}function hp(i,s,l,f){var _=Cn();f=f===void 0?null:f;var T=void 0;if(Ni!==null){var x=Ni.memoizedState;if(T=x.destroy,f!==null&&Dg(f,x.deps)){_.memoizedState=Fc(s,l,T,f);return}}mi.flags|=i,_.memoizedState=Fc(1|s,l,T,f)}function x0(i,s){return Td(8390656,8,i,s)}function Fg(i,s){return hp(2048,8,i,s)}function kx(i,s){return hp(4,2,i,s)}function Ix(i,s){return hp(4,4,i,s)}function Cx(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function Px(i,s,l){return l=l!=null?l.concat([i]):null,hp(4,4,Cx.bind(null,s,i),l)}function Bg(){}function Ax(i,s){var l=Cn();s=s===void 0?null:s;var f=l.memoizedState;return f!==null&&s!==null&&Dg(s,f[1])?f[0]:(l.memoizedState=[i,s],i)}function zx(i,s){var l=Cn();s=s===void 0?null:s;var f=l.memoizedState;return f!==null&&s!==null&&Dg(s,f[1])?f[0]:(i=i(),l.memoizedState=[i,s],i)}function Mx(i,s,l){return ba&21?($n(l,s)||(l=Rv(),mi.lanes|=l,Sa|=l,i.baseState=!0),s):(i.baseState&&(i.baseState=!1,qr=!0),i.memoizedState=l)}function xS(i,s){var l=qt;qt=l!==0&&4>l?l:4,i(!0);var f=Gf.transition;Gf.transition={};try{i(!1),s()}finally{qt=l,Gf.transition=f}}function Dx(){return Cn().memoizedState}function wS(i,s,l){var f=Ro(i);if(l={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null},Lx(i))Rx(s,l);else if(l=hx(i,s,l,f),l!==null){var _=Lr();jn(l,i,f,_),Fx(l,s,f)}}function bS(i,s,l){var f=Ro(i),_={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null};if(Lx(i))Rx(s,_);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=s.lastRenderedReducer,T!==null))try{var x=s.lastRenderedState,d=T(x,l);if(_.hasEagerState=!0,_.eagerState=d,$n(d,x)){var U=s.interleaved;U===null?(_.next=_,Cg(s)):(_.next=U.next,U.next=_),s.interleaved=_;return}}catch{}finally{}l=hx(i,s,_,f),l!==null&&(_=Lr(),jn(l,i,f,_),Fx(l,s,f))}}function Lx(i){var s=i.alternate;return i===mi||s!==null&&s===mi}function Rx(i,s){yc=Kd=!0;var l=i.pending;l===null?s.next=s:(s.next=l.next,l.next=s),i.pending=s}function Fx(i,s,l){if(l&4194240){var f=s.lanes;f&=i.pendingLanes,l|=f,s.lanes=l,fg(i,l)}}var Xd={readContext:In,useCallback:gr,useContext:gr,useEffect:gr,useImperativeHandle:gr,useInsertionEffect:gr,useLayoutEffect:gr,useMemo:gr,useReducer:gr,useRef:gr,useState:gr,useDebugValue:gr,useDeferredValue:gr,useTransition:gr,useMutableSource:gr,useSyncExternalStore:gr,useId:gr,unstable_isNewReconciler:!1},SS={readContext:In,useCallback:function(i,s){return rs().memoizedState=[i,s===void 0?null:s],i},useContext:In,useEffect:x0,useImperativeHandle:function(i,s,l){return l=l!=null?l.concat([i]):null,Td(4194308,4,Cx.bind(null,s,i),l)},useLayoutEffect:function(i,s){return Td(4194308,4,i,s)},useInsertionEffect:function(i,s){return Td(4,2,i,s)},useMemo:function(i,s){var l=rs();return s=s===void 0?null:s,i=i(),l.memoizedState=[i,s],i},useReducer:function(i,s,l){var f=rs();return s=l!==void 0?l(s):s,f.memoizedState=f.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},f.queue=i,i=i.dispatch=wS.bind(null,mi,i),[f.memoizedState,i]},useRef:function(i){var s=rs();return i={current:i},s.memoizedState=i},useState:v0,useDebugValue:Bg,useDeferredValue:function(i){return rs().memoizedState=i},useTransition:function(){var i=v0(!1),s=i[0];return i=xS.bind(null,i[1]),rs().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,l){var f=mi,_=rs();if(ui){if(l===void 0)throw Error(Re(407));l=l()}else{if(l=s(),Ki===null)throw Error(Re(349));ba&30||xx(f,s,l)}_.memoizedState=l;var T={value:l,getSnapshot:s};return _.queue=T,x0(bx.bind(null,f,T,i),[i]),f.flags|=2048,Fc(9,wx.bind(null,f,T,l,s),void 0,null),l},useId:function(){var i=rs(),s=Ki.identifierPrefix;if(ui){var l=Rs,f=Ls;l=(f&~(1<<32-Un(f)-1)).toString(32)+l,s=":"+s+"R"+l,l=Lc++,0<l&&(s+="H"+l.toString(32)),s+=":"}else l=vS++,s=":"+s+"r"+l.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},TS={readContext:In,useCallback:Ax,useContext:In,useEffect:Fg,useImperativeHandle:Px,useInsertionEffect:kx,useLayoutEffect:Ix,useMemo:zx,useReducer:Wf,useRef:Ex,useState:function(){return Wf(Rc)},useDebugValue:Bg,useDeferredValue:function(i){var s=Cn();return Mx(s,Ni.memoizedState,i)},useTransition:function(){var i=Wf(Rc)[0],s=Cn().memoizedState;return[i,s]},useMutableSource:_x,useSyncExternalStore:vx,useId:Dx,unstable_isNewReconciler:!1},ES={readContext:In,useCallback:Ax,useContext:In,useEffect:Fg,useImperativeHandle:Px,useInsertionEffect:kx,useLayoutEffect:Ix,useMemo:zx,useReducer:Kf,useRef:Ex,useState:function(){return Kf(Rc)},useDebugValue:Bg,useDeferredValue:function(i){var s=Cn();return Ni===null?s.memoizedState=i:Mx(s,Ni.memoizedState,i)},useTransition:function(){var i=Kf(Rc)[0],s=Cn().memoizedState;return[i,s]},useMutableSource:_x,useSyncExternalStore:vx,useId:Dx,unstable_isNewReconciler:!1};function Bl(i,s){try{var l="",f=s;do l+=Qb(f),f=f.return;while(f);var _=l}catch(T){_=`
Error generating stack: `+T.message+`
`+T.stack}return{value:i,source:s,stack:_,digest:null}}function Xf(i,s,l){return{value:i,source:null,stack:l??null,digest:s??null}}function Bm(i,s){try{console.error(s.value)}catch(l){setTimeout(function(){throw l})}}var kS=typeof WeakMap=="function"?WeakMap:Map;function Bx(i,s,l){l=Fs(-1,l),l.tag=3,l.payload={element:null};var f=s.value;return l.callback=function(){Jd||(Jd=!0,Gm=f),Bm(i,s)},l}function Ox(i,s,l){l=Fs(-1,l),l.tag=3;var f=i.type.getDerivedStateFromError;if(typeof f=="function"){var _=s.value;l.payload=function(){return f(_)},l.callback=function(){Bm(i,s)}}var T=i.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(l.callback=function(){Bm(i,s),typeof f!="function"&&(Lo===null?Lo=new Set([this]):Lo.add(this));var x=s.stack;this.componentDidCatch(s.value,{componentStack:x!==null?x:""})}),l}function w0(i,s,l){var f=i.pingCache;if(f===null){f=i.pingCache=new kS;var _=new Set;f.set(s,_)}else _=f.get(s),_===void 0&&(_=new Set,f.set(s,_));_.has(l)||(_.add(l),i=VS.bind(null,i,s,l),s.then(i,i))}function b0(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function S0(i,s,l,f,_){return i.mode&1?(i.flags|=65536,i.lanes=_,i):(i===s?i.flags|=65536:(i.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(s=Fs(-1,1),s.tag=2,Do(l,s,1))),l.lanes|=1),i)}var IS=js.ReactCurrentOwner,qr=!1;function Dr(i,s,l,f){s.child=i===null?gx(s,null,l,f):Rl(s,i.child,l,f)}function T0(i,s,l,f,_){l=l.render;var T=s.ref;return Pl(s,_),f=Lg(i,s,l,f,T,_),l=Rg(),i!==null&&!qr?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~_,Us(i,s,_)):(ui&&l&&bg(s),s.flags|=1,Dr(i,s,f,_),s.child)}function E0(i,s,l,f,_){if(i===null){var T=l.type;return typeof T=="function"&&!Zg(T)&&T.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(s.tag=15,s.type=T,Nx(i,s,T,f,_)):(i=Cd(l.type,null,f,s,s.mode,_),i.ref=s.ref,i.return=s,s.child=i)}if(T=i.child,!(i.lanes&_)){var x=T.memoizedProps;if(l=l.compare,l=l!==null?l:Cc,l(x,f)&&i.ref===s.ref)return Us(i,s,_)}return s.flags|=1,i=Fo(T,f),i.ref=s.ref,i.return=s,s.child=i}function Nx(i,s,l,f,_){if(i!==null){var T=i.memoizedProps;if(Cc(T,f)&&i.ref===s.ref)if(qr=!1,s.pendingProps=f=T,(i.lanes&_)!==0)i.flags&131072&&(qr=!0);else return s.lanes=i.lanes,Us(i,s,_)}return Om(i,s,l,f,_)}function Vx(i,s,l){var f=s.pendingProps,_=f.children,T=i!==null?i.memoizedState:null;if(f.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qt(Tl,on),on|=l;else{if(!(l&1073741824))return i=T!==null?T.baseLanes|l:l,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,Qt(Tl,on),on|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=T!==null?T.baseLanes:l,Qt(Tl,on),on|=f}else T!==null?(f=T.baseLanes|l,s.memoizedState=null):f=l,Qt(Tl,on),on|=f;return Dr(i,s,_,l),s.child}function Ux(i,s){var l=s.ref;(i===null&&l!==null||i!==null&&i.ref!==l)&&(s.flags|=512,s.flags|=2097152)}function Om(i,s,l,f,_){var T=Hr(l)?xa:vr.current;return T=Dl(s,T),Pl(s,_),l=Lg(i,s,l,f,T,_),f=Rg(),i!==null&&!qr?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~_,Us(i,s,_)):(ui&&f&&bg(s),s.flags|=1,Dr(i,s,l,_),s.child)}function k0(i,s,l,f,_){if(Hr(l)){var T=!0;jd(s)}else T=!1;if(Pl(s,_),s.stateNode===null)Ed(i,s),fx(s,l,f),Fm(s,l,f,_),f=!0;else if(i===null){var x=s.stateNode,d=s.memoizedProps;x.props=d;var U=x.context,ee=l.contextType;typeof ee=="object"&&ee!==null?ee=In(ee):(ee=Hr(l)?xa:vr.current,ee=Dl(s,ee));var de=l.getDerivedStateFromProps,H=typeof de=="function"||typeof x.getSnapshotBeforeUpdate=="function";H||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(d!==f||U!==ee)&&y0(s,x,f,ee),To=!1;var G=s.memoizedState;x.state=G,Gd(s,f,x,_),U=s.memoizedState,d!==f||G!==U||Zr.current||To?(typeof de=="function"&&(Rm(s,l,de,f),U=s.memoizedState),(d=To||g0(s,l,d,f,G,U,ee))?(H||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(s.flags|=4194308)):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=f,s.memoizedState=U),x.props=f,x.state=U,x.context=ee,f=d):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),f=!1)}else{x=s.stateNode,dx(i,s),d=s.memoizedProps,ee=s.type===s.elementType?d:On(s.type,d),x.props=ee,H=s.pendingProps,G=x.context,U=l.contextType,typeof U=="object"&&U!==null?U=In(U):(U=Hr(l)?xa:vr.current,U=Dl(s,U));var Me=l.getDerivedStateFromProps;(de=typeof Me=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(d!==H||G!==U)&&y0(s,x,f,U),To=!1,G=s.memoizedState,x.state=G,Gd(s,f,x,_);var xe=s.memoizedState;d!==H||G!==xe||Zr.current||To?(typeof Me=="function"&&(Rm(s,l,Me,f),xe=s.memoizedState),(ee=To||g0(s,l,ee,f,G,xe,U)||!1)?(de||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(f,xe,U),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(f,xe,U)),typeof x.componentDidUpdate=="function"&&(s.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof x.componentDidUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=1024),s.memoizedProps=f,s.memoizedState=xe),x.props=f,x.state=xe,x.context=U,f=ee):(typeof x.componentDidUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=1024),f=!1)}return Nm(i,s,l,f,T,_)}function Nm(i,s,l,f,_,T){Ux(i,s);var x=(s.flags&128)!==0;if(!f&&!x)return _&&h0(s,l,!1),Us(i,s,T);f=s.stateNode,IS.current=s;var d=x&&typeof l.getDerivedStateFromError!="function"?null:f.render();return s.flags|=1,i!==null&&x?(s.child=Rl(s,i.child,null,T),s.child=Rl(s,null,d,T)):Dr(i,s,d,T),s.memoizedState=f.state,_&&h0(s,l,!0),s.child}function jx(i){var s=i.stateNode;s.pendingContext?c0(i,s.pendingContext,s.pendingContext!==s.context):s.context&&c0(i,s.context,!1),Ag(i,s.containerInfo)}function I0(i,s,l,f,_){return Ll(),Tg(_),s.flags|=256,Dr(i,s,l,f),s.child}var Vm={dehydrated:null,treeContext:null,retryLane:0};function Um(i){return{baseLanes:i,cachePool:null,transitions:null}}function $x(i,s,l){var f=s.pendingProps,_=fi.current,T=!1,x=(s.flags&128)!==0,d;if((d=x)||(d=i!==null&&i.memoizedState===null?!1:(_&2)!==0),d?(T=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(_|=1),Qt(fi,_&1),i===null)return Dm(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(s.mode&1?i.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(x=f.children,i=f.fallback,T?(f=s.mode,T=s.child,x={mode:"hidden",children:x},!(f&1)&&T!==null?(T.childLanes=0,T.pendingProps=x):T=fp(x,f,0,null),i=va(i,f,l,null),T.return=s,i.return=s,T.sibling=i,s.child=T,s.child.memoizedState=Um(l),s.memoizedState=Vm,i):Og(s,x));if(_=i.memoizedState,_!==null&&(d=_.dehydrated,d!==null))return CS(i,s,x,f,d,_,l);if(T){T=f.fallback,x=s.mode,_=i.child,d=_.sibling;var U={mode:"hidden",children:f.children};return!(x&1)&&s.child!==_?(f=s.child,f.childLanes=0,f.pendingProps=U,s.deletions=null):(f=Fo(_,U),f.subtreeFlags=_.subtreeFlags&14680064),d!==null?T=Fo(d,T):(T=va(T,x,l,null),T.flags|=2),T.return=s,f.return=s,f.sibling=T,s.child=f,f=T,T=s.child,x=i.child.memoizedState,x=x===null?Um(l):{baseLanes:x.baseLanes|l,cachePool:null,transitions:x.transitions},T.memoizedState=x,T.childLanes=i.childLanes&~l,s.memoizedState=Vm,f}return T=i.child,i=T.sibling,f=Fo(T,{mode:"visible",children:f.children}),!(s.mode&1)&&(f.lanes=l),f.return=s,f.sibling=null,i!==null&&(l=s.deletions,l===null?(s.deletions=[i],s.flags|=16):l.push(i)),s.child=f,s.memoizedState=null,f}function Og(i,s){return s=fp({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function pd(i,s,l,f){return f!==null&&Tg(f),Rl(s,i.child,null,l),i=Og(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function CS(i,s,l,f,_,T,x){if(l)return s.flags&256?(s.flags&=-257,f=Xf(Error(Re(422))),pd(i,s,x,f)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(T=f.fallback,_=s.mode,f=fp({mode:"visible",children:f.children},_,0,null),T=va(T,_,x,null),T.flags|=2,f.return=s,T.return=s,f.sibling=T,s.child=f,s.mode&1&&Rl(s,i.child,null,x),s.child.memoizedState=Um(x),s.memoizedState=Vm,T);if(!(s.mode&1))return pd(i,s,x,null);if(_.data==="$!"){if(f=_.nextSibling&&_.nextSibling.dataset,f)var d=f.dgst;return f=d,T=Error(Re(419)),f=Xf(T,f,void 0),pd(i,s,x,f)}if(d=(x&i.childLanes)!==0,qr||d){if(f=Ki,f!==null){switch(x&-x){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(f.suspendedLanes|x)?0:_,_!==0&&_!==T.retryLane&&(T.retryLane=_,Vs(i,_),jn(f,i,_,-1))}return qg(),f=Xf(Error(Re(421))),pd(i,s,x,f)}return _.data==="$?"?(s.flags|=128,s.child=i.child,s=US.bind(null,i),_._reactRetry=s,null):(i=T.treeContext,an=Mo(_.nextSibling),ln=s,ui=!0,Vn=null,i!==null&&(bn[Sn++]=Ls,bn[Sn++]=Rs,bn[Sn++]=wa,Ls=i.id,Rs=i.overflow,wa=s),s=Og(s,f.children),s.flags|=4096,s)}function C0(i,s,l){i.lanes|=s;var f=i.alternate;f!==null&&(f.lanes|=s),Lm(i.return,s,l)}function Yf(i,s,l,f,_){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:_}:(T.isBackwards=s,T.rendering=null,T.renderingStartTime=0,T.last=f,T.tail=l,T.tailMode=_)}function qx(i,s,l){var f=s.pendingProps,_=f.revealOrder,T=f.tail;if(Dr(i,s,f.children,l),f=fi.current,f&2)f=f&1|2,s.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&C0(i,l,s);else if(i.tag===19)C0(i,l,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}f&=1}if(Qt(fi,f),!(s.mode&1))s.memoizedState=null;else switch(_){case"forwards":for(l=s.child,_=null;l!==null;)i=l.alternate,i!==null&&Wd(i)===null&&(_=l),l=l.sibling;l=_,l===null?(_=s.child,s.child=null):(_=l.sibling,l.sibling=null),Yf(s,!1,_,l,T);break;case"backwards":for(l=null,_=s.child,s.child=null;_!==null;){if(i=_.alternate,i!==null&&Wd(i)===null){s.child=_;break}i=_.sibling,_.sibling=l,l=_,_=i}Yf(s,!0,l,null,T);break;case"together":Yf(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Ed(i,s){!(s.mode&1)&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function Us(i,s,l){if(i!==null&&(s.dependencies=i.dependencies),Sa|=s.lanes,!(l&s.childLanes))return null;if(i!==null&&s.child!==i.child)throw Error(Re(153));if(s.child!==null){for(i=s.child,l=Fo(i,i.pendingProps),s.child=l,l.return=s;i.sibling!==null;)i=i.sibling,l=l.sibling=Fo(i,i.pendingProps),l.return=s;l.sibling=null}return s.child}function PS(i,s,l){switch(s.tag){case 3:jx(s),Ll();break;case 5:yx(s);break;case 1:Hr(s.type)&&jd(s);break;case 4:Ag(s,s.stateNode.containerInfo);break;case 10:var f=s.type._context,_=s.memoizedProps.value;Qt(Zd,f._currentValue),f._currentValue=_;break;case 13:if(f=s.memoizedState,f!==null)return f.dehydrated!==null?(Qt(fi,fi.current&1),s.flags|=128,null):l&s.child.childLanes?$x(i,s,l):(Qt(fi,fi.current&1),i=Us(i,s,l),i!==null?i.sibling:null);Qt(fi,fi.current&1);break;case 19:if(f=(l&s.childLanes)!==0,i.flags&128){if(f)return qx(i,s,l);s.flags|=128}if(_=s.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),Qt(fi,fi.current),f)break;return null;case 22:case 23:return s.lanes=0,Vx(i,s,l)}return Us(i,s,l)}var Zx,jm,Hx,Gx;Zx=function(i,s){for(var l=s.child;l!==null;){if(l.tag===5||l.tag===6)i.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};jm=function(){};Hx=function(i,s,l,f){var _=i.memoizedProps;if(_!==f){i=s.stateNode,ya(as.current);var T=null;switch(l){case"input":_=cm(i,_),f=cm(i,f),T=[];break;case"select":_=gi({},_,{value:void 0}),f=gi({},f,{value:void 0}),T=[];break;case"textarea":_=pm(i,_),f=pm(i,f),T=[];break;default:typeof _.onClick!="function"&&typeof f.onClick=="function"&&(i.onclick=Vd)}mm(l,f);var x;l=null;for(ee in _)if(!f.hasOwnProperty(ee)&&_.hasOwnProperty(ee)&&_[ee]!=null)if(ee==="style"){var d=_[ee];for(x in d)d.hasOwnProperty(x)&&(l||(l={}),l[x]="")}else ee!=="dangerouslySetInnerHTML"&&ee!=="children"&&ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(wc.hasOwnProperty(ee)?T||(T=[]):(T=T||[]).push(ee,null));for(ee in f){var U=f[ee];if(d=_!=null?_[ee]:void 0,f.hasOwnProperty(ee)&&U!==d&&(U!=null||d!=null))if(ee==="style")if(d){for(x in d)!d.hasOwnProperty(x)||U&&U.hasOwnProperty(x)||(l||(l={}),l[x]="");for(x in U)U.hasOwnProperty(x)&&d[x]!==U[x]&&(l||(l={}),l[x]=U[x])}else l||(T||(T=[]),T.push(ee,l)),l=U;else ee==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,d=d?d.__html:void 0,U!=null&&d!==U&&(T=T||[]).push(ee,U)):ee==="children"?typeof U!="string"&&typeof U!="number"||(T=T||[]).push(ee,""+U):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&(wc.hasOwnProperty(ee)?(U!=null&&ee==="onScroll"&&ri("scroll",i),T||d===U||(T=[])):(T=T||[]).push(ee,U))}l&&(T=T||[]).push("style",l);var ee=T;(s.updateQueue=ee)&&(s.flags|=4)}};Gx=function(i,s,l,f){l!==f&&(s.flags|=4)};function sc(i,s){if(!ui)switch(i.tailMode){case"hidden":s=i.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function yr(i){var s=i.alternate!==null&&i.alternate.child===i.child,l=0,f=0;if(s)for(var _=i.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags&14680064,f|=_.flags&14680064,_.return=i,_=_.sibling;else for(_=i.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=i,_=_.sibling;return i.subtreeFlags|=f,i.childLanes=l,s}function AS(i,s,l){var f=s.pendingProps;switch(Sg(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yr(s),null;case 1:return Hr(s.type)&&Ud(),yr(s),null;case 3:return f=s.stateNode,Fl(),ni(Zr),ni(vr),Mg(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(i===null||i.child===null)&&(hd(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Vn!==null&&(Xm(Vn),Vn=null))),jm(i,s),yr(s),null;case 5:zg(s);var _=ya(Dc.current);if(l=s.type,i!==null&&s.stateNode!=null)Hx(i,s,l,f,_),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!f){if(s.stateNode===null)throw Error(Re(166));return yr(s),null}if(i=ya(as.current),hd(s)){f=s.stateNode,l=s.type;var T=s.memoizedProps;switch(f[ns]=s,f[zc]=T,i=(s.mode&1)!==0,l){case"dialog":ri("cancel",f),ri("close",f);break;case"iframe":case"object":case"embed":ri("load",f);break;case"video":case"audio":for(_=0;_<hc.length;_++)ri(hc[_],f);break;case"source":ri("error",f);break;case"img":case"image":case"link":ri("error",f),ri("load",f);break;case"details":ri("toggle",f);break;case"input":B_(f,T),ri("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!T.multiple},ri("invalid",f);break;case"textarea":N_(f,T),ri("invalid",f)}mm(l,T),_=null;for(var x in T)if(T.hasOwnProperty(x)){var d=T[x];x==="children"?typeof d=="string"?f.textContent!==d&&(T.suppressHydrationWarning!==!0&&cd(f.textContent,d,i),_=["children",d]):typeof d=="number"&&f.textContent!==""+d&&(T.suppressHydrationWarning!==!0&&cd(f.textContent,d,i),_=["children",""+d]):wc.hasOwnProperty(x)&&d!=null&&x==="onScroll"&&ri("scroll",f)}switch(l){case"input":id(f),O_(f,T,!0);break;case"textarea":id(f),V_(f);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(f.onclick=Vd)}f=_,s.updateQueue=f,f!==null&&(s.flags|=4)}else{x=_.nodeType===9?_:_.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=xv(l)),i==="http://www.w3.org/1999/xhtml"?l==="script"?(i=x.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof f.is=="string"?i=x.createElement(l,{is:f.is}):(i=x.createElement(l),l==="select"&&(x=i,f.multiple?x.multiple=!0:f.size&&(x.size=f.size))):i=x.createElementNS(i,l),i[ns]=s,i[zc]=f,Zx(i,s,!1,!1),s.stateNode=i;e:{switch(x=gm(l,f),l){case"dialog":ri("cancel",i),ri("close",i),_=f;break;case"iframe":case"object":case"embed":ri("load",i),_=f;break;case"video":case"audio":for(_=0;_<hc.length;_++)ri(hc[_],i);_=f;break;case"source":ri("error",i),_=f;break;case"img":case"image":case"link":ri("error",i),ri("load",i),_=f;break;case"details":ri("toggle",i),_=f;break;case"input":B_(i,f),_=cm(i,f),ri("invalid",i);break;case"option":_=f;break;case"select":i._wrapperState={wasMultiple:!!f.multiple},_=gi({},f,{value:void 0}),ri("invalid",i);break;case"textarea":N_(i,f),_=pm(i,f),ri("invalid",i);break;default:_=f}mm(l,_),d=_;for(T in d)if(d.hasOwnProperty(T)){var U=d[T];T==="style"?Sv(i,U):T==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,U!=null&&wv(i,U)):T==="children"?typeof U=="string"?(l!=="textarea"||U!=="")&&bc(i,U):typeof U=="number"&&bc(i,""+U):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(wc.hasOwnProperty(T)?U!=null&&T==="onScroll"&&ri("scroll",i):U!=null&&lg(i,T,U,x))}switch(l){case"input":id(i),O_(i,f,!1);break;case"textarea":id(i),V_(i);break;case"option":f.value!=null&&i.setAttribute("value",""+Bo(f.value));break;case"select":i.multiple=!!f.multiple,T=f.value,T!=null?El(i,!!f.multiple,T,!1):f.defaultValue!=null&&El(i,!!f.multiple,f.defaultValue,!0);break;default:typeof _.onClick=="function"&&(i.onclick=Vd)}switch(l){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return yr(s),null;case 6:if(i&&s.stateNode!=null)Gx(i,s,i.memoizedProps,f);else{if(typeof f!="string"&&s.stateNode===null)throw Error(Re(166));if(l=ya(Dc.current),ya(as.current),hd(s)){if(f=s.stateNode,l=s.memoizedProps,f[ns]=s,(T=f.nodeValue!==l)&&(i=ln,i!==null))switch(i.tag){case 3:cd(f.nodeValue,l,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&cd(f.nodeValue,l,(i.mode&1)!==0)}T&&(s.flags|=4)}else f=(l.nodeType===9?l:l.ownerDocument).createTextNode(f),f[ns]=s,s.stateNode=f}return yr(s),null;case 13:if(ni(fi),f=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(ui&&an!==null&&s.mode&1&&!(s.flags&128))cx(),Ll(),s.flags|=98560,T=!1;else if(T=hd(s),f!==null&&f.dehydrated!==null){if(i===null){if(!T)throw Error(Re(318));if(T=s.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(Re(317));T[ns]=s}else Ll(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;yr(s),T=!1}else Vn!==null&&(Xm(Vn),Vn=null),T=!0;if(!T)return s.flags&65536?s:null}return s.flags&128?(s.lanes=l,s):(f=f!==null,f!==(i!==null&&i.memoizedState!==null)&&f&&(s.child.flags|=8192,s.mode&1&&(i===null||fi.current&1?Vi===0&&(Vi=3):qg())),s.updateQueue!==null&&(s.flags|=4),yr(s),null);case 4:return Fl(),jm(i,s),i===null&&Pc(s.stateNode.containerInfo),yr(s),null;case 10:return Ig(s.type._context),yr(s),null;case 17:return Hr(s.type)&&Ud(),yr(s),null;case 19:if(ni(fi),T=s.memoizedState,T===null)return yr(s),null;if(f=(s.flags&128)!==0,x=T.rendering,x===null)if(f)sc(T,!1);else{if(Vi!==0||i!==null&&i.flags&128)for(i=s.child;i!==null;){if(x=Wd(i),x!==null){for(s.flags|=128,sc(T,!1),f=x.updateQueue,f!==null&&(s.updateQueue=f,s.flags|=4),s.subtreeFlags=0,f=l,l=s.child;l!==null;)T=l,i=f,T.flags&=14680066,x=T.alternate,x===null?(T.childLanes=0,T.lanes=i,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=x.childLanes,T.lanes=x.lanes,T.child=x.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=x.memoizedProps,T.memoizedState=x.memoizedState,T.updateQueue=x.updateQueue,T.type=x.type,i=x.dependencies,T.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),l=l.sibling;return Qt(fi,fi.current&1|2),s.child}i=i.sibling}T.tail!==null&&Ci()>Ol&&(s.flags|=128,f=!0,sc(T,!1),s.lanes=4194304)}else{if(!f)if(i=Wd(x),i!==null){if(s.flags|=128,f=!0,l=i.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),sc(T,!0),T.tail===null&&T.tailMode==="hidden"&&!x.alternate&&!ui)return yr(s),null}else 2*Ci()-T.renderingStartTime>Ol&&l!==1073741824&&(s.flags|=128,f=!0,sc(T,!1),s.lanes=4194304);T.isBackwards?(x.sibling=s.child,s.child=x):(l=T.last,l!==null?l.sibling=x:s.child=x,T.last=x)}return T.tail!==null?(s=T.tail,T.rendering=s,T.tail=s.sibling,T.renderingStartTime=Ci(),s.sibling=null,l=fi.current,Qt(fi,f?l&1|2:l&1),s):(yr(s),null);case 22:case 23:return $g(),f=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==f&&(s.flags|=8192),f&&s.mode&1?on&1073741824&&(yr(s),s.subtreeFlags&6&&(s.flags|=8192)):yr(s),null;case 24:return null;case 25:return null}throw Error(Re(156,s.tag))}function zS(i,s){switch(Sg(s),s.tag){case 1:return Hr(s.type)&&Ud(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Fl(),ni(Zr),ni(vr),Mg(),i=s.flags,i&65536&&!(i&128)?(s.flags=i&-65537|128,s):null;case 5:return zg(s),null;case 13:if(ni(fi),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(Re(340));Ll()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return ni(fi),null;case 4:return Fl(),null;case 10:return Ig(s.type._context),null;case 22:case 23:return $g(),null;case 24:return null;default:return null}}var fd=!1,_r=!1,MS=typeof WeakSet=="function"?WeakSet:Set,Qe=null;function Sl(i,s){var l=i.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){xi(i,s,f)}else l.current=null}function $m(i,s,l){try{l()}catch(f){xi(i,s,f)}}var P0=!1;function DS(i,s){if(km=Bd,i=Yv(),wg(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else e:{l=(l=i.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var _=f.anchorOffset,T=f.focusNode;f=f.focusOffset;try{l.nodeType,T.nodeType}catch{l=null;break e}var x=0,d=-1,U=-1,ee=0,de=0,H=i,G=null;t:for(;;){for(var Me;H!==l||_!==0&&H.nodeType!==3||(d=x+_),H!==T||f!==0&&H.nodeType!==3||(U=x+f),H.nodeType===3&&(x+=H.nodeValue.length),(Me=H.firstChild)!==null;)G=H,H=Me;for(;;){if(H===i)break t;if(G===l&&++ee===_&&(d=x),G===T&&++de===f&&(U=x),(Me=H.nextSibling)!==null)break;H=G,G=H.parentNode}H=Me}l=d===-1||U===-1?null:{start:d,end:U}}else l=null}l=l||{start:0,end:0}}else l=null;for(Im={focusedElem:i,selectionRange:l},Bd=!1,Qe=s;Qe!==null;)if(s=Qe,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Qe=i;else for(;Qe!==null;){s=Qe;try{var xe=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(xe!==null){var we=xe.memoizedProps,at=xe.memoizedState,ae=s.stateNode,ie=ae.getSnapshotBeforeUpdate(s.elementType===s.type?we:On(s.type,we),at);ae.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var ue=s.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Re(163))}}catch(ke){xi(s,s.return,ke)}if(i=s.sibling,i!==null){i.return=s.return,Qe=i;break}Qe=s.return}return xe=P0,P0=!1,xe}function _c(i,s,l){var f=s.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var _=f=f.next;do{if((_.tag&i)===i){var T=_.destroy;_.destroy=void 0,T!==void 0&&$m(s,l,T)}_=_.next}while(_!==f)}}function dp(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var l=s=s.next;do{if((l.tag&i)===i){var f=l.create;l.destroy=f()}l=l.next}while(l!==s)}}function qm(i){var s=i.ref;if(s!==null){var l=i.stateNode;switch(i.tag){case 5:i=l;break;default:i=l}typeof s=="function"?s(i):s.current=i}}function Wx(i){var s=i.alternate;s!==null&&(i.alternate=null,Wx(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[ns],delete s[zc],delete s[Am],delete s[mS],delete s[gS])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Kx(i){return i.tag===5||i.tag===3||i.tag===4}function A0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Kx(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Zm(i,s,l){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?l.nodeType===8?l.parentNode.insertBefore(i,s):l.insertBefore(i,s):(l.nodeType===8?(s=l.parentNode,s.insertBefore(i,l)):(s=l,s.appendChild(i)),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Vd));else if(f!==4&&(i=i.child,i!==null))for(Zm(i,s,l),i=i.sibling;i!==null;)Zm(i,s,l),i=i.sibling}function Hm(i,s,l){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?l.insertBefore(i,s):l.appendChild(i);else if(f!==4&&(i=i.child,i!==null))for(Hm(i,s,l),i=i.sibling;i!==null;)Hm(i,s,l),i=i.sibling}var ir=null,Nn=!1;function wo(i,s,l){for(l=l.child;l!==null;)Xx(i,s,l),l=l.sibling}function Xx(i,s,l){if(os&&typeof os.onCommitFiberUnmount=="function")try{os.onCommitFiberUnmount(np,l)}catch{}switch(l.tag){case 5:_r||Sl(l,s);case 6:var f=ir,_=Nn;ir=null,wo(i,s,l),ir=f,Nn=_,ir!==null&&(Nn?(i=ir,l=l.stateNode,i.nodeType===8?i.parentNode.removeChild(l):i.removeChild(l)):ir.removeChild(l.stateNode));break;case 18:ir!==null&&(Nn?(i=ir,l=l.stateNode,i.nodeType===8?qf(i.parentNode,l):i.nodeType===1&&qf(i,l),kc(i)):qf(ir,l.stateNode));break;case 4:f=ir,_=Nn,ir=l.stateNode.containerInfo,Nn=!0,wo(i,s,l),ir=f,Nn=_;break;case 0:case 11:case 14:case 15:if(!_r&&(f=l.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){_=f=f.next;do{var T=_,x=T.destroy;T=T.tag,x!==void 0&&(T&2||T&4)&&$m(l,s,x),_=_.next}while(_!==f)}wo(i,s,l);break;case 1:if(!_r&&(Sl(l,s),f=l.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=l.memoizedProps,f.state=l.memoizedState,f.componentWillUnmount()}catch(d){xi(l,s,d)}wo(i,s,l);break;case 21:wo(i,s,l);break;case 22:l.mode&1?(_r=(f=_r)||l.memoizedState!==null,wo(i,s,l),_r=f):wo(i,s,l);break;default:wo(i,s,l)}}function z0(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var l=i.stateNode;l===null&&(l=i.stateNode=new MS),s.forEach(function(f){var _=jS.bind(null,i,f);l.has(f)||(l.add(f),f.then(_,_))})}}function Bn(i,s){var l=s.deletions;if(l!==null)for(var f=0;f<l.length;f++){var _=l[f];try{var T=i,x=s,d=x;e:for(;d!==null;){switch(d.tag){case 5:ir=d.stateNode,Nn=!1;break e;case 3:ir=d.stateNode.containerInfo,Nn=!0;break e;case 4:ir=d.stateNode.containerInfo,Nn=!0;break e}d=d.return}if(ir===null)throw Error(Re(160));Xx(T,x,_),ir=null,Nn=!1;var U=_.alternate;U!==null&&(U.return=null),_.return=null}catch(ee){xi(_,s,ee)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Yx(s,i),s=s.sibling}function Yx(i,s){var l=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Bn(s,i),is(i),f&4){try{_c(3,i,i.return),dp(3,i)}catch(we){xi(i,i.return,we)}try{_c(5,i,i.return)}catch(we){xi(i,i.return,we)}}break;case 1:Bn(s,i),is(i),f&512&&l!==null&&Sl(l,l.return);break;case 5:if(Bn(s,i),is(i),f&512&&l!==null&&Sl(l,l.return),i.flags&32){var _=i.stateNode;try{bc(_,"")}catch(we){xi(i,i.return,we)}}if(f&4&&(_=i.stateNode,_!=null)){var T=i.memoizedProps,x=l!==null?l.memoizedProps:T,d=i.type,U=i.updateQueue;if(i.updateQueue=null,U!==null)try{d==="input"&&T.type==="radio"&&T.name!=null&&_v(_,T),gm(d,x);var ee=gm(d,T);for(x=0;x<U.length;x+=2){var de=U[x],H=U[x+1];de==="style"?Sv(_,H):de==="dangerouslySetInnerHTML"?wv(_,H):de==="children"?bc(_,H):lg(_,de,H,ee)}switch(d){case"input":hm(_,T);break;case"textarea":vv(_,T);break;case"select":var G=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!T.multiple;var Me=T.value;Me!=null?El(_,!!T.multiple,Me,!1):G!==!!T.multiple&&(T.defaultValue!=null?El(_,!!T.multiple,T.defaultValue,!0):El(_,!!T.multiple,T.multiple?[]:"",!1))}_[zc]=T}catch(we){xi(i,i.return,we)}}break;case 6:if(Bn(s,i),is(i),f&4){if(i.stateNode===null)throw Error(Re(162));_=i.stateNode,T=i.memoizedProps;try{_.nodeValue=T}catch(we){xi(i,i.return,we)}}break;case 3:if(Bn(s,i),is(i),f&4&&l!==null&&l.memoizedState.isDehydrated)try{kc(s.containerInfo)}catch(we){xi(i,i.return,we)}break;case 4:Bn(s,i),is(i);break;case 13:Bn(s,i),is(i),_=i.child,_.flags&8192&&(T=_.memoizedState!==null,_.stateNode.isHidden=T,!T||_.alternate!==null&&_.alternate.memoizedState!==null||(Ug=Ci())),f&4&&z0(i);break;case 22:if(de=l!==null&&l.memoizedState!==null,i.mode&1?(_r=(ee=_r)||de,Bn(s,i),_r=ee):Bn(s,i),is(i),f&8192){if(ee=i.memoizedState!==null,(i.stateNode.isHidden=ee)&&!de&&i.mode&1)for(Qe=i,de=i.child;de!==null;){for(H=Qe=de;Qe!==null;){switch(G=Qe,Me=G.child,G.tag){case 0:case 11:case 14:case 15:_c(4,G,G.return);break;case 1:Sl(G,G.return);var xe=G.stateNode;if(typeof xe.componentWillUnmount=="function"){f=G,l=G.return;try{s=f,xe.props=s.memoizedProps,xe.state=s.memoizedState,xe.componentWillUnmount()}catch(we){xi(f,l,we)}}break;case 5:Sl(G,G.return);break;case 22:if(G.memoizedState!==null){D0(H);continue}}Me!==null?(Me.return=G,Qe=Me):D0(H)}de=de.sibling}e:for(de=null,H=i;;){if(H.tag===5){if(de===null){de=H;try{_=H.stateNode,ee?(T=_.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(d=H.stateNode,U=H.memoizedProps.style,x=U!=null&&U.hasOwnProperty("display")?U.display:null,d.style.display=bv("display",x))}catch(we){xi(i,i.return,we)}}}else if(H.tag===6){if(de===null)try{H.stateNode.nodeValue=ee?"":H.memoizedProps}catch(we){xi(i,i.return,we)}}else if((H.tag!==22&&H.tag!==23||H.memoizedState===null||H===i)&&H.child!==null){H.child.return=H,H=H.child;continue}if(H===i)break e;for(;H.sibling===null;){if(H.return===null||H.return===i)break e;de===H&&(de=null),H=H.return}de===H&&(de=null),H.sibling.return=H.return,H=H.sibling}}break;case 19:Bn(s,i),is(i),f&4&&z0(i);break;case 21:break;default:Bn(s,i),is(i)}}function is(i){var s=i.flags;if(s&2){try{e:{for(var l=i.return;l!==null;){if(Kx(l)){var f=l;break e}l=l.return}throw Error(Re(160))}switch(f.tag){case 5:var _=f.stateNode;f.flags&32&&(bc(_,""),f.flags&=-33);var T=A0(i);Hm(i,T,_);break;case 3:case 4:var x=f.stateNode.containerInfo,d=A0(i);Zm(i,d,x);break;default:throw Error(Re(161))}}catch(U){xi(i,i.return,U)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function LS(i,s,l){Qe=i,Jx(i)}function Jx(i,s,l){for(var f=(i.mode&1)!==0;Qe!==null;){var _=Qe,T=_.child;if(_.tag===22&&f){var x=_.memoizedState!==null||fd;if(!x){var d=_.alternate,U=d!==null&&d.memoizedState!==null||_r;d=fd;var ee=_r;if(fd=x,(_r=U)&&!ee)for(Qe=_;Qe!==null;)x=Qe,U=x.child,x.tag===22&&x.memoizedState!==null?L0(_):U!==null?(U.return=x,Qe=U):L0(_);for(;T!==null;)Qe=T,Jx(T),T=T.sibling;Qe=_,fd=d,_r=ee}M0(i)}else _.subtreeFlags&8772&&T!==null?(T.return=_,Qe=T):M0(i)}}function M0(i){for(;Qe!==null;){var s=Qe;if(s.flags&8772){var l=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:_r||dp(5,s);break;case 1:var f=s.stateNode;if(s.flags&4&&!_r)if(l===null)f.componentDidMount();else{var _=s.elementType===s.type?l.memoizedProps:On(s.type,l.memoizedProps);f.componentDidUpdate(_,l.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var T=s.updateQueue;T!==null&&m0(s,T,f);break;case 3:var x=s.updateQueue;if(x!==null){if(l=null,s.child!==null)switch(s.child.tag){case 5:l=s.child.stateNode;break;case 1:l=s.child.stateNode}m0(s,x,l)}break;case 5:var d=s.stateNode;if(l===null&&s.flags&4){l=d;var U=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":U.autoFocus&&l.focus();break;case"img":U.src&&(l.src=U.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var ee=s.alternate;if(ee!==null){var de=ee.memoizedState;if(de!==null){var H=de.dehydrated;H!==null&&kc(H)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Re(163))}_r||s.flags&512&&qm(s)}catch(G){xi(s,s.return,G)}}if(s===i){Qe=null;break}if(l=s.sibling,l!==null){l.return=s.return,Qe=l;break}Qe=s.return}}function D0(i){for(;Qe!==null;){var s=Qe;if(s===i){Qe=null;break}var l=s.sibling;if(l!==null){l.return=s.return,Qe=l;break}Qe=s.return}}function L0(i){for(;Qe!==null;){var s=Qe;try{switch(s.tag){case 0:case 11:case 15:var l=s.return;try{dp(4,s)}catch(U){xi(s,l,U)}break;case 1:var f=s.stateNode;if(typeof f.componentDidMount=="function"){var _=s.return;try{f.componentDidMount()}catch(U){xi(s,_,U)}}var T=s.return;try{qm(s)}catch(U){xi(s,T,U)}break;case 5:var x=s.return;try{qm(s)}catch(U){xi(s,x,U)}}}catch(U){xi(s,s.return,U)}if(s===i){Qe=null;break}var d=s.sibling;if(d!==null){d.return=s.return,Qe=d;break}Qe=s.return}}var RS=Math.ceil,Yd=js.ReactCurrentDispatcher,Ng=js.ReactCurrentOwner,En=js.ReactCurrentBatchConfig,Lt=0,Ki=null,Di=null,rr=0,on=0,Tl=Vo(0),Vi=0,Bc=null,Sa=0,pp=0,Vg=0,vc=null,$r=null,Ug=0,Ol=1/0,Ms=null,Jd=!1,Gm=null,Lo=null,md=!1,Co=null,Qd=0,xc=0,Wm=null,kd=-1,Id=0;function Lr(){return Lt&6?Ci():kd!==-1?kd:kd=Ci()}function Ro(i){return i.mode&1?Lt&2&&rr!==0?rr&-rr:_S.transition!==null?(Id===0&&(Id=Rv()),Id):(i=qt,i!==0||(i=window.event,i=i===void 0?16:jv(i.type)),i):1}function jn(i,s,l,f){if(50<xc)throw xc=0,Wm=null,Error(Re(185));Vc(i,l,f),(!(Lt&2)||i!==Ki)&&(i===Ki&&(!(Lt&2)&&(pp|=l),Vi===4&&ko(i,rr)),Gr(i,f),l===1&&Lt===0&&!(s.mode&1)&&(Ol=Ci()+500,up&&Uo()))}function Gr(i,s){var l=i.callbackNode;_2(i,s);var f=Fd(i,i===Ki?rr:0);if(f===0)l!==null&&$_(l),i.callbackNode=null,i.callbackPriority=0;else if(s=f&-f,i.callbackPriority!==s){if(l!=null&&$_(l),s===1)i.tag===0?yS(R0.bind(null,i)):ax(R0.bind(null,i)),pS(function(){!(Lt&6)&&Uo()}),l=null;else{switch(Fv(f)){case 1:l=pg;break;case 4:l=Dv;break;case 16:l=Rd;break;case 536870912:l=Lv;break;default:l=Rd}l=o1(l,Qx.bind(null,i))}i.callbackPriority=s,i.callbackNode=l}}function Qx(i,s){if(kd=-1,Id=0,Lt&6)throw Error(Re(327));var l=i.callbackNode;if(Al()&&i.callbackNode!==l)return null;var f=Fd(i,i===Ki?rr:0);if(f===0)return null;if(f&30||f&i.expiredLanes||s)s=ep(i,f);else{s=f;var _=Lt;Lt|=2;var T=t1();(Ki!==i||rr!==s)&&(Ms=null,Ol=Ci()+500,_a(i,s));do try{OS();break}catch(d){e1(i,d)}while(!0);kg(),Yd.current=T,Lt=_,Di!==null?s=0:(Ki=null,rr=0,s=Vi)}if(s!==0){if(s===2&&(_=wm(i),_!==0&&(f=_,s=Km(i,_))),s===1)throw l=Bc,_a(i,0),ko(i,f),Gr(i,Ci()),l;if(s===6)ko(i,f);else{if(_=i.current.alternate,!(f&30)&&!FS(_)&&(s=ep(i,f),s===2&&(T=wm(i),T!==0&&(f=T,s=Km(i,T))),s===1))throw l=Bc,_a(i,0),ko(i,f),Gr(i,Ci()),l;switch(i.finishedWork=_,i.finishedLanes=f,s){case 0:case 1:throw Error(Re(345));case 2:fa(i,$r,Ms);break;case 3:if(ko(i,f),(f&130023424)===f&&(s=Ug+500-Ci(),10<s)){if(Fd(i,0)!==0)break;if(_=i.suspendedLanes,(_&f)!==f){Lr(),i.pingedLanes|=i.suspendedLanes&_;break}i.timeoutHandle=Pm(fa.bind(null,i,$r,Ms),s);break}fa(i,$r,Ms);break;case 4:if(ko(i,f),(f&4194240)===f)break;for(s=i.eventTimes,_=-1;0<f;){var x=31-Un(f);T=1<<x,x=s[x],x>_&&(_=x),f&=~T}if(f=_,f=Ci()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*RS(f/1960))-f,10<f){i.timeoutHandle=Pm(fa.bind(null,i,$r,Ms),f);break}fa(i,$r,Ms);break;case 5:fa(i,$r,Ms);break;default:throw Error(Re(329))}}}return Gr(i,Ci()),i.callbackNode===l?Qx.bind(null,i):null}function Km(i,s){var l=vc;return i.current.memoizedState.isDehydrated&&(_a(i,s).flags|=256),i=ep(i,s),i!==2&&(s=$r,$r=l,s!==null&&Xm(s)),i}function Xm(i){$r===null?$r=i:$r.push.apply($r,i)}function FS(i){for(var s=i;;){if(s.flags&16384){var l=s.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var f=0;f<l.length;f++){var _=l[f],T=_.getSnapshot;_=_.value;try{if(!$n(T(),_))return!1}catch{return!1}}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ko(i,s){for(s&=~Vg,s&=~pp,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var l=31-Un(s),f=1<<l;i[l]=-1,s&=~f}}function R0(i){if(Lt&6)throw Error(Re(327));Al();var s=Fd(i,0);if(!(s&1))return Gr(i,Ci()),null;var l=ep(i,s);if(i.tag!==0&&l===2){var f=wm(i);f!==0&&(s=f,l=Km(i,f))}if(l===1)throw l=Bc,_a(i,0),ko(i,s),Gr(i,Ci()),l;if(l===6)throw Error(Re(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,fa(i,$r,Ms),Gr(i,Ci()),null}function jg(i,s){var l=Lt;Lt|=1;try{return i(s)}finally{Lt=l,Lt===0&&(Ol=Ci()+500,up&&Uo())}}function Ta(i){Co!==null&&Co.tag===0&&!(Lt&6)&&Al();var s=Lt;Lt|=1;var l=En.transition,f=qt;try{if(En.transition=null,qt=1,i)return i()}finally{qt=f,En.transition=l,Lt=s,!(Lt&6)&&Uo()}}function $g(){on=Tl.current,ni(Tl)}function _a(i,s){i.finishedWork=null,i.finishedLanes=0;var l=i.timeoutHandle;if(l!==-1&&(i.timeoutHandle=-1,dS(l)),Di!==null)for(l=Di.return;l!==null;){var f=l;switch(Sg(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Ud();break;case 3:Fl(),ni(Zr),ni(vr),Mg();break;case 5:zg(f);break;case 4:Fl();break;case 13:ni(fi);break;case 19:ni(fi);break;case 10:Ig(f.type._context);break;case 22:case 23:$g()}l=l.return}if(Ki=i,Di=i=Fo(i.current,null),rr=on=s,Vi=0,Bc=null,Vg=pp=Sa=0,$r=vc=null,ga!==null){for(s=0;s<ga.length;s++)if(l=ga[s],f=l.interleaved,f!==null){l.interleaved=null;var _=f.next,T=l.pending;if(T!==null){var x=T.next;T.next=_,f.next=x}l.pending=f}ga=null}return i}function e1(i,s){do{var l=Di;try{if(kg(),Sd.current=Xd,Kd){for(var f=mi.memoizedState;f!==null;){var _=f.queue;_!==null&&(_.pending=null),f=f.next}Kd=!1}if(ba=0,Wi=Ni=mi=null,yc=!1,Lc=0,Ng.current=null,l===null||l.return===null){Vi=1,Bc=s,Di=null;break}e:{var T=i,x=l.return,d=l,U=s;if(s=rr,d.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){var ee=U,de=d,H=de.tag;if(!(de.mode&1)&&(H===0||H===11||H===15)){var G=de.alternate;G?(de.updateQueue=G.updateQueue,de.memoizedState=G.memoizedState,de.lanes=G.lanes):(de.updateQueue=null,de.memoizedState=null)}var Me=b0(x);if(Me!==null){Me.flags&=-257,S0(Me,x,d,T,s),Me.mode&1&&w0(T,ee,s),s=Me,U=ee;var xe=s.updateQueue;if(xe===null){var we=new Set;we.add(U),s.updateQueue=we}else xe.add(U);break e}else{if(!(s&1)){w0(T,ee,s),qg();break e}U=Error(Re(426))}}else if(ui&&d.mode&1){var at=b0(x);if(at!==null){!(at.flags&65536)&&(at.flags|=256),S0(at,x,d,T,s),Tg(Bl(U,d));break e}}T=U=Bl(U,d),Vi!==4&&(Vi=2),vc===null?vc=[T]:vc.push(T),T=x;do{switch(T.tag){case 3:T.flags|=65536,s&=-s,T.lanes|=s;var ae=Bx(T,U,s);f0(T,ae);break e;case 1:d=U;var ie=T.type,ue=T.stateNode;if(!(T.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Lo===null||!Lo.has(ue)))){T.flags|=65536,s&=-s,T.lanes|=s;var ke=Ox(T,d,s);f0(T,ke);break e}}T=T.return}while(T!==null)}r1(l)}catch(qe){s=qe,Di===l&&l!==null&&(Di=l=l.return);continue}break}while(!0)}function t1(){var i=Yd.current;return Yd.current=Xd,i===null?Xd:i}function qg(){(Vi===0||Vi===3||Vi===2)&&(Vi=4),Ki===null||!(Sa&268435455)&&!(pp&268435455)||ko(Ki,rr)}function ep(i,s){var l=Lt;Lt|=2;var f=t1();(Ki!==i||rr!==s)&&(Ms=null,_a(i,s));do try{BS();break}catch(_){e1(i,_)}while(!0);if(kg(),Lt=l,Yd.current=f,Di!==null)throw Error(Re(261));return Ki=null,rr=0,Vi}function BS(){for(;Di!==null;)i1(Di)}function OS(){for(;Di!==null&&!u2();)i1(Di)}function i1(i){var s=s1(i.alternate,i,on);i.memoizedProps=i.pendingProps,s===null?r1(i):Di=s,Ng.current=null}function r1(i){var s=i;do{var l=s.alternate;if(i=s.return,s.flags&32768){if(l=zS(l,s),l!==null){l.flags&=32767,Di=l;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Vi=6,Di=null;return}}else if(l=AS(l,s,on),l!==null){Di=l;return}if(s=s.sibling,s!==null){Di=s;return}Di=s=i}while(s!==null);Vi===0&&(Vi=5)}function fa(i,s,l){var f=qt,_=En.transition;try{En.transition=null,qt=1,NS(i,s,l,f)}finally{En.transition=_,qt=f}return null}function NS(i,s,l,f){do Al();while(Co!==null);if(Lt&6)throw Error(Re(327));l=i.finishedWork;var _=i.finishedLanes;if(l===null)return null;if(i.finishedWork=null,i.finishedLanes=0,l===i.current)throw Error(Re(177));i.callbackNode=null,i.callbackPriority=0;var T=l.lanes|l.childLanes;if(v2(i,T),i===Ki&&(Di=Ki=null,rr=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||md||(md=!0,o1(Rd,function(){return Al(),null})),T=(l.flags&15990)!==0,l.subtreeFlags&15990||T){T=En.transition,En.transition=null;var x=qt;qt=1;var d=Lt;Lt|=4,Ng.current=null,DS(i,l),Yx(l,i),sS(Im),Bd=!!km,Im=km=null,i.current=l,LS(l),c2(),Lt=d,qt=x,En.transition=T}else i.current=l;if(md&&(md=!1,Co=i,Qd=_),T=i.pendingLanes,T===0&&(Lo=null),p2(l.stateNode),Gr(i,Ci()),s!==null)for(f=i.onRecoverableError,l=0;l<s.length;l++)_=s[l],f(_.value,{componentStack:_.stack,digest:_.digest});if(Jd)throw Jd=!1,i=Gm,Gm=null,i;return Qd&1&&i.tag!==0&&Al(),T=i.pendingLanes,T&1?i===Wm?xc++:(xc=0,Wm=i):xc=0,Uo(),null}function Al(){if(Co!==null){var i=Fv(Qd),s=En.transition,l=qt;try{if(En.transition=null,qt=16>i?16:i,Co===null)var f=!1;else{if(i=Co,Co=null,Qd=0,Lt&6)throw Error(Re(331));var _=Lt;for(Lt|=4,Qe=i.current;Qe!==null;){var T=Qe,x=T.child;if(Qe.flags&16){var d=T.deletions;if(d!==null){for(var U=0;U<d.length;U++){var ee=d[U];for(Qe=ee;Qe!==null;){var de=Qe;switch(de.tag){case 0:case 11:case 15:_c(8,de,T)}var H=de.child;if(H!==null)H.return=de,Qe=H;else for(;Qe!==null;){de=Qe;var G=de.sibling,Me=de.return;if(Wx(de),de===ee){Qe=null;break}if(G!==null){G.return=Me,Qe=G;break}Qe=Me}}}var xe=T.alternate;if(xe!==null){var we=xe.child;if(we!==null){xe.child=null;do{var at=we.sibling;we.sibling=null,we=at}while(we!==null)}}Qe=T}}if(T.subtreeFlags&2064&&x!==null)x.return=T,Qe=x;else e:for(;Qe!==null;){if(T=Qe,T.flags&2048)switch(T.tag){case 0:case 11:case 15:_c(9,T,T.return)}var ae=T.sibling;if(ae!==null){ae.return=T.return,Qe=ae;break e}Qe=T.return}}var ie=i.current;for(Qe=ie;Qe!==null;){x=Qe;var ue=x.child;if(x.subtreeFlags&2064&&ue!==null)ue.return=x,Qe=ue;else e:for(x=ie;Qe!==null;){if(d=Qe,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:dp(9,d)}}catch(qe){xi(d,d.return,qe)}if(d===x){Qe=null;break e}var ke=d.sibling;if(ke!==null){ke.return=d.return,Qe=ke;break e}Qe=d.return}}if(Lt=_,Uo(),os&&typeof os.onPostCommitFiberRoot=="function")try{os.onPostCommitFiberRoot(np,i)}catch{}f=!0}return f}finally{qt=l,En.transition=s}}return!1}function F0(i,s,l){s=Bl(l,s),s=Bx(i,s,1),i=Do(i,s,1),s=Lr(),i!==null&&(Vc(i,1,s),Gr(i,s))}function xi(i,s,l){if(i.tag===3)F0(i,i,l);else for(;s!==null;){if(s.tag===3){F0(s,i,l);break}else if(s.tag===1){var f=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Lo===null||!Lo.has(f))){i=Bl(l,i),i=Ox(s,i,1),s=Do(s,i,1),i=Lr(),s!==null&&(Vc(s,1,i),Gr(s,i));break}}s=s.return}}function VS(i,s,l){var f=i.pingCache;f!==null&&f.delete(s),s=Lr(),i.pingedLanes|=i.suspendedLanes&l,Ki===i&&(rr&l)===l&&(Vi===4||Vi===3&&(rr&130023424)===rr&&500>Ci()-Ug?_a(i,0):Vg|=l),Gr(i,s)}function n1(i,s){s===0&&(i.mode&1?(s=sd,sd<<=1,!(sd&130023424)&&(sd=4194304)):s=1);var l=Lr();i=Vs(i,s),i!==null&&(Vc(i,s,l),Gr(i,l))}function US(i){var s=i.memoizedState,l=0;s!==null&&(l=s.retryLane),n1(i,l)}function jS(i,s){var l=0;switch(i.tag){case 13:var f=i.stateNode,_=i.memoizedState;_!==null&&(l=_.retryLane);break;case 19:f=i.stateNode;break;default:throw Error(Re(314))}f!==null&&f.delete(s),n1(i,l)}var s1;s1=function(i,s,l){if(i!==null)if(i.memoizedProps!==s.pendingProps||Zr.current)qr=!0;else{if(!(i.lanes&l)&&!(s.flags&128))return qr=!1,PS(i,s,l);qr=!!(i.flags&131072)}else qr=!1,ui&&s.flags&1048576&&lx(s,qd,s.index);switch(s.lanes=0,s.tag){case 2:var f=s.type;Ed(i,s),i=s.pendingProps;var _=Dl(s,vr.current);Pl(s,l),_=Lg(null,s,f,i,_,l);var T=Rg();return s.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Hr(f)?(T=!0,jd(s)):T=!1,s.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Pg(s),_.updater=cp,s.stateNode=_,_._reactInternals=s,Fm(s,f,i,l),s=Nm(null,s,f,!0,T,l)):(s.tag=0,ui&&T&&bg(s),Dr(null,s,_,l),s=s.child),s;case 16:f=s.elementType;e:{switch(Ed(i,s),i=s.pendingProps,_=f._init,f=_(f._payload),s.type=f,_=s.tag=qS(f),i=On(f,i),_){case 0:s=Om(null,s,f,i,l);break e;case 1:s=k0(null,s,f,i,l);break e;case 11:s=T0(null,s,f,i,l);break e;case 14:s=E0(null,s,f,On(f.type,i),l);break e}throw Error(Re(306,f,""))}return s;case 0:return f=s.type,_=s.pendingProps,_=s.elementType===f?_:On(f,_),Om(i,s,f,_,l);case 1:return f=s.type,_=s.pendingProps,_=s.elementType===f?_:On(f,_),k0(i,s,f,_,l);case 3:e:{if(jx(s),i===null)throw Error(Re(387));f=s.pendingProps,T=s.memoizedState,_=T.element,dx(i,s),Gd(s,f,null,l);var x=s.memoizedState;if(f=x.element,T.isDehydrated)if(T={element:f,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},s.updateQueue.baseState=T,s.memoizedState=T,s.flags&256){_=Bl(Error(Re(423)),s),s=I0(i,s,f,l,_);break e}else if(f!==_){_=Bl(Error(Re(424)),s),s=I0(i,s,f,l,_);break e}else for(an=Mo(s.stateNode.containerInfo.firstChild),ln=s,ui=!0,Vn=null,l=gx(s,null,f,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ll(),f===_){s=Us(i,s,l);break e}Dr(i,s,f,l)}s=s.child}return s;case 5:return yx(s),i===null&&Dm(s),f=s.type,_=s.pendingProps,T=i!==null?i.memoizedProps:null,x=_.children,Cm(f,_)?x=null:T!==null&&Cm(f,T)&&(s.flags|=32),Ux(i,s),Dr(i,s,x,l),s.child;case 6:return i===null&&Dm(s),null;case 13:return $x(i,s,l);case 4:return Ag(s,s.stateNode.containerInfo),f=s.pendingProps,i===null?s.child=Rl(s,null,f,l):Dr(i,s,f,l),s.child;case 11:return f=s.type,_=s.pendingProps,_=s.elementType===f?_:On(f,_),T0(i,s,f,_,l);case 7:return Dr(i,s,s.pendingProps,l),s.child;case 8:return Dr(i,s,s.pendingProps.children,l),s.child;case 12:return Dr(i,s,s.pendingProps.children,l),s.child;case 10:e:{if(f=s.type._context,_=s.pendingProps,T=s.memoizedProps,x=_.value,Qt(Zd,f._currentValue),f._currentValue=x,T!==null)if($n(T.value,x)){if(T.children===_.children&&!Zr.current){s=Us(i,s,l);break e}}else for(T=s.child,T!==null&&(T.return=s);T!==null;){var d=T.dependencies;if(d!==null){x=T.child;for(var U=d.firstContext;U!==null;){if(U.context===f){if(T.tag===1){U=Fs(-1,l&-l),U.tag=2;var ee=T.updateQueue;if(ee!==null){ee=ee.shared;var de=ee.pending;de===null?U.next=U:(U.next=de.next,de.next=U),ee.pending=U}}T.lanes|=l,U=T.alternate,U!==null&&(U.lanes|=l),Lm(T.return,l,s),d.lanes|=l;break}U=U.next}}else if(T.tag===10)x=T.type===s.type?null:T.child;else if(T.tag===18){if(x=T.return,x===null)throw Error(Re(341));x.lanes|=l,d=x.alternate,d!==null&&(d.lanes|=l),Lm(x,l,s),x=T.sibling}else x=T.child;if(x!==null)x.return=T;else for(x=T;x!==null;){if(x===s){x=null;break}if(T=x.sibling,T!==null){T.return=x.return,x=T;break}x=x.return}T=x}Dr(i,s,_.children,l),s=s.child}return s;case 9:return _=s.type,f=s.pendingProps.children,Pl(s,l),_=In(_),f=f(_),s.flags|=1,Dr(i,s,f,l),s.child;case 14:return f=s.type,_=On(f,s.pendingProps),_=On(f.type,_),E0(i,s,f,_,l);case 15:return Nx(i,s,s.type,s.pendingProps,l);case 17:return f=s.type,_=s.pendingProps,_=s.elementType===f?_:On(f,_),Ed(i,s),s.tag=1,Hr(f)?(i=!0,jd(s)):i=!1,Pl(s,l),fx(s,f,_),Fm(s,f,_,l),Nm(null,s,f,!0,i,l);case 19:return qx(i,s,l);case 22:return Vx(i,s,l)}throw Error(Re(156,s.tag))};function o1(i,s){return Mv(i,s)}function $S(i,s,l,f){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tn(i,s,l,f){return new $S(i,s,l,f)}function Zg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function qS(i){if(typeof i=="function")return Zg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===cg)return 11;if(i===hg)return 14}return 2}function Fo(i,s){var l=i.alternate;return l===null?(l=Tn(i.tag,s,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=s,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&14680064,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,s=i.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l}function Cd(i,s,l,f,_,T){var x=2;if(f=i,typeof i=="function")Zg(i)&&(x=1);else if(typeof i=="string")x=5;else e:switch(i){case fl:return va(l.children,_,T,s);case ug:x=8,_|=8;break;case om:return i=Tn(12,l,s,_|2),i.elementType=om,i.lanes=T,i;case am:return i=Tn(13,l,s,_),i.elementType=am,i.lanes=T,i;case lm:return i=Tn(19,l,s,_),i.elementType=lm,i.lanes=T,i;case mv:return fp(l,_,T,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case pv:x=10;break e;case fv:x=9;break e;case cg:x=11;break e;case hg:x=14;break e;case So:x=16,f=null;break e}throw Error(Re(130,i==null?i:typeof i,""))}return s=Tn(x,l,s,_),s.elementType=i,s.type=f,s.lanes=T,s}function va(i,s,l,f){return i=Tn(7,i,f,s),i.lanes=l,i}function fp(i,s,l,f){return i=Tn(22,i,f,s),i.elementType=mv,i.lanes=l,i.stateNode={isHidden:!1},i}function Jf(i,s,l){return i=Tn(6,i,null,s),i.lanes=l,i}function Qf(i,s,l){return s=Tn(4,i.children!==null?i.children:[],i.key,s),s.lanes=l,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function ZS(i,s,l,f,_){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Df(0),this.expirationTimes=Df(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Df(0),this.identifierPrefix=f,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Hg(i,s,l,f,_,T,x,d,U){return i=new ZS(i,s,l,d,U),s===1?(s=1,T===!0&&(s|=8)):s=0,T=Tn(3,null,null,s),i.current=T,T.stateNode=i,T.memoizedState={element:f,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pg(T),i}function HS(i,s,l){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pl,key:f==null?null:""+f,children:i,containerInfo:s,implementation:l}}function a1(i){if(!i)return Oo;i=i._reactInternals;e:{if(ka(i)!==i||i.tag!==1)throw Error(Re(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Hr(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Re(171))}if(i.tag===1){var l=i.type;if(Hr(l))return ox(i,l,s)}return s}function l1(i,s,l,f,_,T,x,d,U){return i=Hg(l,f,!0,i,_,T,x,d,U),i.context=a1(null),l=i.current,f=Lr(),_=Ro(l),T=Fs(f,_),T.callback=s??null,Do(l,T,_),i.current.lanes=_,Vc(i,_,f),Gr(i,f),i}function mp(i,s,l,f){var _=s.current,T=Lr(),x=Ro(_);return l=a1(l),s.context===null?s.context=l:s.pendingContext=l,s=Fs(T,x),s.payload={element:i},f=f===void 0?null:f,f!==null&&(s.callback=f),i=Do(_,s,x),i!==null&&(jn(i,_,x,T),bd(i,_,x)),x}function tp(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function B0(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<s?l:s}}function Gg(i,s){B0(i,s),(i=i.alternate)&&B0(i,s)}function GS(){return null}var u1=typeof reportError=="function"?reportError:function(i){console.error(i)};function Wg(i){this._internalRoot=i}gp.prototype.render=Wg.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(Re(409));mp(i,s,null,null)};gp.prototype.unmount=Wg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;Ta(function(){mp(null,i,null,null)}),s[Ns]=null}};function gp(i){this._internalRoot=i}gp.prototype.unstable_scheduleHydration=function(i){if(i){var s=Nv();i={blockedOn:null,target:i,priority:s};for(var l=0;l<Eo.length&&s!==0&&s<Eo[l].priority;l++);Eo.splice(l,0,i),l===0&&Uv(i)}};function Kg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function yp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function O0(){}function WS(i,s,l,f,_){if(_){if(typeof f=="function"){var T=f;f=function(){var ee=tp(x);T.call(ee)}}var x=l1(s,f,i,0,null,!1,!1,"",O0);return i._reactRootContainer=x,i[Ns]=x.current,Pc(i.nodeType===8?i.parentNode:i),Ta(),x}for(;_=i.lastChild;)i.removeChild(_);if(typeof f=="function"){var d=f;f=function(){var ee=tp(U);d.call(ee)}}var U=Hg(i,0,!1,null,null,!1,!1,"",O0);return i._reactRootContainer=U,i[Ns]=U.current,Pc(i.nodeType===8?i.parentNode:i),Ta(function(){mp(s,U,l,f)}),U}function _p(i,s,l,f,_){var T=l._reactRootContainer;if(T){var x=T;if(typeof _=="function"){var d=_;_=function(){var U=tp(x);d.call(U)}}mp(s,x,i,_)}else x=WS(l,s,i,_,f);return tp(x)}Bv=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var l=cc(s.pendingLanes);l!==0&&(fg(s,l|1),Gr(s,Ci()),!(Lt&6)&&(Ol=Ci()+500,Uo()))}break;case 13:Ta(function(){var f=Vs(i,1);if(f!==null){var _=Lr();jn(f,i,1,_)}}),Gg(i,1)}};mg=function(i){if(i.tag===13){var s=Vs(i,134217728);if(s!==null){var l=Lr();jn(s,i,134217728,l)}Gg(i,134217728)}};Ov=function(i){if(i.tag===13){var s=Ro(i),l=Vs(i,s);if(l!==null){var f=Lr();jn(l,i,s,f)}Gg(i,s)}};Nv=function(){return qt};Vv=function(i,s){var l=qt;try{return qt=i,s()}finally{qt=l}};_m=function(i,s,l){switch(s){case"input":if(hm(i,l),s=l.name,l.type==="radio"&&s!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<l.length;s++){var f=l[s];if(f!==i&&f.form===i.form){var _=lp(f);if(!_)throw Error(Re(90));yv(f),hm(f,_)}}}break;case"textarea":vv(i,l);break;case"select":s=l.value,s!=null&&El(i,!!l.multiple,s,!1)}};kv=jg;Iv=Ta;var KS={usingClientEntryPoint:!1,Events:[jc,_l,lp,Tv,Ev,jg]},oc={findFiberByHostInstance:ma,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},XS={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:js.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Av(i),i===null?null:i.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||GS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gd.isDisabled&&gd.supportsFiber)try{np=gd.inject(XS),os=gd}catch{}}cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KS;cn.createPortal=function(i,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kg(s))throw Error(Re(200));return HS(i,s,null,l)};cn.createRoot=function(i,s){if(!Kg(i))throw Error(Re(299));var l=!1,f="",_=u1;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(f=s.identifierPrefix),s.onRecoverableError!==void 0&&(_=s.onRecoverableError)),s=Hg(i,1,!1,null,null,l,!1,f,_),i[Ns]=s.current,Pc(i.nodeType===8?i.parentNode:i),new Wg(s)};cn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(Re(188)):(i=Object.keys(i).join(","),Error(Re(268,i)));return i=Av(s),i=i===null?null:i.stateNode,i};cn.flushSync=function(i){return Ta(i)};cn.hydrate=function(i,s,l){if(!yp(s))throw Error(Re(200));return _p(null,i,s,!0,l)};cn.hydrateRoot=function(i,s,l){if(!Kg(i))throw Error(Re(405));var f=l!=null&&l.hydratedSources||null,_=!1,T="",x=u1;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(T=l.identifierPrefix),l.onRecoverableError!==void 0&&(x=l.onRecoverableError)),s=l1(s,null,i,1,l??null,_,!1,T,x),i[Ns]=s.current,Pc(i),f)for(i=0;i<f.length;i++)l=f[i],_=l._getVersion,_=_(l._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[l,_]:s.mutableSourceEagerHydrationData.push(l,_);return new gp(s)};cn.render=function(i,s,l){if(!yp(s))throw Error(Re(200));return _p(null,i,s,!1,l)};cn.unmountComponentAtNode=function(i){if(!yp(i))throw Error(Re(40));return i._reactRootContainer?(Ta(function(){_p(null,null,i,!1,function(){i._reactRootContainer=null,i[Ns]=null})}),!0):!1};cn.unstable_batchedUpdates=jg;cn.unstable_renderSubtreeIntoContainer=function(i,s,l,f){if(!yp(l))throw Error(Re(200));if(i==null||i._reactInternals===void 0)throw Error(Re(38));return _p(i,s,l,!1,f)};cn.version="18.2.0-next-9e3b772b8-20220608";function c1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c1)}catch(i){console.error(i)}}c1(),lv.exports=cn;var YS=lv.exports,N0=YS;nm.createRoot=N0.createRoot,nm.hydrateRoot=N0.hydrateRoot;function h1(i,s){return function(){return i.apply(s,arguments)}}const{toString:JS}=Object.prototype,{getPrototypeOf:Xg}=Object,vp=(i=>s=>{const l=JS.call(s);return i[l]||(i[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),ls=i=>(i=i.toLowerCase(),s=>vp(s)===i),xp=i=>s=>typeof s===i,{isArray:$l}=Array,Oc=xp("undefined");function QS(i){return i!==null&&!Oc(i)&&i.constructor!==null&&!Oc(i.constructor)&&kn(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const d1=ls("ArrayBuffer");function eT(i){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(i):s=i&&i.buffer&&d1(i.buffer),s}const tT=xp("string"),kn=xp("function"),p1=xp("number"),wp=i=>i!==null&&typeof i=="object",iT=i=>i===!0||i===!1,Pd=i=>{if(vp(i)!=="object")return!1;const s=Xg(i);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},rT=ls("Date"),nT=ls("File"),sT=ls("Blob"),oT=ls("FileList"),aT=i=>wp(i)&&kn(i.pipe),lT=i=>{let s;return i&&(typeof FormData=="function"&&i instanceof FormData||kn(i.append)&&((s=vp(i))==="formdata"||s==="object"&&kn(i.toString)&&i.toString()==="[object FormData]"))},uT=ls("URLSearchParams"),cT=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qc(i,s,{allOwnKeys:l=!1}={}){if(i===null||typeof i>"u")return;let f,_;if(typeof i!="object"&&(i=[i]),$l(i))for(f=0,_=i.length;f<_;f++)s.call(null,i[f],f,i);else{const T=l?Object.getOwnPropertyNames(i):Object.keys(i),x=T.length;let d;for(f=0;f<x;f++)d=T[f],s.call(null,i[d],d,i)}}function f1(i,s){s=s.toLowerCase();const l=Object.keys(i);let f=l.length,_;for(;f-- >0;)if(_=l[f],s===_.toLowerCase())return _;return null}const m1=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,g1=i=>!Oc(i)&&i!==m1;function Ym(){const{caseless:i}=g1(this)&&this||{},s={},l=(f,_)=>{const T=i&&f1(s,_)||_;Pd(s[T])&&Pd(f)?s[T]=Ym(s[T],f):Pd(f)?s[T]=Ym({},f):$l(f)?s[T]=f.slice():s[T]=f};for(let f=0,_=arguments.length;f<_;f++)arguments[f]&&qc(arguments[f],l);return s}const hT=(i,s,l,{allOwnKeys:f}={})=>(qc(s,(_,T)=>{l&&kn(_)?i[T]=h1(_,l):i[T]=_},{allOwnKeys:f}),i),dT=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),pT=(i,s,l,f)=>{i.prototype=Object.create(s.prototype,f),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:s.prototype}),l&&Object.assign(i.prototype,l)},fT=(i,s,l,f)=>{let _,T,x;const d={};if(s=s||{},i==null)return s;do{for(_=Object.getOwnPropertyNames(i),T=_.length;T-- >0;)x=_[T],(!f||f(x,i,s))&&!d[x]&&(s[x]=i[x],d[x]=!0);i=l!==!1&&Xg(i)}while(i&&(!l||l(i,s))&&i!==Object.prototype);return s},mT=(i,s,l)=>{i=String(i),(l===void 0||l>i.length)&&(l=i.length),l-=s.length;const f=i.indexOf(s,l);return f!==-1&&f===l},gT=i=>{if(!i)return null;if($l(i))return i;let s=i.length;if(!p1(s))return null;const l=new Array(s);for(;s-- >0;)l[s]=i[s];return l},yT=(i=>s=>i&&s instanceof i)(typeof Uint8Array<"u"&&Xg(Uint8Array)),_T=(i,s)=>{const f=(i&&i[Symbol.iterator]).call(i);let _;for(;(_=f.next())&&!_.done;){const T=_.value;s.call(i,T[0],T[1])}},vT=(i,s)=>{let l;const f=[];for(;(l=i.exec(s))!==null;)f.push(l);return f},xT=ls("HTMLFormElement"),wT=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,f,_){return f.toUpperCase()+_}),V0=(({hasOwnProperty:i})=>(s,l)=>i.call(s,l))(Object.prototype),bT=ls("RegExp"),y1=(i,s)=>{const l=Object.getOwnPropertyDescriptors(i),f={};qc(l,(_,T)=>{let x;(x=s(_,T,i))!==!1&&(f[T]=x||_)}),Object.defineProperties(i,f)},ST=i=>{y1(i,(s,l)=>{if(kn(i)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const f=i[l];if(kn(f)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},TT=(i,s)=>{const l={},f=_=>{_.forEach(T=>{l[T]=!0})};return $l(i)?f(i):f(String(i).split(s)),l},ET=()=>{},kT=(i,s)=>(i=+i,Number.isFinite(i)?i:s),em="abcdefghijklmnopqrstuvwxyz",U0="0123456789",_1={DIGIT:U0,ALPHA:em,ALPHA_DIGIT:em+em.toUpperCase()+U0},IT=(i=16,s=_1.ALPHA_DIGIT)=>{let l="";const{length:f}=s;for(;i--;)l+=s[Math.random()*f|0];return l};function CT(i){return!!(i&&kn(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const PT=i=>{const s=new Array(10),l=(f,_)=>{if(wp(f)){if(s.indexOf(f)>=0)return;if(!("toJSON"in f)){s[_]=f;const T=$l(f)?[]:{};return qc(f,(x,d)=>{const U=l(x,_+1);!Oc(U)&&(T[d]=U)}),s[_]=void 0,T}}return f};return l(i,0)},AT=ls("AsyncFunction"),zT=i=>i&&(wp(i)||kn(i))&&kn(i.then)&&kn(i.catch),Ce={isArray:$l,isArrayBuffer:d1,isBuffer:QS,isFormData:lT,isArrayBufferView:eT,isString:tT,isNumber:p1,isBoolean:iT,isObject:wp,isPlainObject:Pd,isUndefined:Oc,isDate:rT,isFile:nT,isBlob:sT,isRegExp:bT,isFunction:kn,isStream:aT,isURLSearchParams:uT,isTypedArray:yT,isFileList:oT,forEach:qc,merge:Ym,extend:hT,trim:cT,stripBOM:dT,inherits:pT,toFlatObject:fT,kindOf:vp,kindOfTest:ls,endsWith:mT,toArray:gT,forEachEntry:_T,matchAll:vT,isHTMLForm:xT,hasOwnProperty:V0,hasOwnProp:V0,reduceDescriptors:y1,freezeMethods:ST,toObjectSet:TT,toCamelCase:wT,noop:ET,toFiniteNumber:kT,findKey:f1,global:m1,isContextDefined:g1,ALPHABET:_1,generateString:IT,isSpecCompliantForm:CT,toJSONObject:PT,isAsyncFn:AT,isThenable:zT};function Dt(i,s,l,f,_){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",s&&(this.code=s),l&&(this.config=l),f&&(this.request=f),_&&(this.response=_)}Ce.inherits(Dt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ce.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const v1=Dt.prototype,x1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{x1[i]={value:i}});Object.defineProperties(Dt,x1);Object.defineProperty(v1,"isAxiosError",{value:!0});Dt.from=(i,s,l,f,_,T)=>{const x=Object.create(v1);return Ce.toFlatObject(i,x,function(U){return U!==Error.prototype},d=>d!=="isAxiosError"),Dt.call(x,i.message,s,l,f,_),x.cause=i,x.name=i.name,T&&Object.assign(x,T),x};const MT=null;function Jm(i){return Ce.isPlainObject(i)||Ce.isArray(i)}function w1(i){return Ce.endsWith(i,"[]")?i.slice(0,-2):i}function j0(i,s,l){return i?i.concat(s).map(function(_,T){return _=w1(_),!l&&T?"["+_+"]":_}).join(l?".":""):s}function DT(i){return Ce.isArray(i)&&!i.some(Jm)}const LT=Ce.toFlatObject(Ce,{},null,function(s){return/^is[A-Z]/.test(s)});function bp(i,s,l){if(!Ce.isObject(i))throw new TypeError("target must be an object");s=s||new FormData,l=Ce.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(we,at){return!Ce.isUndefined(at[we])});const f=l.metaTokens,_=l.visitor||de,T=l.dots,x=l.indexes,U=(l.Blob||typeof Blob<"u"&&Blob)&&Ce.isSpecCompliantForm(s);if(!Ce.isFunction(_))throw new TypeError("visitor must be a function");function ee(xe){if(xe===null)return"";if(Ce.isDate(xe))return xe.toISOString();if(!U&&Ce.isBlob(xe))throw new Dt("Blob is not supported. Use a Buffer instead.");return Ce.isArrayBuffer(xe)||Ce.isTypedArray(xe)?U&&typeof Blob=="function"?new Blob([xe]):Buffer.from(xe):xe}function de(xe,we,at){let ae=xe;if(xe&&!at&&typeof xe=="object"){if(Ce.endsWith(we,"{}"))we=f?we:we.slice(0,-2),xe=JSON.stringify(xe);else if(Ce.isArray(xe)&&DT(xe)||(Ce.isFileList(xe)||Ce.endsWith(we,"[]"))&&(ae=Ce.toArray(xe)))return we=w1(we),ae.forEach(function(ue,ke){!(Ce.isUndefined(ue)||ue===null)&&s.append(x===!0?j0([we],ke,T):x===null?we:we+"[]",ee(ue))}),!1}return Jm(xe)?!0:(s.append(j0(at,we,T),ee(xe)),!1)}const H=[],G=Object.assign(LT,{defaultVisitor:de,convertValue:ee,isVisitable:Jm});function Me(xe,we){if(!Ce.isUndefined(xe)){if(H.indexOf(xe)!==-1)throw Error("Circular reference detected in "+we.join("."));H.push(xe),Ce.forEach(xe,function(ae,ie){(!(Ce.isUndefined(ae)||ae===null)&&_.call(s,ae,Ce.isString(ie)?ie.trim():ie,we,G))===!0&&Me(ae,we?we.concat(ie):[ie])}),H.pop()}}if(!Ce.isObject(i))throw new TypeError("data must be an object");return Me(i),s}function $0(i){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(f){return s[f]})}function Yg(i,s){this._pairs=[],i&&bp(i,this,s)}const b1=Yg.prototype;b1.append=function(s,l){this._pairs.push([s,l])};b1.toString=function(s){const l=s?function(f){return s.call(this,f,$0)}:$0;return this._pairs.map(function(_){return l(_[0])+"="+l(_[1])},"").join("&")};function RT(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function S1(i,s,l){if(!s)return i;const f=l&&l.encode||RT,_=l&&l.serialize;let T;if(_?T=_(s,l):T=Ce.isURLSearchParams(s)?s.toString():new Yg(s,l).toString(f),T){const x=i.indexOf("#");x!==-1&&(i=i.slice(0,x)),i+=(i.indexOf("?")===-1?"?":"&")+T}return i}class q0{constructor(){this.handlers=[]}use(s,l,f){return this.handlers.push({fulfilled:s,rejected:l,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Ce.forEach(this.handlers,function(f){f!==null&&s(f)})}}const T1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FT=typeof URLSearchParams<"u"?URLSearchParams:Yg,BT=typeof FormData<"u"?FormData:null,OT=typeof Blob<"u"?Blob:null,NT={isBrowser:!0,classes:{URLSearchParams:FT,FormData:BT,Blob:OT},protocols:["http","https","file","blob","url","data"]},E1=typeof window<"u"&&typeof document<"u",VT=(i=>E1&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),UT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:E1,hasStandardBrowserEnv:VT,hasStandardBrowserWebWorkerEnv:UT},Symbol.toStringTag,{value:"Module"})),ss={...jT,...NT};function $T(i,s){return bp(i,new ss.classes.URLSearchParams,Object.assign({visitor:function(l,f,_,T){return ss.isNode&&Ce.isBuffer(l)?(this.append(f,l.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},s))}function qT(i){return Ce.matchAll(/\w+|\[(\w*)]/g,i).map(s=>s[0]==="[]"?"":s[1]||s[0])}function ZT(i){const s={},l=Object.keys(i);let f;const _=l.length;let T;for(f=0;f<_;f++)T=l[f],s[T]=i[T];return s}function k1(i){function s(l,f,_,T){let x=l[T++];if(x==="__proto__")return!0;const d=Number.isFinite(+x),U=T>=l.length;return x=!x&&Ce.isArray(_)?_.length:x,U?(Ce.hasOwnProp(_,x)?_[x]=[_[x],f]:_[x]=f,!d):((!_[x]||!Ce.isObject(_[x]))&&(_[x]=[]),s(l,f,_[x],T)&&Ce.isArray(_[x])&&(_[x]=ZT(_[x])),!d)}if(Ce.isFormData(i)&&Ce.isFunction(i.entries)){const l={};return Ce.forEachEntry(i,(f,_)=>{s(qT(f),_,l,0)}),l}return null}function HT(i,s,l){if(Ce.isString(i))try{return(s||JSON.parse)(i),Ce.trim(i)}catch(f){if(f.name!=="SyntaxError")throw f}return(l||JSON.stringify)(i)}const Jg={transitional:T1,adapter:["xhr","http"],transformRequest:[function(s,l){const f=l.getContentType()||"",_=f.indexOf("application/json")>-1,T=Ce.isObject(s);if(T&&Ce.isHTMLForm(s)&&(s=new FormData(s)),Ce.isFormData(s))return _?JSON.stringify(k1(s)):s;if(Ce.isArrayBuffer(s)||Ce.isBuffer(s)||Ce.isStream(s)||Ce.isFile(s)||Ce.isBlob(s))return s;if(Ce.isArrayBufferView(s))return s.buffer;if(Ce.isURLSearchParams(s))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let d;if(T){if(f.indexOf("application/x-www-form-urlencoded")>-1)return $T(s,this.formSerializer).toString();if((d=Ce.isFileList(s))||f.indexOf("multipart/form-data")>-1){const U=this.env&&this.env.FormData;return bp(d?{"files[]":s}:s,U&&new U,this.formSerializer)}}return T||_?(l.setContentType("application/json",!1),HT(s)):s}],transformResponse:[function(s){const l=this.transitional||Jg.transitional,f=l&&l.forcedJSONParsing,_=this.responseType==="json";if(s&&Ce.isString(s)&&(f&&!this.responseType||_)){const x=!(l&&l.silentJSONParsing)&&_;try{return JSON.parse(s)}catch(d){if(x)throw d.name==="SyntaxError"?Dt.from(d,Dt.ERR_BAD_RESPONSE,this,null,this.response):d}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ss.classes.FormData,Blob:ss.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ce.forEach(["delete","get","head","post","put","patch"],i=>{Jg.headers[i]={}});const Qg=Jg,GT=Ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),WT=i=>{const s={};let l,f,_;return i&&i.split(`
`).forEach(function(x){_=x.indexOf(":"),l=x.substring(0,_).trim().toLowerCase(),f=x.substring(_+1).trim(),!(!l||s[l]&&GT[l])&&(l==="set-cookie"?s[l]?s[l].push(f):s[l]=[f]:s[l]=s[l]?s[l]+", "+f:f)}),s},Z0=Symbol("internals");function ac(i){return i&&String(i).trim().toLowerCase()}function Ad(i){return i===!1||i==null?i:Ce.isArray(i)?i.map(Ad):String(i)}function KT(i){const s=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=l.exec(i);)s[f[1]]=f[2];return s}const XT=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function tm(i,s,l,f,_){if(Ce.isFunction(f))return f.call(this,s,l);if(_&&(s=l),!!Ce.isString(s)){if(Ce.isString(f))return s.indexOf(f)!==-1;if(Ce.isRegExp(f))return f.test(s)}}function YT(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,l,f)=>l.toUpperCase()+f)}function JT(i,s){const l=Ce.toCamelCase(" "+s);["get","set","has"].forEach(f=>{Object.defineProperty(i,f+l,{value:function(_,T,x){return this[f].call(this,s,_,T,x)},configurable:!0})})}class Sp{constructor(s){s&&this.set(s)}set(s,l,f){const _=this;function T(d,U,ee){const de=ac(U);if(!de)throw new Error("header name must be a non-empty string");const H=Ce.findKey(_,de);(!H||_[H]===void 0||ee===!0||ee===void 0&&_[H]!==!1)&&(_[H||U]=Ad(d))}const x=(d,U)=>Ce.forEach(d,(ee,de)=>T(ee,de,U));return Ce.isPlainObject(s)||s instanceof this.constructor?x(s,l):Ce.isString(s)&&(s=s.trim())&&!XT(s)?x(WT(s),l):s!=null&&T(l,s,f),this}get(s,l){if(s=ac(s),s){const f=Ce.findKey(this,s);if(f){const _=this[f];if(!l)return _;if(l===!0)return KT(_);if(Ce.isFunction(l))return l.call(this,_,f);if(Ce.isRegExp(l))return l.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,l){if(s=ac(s),s){const f=Ce.findKey(this,s);return!!(f&&this[f]!==void 0&&(!l||tm(this,this[f],f,l)))}return!1}delete(s,l){const f=this;let _=!1;function T(x){if(x=ac(x),x){const d=Ce.findKey(f,x);d&&(!l||tm(f,f[d],d,l))&&(delete f[d],_=!0)}}return Ce.isArray(s)?s.forEach(T):T(s),_}clear(s){const l=Object.keys(this);let f=l.length,_=!1;for(;f--;){const T=l[f];(!s||tm(this,this[T],T,s,!0))&&(delete this[T],_=!0)}return _}normalize(s){const l=this,f={};return Ce.forEach(this,(_,T)=>{const x=Ce.findKey(f,T);if(x){l[x]=Ad(_),delete l[T];return}const d=s?YT(T):String(T).trim();d!==T&&delete l[T],l[d]=Ad(_),f[d]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const l=Object.create(null);return Ce.forEach(this,(f,_)=>{f!=null&&f!==!1&&(l[_]=s&&Ce.isArray(f)?f.join(", "):f)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,l])=>s+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...l){const f=new this(s);return l.forEach(_=>f.set(_)),f}static accessor(s){const f=(this[Z0]=this[Z0]={accessors:{}}).accessors,_=this.prototype;function T(x){const d=ac(x);f[d]||(JT(_,x),f[d]=!0)}return Ce.isArray(s)?s.forEach(T):T(s),this}}Sp.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ce.reduceDescriptors(Sp.prototype,({value:i},s)=>{let l=s[0].toUpperCase()+s.slice(1);return{get:()=>i,set(f){this[l]=f}}});Ce.freezeMethods(Sp);const Bs=Sp;function im(i,s){const l=this||Qg,f=s||l,_=Bs.from(f.headers);let T=f.data;return Ce.forEach(i,function(d){T=d.call(l,T,_.normalize(),s?s.status:void 0)}),_.normalize(),T}function I1(i){return!!(i&&i.__CANCEL__)}function Zc(i,s,l){Dt.call(this,i??"canceled",Dt.ERR_CANCELED,s,l),this.name="CanceledError"}Ce.inherits(Zc,Dt,{__CANCEL__:!0});function QT(i,s,l){const f=l.config.validateStatus;!l.status||!f||f(l.status)?i(l):s(new Dt("Request failed with status code "+l.status,[Dt.ERR_BAD_REQUEST,Dt.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}const eE=ss.hasStandardBrowserEnv?{write(i,s,l,f,_,T){const x=[i+"="+encodeURIComponent(s)];Ce.isNumber(l)&&x.push("expires="+new Date(l).toGMTString()),Ce.isString(f)&&x.push("path="+f),Ce.isString(_)&&x.push("domain="+_),T===!0&&x.push("secure"),document.cookie=x.join("; ")},read(i){const s=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tE(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function iE(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}function C1(i,s){return i&&!tE(s)?iE(i,s):s}const rE=ss.hasStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a");let f;function _(T){let x=T;return s&&(l.setAttribute("href",x),x=l.href),l.setAttribute("href",x),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:l.pathname.charAt(0)==="/"?l.pathname:"/"+l.pathname}}return f=_(window.location.href),function(x){const d=Ce.isString(x)?_(x):x;return d.protocol===f.protocol&&d.host===f.host}}():function(){return function(){return!0}}();function nE(i){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return s&&s[1]||""}function sE(i,s){i=i||10;const l=new Array(i),f=new Array(i);let _=0,T=0,x;return s=s!==void 0?s:1e3,function(U){const ee=Date.now(),de=f[T];x||(x=ee),l[_]=U,f[_]=ee;let H=T,G=0;for(;H!==_;)G+=l[H++],H=H%i;if(_=(_+1)%i,_===T&&(T=(T+1)%i),ee-x<s)return;const Me=de&&ee-de;return Me?Math.round(G*1e3/Me):void 0}}function H0(i,s){let l=0;const f=sE(50,250);return _=>{const T=_.loaded,x=_.lengthComputable?_.total:void 0,d=T-l,U=f(d),ee=T<=x;l=T;const de={loaded:T,total:x,progress:x?T/x:void 0,bytes:d,rate:U||void 0,estimated:U&&x&&ee?(x-T)/U:void 0,event:_};de[s?"download":"upload"]=!0,i(de)}}const oE=typeof XMLHttpRequest<"u",aE=oE&&function(i){return new Promise(function(l,f){let _=i.data;const T=Bs.from(i.headers).normalize();let{responseType:x,withXSRFToken:d}=i,U;function ee(){i.cancelToken&&i.cancelToken.unsubscribe(U),i.signal&&i.signal.removeEventListener("abort",U)}let de;if(Ce.isFormData(_)){if(ss.hasStandardBrowserEnv||ss.hasStandardBrowserWebWorkerEnv)T.setContentType(!1);else if((de=T.getContentType())!==!1){const[we,...at]=de?de.split(";").map(ae=>ae.trim()).filter(Boolean):[];T.setContentType([we||"multipart/form-data",...at].join("; "))}}let H=new XMLHttpRequest;if(i.auth){const we=i.auth.username||"",at=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";T.set("Authorization","Basic "+btoa(we+":"+at))}const G=C1(i.baseURL,i.url);H.open(i.method.toUpperCase(),S1(G,i.params,i.paramsSerializer),!0),H.timeout=i.timeout;function Me(){if(!H)return;const we=Bs.from("getAllResponseHeaders"in H&&H.getAllResponseHeaders()),ae={data:!x||x==="text"||x==="json"?H.responseText:H.response,status:H.status,statusText:H.statusText,headers:we,config:i,request:H};QT(function(ue){l(ue),ee()},function(ue){f(ue),ee()},ae),H=null}if("onloadend"in H?H.onloadend=Me:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(Me)},H.onabort=function(){H&&(f(new Dt("Request aborted",Dt.ECONNABORTED,i,H)),H=null)},H.onerror=function(){f(new Dt("Network Error",Dt.ERR_NETWORK,i,H)),H=null},H.ontimeout=function(){let at=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const ae=i.transitional||T1;i.timeoutErrorMessage&&(at=i.timeoutErrorMessage),f(new Dt(at,ae.clarifyTimeoutError?Dt.ETIMEDOUT:Dt.ECONNABORTED,i,H)),H=null},ss.hasStandardBrowserEnv&&(d&&Ce.isFunction(d)&&(d=d(i)),d||d!==!1&&rE(G))){const we=i.xsrfHeaderName&&i.xsrfCookieName&&eE.read(i.xsrfCookieName);we&&T.set(i.xsrfHeaderName,we)}_===void 0&&T.setContentType(null),"setRequestHeader"in H&&Ce.forEach(T.toJSON(),function(at,ae){H.setRequestHeader(ae,at)}),Ce.isUndefined(i.withCredentials)||(H.withCredentials=!!i.withCredentials),x&&x!=="json"&&(H.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&H.addEventListener("progress",H0(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&H.upload&&H.upload.addEventListener("progress",H0(i.onUploadProgress)),(i.cancelToken||i.signal)&&(U=we=>{H&&(f(!we||we.type?new Zc(null,i,H):we),H.abort(),H=null)},i.cancelToken&&i.cancelToken.subscribe(U),i.signal&&(i.signal.aborted?U():i.signal.addEventListener("abort",U)));const xe=nE(G);if(xe&&ss.protocols.indexOf(xe)===-1){f(new Dt("Unsupported protocol "+xe+":",Dt.ERR_BAD_REQUEST,i));return}H.send(_||null)})},Qm={http:MT,xhr:aE};Ce.forEach(Qm,(i,s)=>{if(i){try{Object.defineProperty(i,"name",{value:s})}catch{}Object.defineProperty(i,"adapterName",{value:s})}});const G0=i=>`- ${i}`,lE=i=>Ce.isFunction(i)||i===null||i===!1,P1={getAdapter:i=>{i=Ce.isArray(i)?i:[i];const{length:s}=i;let l,f;const _={};for(let T=0;T<s;T++){l=i[T];let x;if(f=l,!lE(l)&&(f=Qm[(x=String(l)).toLowerCase()],f===void 0))throw new Dt(`Unknown adapter '${x}'`);if(f)break;_[x||"#"+T]=f}if(!f){const T=Object.entries(_).map(([d,U])=>`adapter ${d} `+(U===!1?"is not supported by the environment":"is not available in the build"));let x=s?T.length>1?`since :
`+T.map(G0).join(`
`):" "+G0(T[0]):"as no adapter specified";throw new Dt("There is no suitable adapter to dispatch the request "+x,"ERR_NOT_SUPPORT")}return f},adapters:Qm};function rm(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Zc(null,i)}function W0(i){return rm(i),i.headers=Bs.from(i.headers),i.data=im.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),P1.getAdapter(i.adapter||Qg.adapter)(i).then(function(f){return rm(i),f.data=im.call(i,i.transformResponse,f),f.headers=Bs.from(f.headers),f},function(f){return I1(f)||(rm(i),f&&f.response&&(f.response.data=im.call(i,i.transformResponse,f.response),f.response.headers=Bs.from(f.response.headers))),Promise.reject(f)})}const K0=i=>i instanceof Bs?{...i}:i;function Nl(i,s){s=s||{};const l={};function f(ee,de,H){return Ce.isPlainObject(ee)&&Ce.isPlainObject(de)?Ce.merge.call({caseless:H},ee,de):Ce.isPlainObject(de)?Ce.merge({},de):Ce.isArray(de)?de.slice():de}function _(ee,de,H){if(Ce.isUndefined(de)){if(!Ce.isUndefined(ee))return f(void 0,ee,H)}else return f(ee,de,H)}function T(ee,de){if(!Ce.isUndefined(de))return f(void 0,de)}function x(ee,de){if(Ce.isUndefined(de)){if(!Ce.isUndefined(ee))return f(void 0,ee)}else return f(void 0,de)}function d(ee,de,H){if(H in s)return f(ee,de);if(H in i)return f(void 0,ee)}const U={url:T,method:T,data:T,baseURL:x,transformRequest:x,transformResponse:x,paramsSerializer:x,timeout:x,timeoutMessage:x,withCredentials:x,withXSRFToken:x,adapter:x,responseType:x,xsrfCookieName:x,xsrfHeaderName:x,onUploadProgress:x,onDownloadProgress:x,decompress:x,maxContentLength:x,maxBodyLength:x,beforeRedirect:x,transport:x,httpAgent:x,httpsAgent:x,cancelToken:x,socketPath:x,responseEncoding:x,validateStatus:d,headers:(ee,de)=>_(K0(ee),K0(de),!0)};return Ce.forEach(Object.keys(Object.assign({},i,s)),function(de){const H=U[de]||_,G=H(i[de],s[de],de);Ce.isUndefined(G)&&H!==d||(l[de]=G)}),l}const A1="1.6.8",ey={};["object","boolean","number","function","string","symbol"].forEach((i,s)=>{ey[i]=function(f){return typeof f===i||"a"+(s<1?"n ":" ")+i}});const X0={};ey.transitional=function(s,l,f){function _(T,x){return"[Axios v"+A1+"] Transitional option '"+T+"'"+x+(f?". "+f:"")}return(T,x,d)=>{if(s===!1)throw new Dt(_(x," has been removed"+(l?" in "+l:"")),Dt.ERR_DEPRECATED);return l&&!X0[x]&&(X0[x]=!0,console.warn(_(x," has been deprecated since v"+l+" and will be removed in the near future"))),s?s(T,x,d):!0}};function uE(i,s,l){if(typeof i!="object")throw new Dt("options must be an object",Dt.ERR_BAD_OPTION_VALUE);const f=Object.keys(i);let _=f.length;for(;_-- >0;){const T=f[_],x=s[T];if(x){const d=i[T],U=d===void 0||x(d,T,i);if(U!==!0)throw new Dt("option "+T+" must be "+U,Dt.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new Dt("Unknown option "+T,Dt.ERR_BAD_OPTION)}}const eg={assertOptions:uE,validators:ey},bo=eg.validators;class ip{constructor(s){this.defaults=s,this.interceptors={request:new q0,response:new q0}}async request(s,l){try{return await this._request(s,l)}catch(f){if(f instanceof Error){let _;Error.captureStackTrace?Error.captureStackTrace(_={}):_=new Error;const T=_.stack?_.stack.replace(/^.+\n/,""):"";f.stack?T&&!String(f.stack).endsWith(T.replace(/^.+\n.+\n/,""))&&(f.stack+=`
`+T):f.stack=T}throw f}}_request(s,l){typeof s=="string"?(l=l||{},l.url=s):l=s||{},l=Nl(this.defaults,l);const{transitional:f,paramsSerializer:_,headers:T}=l;f!==void 0&&eg.assertOptions(f,{silentJSONParsing:bo.transitional(bo.boolean),forcedJSONParsing:bo.transitional(bo.boolean),clarifyTimeoutError:bo.transitional(bo.boolean)},!1),_!=null&&(Ce.isFunction(_)?l.paramsSerializer={serialize:_}:eg.assertOptions(_,{encode:bo.function,serialize:bo.function},!0)),l.method=(l.method||this.defaults.method||"get").toLowerCase();let x=T&&Ce.merge(T.common,T[l.method]);T&&Ce.forEach(["delete","get","head","post","put","patch","common"],xe=>{delete T[xe]}),l.headers=Bs.concat(x,T);const d=[];let U=!0;this.interceptors.request.forEach(function(we){typeof we.runWhen=="function"&&we.runWhen(l)===!1||(U=U&&we.synchronous,d.unshift(we.fulfilled,we.rejected))});const ee=[];this.interceptors.response.forEach(function(we){ee.push(we.fulfilled,we.rejected)});let de,H=0,G;if(!U){const xe=[W0.bind(this),void 0];for(xe.unshift.apply(xe,d),xe.push.apply(xe,ee),G=xe.length,de=Promise.resolve(l);H<G;)de=de.then(xe[H++],xe[H++]);return de}G=d.length;let Me=l;for(H=0;H<G;){const xe=d[H++],we=d[H++];try{Me=xe(Me)}catch(at){we.call(this,at);break}}try{de=W0.call(this,Me)}catch(xe){return Promise.reject(xe)}for(H=0,G=ee.length;H<G;)de=de.then(ee[H++],ee[H++]);return de}getUri(s){s=Nl(this.defaults,s);const l=C1(s.baseURL,s.url);return S1(l,s.params,s.paramsSerializer)}}Ce.forEach(["delete","get","head","options"],function(s){ip.prototype[s]=function(l,f){return this.request(Nl(f||{},{method:s,url:l,data:(f||{}).data}))}});Ce.forEach(["post","put","patch"],function(s){function l(f){return function(T,x,d){return this.request(Nl(d||{},{method:s,headers:f?{"Content-Type":"multipart/form-data"}:{},url:T,data:x}))}}ip.prototype[s]=l(),ip.prototype[s+"Form"]=l(!0)});const zd=ip;class ty{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(T){l=T});const f=this;this.promise.then(_=>{if(!f._listeners)return;let T=f._listeners.length;for(;T-- >0;)f._listeners[T](_);f._listeners=null}),this.promise.then=_=>{let T;const x=new Promise(d=>{f.subscribe(d),T=d}).then(_);return x.cancel=function(){f.unsubscribe(T)},x},s(function(T,x,d){f.reason||(f.reason=new Zc(T,x,d),l(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const l=this._listeners.indexOf(s);l!==-1&&this._listeners.splice(l,1)}static source(){let s;return{token:new ty(function(_){s=_}),cancel:s}}}const cE=ty;function hE(i){return function(l){return i.apply(null,l)}}function dE(i){return Ce.isObject(i)&&i.isAxiosError===!0}const tg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tg).forEach(([i,s])=>{tg[s]=i});const pE=tg;function z1(i){const s=new zd(i),l=h1(zd.prototype.request,s);return Ce.extend(l,zd.prototype,s,{allOwnKeys:!0}),Ce.extend(l,s,null,{allOwnKeys:!0}),l.create=function(_){return z1(Nl(i,_))},l}const Li=z1(Qg);Li.Axios=zd;Li.CanceledError=Zc;Li.CancelToken=cE;Li.isCancel=I1;Li.VERSION=A1;Li.toFormData=bp;Li.AxiosError=Dt;Li.Cancel=Li.CanceledError;Li.all=function(s){return Promise.all(s)};Li.spread=hE;Li.isAxiosError=dE;Li.mergeConfig=Nl;Li.AxiosHeaders=Bs;Li.formToJSON=i=>k1(Ce.isHTMLForm(i)?new FormData(i):i);Li.getAdapter=P1.getAdapter;Li.HttpStatusCode=pE;Li.default=Li;var M1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(i,s){(function(l,f){i.exports=f()})(Tb,function(){var l={},f={};function _(x,d,U){if(f[x]=U,x==="index"){var ee="var sharedModule = {}; ("+f.shared+")(sharedModule); ("+f.worker+")(sharedModule);",de={};return f.shared(de),f.index(l,de),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"}))),l}}_("shared",["exports"],function(x){function d(r,e,n,a){return new(n||(n=Promise))(function(h,g){function y(k){try{S(a.next(k))}catch(C){g(C)}}function v(k){try{S(a.throw(k))}catch(C){g(C)}}function S(k){var C;k.done?h(k.value):(C=k.value,C instanceof n?C:new n(function(P){P(C)})).then(y,v)}S((a=a.apply(r,e||[])).next())})}function U(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ee=de;function de(r,e){this.x=r,this.y=e}de.prototype={clone:function(){return new de(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),n=Math.sin(r),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(r,e){var n=Math.cos(r),a=Math.sin(r),h=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},de.convert=function(r){return r instanceof de?r:Array.isArray(r)?new de(r[0],r[1]):r};var H=U(ee),G=Me;function Me(r,e,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=a}Me.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var h=this.sampleCurveX(n)-r;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,v=1;for(n=r,a=0;a<20&&(h=this.sampleCurveX(n),!(Math.abs(h-r)<e));a++)r>h?y=n:v=n,n=.5*(v-y)+y;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var xe=U(G);let we,at;function ae(){return we==null&&(we=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),we}function ie(){if(at==null&&(at=!1,ae())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const h=4*a;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&n[a]!==a){at=!0;break}}}return at||!1}function ue(r,e,n,a){const h=new xe(r,e,n,a);return function(g){return h.solve(g)}}const ke=ue(.25,.1,.25,1);function qe(r,e,n){return Math.min(n,Math.max(e,r))}function Je(r,e,n){const a=n-e,h=((r-e)%a+a)%a+e;return h===e?n:h}function Ge(r,...e){for(const n of e)for(const a in n)r[a]=n[a];return r}let et=1;function Rt(r,e,n){const a={};for(const h in r)a[h]=e.call(n||this,r[h],h,r);return a}function xt(r,e,n){const a={};for(const h in r)e.call(n||this,r[h],h,r)&&(a[h]=r[h]);return a}function Zt(r){return Array.isArray(r)?r.map(Zt):typeof r=="object"&&r?Rt(r,Zt):r}const Ot={};function si(r){Ot[r]||(typeof console<"u"&&console.warn(r),Ot[r]=!0)}function sr(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function Pn(r){let e=0;for(let n,a,h=0,g=r.length,y=g-1;h<g;y=h++)n=r[h],a=r[y],e+=(a.x-n.x)*(n.y+a.y);return e}function xr(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let dn=null;function Ze(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(r,e,n,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(r,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const v=y.startsWith("BGR"),S=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(S,function(k,C,P,D,R){const B=4*Math.max(-C,0),V=(Math.max(0,P)-P)*D*4+B,W=4*D,Y=Math.max(0,C),ce=Math.max(0,P);return{rect:{x:Y,y:ce,width:Math.min(k.width,C+D)-Y,height:Math.min(k.height,P+R)-ce},layout:[{offset:V,stride:W}]}}(r,e,n,a,h)),v)for(let k=0;k<S.length;k+=4){const C=S[k];S[k]=S[k+2],S[k+2]=C}return S}finally{g.close()}})}let It,zt;const Br="AbortError";function Pi(){return new Error(Br)}const Wr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ri(r){return Wr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Ui="global-dispatcher";class Kr extends Error{constructor(e,n,a,h){super(`AJAXError: ${n} (${e}): ${a}`),this.status=e,this.statusText=n,this.url=a,this.body=h}}const $s=()=>xr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qn=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const a=Ri(r.url);if(a)return a(r,e);if(xr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:r,targetMapId:Ui},e)}if(!(/^file:/.test(n=r.url)||/^file:/.test($s())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:$s(),signal:h.signal});a.type==="json"&&g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const k=yield y.blob();throw new Kr(y.status,y.statusText,a.url,k)}let v;v=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const S=yield v;if(h.signal.aborted)throw Pi();return{data:S,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(r,e);if(xr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:r,mustQueue:!0,targetMapId:Ui},e)}var n;return function(a,h){return new Promise((g,y)=>{const v=new XMLHttpRequest;v.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(v.responseType="arraybuffer");for(const S in a.headers)v.setRequestHeader(S,a.headers[S]);a.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=a.credentials==="include",v.onerror=()=>{y(new Error(v.statusText))},v.onload=()=>{if(!h.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let S=v.response;if(a.type==="json")try{S=JSON.parse(v.response)}catch(k){return void y(k)}g({data:S,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const S=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});y(new Kr(v.status,v.statusText,a.url,S))}},h.signal.addEventListener("abort",()=>{v.abort(),y(Pi())}),v.send(a.body)})}(r,e)};function Ia(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Zn(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function Hn(r,e,n){if(n&&n[r]){const a=n[r].indexOf(e);a!==-1&&n[r].splice(a,1)}}class Gn{constructor(e,n={}){Ge(this,n),this.type=e}}class wi extends Gn{constructor(e,n={}){super("error",Ge({error:e},n))}}class us{on(e,n){return this._listeners=this._listeners||{},Zn(e,n,this._listeners),this}off(e,n){return Hn(e,n,this._listeners),Hn(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Zn(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new Gn(e,n||{}));const a=e.type;if(this.listens(a)){e.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of g)Hn(a,v,this._oneTimeListeners),v.call(this,e);const y=this._eventedParent;y&&(Ge(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof wi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function jo(r,e){const n={};for(const a in r)a!=="ref"&&(n[a]=r[a]);return cs.forEach(a=>{a in e&&(n[a]=e[a])}),n}function Tt(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!Tt(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!Tt(r[n],e[n]))return!1;return!0}return r===e}function Fi(r,e){r.push(e)}function pn(r,e,n){Fi(n,{command:"addSource",args:[r,e[r]]})}function qs(r,e,n){Fi(e,{command:"removeSource",args:[r]}),n[r]=!0}function Zs(r,e,n,a){qs(r,n,a),pn(r,e,n)}function Hs(r,e,n){let a;for(a in r[n])if(Object.prototype.hasOwnProperty.call(r[n],a)&&a!=="data"&&!Tt(r[n][a],e[n][a]))return!1;for(a in e[n])if(Object.prototype.hasOwnProperty.call(e[n],a)&&a!=="data"&&!Tt(r[n][a],e[n][a]))return!1;return!0}function hs(r,e,n,a,h,g){r=r||{},e=e||{};for(const y in r)Object.prototype.hasOwnProperty.call(r,y)&&(Tt(r[y],e[y])||n.push({command:g,args:[a,y,e[y],h]}));for(const y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(r,y)&&(Tt(r[y],e[y])||n.push({command:g,args:[a,y,e[y],h]}))}function Gs(r){return r.id}function $o(r,e){return r[e.id]=e,r}class Le{constructor(e,n,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function wr(r,...e){for(const n of e)for(const a in n)r[a]=n[a];return r}class or extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class qo{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,h]of n)this.bindings[a]=h}concat(e){return new qo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ds={kind:"null"},ze={kind:"number"},gt={kind:"string"},dt={kind:"boolean"},Bi={kind:"color"},Or={kind:"object"},pt={kind:"value"},Wn={kind:"collator"},An={kind:"formatted"},q={kind:"padding"},M={kind:"resolvedImage"},L={kind:"variableAnchorOffsetCollection"};function O(r,e){return{kind:"array",itemType:r,N:e}}function j(r){if(r.kind==="array"){const e=j(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const re=[ds,ze,gt,dt,Bi,An,Or,O(pt),q,M,L];function ne(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ne(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of re)if(!ne(n,e))return null}}return`Expected ${j(r)} but found ${j(e)} instead.`}function le(r,e){return e.some(n=>n.kind===r.kind)}function Q(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function he(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Ee=.96422,_e=.82521,be=4/29,Ke=6/29,st=3*Ke*Ke,rt=Ke*Ke*Ke,Et=Math.PI/180,lt=180/Math.PI;function Ht(r){return(r%=360)<0&&(r+=360),r}function Nt([r,e,n,a]){let h,g;const y=ft((.2225045*(r=ci(r))+.7168786*(e=ci(e))+.0606169*(n=ci(n)))/1);r===e&&e===n?h=g=y:(h=ft((.4360747*r+.3850649*e+.1430804*n)/Ee),g=ft((.0139322*r+.0971045*e+.7141733*n)/_e));const v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-g),a]}function ci(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ft(r){return r>rt?Math.pow(r,1/3):r/st+be}function ei([r,e,n,a]){let h=(r+16)/116,g=isNaN(e)?h:h+e/500,y=isNaN(n)?h:h-n/200;return h=1*ar(h),g=Ee*ar(g),y=_e*ar(y),[Ai(3.1338561*g-1.6168667*h-.4906146*y),Ai(-.9787684*g+1.9161415*h+.033454*y),Ai(.0719453*g-.2289914*h+1.4052427*y),a]}function Ai(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function ar(r){return r>Ke?r*r*r:st*(r-be)}function ji(r){return parseInt(r.padEnd(2,r),16)/255}function Xi(r,e){return br(e?r/100:r,0,1)}function br(r,e,n){return Math.min(Math.max(e,r),n)}function Hc(r){return!r.some(Number.isNaN)}const Tp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ft{constructor(e,n,a,h=1,g=!0){this.r=e,this.g=n,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,n,a,h]))}static parse(e){if(e instanceof Ft)return e;if(typeof e!="string")return;const n=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Tp[a];if(h){const[y,v,S]=h;return[y/255,v/255,S/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let v=1;return[ji(a.slice(v,v+=y)),ji(a.slice(v,v+=y)),ji(a.slice(v,v+=y)),ji(a.slice(v,v+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,S,k,C,P,D,R,B,V,W,Y,ce]=y,J=[C||" ",R||" ",W].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const se=[k,D,V].join(""),ve=se==="%%%"?100:se===""?255:0;if(ve){const Se=[br(+S/ve,0,1),br(+P/ve,0,1),br(+B/ve,0,1),Y?Xi(+Y,ce):1];if(Hc(Se))return Se}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,v,S,k,C,P,D,R,B]=g,V=[S||" ",C||" ",D].join("");if(V==="  "||V==="  /"||V===",,"||V===",,,"){const W=[+v,br(+k,0,100),br(+P,0,100),R?Xi(+R,B):1];if(Hc(W))return function([Y,ce,J,se]){function ve(Se){const Ve=(Se+Y/30)%12,We=ce*Math.min(J,1-J);return J-We*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return Y=Ht(Y),ce/=100,J/=100,[ve(0),ve(8),ve(4),se]}(W)}}}(e);return n?new Ft(...n,!1):void 0}get rgb(){const{r:e,g:n,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[e/g,n/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,a,h,g]=Nt(e),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?Ht(Math.atan2(h,a)*lt):NaN,y,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nt(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,a,h]=this.rgb;return`rgba(${[e,n,a].map(g=>Math.round(255*g)).join(",")},${h})`}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class ql{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zl{constructor(e,n,a,h,g){this.text=e,this.image=n,this.scale=a,this.fontStack=h,this.textColor=g}}class Sr{constructor(e){this.sections=e}static fromString(e){return new Sr([new Zl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Sr?e:Sr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Tr)return e;if(typeof e=="number")return new Tr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Tr(e)}}toString(){return JSON.stringify(this.values)}}const Gc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $i{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof $i)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const a=e[n],h=e[n+1];if(typeof a!="string"||!Gc.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new $i(e)}}toString(){return JSON.stringify(this.values)}}class Nr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Nr({name:e,available:!1}):null}}function Wc(r,e,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,n,a]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ft||r instanceof ql||r instanceof Sr||r instanceof Tr||r instanceof $i||r instanceof Nr)return!0;if(Array.isArray(r)){for(const e of r)if(!Kn(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Kn(r[e]))return!1;return!0}return!1}function yi(r){if(r===null)return ds;if(typeof r=="string")return gt;if(typeof r=="boolean")return dt;if(typeof r=="number")return ze;if(r instanceof Ft)return Bi;if(r instanceof ql)return Wn;if(r instanceof Sr)return An;if(r instanceof Tr)return q;if(r instanceof $i)return L;if(r instanceof Nr)return M;if(Array.isArray(r)){const e=r.length;let n;for(const a of r){const h=yi(a);if(n){if(n===h)continue;n=pt;break}n=h}return O(n||pt,e)}return Or}function Zo(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Ft||r instanceof Sr||r instanceof Tr||r instanceof $i||r instanceof Nr?r.toString():JSON.stringify(r)}class ps{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Kn(e[1]))return n.error("invalid value");const a=e[1];let h=yi(a);const g=n.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new ps(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class oi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const fs={string:gt,number:ze,boolean:dt,object:Or};class Xr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,h=1;const g=e[0];if(g==="array"){let v,S;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in fs)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=fs[k],h++}else v=pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],h++}a=O(v,S)}else{if(!fs[g])throw new Error(`Types doesn't contain name = ${g}`);a=fs[g]}const y=[];for(;h<e.length;h++){const v=n.parse(e[h],h,pt);if(!v)return null;y.push(v)}return new Xr(a,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!ne(this.type,yi(a)))return a;if(n===this.args.length-1)throw new oi(`Expected value to be of type ${j(this.type)}, but found ${j(yi(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ca={"to-boolean":dt,"to-color":Bi,"to-number":ze,"to-string":gt};class fn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0];if(!Ca[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");const h=Ca[a],g=[];for(let y=1;y<e.length;y++){const v=n.parse(e[y],y,pt);if(!v)return null;g.push(v)}return new fn(h,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,a;for(const h of this.args){if(n=h.evaluate(e),a=null,n instanceof Ft)return n;if(typeof n=="string"){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Wc(n[0],n[1],n[2],n[3]),!a))return new Ft(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new oi(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const a of this.args){n=a.evaluate(e);const h=Tr.parse(n);if(h)return h}throw new oi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const a of this.args){n=a.evaluate(e);const h=$i.parse(n);if(h)return h}throw new oi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new oi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Sr.fromString(Zo(this.args[0].evaluate(e)));case"resolvedImage":return Nr.fromString(Zo(this.args[0].evaluate(e)));default:return Zo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Hl=["Unknown","Point","LineString","Polygon"];class Ws{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Ft.parse(e)),n}}class Mt{constructor(e,n,a=[],h,g=new qo,y=[]){this.registry=e,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=n}parse(e,n,a,h,g={}){return n?this.concat(n,a,h)._parse(e,g):this._parse(e,g)}_parse(e,n){function a(h,g,y){return y==="assert"?new Xr(g,[h]):y==="coerce"?new fn(g,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(e,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,S=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(v.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(v,S))return null}else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"assert")}if(!(y instanceof ps)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const v=new Ws;try{y=new ps(y.type,y.evaluate(v))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){const h=typeof e=="number"?this.path.concat(e):this.path,g=a?this.scope.concat(a):this.scope;return new Mt(this.registry,this._isConstant,h,n||null,g,this.errors)}error(e,...n){const a=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new or(a,e))}checkSubtype(e,n){const a=ne(e,n);return a&&this.error(a),a}}class Pa{constructor(e,n,a){this.type=Wn,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const h=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,dt);if(!h)return null;const g=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,dt);if(!g)return null;let y=null;return a.locale&&(y=n.parse(a.locale,1,gt),!y)?null:new Pa(h,g,y)}evaluate(e){return new ql(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const mn=8192;function Gl(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ho(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Kc(r,e){const n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*mn),Math.round(a*h*mn)]}function Ep(r,e,n){const a=r[0]-e[0],h=r[1]-e[1],g=r[0]-n[0],y=r[1]-n[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function Aa(r,e){let n=!1;for(let y=0,v=e.length;y<v;y++){const S=e[y];for(let k=0,C=S.length;k<C-1;k++){if(Ep(r,S[k],S[k+1]))return!1;(h=S[k])[1]>(a=r)[1]!=(g=S[k+1])[1]>a[1]&&a[0]<(g[0]-h[0])*(a[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var a,h,g;return n}function Xc(r,e){for(let n=0;n<e.length;n++)if(Aa(r,e[n]))return!0;return!1}function Yc(r,e,n,a){const h=a[0]-n[0],g=a[1]-n[1],y=(r[0]-n[0])*g-h*(r[1]-n[1]),v=(e[0]-n[0])*g-h*(e[1]-n[1]);return y>0&&v<0||y<0&&v>0}function kp(r,e,n){for(const k of n)for(let C=0;C<k.length-1;++C)if((v=[(y=k[C+1])[0]-(g=k[C])[0],y[1]-g[1]])[0]*(S=[(h=e)[0]-(a=r)[0],h[1]-a[1]])[1]-v[1]*S[0]!=0&&Yc(a,h,g,y)&&Yc(g,y,a,h))return!0;var a,h,g,y,v,S;return!1}function Jc(r,e){for(let n=0;n<r.length;++n)if(!Aa(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(kp(r[n],r[n+1],e))return!1;return!0}function Ip(r,e){for(let n=0;n<e.length;n++)if(Jc(r,e[n]))return!0;return!1}function za(r,e,n){const a=[];for(let h=0;h<r.length;h++){const g=[];for(let y=0;y<r[h].length;y++){const v=Kc(r[h][y],n);Gl(e,v),g.push(v)}a.push(g)}return a}function Wl(r,e,n){const a=[];for(let h=0;h<r.length;h++){const g=za(r[h],e,n);a.push(g)}return a}function Qc(r,e,n,a){if(r[0]<n[0]||r[0]>n[2]){const h=.5*a;let g=r[0]-n[0]>h?-a:n[0]-r[0]>h?a:0;g===0&&(g=r[0]-n[2]>h?-a:n[2]-r[0]>h?a:0),r[0]+=g}Gl(e,r)}function eh(r,e,n,a){const h=Math.pow(2,a.z)*mn,g=[a.x*mn,a.y*mn],y=[];for(const v of r)for(const S of v){const k=[S.x+g[0],S.y+g[1]];Qc(k,e,n,h),y.push(k)}return y}function Ma(r,e,n,a){const h=Math.pow(2,a.z)*mn,g=[a.x*mn,a.y*mn],y=[];for(const S of r){const k=[];for(const C of S){const P=[C.x+g[0],C.y+g[1]];Gl(e,P),k.push(P)}y.push(k)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of y)for(const k of S)Qc(k,e,n,h)}var v;return y}class ms{constructor(e,n){this.type=dt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Kn(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:y,coordinates:v}=g.geometry;y==="Polygon"&&h.push(v),y==="MultiPolygon"&&h.push(...v)}if(h.length)return new ms(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ms(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ms(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){const v=za(a.coordinates,g,y),S=eh(n.geometry(),h,g,y);if(!Ho(h,g))return!1;for(const k of S)if(!Aa(k,v))return!1}if(a.type==="MultiPolygon"){const v=Wl(a.coordinates,g,y),S=eh(n.geometry(),h,g,y);if(!Ho(h,g))return!1;for(const k of S)if(!Xc(k,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){const v=za(a.coordinates,g,y),S=Ma(n.geometry(),h,g,y);if(!Ho(h,g))return!1;for(const k of S)if(!Jc(k,v))return!1}if(a.type==="MultiPolygon"){const v=Wl(a.coordinates,g,y),S=Ma(n.geometry(),h,g,y);if(!Ho(h,g))return!1;for(const k of S)if(!Ip(k,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Da{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new Da(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Vr{constructor(e,n,a,h){this.name=e,this.type=n,this._evaluate=a,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const a=e[0],h=Vr.definitions[a];if(!h)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let S=null;for(const[k,C]of v){S=new Mt(n.registry,Go,n.path,null,n.scope);const P=[];let D=!1;for(let R=1;R<e.length;R++){const B=e[R],V=Array.isArray(k)?k[R-1]:k.type,W=S.parse(B,1+P.length,V);if(!W){D=!0;break}P.push(W)}if(!D)if(Array.isArray(k)&&k.length!==P.length)S.error(`Expected ${k.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const B=Array.isArray(k)?k[R]:k.type,V=P[R];S.concat(R+1).checkSubtype(B,V.type)}if(S.errors.length===0)return new Vr(a,g,C,P)}}if(v.length===1)n.errors.push(...S.errors);else{const k=(v.length?v:y).map(([P])=>{return D=P,Array.isArray(D)?`(${D.map(j).join(", ")})`:`(${j(D.type)}...)`;var D}).join(" | "),C=[];for(let P=1;P<e.length;P++){const D=n.parse(e[P],1+C.length);if(!D)return null;C.push(j(D.type))}n.error(`Expected arguments of type ${k}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){Vr.definitions=n;for(const a in n)e[a]=Vr}}function Go(r){if(r instanceof Da)return Go(r.boundExpression);if(r instanceof Vr&&r.name==="error"||r instanceof Pa||r instanceof ms)return!1;const e=r instanceof fn||r instanceof Xr;let n=!0;return r.eachChild(a=>{n=e?n&&Go(a):n&&a instanceof ps}),!!n&&Wo(r)&&La(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wo(r){if(r instanceof Vr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ms)return!1;let e=!0;return r.eachChild(n=>{e&&!Wo(n)&&(e=!1)}),e}function Ko(r){if(r instanceof Vr&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!Ko(n)&&(e=!1)}),e}function La(r,e){if(r instanceof Vr&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!La(a,e)&&(n=!1)}),n}function Xo(r,e){const n=r.length-1;let a,h,g=0,y=n,v=0;for(;g<=y;)if(v=Math.floor((g+y)/2),a=r[v],h=r[v+1],a<=e){if(v===n||e<h)return v;g=v+1}else{if(!(a>e))throw new oi("Input is not a number.");y=v-1}return 0}class Ks{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,ze);if(!a)return null;const h=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let y=1;y<e.length;y+=2){const v=y===1?-1/0:e[y],S=e[y+1],k=y,C=y+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const P=n.parse(S,C,g);if(!P)return null;g=g||P.type,h.push([v,P])}return new Ks(g,a,h)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return a[0].evaluate(e);const g=n.length;return h>=n[g-1]?a[g-1].evaluate(e):a[Xo(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Cp(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Pp=th;function th(r,e,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=a}th.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var h=this.sampleCurveX(n)-r;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,v=1;for(n=r,a=0;a<20&&(h=this.sampleCurveX(n),!(Math.abs(h-r)<e));a++)r>h?y=n:v=n,n=.5*(v-y)+y;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Ap=Cp(Pp);function gs(r,e,n){return r+n*(e-r)}function Ra(r,e,n){return r.map((a,h)=>gs(a,e[h],n))}const Er={number:gs,color:function(r,e,n,a="rgb"){switch(a){case"rgb":{const[h,g,y,v]=Ra(r.rgb,e.rgb,n);return new Ft(h,g,y,v,!1)}case"hcl":{const[h,g,y,v]=r.hcl,[S,k,C,P]=e.hcl;let D,R;if(isNaN(h)||isNaN(S))isNaN(h)?isNaN(S)?D=NaN:(D=S,y!==1&&y!==0||(R=k)):(D=h,C!==1&&C!==0||(R=g));else{let ce=S-h;S>h&&ce>180?ce-=360:S<h&&h-S>180&&(ce+=360),D=h+n*ce}const[B,V,W,Y]=function([ce,J,se,ve]){return ce=isNaN(ce)?0:ce*Et,ei([se,Math.cos(ce)*J,Math.sin(ce)*J,ve])}([D,R??gs(g,k,n),gs(y,C,n),gs(v,P,n)]);return new Ft(B,V,W,Y,!1)}case"lab":{const[h,g,y,v]=ei(Ra(r.lab,e.lab,n));return new Ft(h,g,y,v,!1)}}},array:Ra,padding:function(r,e,n){return new Tr(Ra(r.values,e.values,n))},variableAnchorOffsetCollection:function(r,e,n){const a=r.values,h=e.values;if(a.length!==h.length)throw new oi(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new oi(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);const[v,S]=a[y+1],[k,C]=h[y+1];g.push([gs(v,k,n),gs(S,C,n)])}return new $i(g)}};class Yi{constructor(e,n,a,h,g){this.type=e,this.operator=n,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,v]of g)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(e,n,a,h){let g=0;if(e.name==="exponential")g=Xs(n,e.base,a,h);else if(e.name==="linear")g=Xs(n,1,a,h);else if(e.name==="cubic-bezier"){const y=e.controlPoints;g=new Ap(y[0],y[1],y[2],y[3]).solve(Xs(n,1,a,h))}return g}static parse(e,n){let[a,h,g,...y]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const k=h[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:k}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const k=h.slice(1);if(k.length!==4||k.some(C=>typeof C!="number"||C<0||C>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,ze),!g)return null;const v=[];let S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=Bi:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let k=0;k<y.length;k+=2){const C=y[k],P=y[k+1],D=k+3,R=k+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=n.parse(P,R,S);if(!B)return null;S=S||B.type,v.push([C,B])}return he(S,ze)||he(S,Bi)||he(S,q)||he(S,L)||he(S,O(ze))?new Yi(S,a,h,g,v):n.error(`Type ${j(S)} is not interpolatable.`)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return a[0].evaluate(e);const g=n.length;if(h>=n[g-1])return a[g-1].evaluate(e);const y=Xo(n,h),v=Yi.interpolationFactor(this.interpolation,h,n[y],n[y+1]),S=a[y].evaluate(e),k=a[y+1].evaluate(e);switch(this.operator){case"interpolate":return Er[this.type.kind](S,k,v);case"interpolate-hcl":return Er.color(S,k,v,"hcl");case"interpolate-lab":return Er.color(S,k,v,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Xs(r,e,n,a){const h=a-n,g=r-n;return h===0?0:e===1?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}class Ct{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const h=n.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const v of e.slice(1)){const S=n.parse(v,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,g.push(S)}if(!a)throw new Error("No output type");const y=h&&g.some(v=>ne(h,v.type));return new Ct(y?pt:a,g)}evaluate(e){let n,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(e),a&&a instanceof Nr&&!a.available&&(n||(n=a.name),a=null,h===this.args.length&&(a=n)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Fa{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let g=1;g<e.length-1;g+=2){const y=e[g];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=n.parse(e[g+1],g+1);if(!v)return null;a.push([y,v])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return h?new Fa(a,h):null}outputDefined(){return this.result.outputDefined()}}class Kl{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,ze),h=n.parse(e[2],2,O(n.expectedType||pt));return a&&h?new Kl(h.type.itemType,a,h):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new oi(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new oi(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new oi(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Xl{constructor(e,n){this.type=dt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,pt),h=n.parse(e[2],2,pt);return a&&h?le(a.type,[dt,gt,ze,ds,pt])?new Xl(a,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Q(n,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${j(yi(n))} instead.`);if(!Q(a,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${j(yi(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ba{constructor(e,n,a){this.type=ze,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,pt),h=n.parse(e[2],2,pt);if(!a||!h)return null;if(!le(a.type,[dt,gt,ze,ds,pt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(a.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,ze);return g?new Ba(a,h,g):null}return new Ba(a,h)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Q(n,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${j(yi(n))} instead.`);if(!Q(a,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${j(yi(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(n,h)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Yl{constructor(e,n,a,h,g,y){this.inputType=e,this.type=n,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const g={},y=[];for(let k=2;k<e.length-1;k+=2){let C=e[k];const P=e[k+1];Array.isArray(C)||(C=[C]);const D=n.concat(k);if(C.length===0)return D.error("Expected at least one branch label.");for(const B of C){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,yi(B)))return null}else a=yi(B);if(g[String(B)]!==void 0)return D.error("Branch labels must be unique.");g[String(B)]=y.length}const R=n.parse(P,k,h);if(!R)return null;h=h||R.type,y.push(R)}const v=n.parse(e[1],1,pt);if(!v)return null;const S=n.parse(e[e.length-1],e.length-1,h);return S?v.type.kind!=="value"&&n.concat(1).checkSubtype(a,v.type)?null:new Yl(a,h,v,g,y,S):null}evaluate(e){const n=this.input.evaluate(e);return(yi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Jl{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const v=n.parse(e[y],y,dt);if(!v)return null;const S=n.parse(e[y+1],y+1,a);if(!S)return null;h.push([v,S]),a=a||S.type}const g=n.parse(e[e.length-1],e.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new Jl(a,h,g)}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Oa{constructor(e,n,a,h){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,pt),h=n.parse(e[2],2,ze);if(!a||!h)return null;if(!le(a.type,[O(pt),gt,pt]))return n.error(`Expected first argument to be of type array or string, but found ${j(a.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,ze);return g?new Oa(a.type,a,h,g):null}return new Oa(a.type,a,h)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Q(n,["string","array"]))throw new oi(`Expected first argument to be of type array or string, but found ${j(yi(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(a,h)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ih(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function rh(r,e,n,a){return a.compare(e,n)===0}function Ys(r,e,n){const a=r!=="=="&&r!=="!=";return class D1{constructor(g,y,v){this.type=dt,this.lhs=g,this.rhs=y,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const v=g[0];let S=y.parse(g[1],1,pt);if(!S)return null;if(!ih(v,S.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${j(S.type)}'.`);let k=y.parse(g[2],2,pt);if(!k)return null;if(!ih(v,k.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${j(k.type)}'.`);if(S.type.kind!==k.type.kind&&S.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${j(S.type)}' and '${j(k.type)}'.`);a&&(S.type.kind==="value"&&k.type.kind!=="value"?S=new Xr(k.type,[S]):S.type.kind!=="value"&&k.type.kind==="value"&&(k=new Xr(S.type,[k])));let C=null;if(g.length===4){if(S.type.kind!=="string"&&k.type.kind!=="string"&&S.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(C=y.parse(g[3],3,Wn),!C)return null}return new D1(S,k,C)}evaluate(g){const y=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const S=yi(y),k=yi(v);if(S.kind!==k.kind||S.kind!=="string"&&S.kind!=="number")throw new oi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${k.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=yi(y),k=yi(v);if(S.kind!=="string"||k.kind!=="string")return e(g,y,v)}return this.collator?n(g,y,v,this.collator.evaluate(g)):e(g,y,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const zp=Ys("==",function(r,e,n){return e===n},rh),Mp=Ys("!=",function(r,e,n){return e!==n},function(r,e,n,a){return!rh(0,e,n,a)}),Dp=Ys("<",function(r,e,n){return e<n},function(r,e,n,a){return a.compare(e,n)<0}),Lp=Ys(">",function(r,e,n){return e>n},function(r,e,n,a){return a.compare(e,n)>0}),Rp=Ys("<=",function(r,e,n){return e<=n},function(r,e,n,a){return a.compare(e,n)<=0}),Fp=Ys(">=",function(r,e,n){return e>=n},function(r,e,n,a){return a.compare(e,n)>=0});class Ql{constructor(e,n,a,h,g){this.type=gt,this.number=e,this.locale=n,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,ze);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,gt),!g))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,gt),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=n.parse(h["min-fraction-digits"],1,ze),!v))return null;let S=null;return h["max-fraction-digits"]&&(S=n.parse(h["max-fraction-digits"],1,ze),!S)?null:new Ql(a,g,y,v,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Na{constructor(e){this.type=An,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=e.length-1;++y){const v=e[y];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let S=null;if(v["font-scale"]&&(S=n.parse(v["font-scale"],1,ze),!S))return null;let k=null;if(v["text-font"]&&(k=n.parse(v["text-font"],1,O(gt)),!k))return null;let C=null;if(v["text-color"]&&(C=n.parse(v["text-color"],1,Bi),!C))return null;const P=h[h.length-1];P.scale=S,P.font=k,P.textColor=C}else{const S=n.parse(e[y],1,pt);if(!S)return null;const k=S.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:S,scale:null,font:null,textColor:null})}}return new Na(h)}evaluate(e){return new Sr(this.sections.map(n=>{const a=n.content.evaluate(e);return yi(a)===M?new Zl("",a,null,null,null):new Zl(Zo(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class eu{constructor(e){this.type=M,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const a=n.parse(e[1],1,gt);return a?new eu(a):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),a=Nr.fromString(n);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(n)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class tu{constructor(e){this.type=ze,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${j(a.type)} instead.`):new tu(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new oi(`Expected value to be of type string or array, but found ${j(yi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Js={"==":zp,"!=":Mp,">":Lp,"<":Dp,">=":Fp,"<=":Rp,array:Xr,at:Kl,boolean:Xr,case:Jl,coalesce:Ct,collator:Pa,format:Na,image:eu,in:Xl,"index-of":Ba,interpolate:Yi,"interpolate-hcl":Yi,"interpolate-lab":Yi,length:tu,let:Fa,literal:ps,match:Yl,number:Xr,"number-format":Ql,object:Xr,slice:Oa,step:Ks,string:Xr,"to-boolean":fn,"to-color":fn,"to-number":fn,"to-string":fn,var:Da,within:ms};function nh(r,[e,n,a,h]){e=e.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);const g=h?h.evaluate(r):1,y=Wc(e,n,a,g);if(y)throw new oi(y);return new Ft(e/255,n/255,a/255,g,!1)}function sh(r,e){return r in e}function iu(r,e){const n=e[r];return n===void 0?null:n}function ys(r){return{type:r}}function oh(r){return{result:"success",value:r}}function Qs(r){return{result:"error",value:r}}function eo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ah(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function ru(r){return!!r.expression&&r.expression.interpolated}function Pt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function to(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Bp(r){return r}function lh(r,e){const n=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),g=r.type||(ru(e)?"exponential":"interval");if(n||e.type==="padding"){const C=n?Ft.parse:Tr.parse;(r=wr({},r)).stops&&(r.stops=r.stops.map(P=>[P[0],C(P[1])])),r.default=C(r.default?r.default:e.default)}if(r.colorSpace&&(y=r.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var y;let v,S,k;if(g==="exponential")v=uh;else if(g==="interval")v=hi;else if(g==="categorical"){v=Op,S=Object.create(null);for(const C of r.stops)S[C[0]]=C[1];k=typeof r.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=kt}if(a){const C={},P=[];for(let B=0;B<r.stops.length;B++){const V=r.stops[B],W=V[0].zoom;C[W]===void 0&&(C[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},P.push(W)),C[W].stops.push([V[0].value,V[1]])}const D=[];for(const B of P)D.push([C[B].zoom,lh(C[B],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Yi.interpolationFactor.bind(void 0,R),zoomStops:D.map(B=>B[0]),evaluate:({zoom:B},V)=>uh({stops:D,base:r.base},e,B).evaluate(B,V)}}if(h){const C=g==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Yi.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(r,e,P,S,k)}}return{kind:"source",evaluate(C,P){const D=P&&P.properties?P.properties[r.property]:void 0;return D===void 0?Yo(r.default,e.default):v(r,e,D,S,k)}}}function Yo(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function Op(r,e,n,a,h){return Yo(typeof n===h?a[n]:void 0,r.default,e.default)}function hi(r,e,n){if(Pt(n)!=="number")return Yo(r.default,e.default);const a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];const h=Xo(r.stops.map(g=>g[0]),n);return r.stops[h][1]}function uh(r,e,n){const a=r.base!==void 0?r.base:1;if(Pt(n)!=="number")return Yo(r.default,e.default);const h=r.stops.length;if(h===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[h-1][0])return r.stops[h-1][1];const g=Xo(r.stops.map(C=>C[0]),n),y=function(C,P,D,R){const B=R-D,V=C-D;return B===0?0:P===1?V/B:(Math.pow(P,V)-1)/(Math.pow(P,B)-1)}(n,a,r.stops[g][0],r.stops[g+1][0]),v=r.stops[g][1],S=r.stops[g+1][1],k=Er[e.type]||Bp;return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),D=S.evaluate.apply(void 0,C);if(P!==void 0&&D!==void 0)return k(P,D,y,r.colorSpace)}}:k(v,S,y,r.colorSpace)}function kt(r,e,n){switch(e.type){case"color":n=Ft.parse(n);break;case"formatted":n=Sr.fromString(n.toString());break;case"resolvedImage":n=Nr.fromString(n.toString());break;case"padding":n=Tr.parse(n);break;default:Pt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Yo(n,r.default,e.default)}Vr.register(Js,{error:[{kind:"error"},[gt],(r,[e])=>{throw new oi(e.evaluate(r))}],typeof:[gt,[pt],(r,[e])=>j(yi(e.evaluate(r)))],"to-rgba":[O(ze,4),[Bi],(r,[e])=>{const[n,a,h,g]=e.evaluate(r).rgb;return[255*n,255*a,255*h,g]}],rgb:[Bi,[ze,ze,ze],nh],rgba:[Bi,[ze,ze,ze,ze],nh],has:{type:dt,overloads:[[[gt],(r,[e])=>sh(e.evaluate(r),r.properties())],[[gt,Or],(r,[e,n])=>sh(e.evaluate(r),n.evaluate(r))]]},get:{type:pt,overloads:[[[gt],(r,[e])=>iu(e.evaluate(r),r.properties())],[[gt,Or],(r,[e,n])=>iu(e.evaluate(r),n.evaluate(r))]]},"feature-state":[pt,[gt],(r,[e])=>iu(e.evaluate(r),r.featureState||{})],properties:[Or,[],r=>r.properties()],"geometry-type":[gt,[],r=>r.geometryType()],id:[pt,[],r=>r.id()],zoom:[ze,[],r=>r.globals.zoom],"heatmap-density":[ze,[],r=>r.globals.heatmapDensity||0],"line-progress":[ze,[],r=>r.globals.lineProgress||0],accumulated:[pt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ze,ys(ze),(r,e)=>{let n=0;for(const a of e)n+=a.evaluate(r);return n}],"*":[ze,ys(ze),(r,e)=>{let n=1;for(const a of e)n*=a.evaluate(r);return n}],"-":{type:ze,overloads:[[[ze,ze],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[ze],(r,[e])=>-e.evaluate(r)]]},"/":[ze,[ze,ze],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[ze,[ze,ze],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[ze,[],()=>Math.LN2],pi:[ze,[],()=>Math.PI],e:[ze,[],()=>Math.E],"^":[ze,[ze,ze],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[ze,[ze],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[ze,[ze],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[ze,[ze],(r,[e])=>Math.log(e.evaluate(r))],log2:[ze,[ze],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[ze,[ze],(r,[e])=>Math.sin(e.evaluate(r))],cos:[ze,[ze],(r,[e])=>Math.cos(e.evaluate(r))],tan:[ze,[ze],(r,[e])=>Math.tan(e.evaluate(r))],asin:[ze,[ze],(r,[e])=>Math.asin(e.evaluate(r))],acos:[ze,[ze],(r,[e])=>Math.acos(e.evaluate(r))],atan:[ze,[ze],(r,[e])=>Math.atan(e.evaluate(r))],min:[ze,ys(ze),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[ze,ys(ze),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[ze,[ze],(r,[e])=>Math.abs(e.evaluate(r))],round:[ze,[ze],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[ze,[ze],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[ze,[ze],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[dt,[gt,pt],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[dt,[pt],(r,[e])=>r.id()===e.value],"filter-type-==":[dt,[gt],(r,[e])=>r.geometryType()===e.value],"filter-<":[dt,[gt,pt],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a<h}],"filter-id-<":[dt,[pt],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[dt,[gt,pt],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a>h}],"filter-id->":[dt,[pt],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[dt,[gt,pt],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[dt,[pt],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[dt,[gt,pt],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[dt,[pt],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[dt,[pt],(r,[e])=>e.value in r.properties()],"filter-has-id":[dt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[dt,[O(gt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[dt,[O(pt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[dt,[gt,O(pt)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[dt,[gt,O(pt)],(r,[e,n])=>function(a,h,g,y){for(;g<=y;){const v=g+y>>1;if(h[v]===a)return!0;h[v]>a?y=v-1:g=v+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:dt,overloads:[[[dt,dt],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[ys(dt),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:dt,overloads:[[[dt,dt],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[ys(dt),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[dt,[dt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[dt,[gt],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[gt,[gt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[gt,[gt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[gt,ys(pt),(r,e)=>e.map(n=>Zo(n.evaluate(r))).join("")],"resolved-locale":[gt,[Wn],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Jo{constructor(e,n){var a;this.expression=e,this._warningHistory={},this._evaluator=new Ws,this._defaultValue=n?(a=n).type==="color"&&to(a.default)?new Ft(0,0,0,0):a.type==="color"?Ft.parse(a.default)||null:a.type==="padding"?Tr.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?$i.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,h,g,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,h,g,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new oi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function jt(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Js}function Vt(r,e){const n=new Mt(Js,Go,[],e?function(h){const g={color:Bi,string:gt,number:ze,enum:gt,boolean:dt,formatted:An,padding:q,resolvedImage:M,variableAnchorOffsetCollection:L};return h.type==="array"?O(g[h.value]||pt,h.length):g[h.type]}(e):void 0),a=n.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?oh(new Jo(a,e)):Qs(n.errors)}class io{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Ko(n.expression)}evaluateWithoutErrorHandling(e,n,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,h,g,y)}evaluate(e,n,a,h,g,y){return this._styleExpression.evaluate(e,n,a,h,g,y)}}class Va{constructor(e,n,a,h){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ko(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,h,g,y)}evaluate(e,n,a,h,g,y){return this._styleExpression.evaluate(e,n,a,h,g,y)}interpolationFactor(e,n,a){return this.interpolationType?Yi.interpolationFactor(this.interpolationType,e,n,a):0}}function ch(r,e){const n=Vt(r,e);if(n.result==="error")return n;const a=n.value.expression,h=Wo(a);if(!h&&!eo(e))return Qs([new or("","data expressions not supported")]);const g=La(a,["zoom"]);if(!g&&!ah(e))return Qs([new or("","zoom expressions not supported")]);const y=ja(a);return y||g?y instanceof or?Qs([y]):y instanceof Yi&&!ru(e)?Qs([new or("",'"interpolate" expressions cannot be used with this property')]):oh(y?new Va(h?"camera":"composite",n.value,y.labels,y instanceof Yi?y.interpolation:void 0):new io(h?"constant":"source",n.value)):Qs([new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ua{constructor(e,n){this._parameters=e,this._specification=n,wr(this,lh(this._parameters,this._specification))}static deserialize(e){return new Ua(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ja(r){let e=null;if(r instanceof Fa)e=ja(r.result);else if(r instanceof Ct){for(const n of r.args)if(e=ja(n),e)break}else(r instanceof Ks||r instanceof Yi)&&r.input instanceof Vr&&r.input.name==="zoom"&&(e=r);return e instanceof or||r.eachChild(n=>{const a=ja(n);a instanceof or?e=a:!e&&a?e=new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function nu(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!nu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const hh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $a(r){if(r==null)return{filter:()=>!0,needGeometry:!1};nu(r)||(r=ro(r));const e=Vt(r,hh);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,a,h)=>e.value.evaluate(n,a,{},h),needGeometry:su(r)}}function dh(r,e){return r<e?-1:r>e?1:0}function su(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(su(r[e]))return!0;return!1}function ro(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?ou(r[1],r[2],"=="):e==="!="?qa(ou(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ou(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(ro))):e==="all"?["all"].concat(r.slice(1).map(ro)):e==="none"?["all"].concat(r.slice(1).map(ro).map(qa)):e==="in"?ph(r[1],r.slice(2)):e==="!in"?qa(ph(r[1],r.slice(2))):e==="has"?fh(r[1]):e==="!has"?qa(fh(r[1])):e!=="within"||r;var n}function ou(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function ph(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(dh)]]:["filter-in-small",r,["literal",e]]}}function fh(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function qa(r){return["!",r]}function au(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(const g of r)h+=`${au(g)},`;return`${h}]`}const n=Object.keys(r).sort();let a="{";for(let h=0;h<n.length;h++)a+=`${JSON.stringify(n[h])}:${au(r[n[h]])},`;return`${a}}`}function Np(r){let e="";for(const n of cs)e+=`/${au(r[n])}`;return e}function mh(r){const e=r.value;return e?[new Le(r.key,e,"constants have been deprecated as of v8")]:[]}function ai(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Xn(r){if(Array.isArray(r))return r.map(Xn);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=Xn(r[n]);return e}return ai(r)}function kr(r){const e=r.key,n=r.value,a=r.valueSpec||{},h=r.objectElementValidators||{},g=r.style,y=r.styleSpec,v=r.validateSpec;let S=[];const k=Pt(n);if(k!=="object")return[new Le(e,n,`object expected, ${k} found`)];for(const C in n){const P=C.split(".")[0],D=a[P]||a["*"];let R;if(h[P])R=h[P];else if(a[P])R=v;else if(h["*"])R=h["*"];else{if(!a["*"]){S.push(new Le(e,n[C],`unknown property "${C}"`));continue}R=v}S=S.concat(R({key:(e&&`${e}.`)+C,value:n[C],valueSpec:D,style:g,styleSpec:y,object:n,objectKey:C,validateSpec:v},n))}for(const C in a)h[C]||a[C].required&&a[C].default===void 0&&n[C]===void 0&&S.push(new Le(e,n,`missing required property "${C}"`));return S}function no(r){const e=r.value,n=r.valueSpec,a=r.style,h=r.styleSpec,g=r.key,y=r.arrayElementValidator||r.validateSpec;if(Pt(e)!=="array")return[new Le(g,e,`array expected, ${Pt(e)} found`)];if(n.length&&e.length!==n.length)return[new Le(g,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Le(g,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let v={type:n.value,values:n.values};h.$version<7&&(v.function=n.function),Pt(n.value)==="object"&&(v=n.value);let S=[];for(let k=0;k<e.length;k++)S=S.concat(y({array:e,arrayIndex:k,value:e[k],valueSpec:v,validateSpec:r.validateSpec,style:a,styleSpec:h,key:`${g}[${k}]`}));return S}function lu(r){const e=r.key,n=r.value,a=r.valueSpec;let h=Pt(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Le(e,n,`number expected, ${h} found`)]:"minimum"in a&&n<a.minimum?[new Le(e,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new Le(e,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function uu(r){const e=r.valueSpec,n=ai(r.value.type);let a,h,g,y={};const v=n!=="categorical"&&r.value.property===void 0,S=!v,k=Pt(r.value.stops)==="array"&&Pt(r.value.stops[0])==="array"&&Pt(r.value.stops[0][0])==="object",C=kr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Le(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const V=R.value;return B=B.concat(no({key:R.key,value:V,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),Pt(V)==="array"&&V.length===0&&B.push(new Le(R.key,V,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:e,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&v&&C.push(new Le(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||C.push(new Le(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!ru(r.valueSpec)&&C.push(new Le(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!eo(r.valueSpec)?C.push(new Le(r.key,r.value,"property functions not supported")):v&&!ah(r.valueSpec)&&C.push(new Le(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||C.push(new Le(r.key,r.value,'"property" property is required')),C;function P(R){let B=[];const V=R.value,W=R.key;if(Pt(V)!=="array")return[new Le(W,V,`array expected, ${Pt(V)} found`)];if(V.length!==2)return[new Le(W,V,`array length 2 expected, length ${V.length} found`)];if(k){if(Pt(V[0])!=="object")return[new Le(W,V,`object expected, ${Pt(V[0])} found`)];if(V[0].zoom===void 0)return[new Le(W,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new Le(W,V,"object stop key must have value")];if(g&&g>ai(V[0].zoom))return[new Le(W,V[0].zoom,"stop zoom values must appear in ascending order")];ai(V[0].zoom)!==g&&(g=ai(V[0].zoom),h=void 0,y={}),B=B.concat(kr({key:`${W}[0]`,value:V[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:lu,value:D}}))}else B=B.concat(D({key:`${W}[0]`,value:V[0],valueSpec:{},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},V));return jt(Xn(V[1]))?B.concat([new Le(`${W}[1]`,V[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${W}[1]`,value:V[1],valueSpec:e,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function D(R,B){const V=Pt(R.value),W=ai(R.value),Y=R.value!==null?R.value:B;if(a){if(V!==a)return[new Le(R.key,Y,`${V} stop domain type must match previous stop domain type ${a}`)]}else a=V;if(V!=="number"&&V!=="string"&&V!=="boolean")return[new Le(R.key,Y,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&n!=="categorical"){let ce=`number expected, ${V} found`;return eo(e)&&n===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(R.key,Y,ce)]}return n!=="categorical"||V!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&V==="number"&&h!==void 0&&W<h?[new Le(R.key,Y,"stop domain values must appear in ascending order")]:(h=W,n==="categorical"&&W in y?[new Le(R.key,Y,"stop domain values must be unique")]:(y[W]=!0,[])):[new Le(R.key,Y,`integer expected, found ${W}`)]}}function so(r){const e=(r.expressionContext==="property"?ch:Vt)(Xn(r.value),r.valueSpec);if(e.result==="error")return e.value.map(a=>new Le(`${r.key}${a.key}`,r.value,a.message));const n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Le(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ko(n))return[new Le(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ko(n))return[new Le(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!La(n,["zoom","feature-state"]))return[new Le(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Wo(n))return[new Le(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _s(r){const e=r.key,n=r.value,a=r.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(ai(n))===-1&&h.push(new Le(e,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(ai(n))===-1&&h.push(new Le(e,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function oo(r){return nu(Xn(r.value))?so(wr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qo(r)}function Qo(r){const e=r.value,n=r.key;if(Pt(e)!=="array")return[new Le(n,e,`array expected, ${Pt(e)} found`)];const a=r.styleSpec;let h,g=[];if(e.length<1)return[new Le(n,e,"filter array must have at least 1 element")];switch(g=g.concat(_s({key:`${n}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),ai(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ai(e[1])==="$type"&&g.push(new Le(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Le(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Pt(e[1]),h!=="string"&&g.push(new Le(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=Pt(e[y]),ai(e[1])==="$type"?g=g.concat(_s({key:`${n}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Le(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)g=g.concat(Qo({key:`${n}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=Pt(e[1]),e.length!==2?g.push(new Le(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Le(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Pt(e[1]),e.length!==2?g.push(new Le(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&g.push(new Le(`${n}[1]`,e[1],`object expected, ${h} found`))}return g}function cu(r,e){const n=r.key,a=r.validateSpec,h=r.style,g=r.styleSpec,y=r.value,v=r.objectKey,S=g[`${e}_${r.layerType}`];if(!S)return[];const k=v.match(/^(.*)-transition$/);if(e==="paint"&&k&&S[k[1]]&&S[k[1]].transition)return a({key:n,value:y,valueSpec:g.transition,style:h,styleSpec:g});const C=r.valueSpec||S[v];if(!C)return[new Le(n,y,`unknown property "${v}"`)];let P;if(Pt(y)==="string"&&eo(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new Le(n,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const D=[];return r.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&D.push(new Le(n,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&to(Xn(y))&&ai(y.type)==="identity"&&D.push(new Le(n,y,'"text-font" does not support identity functions'))),D.concat(a({key:r.key,value:y,valueSpec:C,style:h,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:v}))}function Za(r){return cu(r,"paint")}function hu(r){return cu(r,"layout")}function du(r){let e=[];const n=r.value,a=r.key,h=r.style,g=r.styleSpec;n.type||n.ref||e.push(new Le(a,n,'either "type" or "ref" is required'));let y=ai(n.type);const v=ai(n.ref);if(n.id){const S=ai(n.id);for(let k=0;k<r.arrayIndex;k++){const C=h.layers[k];ai(C.id)===S&&e.push(new Le(a,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&e.push(new Le(a,n[k],`"${k}" is prohibited for ref layers`))}),h.layers.forEach(k=>{ai(k.id)===v&&(S=k)}),S?S.ref?e.push(new Le(a,n.ref,"ref cannot reference another ref layer")):y=ai(S.type):e.push(new Le(a,n.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(n.source){const S=h.sources&&h.sources[n.source],k=S&&ai(S.type);S?k==="vector"&&y==="raster"?e.push(new Le(a,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&y==="hillshade"?e.push(new Le(a,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&y!=="raster"?e.push(new Le(a,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&y!=="hillshade"?e.push(new Le(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&S.lineMetrics||e.push(new Le(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Le(a,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Le(a,n.source,`source "${n.source}" not found`))}else e.push(new Le(a,n,'missing required property "source"'));return e=e.concat(kr({key:a,value:n,valueSpec:g.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:n.type,valueSpec:g.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:oo,layout:S=>kr({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":k=>hu(wr({layerType:y},k))}}),paint:S=>kr({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":k=>Za(wr({layerType:y},k))}})}})),e}function gn(r){const e=r.value,n=r.key,a=Pt(e);return a!=="string"?[new Le(n,e,`string expected, ${a} found`)]:[]}const gh={promoteId:function({key:r,value:e}){if(Pt(e)==="string")return gn({key:r,value:e});{const n=[];for(const a in e)n.push(...gn({key:`${r}.${a}`,value:e[a]}));return n}}};function yh(r){const e=r.value,n=r.key,a=r.styleSpec,h=r.style,g=r.validateSpec;if(!e.type)return[new Le(n,e,'"type" is required')];const y=ai(e.type);let v;switch(y){case"vector":case"raster":return v=kr({key:n,value:e,valueSpec:a[`source_${y.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:gh,validateSpec:g}),v;case"raster-dem":return v=function(S){var k;const C=(k=S.sourceName)!==null&&k!==void 0?k:"",P=S.value,D=S.styleSpec,R=D.source_raster_dem,B=S.style;let V=[];const W=Pt(P);if(P===void 0)return V;if(W!=="object")return V.push(new Le("source_raster_dem",P,`object expected, ${W} found`)),V;const Y=ai(P.encoding)==="custom",ce=["redFactor","greenFactor","blueFactor","baseShift"],J=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const se in P)!Y&&ce.includes(se)?V.push(new Le(se,P[se],`In "${C}": "${se}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):R[se]?V=V.concat(S.validateSpec({key:se,value:P[se],valueSpec:R[se],validateSpec:S.validateSpec,style:B,styleSpec:D})):V.push(new Le(se,P[se],`unknown property "${se}"`));return V}({sourceName:n,value:e,style:r.style,styleSpec:a,validateSpec:g}),v;case"geojson":if(v=kr({key:n,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:gh}),e.cluster)for(const S in e.clusterProperties){const[k,C]=e.clusterProperties[S],P=typeof k=="string"?[k,["accumulated"],["get",S]]:k;v.push(...so({key:`${n}.${S}.map`,value:C,validateSpec:g,expressionContext:"cluster-map"})),v.push(...so({key:`${n}.${S}.reduce`,value:P,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return kr({key:n,value:e,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return kr({key:n,value:e,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new Le(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _s({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:a})}}function _h(r){const e=r.value,n=r.styleSpec,a=n.light,h=r.style;let g=[];const y=Pt(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new Le("light",e,`object expected, ${y} found`)]),g;for(const v in e){const S=v.match(/^(.*)-transition$/);g=g.concat(S&&a[S[1]]&&a[S[1]].transition?r.validateSpec({key:v,value:e[v],valueSpec:n.transition,validateSpec:r.validateSpec,style:h,styleSpec:n}):a[v]?r.validateSpec({key:v,value:e[v],valueSpec:a[v],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new Le(v,e[v],`unknown property "${v}"`)])}return g}function vh(r){const e=r.value,n=r.styleSpec,a=n.sky,h=r.style,g=Pt(e);if(e===void 0)return[];if(g!=="object")return[new Le("sky",e,`object expected, ${g} found`)];let y=[];for(const v in e)y=y.concat(a[v]?zi({key:v,value:e[v],valueSpec:a[v],style:h,styleSpec:n}):[new Le(v,e[v],`unknown property "${v}"`)]);return y}function xh(r){const e=r.value,n=r.styleSpec,a=n.terrain,h=r.style;let g=[];const y=Pt(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new Le("terrain",e,`object expected, ${y} found`)]),g;for(const v in e)g=g.concat(a[v]?r.validateSpec({key:v,value:e[v],valueSpec:a[v],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new Le(v,e[v],`unknown property "${v}"`)]);return g}function ea(r){let e=[];const n=r.value,a=r.key;if(Array.isArray(n)){const h=[],g=[];for(const y in n)n[y].id&&h.includes(n[y].id)&&e.push(new Le(a,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),h.push(n[y].id),n[y].url&&g.includes(n[y].url)&&e.push(new Le(a,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),g.push(n[y].url),e=e.concat(kr({key:`${a}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return gn({key:a,value:n})}const ta={"*":()=>[],array:no,boolean:function(r){const e=r.value,n=r.key,a=Pt(e);return a!=="boolean"?[new Le(n,e,`boolean expected, ${a} found`)]:[]},number:lu,color:function(r){const e=r.key,n=r.value,a=Pt(n);return a!=="string"?[new Le(e,n,`color expected, ${a} found`)]:Ft.parse(String(n))?[]:[new Le(e,n,`color expected, "${n}" found`)]},constants:mh,enum:_s,filter:oo,function:uu,layer:du,object:kr,source:yh,light:_h,sky:vh,terrain:xh,string:gn,formatted:function(r){return gn(r).length===0?[]:so(r)},resolvedImage:function(r){return gn(r).length===0?[]:so(r)},padding:function(r){const e=r.key,n=r.value;if(Pt(n)==="array"){if(n.length<1||n.length>4)return[new Le(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<n.length;g++)h=h.concat(r.validateSpec({key:`${e}[${g}]`,value:n[g],validateSpec:r.validateSpec,valueSpec:a}));return h}return lu({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,n=r.value,a=Pt(n),h=r.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new Le(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<n.length;y+=2)g=g.concat(_s({key:`${e}[${y}]`,value:n[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(no({key:`${e}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return g},sprite:ea};function zi(r){const e=r.value,n=r.valueSpec,a=r.styleSpec;return r.validateSpec=zi,n.expression&&to(ai(e))?uu(r):n.expression&&jt(Xn(e))?so(r):n.type&&ta[n.type]?ta[n.type](r):kr(wr({},r,{valueSpec:n.type?a[n.type]:n}))}function ao(r){const e=r.value,n=r.key,a=gn(r);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Le(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Le(n,e,'"glyphs" url must include a "{range}" token'))),a}function Ur(r,e=ye){let n=[];return n=n.concat(zi({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:zi,objectElementValidators:{glyphs:ao,"*":()=>[]}})),r.constants&&(n=n.concat(mh({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:zi}))),wh(n)}function yn(r){return function(e){return r({...e,validateSpec:zi})}}function wh(r){return[].concat(r).sort((e,n)=>e.line-n.line)}function lr(r){return function(...e){return wh(r.apply(this,e))}}Ur.source=lr(yn(yh)),Ur.sprite=lr(yn(ea)),Ur.glyphs=lr(yn(ao)),Ur.light=lr(yn(_h)),Ur.sky=lr(yn(vh)),Ur.terrain=lr(yn(xh)),Ur.layer=lr(yn(du)),Ur.filter=lr(yn(oo)),Ur.paintProperty=lr(yn(Za)),Ur.layoutProperty=lr(yn(hu));const lo=Ur,pu=lo.light,Vp=lo.paintProperty,fu=lo.layoutProperty;function bh(r,e){let n=!1;if(e&&e.length)for(const a of e)r.fire(new wi(new Error(a.message))),n=!0;return n}class zn{constructor(e,n,a){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(n=y[1])+2*(a=y[2]);for(let S=0;S<this.d*this.d;S++){const k=y[3+S],C=y[3+S+1];h.push(k===C?null:y.subarray(k,C))}const v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=a,this.scale=n/e,this.uid=0;const g=a/n*e;this.min=-g,this.max=e+g}insert(e,n,a,h,g){this._forEachCell(n,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,a,h,g,y){this.cells[g].push(y)}query(e,n,a,h,g){const y=this.min,v=this.max;if(e<=y&&n<=y&&v<=a&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,n,a,h,this._queryCell,S,{},g),S}}_queryCell(e,n,a,h,g,y,v,S){const k=this.cells[g];if(k!==null){const C=this.keys,P=this.bboxes;for(let D=0;D<k.length;D++){const R=k[D];if(v[R]===void 0){const B=4*R;(S?S(P[B+0],P[B+1],P[B+2],P[B+3]):e<=P[B+2]&&n<=P[B+3]&&a>=P[B+0]&&h>=P[B+1])?(v[R]=!0,y.push(C[R])):v[R]=!1}}}}_forEachCell(e,n,a,h,g,y,v,S){const k=this._convertToCellCoord(e),C=this._convertToCellCoord(n),P=this._convertToCellCoord(a),D=this._convertToCellCoord(h);for(let R=k;R<=P;R++)for(let B=C;B<=D;B++){const V=this.d*B+R;if((!S||S(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,e,n,a,h,V,y,v,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(n+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=n;for(let y=0;y<e.length;y++){const v=e[y];h[3+y]=g,h.set(v,g),g+=v.length}return h[3+e.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+e.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(e,n){const a=e.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(e){return new zn(e.buffer)}}const Yn={};function $e(r,e,n={}){if(Yn[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Yn[r]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",zn),$e("Color",Ft),$e("Error",Error),$e("AJAXError",Kr),$e("ResolvedImage",Nr),$e("StylePropertyFunction",Ua),$e("StyleExpression",Jo,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Va),$e("ZoomConstantExpression",io),$e("CompoundExpression",Vr,{omit:["_evaluate"]});for(const r in Js)Js[r]._classRegistryKey||$e(`Expression_${r}`,Js[r]);function mu(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function vs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error)return r;if(mu(r)||Ze(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const n=r;return e&&e.push(n.buffer),n}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const a of r)n.push(vs(a,e));return n}if(typeof r=="object"){const n=r.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!Yn[a])throw new Error(`${a} is not registered.`);const h=n.serialize?n.serialize(r,e):{};if(n.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in r){if(!r.hasOwnProperty(g)||Yn[a].omit.indexOf(g)>=0)continue;const y=r[g];h[g]=Yn[a].shallow.indexOf(g)>=0?y:vs(y,e)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function uo(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||mu(r)||Ze(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(uo);if(typeof r=="object"){const e=r.$name||"Object";if(!Yn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Yn[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);const a=Object.create(n.prototype);for(const h of Object.keys(r)){if(h==="$name")continue;const g=r[h];a[h]=Yn[e].shallow.indexOf(h)>=0?g:uo(g)}return a}throw new Error("can't deserialize object of type "+typeof r)}class gu{constructor(){this.first=!0}update(e,n){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Ue={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function ia(r){for(const e of r)if(Ga(e.charCodeAt(0)))return!0;return!1}function Ha(r){for(const e of r)if(!Sh(e.charCodeAt(0)))return!1;return!0}function Sh(r){return!(Ue.Arabic(r)||Ue["Arabic Supplement"](r)||Ue["Arabic Extended-A"](r)||Ue["Arabic Presentation Forms-A"](r)||Ue["Arabic Presentation Forms-B"](r))}function Ga(r){return!(r!==746&&r!==747&&(r<4352||!(Ue["Bopomofo Extended"](r)||Ue.Bopomofo(r)||Ue["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ue["CJK Compatibility Ideographs"](r)||Ue["CJK Compatibility"](r)||Ue["CJK Radicals Supplement"](r)||Ue["CJK Strokes"](r)||!(!Ue["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ue["CJK Unified Ideographs Extension A"](r)||Ue["CJK Unified Ideographs"](r)||Ue["Enclosed CJK Letters and Months"](r)||Ue["Hangul Compatibility Jamo"](r)||Ue["Hangul Jamo Extended-A"](r)||Ue["Hangul Jamo Extended-B"](r)||Ue["Hangul Jamo"](r)||Ue["Hangul Syllables"](r)||Ue.Hiragana(r)||Ue["Ideographic Description Characters"](r)||Ue.Kanbun(r)||Ue["Kangxi Radicals"](r)||Ue["Katakana Phonetic Extensions"](r)||Ue.Katakana(r)&&r!==12540||!(!Ue["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ue["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ue["Unified Canadian Aboriginal Syllabics"](r)||Ue["Unified Canadian Aboriginal Syllabics Extended"](r)||Ue["Vertical Forms"](r)||Ue["Yijing Hexagram Symbols"](r)||Ue["Yi Syllables"](r)||Ue["Yi Radicals"](r))))}function yu(r){return!(Ga(r)||function(e){return!!(Ue["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ue["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ue["Letterlike Symbols"](e)||Ue["Number Forms"](e)||Ue["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ue["Control Pictures"](e)&&e!==9251||Ue["Optical Character Recognition"](e)||Ue["Enclosed Alphanumerics"](e)||Ue["Geometric Shapes"](e)||Ue["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ue["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ue["CJK Symbols and Punctuation"](e)||Ue.Katakana(e)||Ue["Private Use Area"](e)||Ue["CJK Compatibility Forms"](e)||Ue["Small Form Variants"](e)||Ue["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function _u(r){return r>=1424&&r<=2303||Ue["Arabic Presentation Forms-A"](r)||Ue["Arabic Presentation Forms-B"](r)}function vu(r,e){return!(!e&&_u(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ue.Khmer(r))}function Th(r){for(const e of r)if(_u(e.charCodeAt(0)))return!0;return!1}const xs=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Gt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gu,this.transition={})}isSupportedScript(e){return function(n,a){for(const h of n)if(!vu(h.charCodeAt(0),a))return!1;return!0}(e,xs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class Wa{constructor(e,n){this.property=e,this.value=n,this.expression=function(a,h){if(to(a))return new Ua(a,h);if(jt(a)){const g=ch(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=Ft.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=$i.parse(a)):g=Tr.parse(a),{kind:"constant",evaluate:()=>g}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Ka{constructor(e){this.property=e,this.value=new Wa(e,void 0)}transitioned(e,n){return new wu(this.property,this.value,n,Ge({},e.transition,this.transition),e.now)}untransitioned(){return new wu(this.property,this.value,null,{},0)}}class xu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Zt(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ka(this._values[e].property)),this._values[e].value=new Wa(this._values[e].property,n===null?void 0:Zt(n))}getTransition(e){return Zt(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ka(this._values[e].property)),this._values[e].transition=Zt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const h=this.getTransition(n);h!==void 0&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const a=new Eh(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,n._values[h]);return a}untransitioned(){const e=new Eh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class wu{constructor(e,n,a,h,g){this.property=e,this.value=n,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const h=e.now||0,g=this.value.possiblyEvaluate(e,n,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(e,n,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,a),g,function(S){if(S<=0)return 0;if(S>=1)return 1;const k=S*S,C=k*S;return 4*(S<.5?C:3*(S-k)+C-.75)}(v))}}return g}}class Eh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const h=new ra(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Up{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Zt(this._values[e].value)}setValue(e,n){this._values[e]=new Wa(this._values[e].property,n===null?void 0:Zt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){const h=new ra(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,a);return h}}class Yr{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,h){return this.property.evaluate(this.value,this.parameters,e,n,a,h)}}class ra{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,a){const h=Er[this.specification.type];return h?h(e,n,a):e}}class it{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,h){return new Yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,h)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Yr(this,{kind:"constant",value:void 0},e.parameters);const h=Er[this.specification.type];if(h){const g=h(e.value.value,n.value.value,a);return new Yr(this,{kind:"constant",value:g},e.parameters)}return e}evaluate(e,n,a,h,g,y){return e.kind==="constant"?e.value:e.evaluate(n,a,h,g,y)}}class ws extends it{possiblyEvaluate(e,n,a,h){if(e.value===void 0)return new Yr(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const g=e.expression.evaluate(n,null,{},a,h),y=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(y,y,y,n);return new Yr(this,{kind:"constant",value:v},n)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Yr(this,{kind:"constant",value:g},n)}return new Yr(this,e.expression,n)}evaluate(e,n,a,h,g,y){if(e.kind==="source"){const v=e.evaluate(n,a,h,g,y);return this._calculate(v,v,v,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},a,h),e.evaluate({zoom:Math.floor(n.zoom)},a,h),e.evaluate({zoom:Math.floor(n.zoom)+1},a,h),n):e.value}_calculate(e,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:a,to:n}}interpolate(e){return e}}class bu{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(n,null,{},a,h);return this._calculate(g,g,g,n)}return this._calculate(e.expression.evaluate(new Gt(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Gt(Math.floor(n.zoom),n)),e.expression.evaluate(new Gt(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:a,to:n}}interpolate(e){return e}}class na{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,h){return!!e.expression.evaluate(n,null,{},a,h)}interpolate(){return!1}}class ur{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new Wa(a,void 0),g=this.defaultTransitionablePropertyValues[n]=new Ka(a);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}$e("DataDrivenProperty",it),$e("DataConstantProperty",Ye),$e("CrossFadedDataDrivenProperty",ws),$e("CrossFadedProperty",bu),$e("ColorRampProperty",na);const kh="-transition";class Jr extends us{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Up(n.layout)),n.paint)){this._transitionablePaint=new xu(n.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ra(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,a={}){n!=null&&this._validate(fu,`layers.${this.id}.layout.${e}`,e,n,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(kh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,a={}){if(n!=null&&this._validate(Vp,`layers.${this.id}.paint.${e}`,e,n,a))return!1;if(e.endsWith(kh))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[e],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(e,v,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),xt(e,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(e,n,a,h,g={}){return(!g||g.validate!==!1)&&bh(this,e.call(lo,{key:n,layerType:this.type,objectKey:a,value:h,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Yr&&eo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Ih={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class co{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function di(r,e=1){let n=0,a=0;return{members:r.map(h=>{const g=Ih[h.type].BYTES_PER_ELEMENT,y=n=Ch(n,Math.max(e,g)),v=h.components||1;return a=Math.max(a,g),n+=g*v,{name:h.name,type:h.type,components:v,offset:y}}),size:Ch(n,Math.max(a,e)),alignment:e}}function Ch(r,e){return Math.ceil(r/e)*e}class sa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=a,e}}sa.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",sa);class Xa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=a,this.int16[g+2]=h,e}}Xa.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",Xa);class Jn extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,a,h)}emplace(e,n,a,h,g){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,e}}Jn.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",Jn);class Su extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,a,h,g,y)}emplace(e,n,a,h,g,y,v){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=g,this.int16[S+4]=y,this.int16[S+5]=v,e}}Su.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",Su);class Tu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,a,h,g,y)}emplace(e,n,a,h,g,y,v){const S=4*e,k=8*e;return this.int16[S+0]=n,this.int16[S+1]=a,this.uint8[k+4]=h,this.uint8[k+5]=g,this.uint8[k+6]=y,this.uint8[k+7]=v,e}}Tu.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",Tu);class oa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=a,e}}oa.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",oa);class Eu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y,v,S,k,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,a,h,g,y,v,S,k,C)}emplace(e,n,a,h,g,y,v,S,k,C,P){const D=10*e;return this.uint16[D+0]=n,this.uint16[D+1]=a,this.uint16[D+2]=h,this.uint16[D+3]=g,this.uint16[D+4]=y,this.uint16[D+5]=v,this.uint16[D+6]=S,this.uint16[D+7]=k,this.uint16[D+8]=C,this.uint16[D+9]=P,e}}Eu.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",Eu);class Ya extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y,v,S,k,C,P,D){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,h,g,y,v,S,k,C,P,D)}emplace(e,n,a,h,g,y,v,S,k,C,P,D,R){const B=12*e;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=g,this.uint16[B+4]=y,this.uint16[B+5]=v,this.uint16[B+6]=S,this.uint16[B+7]=k,this.int16[B+8]=C,this.int16[B+9]=P,this.int16[B+10]=D,this.int16[B+11]=R,e}}Ya.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",Ya);class ku extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,e}}ku.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",ku);class Iu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Iu.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",Iu);class Mn extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y,v,S,k){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,a,h,g,y,v,S,k)}emplace(e,n,a,h,g,y,v,S,k,C){const P=10*e,D=5*e;return this.int16[P+0]=n,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=v,this.uint32[D+3]=S,this.uint16[P+8]=k,this.uint16[P+9]=C,e}}Mn.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",Mn);class Ja extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,a,h,g,y)}emplace(e,n,a,h,g,y,v){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=g,this.int16[S+4]=y,this.int16[S+5]=v,e}}Ja.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",Ja);class aa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,h,g)}emplace(e,n,a,h,g,y){const v=4*e,S=8*e;return this.float32[v+0]=n,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[S+6]=g,this.int16[S+7]=y,e}}aa.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",aa);class Qa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,a,h)}emplace(e,n,a,h,g){const y=12*e,v=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=a,this.float32[v+1]=h,this.float32[v+2]=g,e}}Qa.prototype.bytesPerElement=12,$e("StructArrayLayout2ub2f12",Qa);class ho extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=a,this.uint16[g+2]=h,e}}ho.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",ho);class Cu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y,v,S,k,C,P,D,R,B,V,W,Y){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,n,a,h,g,y,v,S,k,C,P,D,R,B,V,W,Y)}emplace(e,n,a,h,g,y,v,S,k,C,P,D,R,B,V,W,Y,ce){const J=24*e,se=12*e,ve=48*e;return this.int16[J+0]=n,this.int16[J+1]=a,this.uint16[J+2]=h,this.uint16[J+3]=g,this.uint32[se+2]=y,this.uint32[se+3]=v,this.uint32[se+4]=S,this.uint16[J+10]=k,this.uint16[J+11]=C,this.uint16[J+12]=P,this.float32[se+7]=D,this.float32[se+8]=R,this.uint8[ve+36]=B,this.uint8[ve+37]=V,this.uint8[ve+38]=W,this.uint32[se+10]=Y,this.int16[J+22]=ce,e}}Cu.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Cu);class po extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h,g,y,v,S,k,C,P,D,R,B,V,W,Y,ce,J,se,ve,Se,Ve,We,Ne,Oe,De,He){const Be=this.length;return this.resize(Be+1),this.emplace(Be,e,n,a,h,g,y,v,S,k,C,P,D,R,B,V,W,Y,ce,J,se,ve,Se,Ve,We,Ne,Oe,De,He)}emplace(e,n,a,h,g,y,v,S,k,C,P,D,R,B,V,W,Y,ce,J,se,ve,Se,Ve,We,Ne,Oe,De,He,Be){const Ae=32*e,tt=16*e;return this.int16[Ae+0]=n,this.int16[Ae+1]=a,this.int16[Ae+2]=h,this.int16[Ae+3]=g,this.int16[Ae+4]=y,this.int16[Ae+5]=v,this.int16[Ae+6]=S,this.int16[Ae+7]=k,this.uint16[Ae+8]=C,this.uint16[Ae+9]=P,this.uint16[Ae+10]=D,this.uint16[Ae+11]=R,this.uint16[Ae+12]=B,this.uint16[Ae+13]=V,this.uint16[Ae+14]=W,this.uint16[Ae+15]=Y,this.uint16[Ae+16]=ce,this.uint16[Ae+17]=J,this.uint16[Ae+18]=se,this.uint16[Ae+19]=ve,this.uint16[Ae+20]=Se,this.uint16[Ae+21]=Ve,this.uint16[Ae+22]=We,this.uint32[tt+12]=Ne,this.float32[tt+13]=Oe,this.float32[tt+14]=De,this.uint16[Ae+30]=He,this.uint16[Ae+31]=Be,e}}po.prototype.bytesPerElement=64,$e("StructArrayLayout8i15ui1ul2f2ui64",po);class Qn extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Qn.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",Qn);class Pu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const g=3*e;return this.uint16[6*e+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,e}}Pu.prototype.bytesPerElement=12,$e("StructArrayLayout1ui2f12",Pu);class el extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const g=4*e;return this.uint32[2*e+0]=n,this.uint16[g+2]=a,this.uint16[g+3]=h,e}}el.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",el);class bs extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=a,e}}bs.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",bs);class Au extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Au.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",Au);class zu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,a,h)}emplace(e,n,a,h,g){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,e}}zu.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",zu);class Mu extends co{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new H(this.anchorPointX,this.anchorPointY)}}Mu.prototype.size=20;class Ph extends Mn{get(e){return new Mu(this,e)}}$e("CollisionBoxArray",Ph);class p extends co{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}p.prototype.size=48;class t extends Cu{get(e){return new p(this,e)}}$e("PlacedSymbolArray",t);class o extends co{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}o.prototype.size=64;class u extends po{get(e){return new o(this,e)}}$e("SymbolInstanceArray",u);class c extends Qn{getoffsetX(e){return this.float32[1*e+0]}}$e("GlyphOffsetArray",c);class m extends Xa{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}$e("SymbolLineVertexArray",m);class w extends co{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}w.prototype.size=12;class b extends Pu{get(e){return new w(this,e)}}$e("TextAnchorOffsetArray",b);class E extends co{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}E.prototype.size=8;class I extends el{get(e){return new E(this,e)}}$e("FeatureIndexArray",I);class A extends sa{}class z extends sa{}class F extends sa{}class Z extends Su{}class $ extends Tu{}class K extends oa{}class N extends Eu{}class te extends Ya{}class pe extends ku{}class X extends Iu{}class oe extends Ja{}class fe extends Qa{}class me extends ho{}class ge extends bs{}const Pe=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Te}=Pe;class Ie{constructor(e=[]){this.segments=e}prepareSegment(e,n,a,h){let g=this.segments[this.segments.length-1];return e>Ie.MAX_VERTEX_ARRAY_LENGTH&&si(`Max vertices per segment is ${Ie.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>Ie.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,h){return new Ie([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function je(r,e){return 256*(r=qe(Math.floor(r),0,255))+qe(Math.floor(e),0,255)}Ie.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",Ie);const ut=di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fe={exports:{}},nt={exports:{}};nt.exports=function(r,e){var n,a,h,g,y,v,S,k;for(a=r.length-(n=3&r.length),h=e,y=3432918353,v=461845907,k=0;k<a;)S=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,h=27492+(65535&(g=5*(65535&(h=(h^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&r.charCodeAt(k+2))<<16;case 2:S^=(255&r.charCodeAt(k+1))<<8;case 1:h^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(k)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var mt=nt.exports,bt={exports:{}};bt.exports=function(r,e){for(var n,a=r.length,h=e^a,g=0;a>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(g)|(255&r.charCodeAt(++g))<<8|(255&r.charCodeAt(++g))<<16|(255&r.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&r.charCodeAt(g+2))<<16;case 2:h^=(255&r.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var ot=mt,yt=bt.exports;Fe.exports=ot,Fe.exports.murmur3=ot,Fe.exports.murmur2=yt;var _t=U(Fe.exports);class Jt{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,a,h){this.ids.push(Ut(e)),this.positions.push(n,a,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ut(e);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=n?h=y:a=y+1}const g=[];for(;this.ids[a]===n;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(e,n){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return cr(a,h,0,a.length-1),n&&n.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(e){const n=new Jt;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Ut(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:_t(String(r))}function cr(r,e,n,a){for(;n<a;){const h=r[n+a>>1];let g=n-1,y=a+1;for(;;){do g++;while(r[g]<h);do y--;while(r[y]>h);if(g>=y)break;_i(r,g,y),_i(e,3*g,3*y),_i(e,3*g+1,3*y+1),_i(e,3*g+2,3*y+2)}y-n<a-y?(cr(r,e,n,y),n=y+1):(cr(r,e,y+1,a),a=y)}}function _i(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}$e("FeaturePositionMap",Jt);class $t{constructor(e,n){this.gl=e.gl,this.location=n}}class qi extends $t{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Qr extends $t{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class _n extends $t{constructor(e,n){super(e,n),this.current=Ft.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ss=new Float32Array(16);function Ts(r){return[je(255*r.r,255*r.g),je(255*r.b,255*r.a)]}class vn{constructor(e,n,a){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=a}setUniform(e,n,a){e.set(a.constantOr(this.value))}getBinding(e,n,a){return this.type==="color"?new _n(e,n):new qi(e,n)}}class en{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,n,a){return a.substr(0,9)==="u_pattern"?new Qr(e,n):new qi(e,n)}}class ii{constructor(e,n,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,a,h,g){const y=this.paintVertexArray.length,v=this.expression.evaluate(new Gt(0),n,{},h,[],g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,n,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(e,n,g)}_setPaintValue(e,n,a){if(this.type==="color"){const h=Ts(a);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wt{constructor(e,n,a,h,g,y){this.expression=e,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,a,h,g){const y=this.expression.evaluate(new Gt(this.zoom),n,{},h,[],g),v=this.expression.evaluate(new Gt(this.zoom+1),n,{},h,[],g),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,y,v)}updatePaintArray(e,n,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(e,n,g,y)}_setPaintValue(e,n,a,h){if(this.type==="color"){const g=Ts(a),y=Ts(h);for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],y[0],y[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=qe(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,n,a){return new qi(e,n)}}class li{constructor(e,n,a,h,g,y){this.expression=e,this.type=n,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,n,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,h,g){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,n,a,h){if(!h||!a)return;const{min:g,mid:y,max:v}=a,S=h[g],k=h[y],C=h[v];if(S&&k&&C)for(let P=e;P<n;P++)this.zoomInPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],k.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],k.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ut.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ut.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fo{constructor(e,n,a){this.binders={},this._buffers=[];const h=[];for(const g in e.paint._values){if(!a(g))continue;const y=e.paint.get(g);if(!(y instanceof Yr&&eo(y.property.specification)))continue;const v=Mi(g,e.type),S=y.value,k=y.property.specification.type,C=y.property.useIntegerZoom,P=y.property.specification["property-type"],D=P==="cross-faded"||P==="cross-faded-data-driven";if(S.kind==="constant")this.binders[g]=D?new en(S.value,v):new vn(S.value,v,k),h.push(`/u_${g}`);else if(S.kind==="source"||D){const R=Ir(g,k,"source");this.binders[g]=D?new li(S,k,C,n,R,e.id):new ii(S,v,k,R),h.push(`/a_${g}`)}else{const R=Ir(g,k,"composite");this.binders[g]=new Wt(S,v,k,C,n,R),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ii||n instanceof Wt?n.maxValue:0}populatePaintArrays(e,n,a,h,g){for(const y in this.binders){const v=this.binders[y];(v instanceof ii||v instanceof Wt||v instanceof li)&&v.populatePaintArray(e,n,a,h,g)}}setConstantPatternPositions(e,n){for(const a in this.binders){const h=this.binders[a];h instanceof en&&h.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,a,h,g){let y=!1;for(const v in e){const S=n.getPositions(v);for(const k of S){const C=a.feature(k.index);for(const P in this.binders){const D=this.binders[P];if((D instanceof ii||D instanceof Wt||D instanceof li)&&D.expression.isStateDependent===!0){const R=h.paint.get(P);D.expression=R.value,D.updatePaintArray(k.start,k.end,C,e[v],g),y=!0}}}}return y}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof vn||a instanceof en)&&e.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof ii||a instanceof Wt)for(let h=0;h<a.paintVertexAttributes.length;h++)e.push(a.paintVertexAttributes[h].name);else if(a instanceof li)for(let h=0;h<ut.members.length;h++)e.push(ut.members[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof vn||a instanceof en||a instanceof Wt)for(const h of a.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof vn||g instanceof en||g instanceof Wt){for(const y of g.uniformNames)if(n[y]){const v=g.getBinding(e,n[y],y);a.push({name:y,property:h,binding:v})}}}return a}setUniforms(e,n,a,h){for(const{name:g,property:y,binding:v}of n)this.binders[y].setUniform(v,h,a.get(y),g)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const a=this.binders[n];if(e&&a instanceof li){const h=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof ii||a instanceof Wt)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof ii||a instanceof Wt||a instanceof li)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ii||n instanceof Wt||n instanceof li)&&n.destroy()}}}class Xt{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new fo(h,n,a);this.needsUpload=!1,this._featureMap=new Jt,this._bufferOffset=0}populatePaintArrays(e,n,a,h,g,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,n,h,g,y);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,n,g,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Mi(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Ir(r,e,n){const a={color:{source:oa,composite:zu},number:{source:Qn,composite:oa}},h=function(g){return{"line-pattern":{source:N,composite:N},"fill-pattern":{source:N,composite:N},"fill-extrusion-pattern":{source:N,composite:N}}[g]}(r);return h&&h[n]||a[e][n]}$e("ConstantBinder",vn),$e("CrossFadedConstantBinder",en),$e("SourceExpressionBinder",ii),$e("CrossFadedCompositeBinder",li),$e("CompositeExpressionBinder",Wt),$e("ProgramConfiguration",fo,{omit:["_buffers"]}),$e("ProgramConfigurationSet",Xt);const wt=8192,Du=Math.pow(2,14)-1,Ah=-Du-1;function Es(r){const e=wt/r.extent,n=r.loadGeometry();for(let a=0;a<n.length;a++){const h=n[a];for(let g=0;g<h.length;g++){const y=h[g],v=Math.round(y.x*e),S=Math.round(y.y*e);y.x=qe(v,Ah,Du),y.y=qe(S,Ah,Du),(v<y.x||v>y.x+1||S<y.y||S>y.y+1)&&si("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ks(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Es(r):[]}}function tl(r,e,n,a,h){r.emplaceBack(2*e+(a+1)/2,2*n+(h+1)/2)}class Lu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new z,this.indexArray=new me,this.segments=new Ie,this.programConfigurations=new Xt(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){const h=this.layers[0],g=[];let y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(const{feature:S,id:k,index:C,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,R=ks(S,D);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),R,a))continue;const B=v?y.evaluate(R,{},a):void 0,V={id:k,properties:S.properties,type:S.type,sourceLayerIndex:P,index:C,geometry:D?R.geometry:Es(S),patterns:{},sortKey:B};g.push(V)}v&&g.sort((S,k)=>S.sortKey-k.sortKey);for(const S of g){const{geometry:k,index:C,sourceLayerIndex:P}=S,D=e[C].feature;this.addFeature(S,k,C,a),n.featureIndex.insert(D,k,C,P,this.index)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Te),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,h){for(const g of n)for(const y of g){const v=y.x,S=y.y;if(v<0||v>=wt||S<0||S>=wt)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=k.vertexLength;tl(this.layoutVertexArray,v,S,-1,-1),tl(this.layoutVertexArray,v,S,1,-1),tl(this.layoutVertexArray,v,S,1,1),tl(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h)}}function Is(r,e){for(let n=0;n<r.length;n++)if(il(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(il(r,e[n]))return!0;return!!la(r,e)}function zh(r,e,n){return!!il(r,e)||!!ua(e,r,n)}function Ru(r,e){if(r.length===1)return ry(e,r[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let h=0;h<a.length;h++)if(il(r,a[h]))return!0}for(let n=0;n<r.length;n++)if(ry(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(la(r,e[n]))return!0;return!1}function Mh(r,e,n){if(r.length>1){if(la(r,e))return!0;for(let a=0;a<e.length;a++)if(ua(e[a],r,n))return!0}for(let a=0;a<r.length;a++)if(ua(r[a],e,n))return!0;return!1}function la(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const a=r[n],h=r[n+1];for(let g=0;g<e.length-1;g++)if(Dh(a,h,e[g],e[g+1]))return!0}return!1}function Dh(r,e,n,a){return sr(r,n,a)!==sr(e,n,a)&&sr(r,e,n)!==sr(r,e,a)}function ua(r,e,n){const a=n*n;if(e.length===1)return r.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(iy(r,e[h-1],e[h])<a)return!0;return!1}function iy(r,e,n){const a=e.distSqr(n);if(a===0)return r.distSqr(e);const h=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/a;return r.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function ry(r,e){let n,a,h,g=!1;for(let y=0;y<r.length;y++){n=r[y];for(let v=0,S=n.length-1;v<n.length;S=v++)a=n[v],h=n[S],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function il(r,e){let n=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){const g=r[a],y=r[h];g.y>e.y!=y.y>e.y&&e.x<(y.x-g.x)*(e.y-g.y)/(y.y-g.y)+g.x&&(n=!n)}return n}function L1(r,e,n){const a=n[0],h=n[2];if(r.x<a.x&&e.x<a.x||r.x>h.x&&e.x>h.x||r.y<a.y&&e.y<a.y||r.y>h.y&&e.y>h.y)return!1;const g=sr(r,e,n[0]);return g!==sr(r,e,n[1])||g!==sr(r,e,n[2])||g!==sr(r,e,n[3])}function Fu(r,e,n){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(r)}function Lh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Rh(r,e,n,a,h){if(!e[0]&&!e[1])return r;const g=H.convert(e)._mult(h);n==="viewport"&&g._rotate(-a);const y=[];for(let v=0;v<r.length;v++)y.push(r[v].sub(g));return y}let ny,sy;$e("CircleBucket",Lu,{omit:["layers"]});var R1={get paint(){return sy=sy||new ur({"circle-radius":new it(ye.paint_circle["circle-radius"]),"circle-color":new it(ye.paint_circle["circle-color"]),"circle-blur":new it(ye.paint_circle["circle-blur"]),"circle-opacity":new it(ye.paint_circle["circle-opacity"]),"circle-translate":new Ye(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return ny=ny||new ur({"circle-sort-key":new it(ye.layout_circle["circle-sort-key"])})}},hr=1e-6,rl=typeof Float32Array<"u"?Float32Array:Array;function jp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function oy(r,e,n){var a=e[0],h=e[1],g=e[2],y=e[3],v=e[4],S=e[5],k=e[6],C=e[7],P=e[8],D=e[9],R=e[10],B=e[11],V=e[12],W=e[13],Y=e[14],ce=e[15],J=n[0],se=n[1],ve=n[2],Se=n[3];return r[0]=J*a+se*v+ve*P+Se*V,r[1]=J*h+se*S+ve*D+Se*W,r[2]=J*g+se*k+ve*R+Se*Y,r[3]=J*y+se*C+ve*B+Se*ce,r[4]=(J=n[4])*a+(se=n[5])*v+(ve=n[6])*P+(Se=n[7])*V,r[5]=J*h+se*S+ve*D+Se*W,r[6]=J*g+se*k+ve*R+Se*Y,r[7]=J*y+se*C+ve*B+Se*ce,r[8]=(J=n[8])*a+(se=n[9])*v+(ve=n[10])*P+(Se=n[11])*V,r[9]=J*h+se*S+ve*D+Se*W,r[10]=J*g+se*k+ve*R+Se*Y,r[11]=J*y+se*C+ve*B+Se*ce,r[12]=(J=n[12])*a+(se=n[13])*v+(ve=n[14])*P+(Se=n[15])*V,r[13]=J*h+se*S+ve*D+Se*W,r[14]=J*g+se*k+ve*R+Se*Y,r[15]=J*y+se*C+ve*B+Se*ce,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Bu,F1=oy;function Fh(r,e,n){var a=e[0],h=e[1],g=e[2],y=e[3];return r[0]=n[0]*a+n[4]*h+n[8]*g+n[12]*y,r[1]=n[1]*a+n[5]*h+n[9]*g+n[13]*y,r[2]=n[2]*a+n[6]*h+n[10]*g+n[14]*y,r[3]=n[3]*a+n[7]*h+n[11]*g+n[15]*y,r}Bu=new rl(4),rl!=Float32Array&&(Bu[0]=0,Bu[1]=0,Bu[2]=0,Bu[3]=0);class B1 extends Jr{constructor(e){super(e,R1)}createBucket(e){return new Lu(e)}queryRadius(e){const n=e;return Fu("circle-radius",this,n)+Fu("circle-stroke-width",this,n)+Lh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,a,h,g,y,v,S){const k=Rh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),C=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),P=this.paint.get("circle-pitch-alignment")==="map",D=P?k:function(B,V){return B.map(W=>ay(W,V))}(k,S),R=P?C*v:C;for(const B of h)for(const V of B){const W=P?V:ay(V,S);let Y=R;const ce=Fh([],[V.x,V.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=ce[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=y.cameraToCenterDistance/ce[3]),zh(D,W,Y))return!0}return!1}}function ay(r,e){const n=Fh([],[r.x,r.y,0,1],e);return new H(n[0]/n[3],n[1]/n[3])}class ly extends Lu{}let uy;$e("HeatmapBucket",ly,{omit:["layers"]});var O1={get paint(){return uy=uy||new ur({"heatmap-radius":new it(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new na(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(ye.paint_heatmap["heatmap-opacity"])})}};function $p(r,{width:e,height:n},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*n*a}`)}else h=new Uint8Array(e*n*a);return r.width=e,r.height=n,r.data=h,r}function cy(r,{width:e,height:n},a){if(e===r.width&&n===r.height)return;const h=$p({},{width:e,height:n},a);qp(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,n)},a),r.width=e,r.height=n,r.data=h.data}function qp(r,e,n,a,h,g){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||n.x>r.width-h.width||n.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,v=e.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<h.height;S++){const k=((n.y+S)*r.width+n.x)*g,C=((a.y+S)*e.width+a.x)*g;for(let P=0;P<h.width*g;P++)v[C+P]=y[k+P]}return e}class Ou{constructor(e,n){$p(this,e,1,n)}resize(e){cy(this,e,1)}clone(){return new Ou({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,h,g){qp(e,n,a,h,g,1)}}class tn{constructor(e,n){$p(this,e,4,n)}resize(e){cy(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new tn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,h,g){qp(e,n,a,h,g,4)}}function hy(r){const e={},n=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new tn({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(y,v,S)=>{e[r.evaluationKey]=S;const k=r.expression.evaluate(e);h.data[y+v+0]=Math.floor(255*k.r/k.a),h.data[y+v+1]=Math.floor(255*k.g/k.a),h.data[y+v+2]=Math.floor(255*k.b/k.a),h.data[y+v+3]=Math.floor(255*k.a)};if(r.clips)for(let y=0,v=0;y<a;++y,v+=4*n)for(let S=0,k=0;S<n;S++,k+=4){const C=S/(n-1),{start:P,end:D}=r.clips[y];g(v,k,P*(1-C)+D*C)}else for(let y=0,v=0;y<n;y++,v+=4)g(0,v,y/(n-1));return h}$e("AlphaImage",Ou),$e("RGBAImage",tn);class N1 extends Jr{createBucket(e){return new ly(e)}constructor(e){super(e,O1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dy;var V1={get paint(){return dy=dy||new ur({"hillshade-illumination-direction":new Ye(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(ye.paint_hillshade["hillshade-accent-color"])})}};class U1 extends Jr{constructor(e){super(e,V1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const j1=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:$1}=j1;var Zp={exports:{}};function Bh(r,e,n){n=n||2;var a,h,g,y,v,S,k,C=e&&e.length,P=C?e[0]*n:r.length,D=py(r,0,P,n,!0),R=[];if(!D||D.next===D.prev)return R;if(C&&(D=function(V,W,Y,ce){var J,se,ve,Se=[];for(J=0,se=W.length;J<se;J++)(ve=py(V,W[J]*ce,J<se-1?W[J+1]*ce:V.length,ce,!1))===ve.next&&(ve.steiner=!0),Se.push(Y1(ve));for(Se.sort(W1),J=0;J<Se.length;J++)Y=K1(Se[J],Y);return Y}(r,e,D,n)),r.length>80*n){a=g=r[0],h=y=r[1];for(var B=n;B<P;B+=n)(v=r[B])<a&&(a=v),(S=r[B+1])<h&&(h=S),v>g&&(g=v),S>y&&(y=S);k=(k=Math.max(g-a,y-h))!==0?32767/k:0}return Nu(D,R,n,a,h,k,0),R}function py(r,e,n,a,h){var g,y;if(h===Wp(r,e,n,a)>0)for(g=e;g<n;g+=a)y=gy(g,r[g],r[g+1],y);else for(g=n-a;g>=e;g-=a)y=gy(g,r[g],r[g+1],y);return y&&Oh(y,y.next)&&(Uu(y),y=y.next),y}function ca(r,e){if(!r)return r;e||(e=r);var n,a=r;do if(n=!1,a.steiner||!Oh(a,a.next)&&pi(a.prev,a,a.next)!==0)a=a.next;else{if(Uu(a),(a=e=a.prev)===a.next)break;n=!0}while(n||a!==e);return e}function Nu(r,e,n,a,h,g,y){if(r){!y&&g&&function(C,P,D,R){var B=C;do B.z===0&&(B.z=Hp(B.x,B.y,P,D,R)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==C);B.prevZ.nextZ=null,B.prevZ=null,function(V){var W,Y,ce,J,se,ve,Se,Ve,We=1;do{for(Y=V,V=null,se=null,ve=0;Y;){for(ve++,ce=Y,Se=0,W=0;W<We&&(Se++,ce=ce.nextZ);W++);for(Ve=We;Se>0||Ve>0&&ce;)Se!==0&&(Ve===0||!ce||Y.z<=ce.z)?(J=Y,Y=Y.nextZ,Se--):(J=ce,ce=ce.nextZ,Ve--),se?se.nextZ=J:V=J,J.prevZ=se,se=J;Y=ce}se.nextZ=null,We*=2}while(ve>1)}(B)}(r,a,h,g);for(var v,S,k=r;r.prev!==r.next;)if(v=r.prev,S=r.next,g?Z1(r,a,h,g):q1(r))e.push(v.i/n|0),e.push(r.i/n|0),e.push(S.i/n|0),Uu(r),r=S.next,k=S.next;else if((r=S)===k){y?y===1?Nu(r=H1(ca(r),e,n),e,n,a,h,g,2):y===2&&G1(r,e,n,a,h,g):Nu(ca(r),e,n,a,h,g,1);break}}}function q1(r){var e=r.prev,n=r,a=r.next;if(pi(e,n,a)>=0)return!1;for(var h=e.x,g=n.x,y=a.x,v=e.y,S=n.y,k=a.y,C=h<g?h<y?h:y:g<y?g:y,P=v<S?v<k?v:k:S<k?S:k,D=h>g?h>y?h:y:g>y?g:y,R=v>S?v>k?v:k:S>k?S:k,B=a.next;B!==e;){if(B.x>=C&&B.x<=D&&B.y>=P&&B.y<=R&&nl(h,v,g,S,y,k,B.x,B.y)&&pi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Z1(r,e,n,a){var h=r.prev,g=r,y=r.next;if(pi(h,g,y)>=0)return!1;for(var v=h.x,S=g.x,k=y.x,C=h.y,P=g.y,D=y.y,R=v<S?v<k?v:k:S<k?S:k,B=C<P?C<D?C:D:P<D?P:D,V=v>S?v>k?v:k:S>k?S:k,W=C>P?C>D?C:D:P>D?P:D,Y=Hp(R,B,e,n,a),ce=Hp(V,W,e,n,a),J=r.prevZ,se=r.nextZ;J&&J.z>=Y&&se&&se.z<=ce;){if(J.x>=R&&J.x<=V&&J.y>=B&&J.y<=W&&J!==h&&J!==y&&nl(v,C,S,P,k,D,J.x,J.y)&&pi(J.prev,J,J.next)>=0||(J=J.prevZ,se.x>=R&&se.x<=V&&se.y>=B&&se.y<=W&&se!==h&&se!==y&&nl(v,C,S,P,k,D,se.x,se.y)&&pi(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;J&&J.z>=Y;){if(J.x>=R&&J.x<=V&&J.y>=B&&J.y<=W&&J!==h&&J!==y&&nl(v,C,S,P,k,D,J.x,J.y)&&pi(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;se&&se.z<=ce;){if(se.x>=R&&se.x<=V&&se.y>=B&&se.y<=W&&se!==h&&se!==y&&nl(v,C,S,P,k,D,se.x,se.y)&&pi(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function H1(r,e,n){var a=r;do{var h=a.prev,g=a.next.next;!Oh(h,g)&&fy(h,a,a.next,g)&&Vu(h,g)&&Vu(g,h)&&(e.push(h.i/n|0),e.push(a.i/n|0),e.push(g.i/n|0),Uu(a),Uu(a.next),a=r=g),a=a.next}while(a!==r);return ca(a)}function G1(r,e,n,a,h,g){var y=r;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&J1(y,v)){var S=my(y,v);return y=ca(y,y.next),S=ca(S,S.next),Nu(y,e,n,a,h,g,0),void Nu(S,e,n,a,h,g,0)}v=v.next}y=y.next}while(y!==r)}function W1(r,e){return r.x-e.x}function K1(r,e){var n=function(h,g){var y,v=g,S=h.x,k=h.y,C=-1/0;do{if(k<=v.y&&k>=v.next.y&&v.next.y!==v.y){var P=v.x+(k-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(P<=S&&P>C&&(C=P,y=v.x<v.next.x?v:v.next,P===S))return y}v=v.next}while(v!==g);if(!y)return null;var D,R=y,B=y.x,V=y.y,W=1/0;v=y;do S>=v.x&&v.x>=B&&S!==v.x&&nl(k<V?S:C,k,B,V,k<V?C:S,k,v.x,v.y)&&(D=Math.abs(k-v.y)/(S-v.x),Vu(v,h)&&(D<W||D===W&&(v.x>y.x||v.x===y.x&&X1(y,v)))&&(y=v,W=D)),v=v.next;while(v!==R);return y}(r,e);if(!n)return e;var a=my(n,r);return ca(a,a.next),ca(n,n.next)}function X1(r,e){return pi(r.prev,r,e.prev)<0&&pi(e.next,r,r.next)<0}function Hp(r,e,n,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Y1(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function nl(r,e,n,a,h,g,y,v){return(h-y)*(e-v)>=(r-y)*(g-v)&&(r-y)*(a-v)>=(n-y)*(e-v)&&(n-y)*(g-v)>=(h-y)*(a-v)}function J1(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,a){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==a.i&&h.next.i!==a.i&&fy(h,h.next,n,a))return!0;h=h.next}while(h!==n);return!1}(r,e)&&(Vu(r,e)&&Vu(e,r)&&function(n,a){var h=n,g=!1,y=(n.x+a.x)/2,v=(n.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==n);return g}(r,e)&&(pi(r.prev,r,e.prev)||pi(r,e.prev,e))||Oh(r,e)&&pi(r.prev,r,r.next)>0&&pi(e.prev,e,e.next)>0)}function pi(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Oh(r,e){return r.x===e.x&&r.y===e.y}function fy(r,e,n,a){var h=Vh(pi(r,e,n)),g=Vh(pi(r,e,a)),y=Vh(pi(n,a,r)),v=Vh(pi(n,a,e));return h!==g&&y!==v||!(h!==0||!Nh(r,n,e))||!(g!==0||!Nh(r,a,e))||!(y!==0||!Nh(n,r,a))||!(v!==0||!Nh(n,e,a))}function Nh(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function Vh(r){return r>0?1:r<0?-1:0}function Vu(r,e){return pi(r.prev,r,r.next)<0?pi(r,e,r.next)>=0&&pi(r,r.prev,e)>=0:pi(r,e,r.prev)<0||pi(r,r.next,e)<0}function my(r,e){var n=new Gp(r.i,r.x,r.y),a=new Gp(e.i,e.x,e.y),h=r.next,g=e.prev;return r.next=e,e.prev=r,n.next=h,h.prev=n,a.next=n,n.prev=a,g.next=a,a.prev=g,a}function gy(r,e,n,a){var h=new Gp(r,e,n);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Uu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Gp(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(r,e,n,a){for(var h=0,g=e,y=n-a;g<n;g+=a)h+=(r[y]-r[g])*(r[g+1]+r[y+1]),y=g;return h}Zp.exports=Bh,Zp.exports.default=Bh,Bh.deviation=function(r,e,n,a){var h=e&&e.length,g=Math.abs(Wp(r,0,h?e[0]*n:r.length,n));if(h)for(var y=0,v=e.length;y<v;y++)g-=Math.abs(Wp(r,e[y]*n,y<v-1?e[y+1]*n:r.length,n));var S=0;for(y=0;y<a.length;y+=3){var k=a[y]*n,C=a[y+1]*n,P=a[y+2]*n;S+=Math.abs((r[k]-r[P])*(r[C+1]-r[k+1])-(r[k]-r[C])*(r[P+1]-r[k+1]))}return g===0&&S===0?0:Math.abs((S-g)/g)},Bh.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},a=0,h=0;h<r.length;h++){for(var g=0;g<r[h].length;g++)for(var y=0;y<e;y++)n.vertices.push(r[h][g][y]);h>0&&n.holes.push(a+=r[h-1].length)}return n};var yy=U(Zp.exports);function Q1(r,e,n,a,h){_y(r,e,n||0,a||r.length-1,h||ew)}function _y(r,e,n,a,h){for(;a>n;){if(a-n>600){var g=a-n+1,y=e-n+1,v=Math.log(g),S=.5*Math.exp(2*v/3),k=.5*Math.sqrt(v*S*(g-S)/g)*(y-g/2<0?-1:1);_y(r,e,Math.max(n,Math.floor(e-y*S/g+k)),Math.min(a,Math.floor(e+(g-y)*S/g+k)),h)}var C=r[e],P=n,D=a;for(ju(r,n,e),h(r[a],C)>0&&ju(r,n,a);P<D;){for(ju(r,P,D),P++,D--;h(r[P],C)<0;)P++;for(;h(r[D],C)>0;)D--}h(r[n],C)===0?ju(r,n,D):ju(r,++D,a),D<=e&&(n=D+1),e<=D&&(a=D-1)}}function ju(r,e,n){var a=r[e];r[e]=r[n],r[n]=a}function ew(r,e){return r<e?-1:r>e?1:0}function Kp(r,e){const n=r.length;if(n<=1)return[r];const a=[];let h,g;for(let y=0;y<n;y++){const v=Pn(r[y]);v!==0&&(r[y].area=Math.abs(v),g===void 0&&(g=v<0),g===v<0?(h&&a.push(h),h=[r[y]]):h.push(r[y]))}if(h&&a.push(h),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(Q1(a[y],e,1,a[y].length-1,tw),a[y]=a[y].slice(0,e));return a}function tw(r,e){return e.area-r.area}function Xp(r,e,n){const a=n.patternDependencies;let h=!1;for(const g of e){const y=g.paint.get(`${r}-pattern`);y.isConstant()||(h=!0);const v=y.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Yp(r,e,n,a,h){const g=h.patternDependencies;for(const y of e){const v=y.paint.get(`${r}-pattern`).value;if(v.kind!=="constant"){let S=v.evaluate({zoom:a-1},n,{},h.availableImages),k=v.evaluate({zoom:a},n,{},h.availableImages),C=v.evaluate({zoom:a+1},n,{},h.availableImages);S=S&&S.name?S.name:S,k=k&&k.name?k.name:k,C=C&&C.name?C.name:C,g[S]=!0,g[k]=!0,g[C]=!0,n.patterns[y.id]={min:S,mid:k,max:C}}}return n}class Jp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new F,this.indexArray=new me,this.indexArray2=new ge,this.programConfigurations=new Xt(e.layers,e.zoom),this.segments=new Ie,this.segments2=new Ie,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){this.hasPattern=Xp("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:S,index:k,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,D=ks(v,P);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),D,a))continue;const R=g?h.evaluate(D,{},a,n.availableImages):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:C,index:k,geometry:P?D.geometry:Es(v),patterns:{},sortKey:R};y.push(B)}g&&y.sort((v,S)=>v.sortKey-S.sortKey);for(const v of y){const{geometry:S,index:k,sourceLayerIndex:C}=v;if(this.hasPattern){const P=Yp("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(v,S,k,a,{});n.featureIndex.insert(e[k].feature,S,k,C,this.index)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}addFeatures(e,n,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,h,g){for(const y of Kp(n,500)){let v=0;for(const R of y)v+=R.length;const S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),k=S.vertexLength,C=[],P=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&P.push(C.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),V=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(V+R.length-1,V),C.push(R[0].x),C.push(R[0].y);for(let W=1;W<R.length;W++)this.layoutVertexArray.emplaceBack(R[W].x,R[W].y),this.indexArray2.emplaceBack(V+W-1,V+W),C.push(R[W].x),C.push(R[W].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const D=yy(C,P);for(let R=0;R<D.length;R+=3)this.indexArray.emplaceBack(k+D[R],k+D[R+1],k+D[R+2]);S.vertexLength+=v,S.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,h)}}let vy,xy;$e("FillBucket",Jp,{omit:["layers","patternFeatures"]});var iw={get paint(){return xy=xy||new ur({"fill-antialias":new Ye(ye.paint_fill["fill-antialias"]),"fill-opacity":new it(ye.paint_fill["fill-opacity"]),"fill-color":new it(ye.paint_fill["fill-color"]),"fill-outline-color":new it(ye.paint_fill["fill-outline-color"]),"fill-translate":new Ye(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new ws(ye.paint_fill["fill-pattern"])})},get layout(){return vy=vy||new ur({"fill-sort-key":new it(ye.layout_fill["fill-sort-key"])})}};class rw extends Jr{constructor(e){super(e,iw)}recalculate(e,n){super.recalculate(e,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Jp(e)}queryRadius(){return Lh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,a,h,g,y,v){return Ru(Rh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}const nw=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sw=di([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ow}=nw;var mo={},aw=ee,wy=sl;function sl(r,e,n,a,h){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=h,r.readFields(lw,this,e)}function lw(r,e,n){r==1?e.id=n.readVarint():r==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[y]=v}}(n,e):r==3?e.type=n.readVarint():r==4&&(e._geometry=n.pos)}function uw(r){for(var e,n,a=0,h=0,g=r.length,y=g-1;h<g;y=h++)a+=((n=r[y]).x-(e=r[h]).x)*(e.y+n.y);return a}sl.types=["Unknown","Point","LineString","Polygon"],sl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,n=r.readVarint()+r.pos,a=1,h=0,g=0,y=0,v=[];r.pos<n;){if(h<=0){var S=r.readVarint();a=7&S,h=S>>3}if(h--,a===1||a===2)g+=r.readSVarint(),y+=r.readSVarint(),a===1&&(e&&v.push(e),e=[]),e.push(new aw(g,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&v.push(e),v},sl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,n=1,a=0,h=0,g=0,y=1/0,v=-1/0,S=1/0,k=-1/0;r.pos<e;){if(a<=0){var C=r.readVarint();n=7&C,a=C>>3}if(a--,n===1||n===2)(h+=r.readSVarint())<y&&(y=h),h>v&&(v=h),(g+=r.readSVarint())<S&&(S=g),g>k&&(k=g);else if(n!==7)throw new Error("unknown command "+n)}return[y,S,v,k]},sl.prototype.toGeoJSON=function(r,e,n){var a,h,g=this.extent*Math.pow(2,n),y=this.extent*r,v=this.extent*e,S=this.loadGeometry(),k=sl.types[this.type];function C(R){for(var B=0;B<R.length;B++){var V=R[B];R[B]=[360*(V.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<S.length;a++)P[a]=S[a][0];C(S=P);break;case 2:for(a=0;a<S.length;a++)C(S[a]);break;case 3:for(S=function(R){var B=R.length;if(B<=1)return[R];for(var V,W,Y=[],ce=0;ce<B;ce++){var J=uw(R[ce]);J!==0&&(W===void 0&&(W=J<0),W===J<0?(V&&Y.push(V),V=[R[ce]]):V.push(R[ce]))}return V&&Y.push(V),Y}(S),a=0;a<S.length;a++)for(h=0;h<S[a].length;h++)C(S[a][h])}S.length===1?S=S[0]:k="Multi"+k;var D={type:"Feature",geometry:{type:k,coordinates:S},properties:this.properties};return"id"in this&&(D.id=this.id),D};var cw=wy,by=Sy;function Sy(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(hw,this,e),this.length=this._features.length}function hw(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(n))}Sy.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new cw(this._pbf,e,this.extent,this._keys,this._values)};var dw=by;function pw(r,e,n){if(r===3){var a=new dw(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}mo.VectorTile=function(r,e){this.layers=r.readFields(pw,{},e)},mo.VectorTileFeature=wy,mo.VectorTileLayer=by;const fw=mo.VectorTileFeature.types,Qp=Math.pow(2,13);function $u(r,e,n,a,h,g,y,v){r.emplaceBack(e,n,2*Math.floor(a*Qp)+y,h*Qp*2,g*Qp*2,Math.round(v))}class ef{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.centroidVertexArray=new A,this.indexArray=new me,this.programConfigurations=new Xt(e.layers,e.zoom),this.segments=new Ie,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){this.features=[],this.hasPattern=Xp("fill-extrusion",this.layers,n);for(const{feature:h,id:g,index:y,sourceLayerIndex:v}of e){const S=this.layers[0]._featureFilter.needGeometry,k=ks(h,S);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),k,a))continue;const C={id:g,sourceLayerIndex:v,index:y,geometry:S?k.geometry:Es(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Yp("fill-extrusion",this.layers,C,this.zoom,n)):this.addFeature(C,C.geometry,y,a,{}),n.featureIndex.insert(h,C.geometry,y,v,this.index,!0)}}addFeatures(e,n,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,n,a)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ow),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sw.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,a,h,g){const y={x:0,y:0,vertexCount:0};for(const v of Kp(n,500)){let S=0;for(const B of v)S+=B.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of v){if(B.length===0||gw(B))continue;let V=0;for(let W=0;W<B.length;W++){const Y=B[W];if(W>=1){const ce=B[W-1];if(!mw(Y,ce)){k.vertexLength+4>Ie.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const J=Y.sub(ce)._perp()._unit(),se=ce.dist(Y);V+se>32768&&(V=0),$u(this.layoutVertexArray,Y.x,Y.y,J.x,J.y,0,0,V),$u(this.layoutVertexArray,Y.x,Y.y,J.x,J.y,0,1,V),y.x+=2*Y.x,y.y+=2*Y.y,y.vertexCount+=2,V+=se,$u(this.layoutVertexArray,ce.x,ce.y,J.x,J.y,0,0,V),$u(this.layoutVertexArray,ce.x,ce.y,J.x,J.y,0,1,V),y.x+=2*ce.x,y.y+=2*ce.y,y.vertexCount+=2;const ve=k.vertexLength;this.indexArray.emplaceBack(ve,ve+2,ve+1),this.indexArray.emplaceBack(ve+1,ve+2,ve+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+S>Ie.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),fw[e.type]!=="Polygon")continue;const C=[],P=[],D=k.vertexLength;for(const B of v)if(B.length!==0){B!==v[0]&&P.push(C.length/2);for(let V=0;V<B.length;V++){const W=B[V];$u(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),y.x+=W.x,y.y+=W.y,y.vertexCount+=1,C.push(W.x),C.push(W.y)}}const R=yy(C,P);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(D+R[B],D+R[B+2],D+R[B+1]);k.primitiveLength+=R.length/3,k.vertexLength+=S}for(let v=0;v<y.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,h)}}function mw(r,e){return r.x===e.x&&(r.x<0||r.x>wt)||r.y===e.y&&(r.y<0||r.y>wt)}function gw(r){return r.every(e=>e.x<0)||r.every(e=>e.x>wt)||r.every(e=>e.y<0)||r.every(e=>e.y>wt)}let Ty;$e("FillExtrusionBucket",ef,{omit:["layers","features"]});var yw={get paint(){return Ty=Ty||new ur({"fill-extrusion-opacity":new Ye(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ws(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class _w extends Jr{constructor(e){super(e,yw)}createBucket(e){return new ef(e)}queryRadius(){return Lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,a,h,g,y,v,S){const k=Rh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),C=this.paint.get("fill-extrusion-height").evaluate(n,a),P=this.paint.get("fill-extrusion-base").evaluate(n,a),D=function(B,V,W,Y){const ce=[];for(const J of B){const se=[J.x,J.y,0,1];Fh(se,se,V),ce.push(new H(se[0]/se[3],se[1]/se[3]))}return ce}(k,S),R=function(B,V,W,Y){const ce=[],J=[],se=Y[8]*V,ve=Y[9]*V,Se=Y[10]*V,Ve=Y[11]*V,We=Y[8]*W,Ne=Y[9]*W,Oe=Y[10]*W,De=Y[11]*W;for(const He of B){const Be=[],Ae=[];for(const tt of He){const Xe=tt.x,vt=tt.y,Kt=Y[0]*Xe+Y[4]*vt+Y[12],Yt=Y[1]*Xe+Y[5]*vt+Y[13],Si=Y[2]*Xe+Y[6]*vt+Y[14],jr=Y[3]*Xe+Y[7]*vt+Y[15],dr=Si+Se,vi=jr+Ve,Oi=Kt+We,Hi=Yt+Ne,pr=Si+Oe,fr=jr+De,Ti=new H((Kt+se)/vi,(Yt+ve)/vi);Ti.z=dr/vi,Be.push(Ti);const Ei=new H(Oi/fr,Hi/fr);Ei.z=pr/fr,Ae.push(Ei)}ce.push(Be),J.push(Ae)}return[ce,J]}(h,P,C,S);return function(B,V,W){let Y=1/0;Ru(W,V)&&(Y=Ey(W,V[0]));for(let ce=0;ce<V.length;ce++){const J=V[ce],se=B[ce];for(let ve=0;ve<J.length-1;ve++){const Se=J[ve],Ve=[Se,J[ve+1],se[ve+1],se[ve],Se];Is(W,Ve)&&(Y=Math.min(Y,Ey(W,Ve)))}}return Y!==1/0&&Y}(R[0],R[1],D)}}function qu(r,e){return r.x*e.x+r.y*e.y}function Ey(r,e){if(r.length===1){let n=0;const a=e[n++];let h;for(;!h||a.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const g=e[n],y=r[0],v=h.sub(a),S=g.sub(a),k=y.sub(a),C=qu(v,v),P=qu(v,S),D=qu(S,S),R=qu(k,v),B=qu(k,S),V=C*D-P*P,W=(D*R-P*B)/V,Y=(C*B-P*R)/V,ce=a.z*(1-W-Y)+h.z*W+g.z*Y;if(isFinite(ce))return ce}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}const vw=di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xw}=vw,ww=di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:bw}=ww,Sw=mo.VectorTileFeature.types,Tw=Math.cos(Math.PI/180*37.5),ky=Math.pow(2,14)/.5;class tf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new $,this.layoutVertexArray2=new K,this.indexArray=new me,this.programConfigurations=new Xt(e.layers,e.zoom),this.segments=new Ie,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){this.hasPattern=Xp("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:S,index:k,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,D=ks(v,P);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),D,a))continue;const R=g?h.evaluate(D,{},a):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:C,index:k,geometry:P?D.geometry:Es(v),patterns:{},sortKey:R};y.push(B)}g&&y.sort((v,S)=>v.sortKey-S.sortKey);for(const v of y){const{geometry:S,index:k,sourceLayerIndex:C}=v;if(this.hasPattern){const P=Yp("line",this.layers,v,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(v,S,k,a,{});n.featureIndex.insert(e[k].feature,S,k,C,this.index)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}addFeatures(e,n,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,bw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,h,g){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),S=y.get("line-cap"),k=y.get("line-miter-limit"),C=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of n)this.addLine(P,e,v,S,k,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,h)}addLine(e,n,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Sw[n.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let k=0;for(;k<S-1&&e[k].equals(e[k+1]);)k++;if(S<(v?3:2))return;a==="bevel"&&(g=1.05);const C=this.overscaling<=16?15*wt/(512*this.overscaling):0,P=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let D,R,B,V,W;this.e1=this.e2=-1,v&&(D=e[S-2],W=e[k].sub(D)._unit()._perp());for(let Y=k;Y<S;Y++){if(B=Y===S-1?v?e[k+1]:void 0:e[Y+1],B&&e[Y].equals(B))continue;W&&(V=W),D&&(R=D),D=e[Y],W=B?B.sub(D)._unit()._perp():V,V=V||W;let ce=V.add(W);ce.x===0&&ce.y===0||ce._unit();const J=V.x*W.x+V.y*W.y,se=ce.x*W.x+ce.y*W.y,ve=se!==0?1/se:1/0,Se=2*Math.sqrt(2-2*se),Ve=se<Tw&&R&&B,We=V.x*W.y-V.y*W.x>0;if(Ve&&Y>k){const De=D.dist(R);if(De>2*C){const He=D.sub(D.sub(R)._mult(C/De)._round());this.updateDistance(R,He),this.addCurrentVertex(He,V,0,0,P),R=He}}const Ne=R&&B;let Oe=Ne?a:v?"butt":h;if(Ne&&Oe==="round"&&(ve<y?Oe="miter":ve<=2&&(Oe="fakeround")),Oe==="miter"&&ve>g&&(Oe="bevel"),Oe==="bevel"&&(ve>2&&(Oe="flipbevel"),ve<g&&(Oe="miter")),R&&this.updateDistance(R,D),Oe==="miter")ce._mult(ve),this.addCurrentVertex(D,ce,0,0,P);else if(Oe==="flipbevel"){if(ve>100)ce=W.mult(-1);else{const De=ve*V.add(W).mag()/V.sub(W).mag();ce._perp()._mult(De*(We?-1:1))}this.addCurrentVertex(D,ce,0,0,P),this.addCurrentVertex(D,ce.mult(-1),0,0,P)}else if(Oe==="bevel"||Oe==="fakeround"){const De=-Math.sqrt(ve*ve-1),He=We?De:0,Be=We?0:De;if(R&&this.addCurrentVertex(D,V,He,Be,P),Oe==="fakeround"){const Ae=Math.round(180*Se/Math.PI/20);for(let tt=1;tt<Ae;tt++){let Xe=tt/Ae;if(Xe!==.5){const Kt=Xe-.5;Xe+=Xe*Kt*(Xe-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Kt*Kt+(.848013+J*(.215638*J-1.06021)))}const vt=W.sub(V)._mult(Xe)._add(V)._unit()._mult(We?-1:1);this.addHalfVertex(D,vt.x,vt.y,!1,We,0,P)}}B&&this.addCurrentVertex(D,W,-He,-Be,P)}else if(Oe==="butt")this.addCurrentVertex(D,ce,0,0,P);else if(Oe==="square"){const De=R?1:-1;this.addCurrentVertex(D,ce,De,De,P)}else Oe==="round"&&(R&&(this.addCurrentVertex(D,V,0,0,P),this.addCurrentVertex(D,V,1,1,P,!0)),B&&(this.addCurrentVertex(D,W,-1,-1,P,!0),this.addCurrentVertex(D,W,0,0,P)));if(Ve&&Y<S-1){const De=D.dist(B);if(De>2*C){const He=D.add(B.sub(D)._mult(C/De)._round());this.updateDistance(D,He),this.addCurrentVertex(He,W,0,0,P),D=He}}}}addCurrentVertex(e,n,a,h,g,y=!1){const v=n.y*h-n.x,S=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*a,n.y-n.x*a,y,!1,a,g),this.addHalfVertex(e,v,S,y,!0,-h,g),this.distance>ky/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,a,h,g,y))}addHalfVertex({x:e,y:n},a,h,g,y,v,S){const k=.5*(this.lineClips?this.scaledDistance*(ky-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),S.primitiveLength++),y?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let Iy,Cy;$e("LineBucket",tf,{omit:["layers","patternFeatures"]});var Py={get paint(){return Cy=Cy||new ur({"line-opacity":new it(ye.paint_line["line-opacity"]),"line-color":new it(ye.paint_line["line-color"]),"line-translate":new Ye(ye.paint_line["line-translate"]),"line-translate-anchor":new Ye(ye.paint_line["line-translate-anchor"]),"line-width":new it(ye.paint_line["line-width"]),"line-gap-width":new it(ye.paint_line["line-gap-width"]),"line-offset":new it(ye.paint_line["line-offset"]),"line-blur":new it(ye.paint_line["line-blur"]),"line-dasharray":new bu(ye.paint_line["line-dasharray"]),"line-pattern":new ws(ye.paint_line["line-pattern"]),"line-gradient":new na(ye.paint_line["line-gradient"])})},get layout(){return Iy=Iy||new ur({"line-cap":new Ye(ye.layout_line["line-cap"]),"line-join":new it(ye.layout_line["line-join"]),"line-miter-limit":new Ye(ye.layout_line["line-miter-limit"]),"line-round-limit":new Ye(ye.layout_line["line-round-limit"]),"line-sort-key":new it(ye.layout_line["line-sort-key"])})}};class Ew extends it{possiblyEvaluate(e,n){return n=new Gt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,a,h){return n=Ge({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,a,h)}}let Uh;class kw extends Jr{constructor(e){super(e,Py),this.gradientVersion=0,Uh||(Uh=new Ew(Py.paint.properties["line-width"].specification),Uh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Uh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new tf(e)}queryRadius(e){const n=e,a=Ay(Fu("line-width",this,n),Fu("line-gap-width",this,n)),h=Fu("line-offset",this,n);return a/2+Math.abs(h)+Lh(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,a,h,g,y,v){const S=Rh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),k=v/2*Ay(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),C=this.paint.get("line-offset").evaluate(n,a);return C&&(h=function(P,D){const R=[];for(let B=0;B<P.length;B++){const V=P[B],W=[];for(let Y=0;Y<V.length;Y++){const ce=V[Y-1],J=V[Y],se=V[Y+1],ve=Y===0?new H(0,0):J.sub(ce)._unit()._perp(),Se=Y===V.length-1?new H(0,0):se.sub(J)._unit()._perp(),Ve=ve._add(Se)._unit(),We=Ve.x*Se.x+Ve.y*Se.y;We!==0&&Ve._mult(1/We),W.push(Ve._mult(D)._add(J))}R.push(W)}return R}(h,C*v)),function(P,D,R){for(let B=0;B<D.length;B++){const V=D[B];if(P.length>=3){for(let W=0;W<V.length;W++)if(il(P,V[W]))return!0}if(Mh(P,V,R))return!0}return!1}(S,h,k)}isTileClipped(){return!0}}function Ay(r,e){return e>0?e+2*r:r}const Iw=di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cw=di([{name:"a_projected_pos",components:3,type:"Float32"}],4);di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pw=di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zy=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Aw=di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zw(r,e,n){return r.sections.forEach(a=>{a.text=function(h,g,y){const v=g.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),xs.applyArabicShaping&&(h=xs.applyArabicShaping(h)),h}(a.text,e,n)}),r}di([{name:"triangle",components:3,type:"Uint16"}]),di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),di([{type:"Float32",name:"offsetX"}]),di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),di([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Zu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var bi=24,My=Bt,Dy=function(r,e,n,a,h){var g,y,v=8*h-a-1,S=(1<<v)-1,k=S>>1,C=-7,P=n?h-1:0,D=n?-1:1,R=r[e+P];for(P+=D,g=R&(1<<-C)-1,R>>=-C,C+=v;C>0;g=256*g+r[e+P],P+=D,C-=8);for(y=g&(1<<-C)-1,g>>=-C,C+=a;C>0;y=256*y+r[e+P],P+=D,C-=8);if(g===0)g=1-k;else{if(g===S)return y?NaN:1/0*(R?-1:1);y+=Math.pow(2,a),g-=k}return(R?-1:1)*y*Math.pow(2,g-a)},Ly=function(r,e,n,a,h,g){var y,v,S,k=8*g-h-1,C=(1<<k)-1,P=C>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:g-1,B=a?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,y=C):(y=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-y))<1&&(y--,S*=2),(e+=y+P>=1?D/S:D*Math.pow(2,1-P))*S>=2&&(y++,S/=2),y+P>=C?(v=0,y=C):y+P>=1?(v=(e*S-1)*Math.pow(2,h),y+=P):(v=e*Math.pow(2,P-1)*Math.pow(2,h),y=0));h>=8;r[n+R]=255&v,R+=B,v/=256,h-=8);for(y=y<<h|v,k+=h;k>0;r[n+R]=255&y,R+=B,y/=256,k-=8);r[n+R-B]|=128*V};function Bt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Bt.Varint=0,Bt.Fixed64=1,Bt.Bytes=2,Bt.Fixed32=5;var rf=4294967296,Ry=1/rf,Fy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Cs(r){return r.type===Bt.Bytes?r.readVarint()+r.pos:r.pos+1}function ol(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function By(r,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var h=n.pos-1;h>=r;h--)n.buf[h+a]=n.buf[h]}function Mw(r,e){for(var n=0;n<r.length;n++)e.writeVarint(r[n])}function Dw(r,e){for(var n=0;n<r.length;n++)e.writeSVarint(r[n])}function Lw(r,e){for(var n=0;n<r.length;n++)e.writeFloat(r[n])}function Rw(r,e){for(var n=0;n<r.length;n++)e.writeDouble(r[n])}function Fw(r,e){for(var n=0;n<r.length;n++)e.writeBoolean(r[n])}function Bw(r,e){for(var n=0;n<r.length;n++)e.writeFixed32(r[n])}function Ow(r,e){for(var n=0;n<r.length;n++)e.writeSFixed32(r[n])}function Nw(r,e){for(var n=0;n<r.length;n++)e.writeFixed64(r[n])}function Vw(r,e){for(var n=0;n<r.length;n++)e.writeSFixed64(r[n])}function jh(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function al(r,e,n){r[n]=e,r[n+1]=e>>>8,r[n+2]=e>>>16,r[n+3]=e>>>24}function Oy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Bt.prototype={destroy:function(){this.buf=null},readFields:function(r,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,r(h,e,this),this.pos===g&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=jh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Oy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=jh(this.buf,this.pos)+jh(this.buf,this.pos+4)*rf;return this.pos+=8,r},readSFixed64:function(){var r=jh(this.buf,this.pos)+Oy(this.buf,this.pos+4)*rf;return this.pos+=8,r},readFloat:function(){var r=Dy(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Dy(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(h,g,y){var v,S,k=y.buf;if(v=(112&(S=k[y.pos++]))>>4,S<128||(v|=(127&(S=k[y.pos++]))<<3,S<128)||(v|=(127&(S=k[y.pos++]))<<10,S<128)||(v|=(127&(S=k[y.pos++]))<<17,S<128)||(v|=(127&(S=k[y.pos++]))<<24,S<128)||(v|=(1&(S=k[y.pos++]))<<31,S<128))return ol(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Fy?function(n,a,h){return Fy.decode(n.subarray(a,h))}(this.buf,e,r):function(n,a,h){for(var g="",y=a;y<h;){var v,S,k,C=n[y],P=null,D=C>239?4:C>223?3:C>191?2:1;if(y+D>h)break;D===1?C<128&&(P=C):D===2?(192&(v=n[y+1]))==128&&(P=(31&C)<<6|63&v)<=127&&(P=null):D===3?(S=n[y+2],(192&(v=n[y+1]))==128&&(192&S)==128&&((P=(15&C)<<12|(63&v)<<6|63&S)<=2047||P>=55296&&P<=57343)&&(P=null)):D===4&&(S=n[y+2],k=n[y+3],(192&(v=n[y+1]))==128&&(192&S)==128&&(192&k)==128&&((P=(15&C)<<18|(63&v)<<12|(63&S)<<6|63&k)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,D=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=D}return g}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Bt.Bytes)return r.push(this.readVarint(e));var n=Cs(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Bt.Bytes)return r.push(this.readSVarint());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Bt.Bytes)return r.push(this.readBoolean());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Bt.Bytes)return r.push(this.readFloat());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Bt.Bytes)return r.push(this.readDouble());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Bt.Bytes)return r.push(this.readFixed32());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Bt.Bytes)return r.push(this.readSFixed32());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Bt.Bytes)return r.push(this.readFixed64());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Bt.Bytes)return r.push(this.readSFixed64());var e=Cs(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Bt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Bt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Bt.Fixed32)this.pos+=4;else{if(e!==Bt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),al(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),al(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),al(this.buf,-1&r,this.pos),al(this.buf,Math.floor(r*Ry),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),al(this.buf,-1&r,this.pos),al(this.buf,Math.floor(r*Ry),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,n){var a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(g,y,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(a,0,n),function(g,y){var v=(7&g)<<4;y.buf[y.pos++]|=v|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,h,g){for(var y,v,S=0;S<h.length;S++){if((y=h.charCodeAt(S))>55295&&y<57344){if(!v){y>56319||S+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):v=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[g++]=239,a[g++]=191,a[g++]=189,v=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,r,this.pos);var n=this.pos-e;n>=128&&By(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),Ly(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ly(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,e){this.pos++;var n=this.pos;r(e,this);var a=this.pos-n;a>=128&&By(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,n){this.writeTag(r,Bt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Mw,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Dw,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Fw,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Lw,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,Rw,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Bw,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Ow,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Nw,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,Vw,e)},writeBytesField:function(r,e){this.writeTag(r,Bt.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Bt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Bt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Bt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Bt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Bt.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Bt.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Bt.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Bt.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Bt.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var nf=U(My);const sf=3;function Uw(r,e,n){r===1&&n.readMessage(jw,e)}function jw(r,e,n){if(r===3){const{id:a,bitmap:h,width:g,height:y,left:v,top:S,advance:k}=n.readMessage($w,{});e.push({id:a,bitmap:new Ou({width:g+2*sf,height:y+2*sf},h),metrics:{width:g,height:y,left:v,top:S,advance:k}})}}function $w(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const Ny=sf;function Vy(r){let e=0,n=0;for(const y of r)e+=y.w*y.h,n=Math.max(n,y.w);r.sort((y,v)=>v.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,g=0;for(const y of r)for(let v=a.length-1;v>=0;v--){const S=a[v];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===S.w&&y.h===S.h){const k=a.pop();v<a.length&&(a[v]=k)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}const Cr=1;class of{constructor(e,{pixelRatio:n,version:a,stretchX:h,stretchY:g,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+Cr,this.paddedRect.y+Cr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Cr,this.paddedRect.y+this.paddedRect.h-Cr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Cr)/this.pixelRatio,(this.paddedRect.h-2*Cr)/this.pixelRatio]}}class Uy{constructor(e,n){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,a,g),this.addImages(n,h,g);const{w:y,h:v}=Vy(g),S=new tn({width:y||1,height:v||1});for(const k in e){const C=e[k],P=a[k].paddedRect;tn.copy(C.data,S,{x:0,y:0},{x:P.x+Cr,y:P.y+Cr},C.data)}for(const k in n){const C=n[k],P=h[k].paddedRect,D=P.x+Cr,R=P.y+Cr,B=C.data.width,V=C.data.height;tn.copy(C.data,S,{x:0,y:0},{x:D,y:R},C.data),tn.copy(C.data,S,{x:0,y:V-1},{x:D,y:R-1},{width:B,height:1}),tn.copy(C.data,S,{x:0,y:0},{x:D,y:R+V},{width:B,height:1}),tn.copy(C.data,S,{x:B-1,y:0},{x:D-1,y:R},{width:1,height:V}),tn.copy(C.data,S,{x:0,y:0},{x:D+B,y:R},{width:1,height:V})}this.image=S,this.iconPositions=a,this.patternPositions=h}addImages(e,n,a){for(const h in e){const g=e[h],y={x:0,y:0,w:g.data.width+2*Cr,h:g.data.height+2*Cr};a.push(y),n[h]=new of(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,g]=e.tl;a.update(n.data,void 0,{x:h,y:g})}}var go;$e("ImagePosition",of),$e("ImageAtlas",Uy),x.ah=void 0,(go=x.ah||(x.ah={}))[go.none=0]="none",go[go.horizontal=1]="horizontal",go[go.vertical=2]="vertical",go[go.horizontalOnly=3]="horizontalOnly";const Hu=-17;class Gu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const a=new Gu;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new Gu;return n.imageName=e,n}}class ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const a=new ll;for(let h=0;h<e.sections.length;h++){const g=e.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let a=0;a<e.length;a++){const h=e.charCodeAt(a+1)||null,g=e.charCodeAt(a-1)||null;n+=h&&yu(h)&&!Zu[e[a+1]]||g&&yu(g)&&!Zu[e[a-1]]||!Zu[e[a]]?e[a]:Zu[e[a]]}return n}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&qh[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&qh[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new ll;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Gu.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void si("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Gu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $h(r,e,n,a,h,g,y,v,S,k,C,P,D,R,B,V){const W=ll.fromFeature(r,h);let Y;P===x.ah.vertical&&W.verticalizePunctuation();const{processBidirectionalText:ce,processStyledBidirectionalText:J}=xs;if(ce&&W.sections.length===1){Y=[];const Se=ce(W.toString(),af(W,k,g,e,a,R,B));for(const Ve of Se){const We=new ll;We.text=Ve,We.sections=W.sections;for(let Ne=0;Ne<Ve.length;Ne++)We.sectionIndex.push(0);Y.push(We)}}else if(J){Y=[];const Se=J(W.text,W.sectionIndex,af(W,k,g,e,a,R,B));for(const Ve of Se){const We=new ll;We.text=Ve[0],We.sectionIndex=Ve[1],We.sections=W.sections,Y.push(We)}}else Y=function(Se,Ve){const We=[],Ne=Se.text;let Oe=0;for(const De of Ve)We.push(Se.substring(Oe,De)),Oe=De;return Oe<Ne.length&&We.push(Se.substring(Oe,Ne.length)),We}(W,af(W,k,g,e,a,R,B));const se=[],ve={positionedLines:se,text:W.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(Se,Ve,We,Ne,Oe,De,He,Be,Ae,tt,Xe,vt){let Kt=0,Yt=Hu,Si=0,jr=0;const dr=Be==="right"?1:Be==="left"?0:.5;let vi=0;for(const Ti of Oe){Ti.trim();const Ei=Ti.getMaxScale(),Ji=(Ei-1)*bi,mr={positionedGlyphs:[],lineOffset:0};Se.positionedLines[vi]=mr;const Qi=mr.positionedGlyphs;let Pr=0;if(!Ti.length()){Yt+=De,++vi;continue}for(let ki=0;ki<Ti.length();ki++){const St=Ti.getSection(ki),er=Ti.getSectionIndex(ki),Gi=Ti.getCharCode(ki);let Ii=0,xn=null,Dn=null,Ln=null,Ps=bi;const wn=!(Ae===x.ah.horizontal||!Xe&&!Ga(Gi)||Xe&&(qh[Gi]||(Oi=Gi,Ue.Arabic(Oi)||Ue["Arabic Supplement"](Oi)||Ue["Arabic Extended-A"](Oi)||Ue["Arabic Presentation Forms-A"](Oi)||Ue["Arabic Presentation Forms-B"](Oi))));if(St.imageName){const nn=Ne[St.imageName];if(!nn)continue;Ln=St.imageName,Se.iconsInText=Se.iconsInText||!0,Dn=nn.paddedRect;const zr=nn.displaySize;St.scale=St.scale*bi/vt,xn={width:zr[0],height:zr[1],left:Cr,top:-Ny,advance:wn?zr[1]:zr[0]},Ii=Ji+(bi-zr[1]*St.scale),Ps=xn.advance;const As=wn?zr[0]*St.scale-bi*Ei:zr[1]*St.scale-bi*Ei;As>0&&As>Pr&&(Pr=As)}else{const nn=We[St.fontStack],zr=nn&&nn[Gi];if(zr&&zr.rect)Dn=zr.rect,xn=zr.metrics;else{const As=Ve[St.fontStack],Ju=As&&As[Gi];if(!Ju)continue;xn=Ju.metrics}Ii=(Ei-St.scale)*bi}wn?(Se.verticalizable=!0,Qi.push({glyph:Gi,imageName:Ln,x:Kt,y:Yt+Ii,vertical:wn,scale:St.scale,fontStack:St.fontStack,sectionIndex:er,metrics:xn,rect:Dn}),Kt+=Ps*St.scale+tt):(Qi.push({glyph:Gi,imageName:Ln,x:Kt,y:Yt+Ii,vertical:wn,scale:St.scale,fontStack:St.fontStack,sectionIndex:er,metrics:xn,rect:Dn}),Kt+=xn.advance*St.scale+tt)}Qi.length!==0&&(Si=Math.max(Kt-tt,Si),Hw(Qi,0,Qi.length-1,dr,Pr)),Kt=0;const Ar=De*Ei+Pr;mr.lineOffset=Math.max(Pr,Ji),Yt+=Ar,jr=Math.max(Ar,jr),++vi}var Oi;const Hi=Yt-Hu,{horizontalAlign:pr,verticalAlign:fr}=lf(He);(function(Ti,Ei,Ji,mr,Qi,Pr,Ar,ki,St){const er=(Ei-Ji)*Qi;let Gi=0;Gi=Pr!==Ar?-ki*mr-Hu:(-mr*St+.5)*Ar;for(const Ii of Ti)for(const xn of Ii.positionedGlyphs)xn.x+=er,xn.y+=Gi})(Se.positionedLines,dr,pr,fr,Si,jr,De,Hi,Oe.length),Se.top+=-fr*Hi,Se.bottom=Se.top+Hi,Se.left+=-pr*Si,Se.right=Se.left+Si}(ve,e,n,a,Y,y,v,S,P,k,D,V),!function(Se){for(const Ve of Se)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(se)&&ve}const qh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jy(r,e,n,a,h,g){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*bi/g+h:0}{const y=n[e.fontStack],v=y&&y[r];return v?v.metrics.advance*e.scale+h:0}}function $y(r,e,n,a){const h=Math.pow(r-e,2);return a?r<e?h/2:2*h:h+Math.abs(n)*n}function Zw(r,e,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function qy(r,e,n,a,h,g){let y=null,v=$y(e,n,h,g);for(const S of a){const k=$y(e-S.x,n,h,g)+S.badness;k<=v&&(y=S,v=k)}return{index:r,x:e,priorBreak:y,badness:v}}function Zy(r){return r?Zy(r.priorBreak).concat(r.index):[]}function af(r,e,n,a,h,g,y){if(g!=="point")return[];if(!r)return[];const v=[],S=function(D,R,B,V,W,Y){let ce=0;for(let J=0;J<D.length();J++){const se=D.getSection(J);ce+=jy(D.getCharCode(J),se,V,W,R,Y)}return ce/Math.max(1,Math.ceil(ce/B))}(r,e,n,a,h,y),k=r.text.indexOf("")>=0;let C=0;for(let D=0;D<r.length();D++){const R=r.getSection(D),B=r.getCharCode(D);if(qh[B]||(C+=jy(B,R,a,h,e,y)),D<r.length()-1){const V=!((P=B)<11904||!(Ue["Bopomofo Extended"](P)||Ue.Bopomofo(P)||Ue["CJK Compatibility Forms"](P)||Ue["CJK Compatibility Ideographs"](P)||Ue["CJK Compatibility"](P)||Ue["CJK Radicals Supplement"](P)||Ue["CJK Strokes"](P)||Ue["CJK Symbols and Punctuation"](P)||Ue["CJK Unified Ideographs Extension A"](P)||Ue["CJK Unified Ideographs"](P)||Ue["Enclosed CJK Letters and Months"](P)||Ue["Halfwidth and Fullwidth Forms"](P)||Ue.Hiragana(P)||Ue["Ideographic Description Characters"](P)||Ue["Kangxi Radicals"](P)||Ue["Katakana Phonetic Extensions"](P)||Ue.Katakana(P)||Ue["Vertical Forms"](P)||Ue["Yi Radicals"](P)||Ue["Yi Syllables"](P)));(qw[B]||V||R.imageName)&&v.push(qy(D+1,C,S,v,Zw(B,r.getCharCode(D+1),V&&k),!1))}}var P;return Zy(qy(r.length(),C,S,v,0,!0))}function lf(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Hw(r,e,n,a,h){if(!a&&!h)return;const g=r[n],y=(r[n].x+g.metrics.advance*g.scale)*a;for(let v=e;v<=n;v++)r[v].x-=y,r[v].y+=h}function Gw(r,e,n){const{horizontalAlign:a,verticalAlign:h}=lf(n),g=e[0]-r.displaySize[0]*a,y=e[1]-r.displaySize[1]*h;return{image:r,top:y,bottom:y+r.displaySize[1],left:g,right:g+r.displaySize[0]}}function Hy(r,e,n,a,h,g){const y=r.image;let v;if(y.content){const W=y.content,Y=y.pixelRatio||1;v=[W[0]/Y,W[1]/Y,y.displaySize[0]-W[2]/Y,y.displaySize[1]-W[3]/Y]}const S=e.left*g,k=e.right*g;let C,P,D,R;n==="width"||n==="both"?(R=h[0]+S-a[3],P=h[0]+k+a[1]):(R=h[0]+(S+k-y.displaySize[0])/2,P=R+y.displaySize[0]);const B=e.top*g,V=e.bottom*g;return n==="height"||n==="both"?(C=h[1]+B-a[0],D=h[1]+V+a[2]):(C=h[1]+(B+V-y.displaySize[1])/2,D=C+y.displaySize[1]),{image:y,top:C,right:P,bottom:D,left:R,collisionPadding:v}}const Wu=255,es=128,yo=Wu*es;function Gy(r,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Gt(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=n;let g=0;for(;g<a.length&&a[g]<=r;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<r+1;)y++;y=Math.min(a.length-1,y);const v=a[g],S=a[y];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:S,minSize:n.evaluate(new Gt(v)),maxSize:n.evaluate(new Gt(S)),interpolationType:h}}}function uf(r,e,n){let a="never";const h=r.get(e);return h?a=h:r.get(n)&&(a="always"),a}const Ww=mo.VectorTileFeature.types,Kw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zh(r,e,n,a,h,g,y,v,S,k,C,P,D){const R=v?Math.min(yo,Math.round(v[0])):0,B=v?Math.min(yo,Math.round(v[1])):0;r.emplaceBack(e,n,Math.round(32*a),Math.round(32*h),g,y,(R<<1)+(S?1:0),B,16*k,16*C,256*P,256*D)}function cf(r,e,n){r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n)}function Xw(r){for(const e of r.sections)if(Th(e.text))return!0;return!1}class hf{constructor(e){this.layoutVertexArray=new te,this.indexArray=new me,this.programConfigurations=e,this.segments=new Ie,this.dynamicLayoutVertexArray=new pe,this.opacityVertexArray=new X,this.hasVisibleVertices=!1,this.placedSymbolArray=new t}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Iw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Cw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Kw,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",hf);class df{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new Ie,this.collisionVertexArray=new fe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Pw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",df);class ul{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jp([]),this.placementViewportMatrix=jp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gy(this.zoom,n["text-size"]),this.iconSizeData=Gy(this.zoom,n["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=uf(a,"text-overlap","text-allow-overlap")!=="never"||uf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>x.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new hf(new Xt(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new hf(new Xt(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new c,this.lineVertexArray=new m,this.symbolInstances=new u,this.textAnchorOffsets=new b}calculateGlyphDependencies(e,n,a,h,g){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,(a||h)&&g){const v=Zu[e.charAt(y)];v&&(n[v.charCodeAt(0)]=!0)}}populate(e,n,a){const h=this.layers[0],g=h.layout,y=g.get("text-font"),v=g.get("text-field"),S=g.get("icon-image"),k=(v.value.kind!=="constant"||v.value.value instanceof Sr&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),C=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!k&&!C)return;const D=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,V=new Gt(this.zoom);for(const{feature:W,id:Y,index:ce,sourceLayerIndex:J}of e){const se=h._featureFilter.needGeometry,ve=ks(W,se);if(!h._featureFilter.filter(V,ve,a))continue;let Se,Ve;if(se||(ve.geometry=Es(W)),k){const Ne=h.getValueAndResolveTokens("text-field",ve,a,B),Oe=Sr.factory(Ne),De=this.hasRTLText=this.hasRTLText||Xw(Oe);(!De||xs.getRTLTextPluginStatus()==="unavailable"||De&&xs.isParsed())&&(Se=zw(Oe,h,ve))}if(C){const Ne=h.getValueAndResolveTokens("icon-image",ve,a,B);Ve=Ne instanceof Nr?Ne:Nr.fromString(Ne)}if(!Se&&!Ve)continue;const We=this.sortFeaturesByKey?P.evaluate(ve,{},a):void 0;if(this.features.push({id:Y,text:Se,icon:Ve,index:ce,sourceLayerIndex:J,geometry:ve.geometry,properties:W.properties,type:Ww[W.type],sortKey:We}),Ve&&(D[Ve.name]=!0),Se){const Ne=y.evaluate(ve,{},a).join(","),Oe=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const De of Se.sections)if(De.image)D[De.image.name]=!0;else{const He=ia(Se.toString()),Be=De.fontStack||Ne,Ae=R[Be]=R[Be]||{};this.calculateGlyphDependencies(De.text,Ae,Oe,this.allowVerticalPlacement,He)}}}g.get("symbol-placement")==="line"&&(this.features=function(W){const Y={},ce={},J=[];let se=0;function ve(Ne){J.push(W[Ne]),se++}function Se(Ne,Oe,De){const He=ce[Ne];return delete ce[Ne],ce[Oe]=He,J[He].geometry[0].pop(),J[He].geometry[0]=J[He].geometry[0].concat(De[0]),He}function Ve(Ne,Oe,De){const He=Y[Oe];return delete Y[Oe],Y[Ne]=He,J[He].geometry[0].shift(),J[He].geometry[0]=De[0].concat(J[He].geometry[0]),He}function We(Ne,Oe,De){const He=De?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ne}:${He.x}:${He.y}`}for(let Ne=0;Ne<W.length;Ne++){const Oe=W[Ne],De=Oe.geometry,He=Oe.text?Oe.text.toString():null;if(!He){ve(Ne);continue}const Be=We(He,De),Ae=We(He,De,!0);if(Be in ce&&Ae in Y&&ce[Be]!==Y[Ae]){const tt=Ve(Be,Ae,De),Xe=Se(Be,Ae,J[tt].geometry);delete Y[Be],delete ce[Ae],ce[We(He,J[Xe].geometry,!0)]=Xe,J[tt].geometry=null}else Be in ce?Se(Be,Ae,De):Ae in Y?Ve(Be,Ae,De):(ve(Ne),Y[Be]=se-1,ce[Ae]=se-1)}return J.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Y)=>W.sortKey-Y.sortKey)}update(e,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(n[e.segment+1]),g=e.dist(n[e.segment]);const y={};for(let v=e.segment+1;v<n.length;v++)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:h},v<n.length-1&&(h+=n[v+1].dist(n[v]));for(let v=e.segment||0;v>=0;v--)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const S=y[v];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,h,g,y,v,S,k,C,P,D){const R=e.indexArray,B=e.layoutVertexArray,V=e.segments.prepareSegment(4*n.length,B,R,this.canOverlap?y.sortKey:void 0),W=this.glyphOffsetArray.length,Y=V.vertexLength,ce=this.allowVerticalPlacement&&v===x.ah.vertical?Math.PI/2:0,J=y.text&&y.text.sections;for(let se=0;se<n.length;se++){const{tl:ve,tr:Se,bl:Ve,br:We,tex:Ne,pixelOffsetTL:Oe,pixelOffsetBR:De,minFontScaleX:He,minFontScaleY:Be,glyphOffset:Ae,isSDF:tt,sectionIndex:Xe}=n[se],vt=V.vertexLength,Kt=Ae[1];Zh(B,S.x,S.y,ve.x,Kt+ve.y,Ne.x,Ne.y,a,tt,Oe.x,Oe.y,He,Be),Zh(B,S.x,S.y,Se.x,Kt+Se.y,Ne.x+Ne.w,Ne.y,a,tt,De.x,Oe.y,He,Be),Zh(B,S.x,S.y,Ve.x,Kt+Ve.y,Ne.x,Ne.y+Ne.h,a,tt,Oe.x,De.y,He,Be),Zh(B,S.x,S.y,We.x,Kt+We.y,Ne.x+Ne.w,Ne.y+Ne.h,a,tt,De.x,De.y,He,Be),cf(e.dynamicLayoutVertexArray,S,ce),R.emplaceBack(vt,vt+1,vt+2),R.emplaceBack(vt+1,vt+2,vt+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ae[0]),se!==n.length-1&&Xe===n[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,y,y.index,{},D,J&&J[Xe])}e.placedSymbolArray.emplaceBack(S.x,S.y,W,this.glyphOffsetArray.length-W,Y,k,C,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,P)}_addCollisionDebugVertex(e,n,a,h,g,y){return n.emplaceBack(0,0),e.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,n,a,h,g,y,v){const S=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),k=S.vertexLength,C=g.layoutVertexArray,P=g.collisionVertexArray,D=v.anchorX,R=v.anchorY;this._addCollisionDebugVertex(C,P,y,D,R,new H(e,n)),this._addCollisionDebugVertex(C,P,y,D,R,new H(a,n)),this._addCollisionDebugVertex(C,P,y,D,R,new H(a,h)),this._addCollisionDebugVertex(C,P,y,D,R,new H(e,h)),S.vertexLength+=4;const B=g.indexArray;B.emplaceBack(k,k+1),B.emplaceBack(k+1,k+2),B.emplaceBack(k+2,k+3),B.emplaceBack(k+3,k),S.primitiveLength+=4}addDebugCollisionBoxes(e,n,a,h){for(let g=e;g<n;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new df(oe,zy.members,ge),this.iconCollisionBox=new df(oe,zy.members,ge);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,a,h,g,y,v,S,k){const C={};for(let P=n;P<a;P++){const D=e.get(P);C.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.textFeatureIndex=D.featureIndex;break}for(let P=h;P<g;P++){const D=e.get(P);C.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.verticalTextFeatureIndex=D.featureIndex;break}for(let P=y;P<v;P++){const D=e.get(P);C.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.iconFeatureIndex=D.featureIndex;break}for(let P=S;P<k;P++){const D=e.get(P);C.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.verticalIconFeatureIndex=D.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),h=[],g=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const S=this.symbolInstances.get(v);h.push(0|Math.round(n*S.anchorX+a*S.anchorY)),g.push(S.featureIndex)}return y.sort((v,S)=>h[v]-h[S]||g[S]-g[v]),y}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Wy,Ky;$e("SymbolBucket",ul,{omit:["layers","collisionBoxArray","features","compareText"]}),ul.MAX_GLYPHS=65535,ul.addDynamicAttributes=cf;var pf={get paint(){return Ky=Ky||new ur({"icon-opacity":new it(ye.paint_symbol["icon-opacity"]),"icon-color":new it(ye.paint_symbol["icon-color"]),"icon-halo-color":new it(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(ye.paint_symbol["text-opacity"]),"text-color":new it(ye.paint_symbol["text-color"],{runtimeType:Bi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new it(ye.paint_symbol["text-halo-color"]),"text-halo-width":new it(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new it(ye.paint_symbol["text-halo-blur"]),"text-translate":new Ye(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(ye.paint_symbol["text-translate-anchor"])})},get layout(){return Wy=Wy||new ur({"symbol-placement":new Ye(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(ye.layout_symbol["icon-size"]),"icon-text-fit":new Ye(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(ye.layout_symbol["icon-image"]),"icon-rotate":new it(ye.layout_symbol["icon-rotate"]),"icon-padding":new it(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new it(ye.layout_symbol["icon-offset"]),"icon-anchor":new it(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(ye.layout_symbol["text-rotation-alignment"]),"text-field":new it(ye.layout_symbol["text-field"]),"text-font":new it(ye.layout_symbol["text-font"]),"text-size":new it(ye.layout_symbol["text-size"]),"text-max-width":new it(ye.layout_symbol["text-max-width"]),"text-line-height":new Ye(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new it(ye.layout_symbol["text-letter-spacing"]),"text-justify":new it(ye.layout_symbol["text-justify"]),"text-radial-offset":new it(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new it(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new it(ye.layout_symbol["text-anchor"]),"text-max-angle":new Ye(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(ye.layout_symbol["text-writing-mode"]),"text-rotate":new it(ye.layout_symbol["text-rotate"]),"text-padding":new Ye(ye.layout_symbol["text-padding"]),"text-keep-upright":new Ye(ye.layout_symbol["text-keep-upright"]),"text-transform":new it(ye.layout_symbol["text-transform"]),"text-offset":new it(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(ye.layout_symbol["text-optional"])})}};class Xy{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ds,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",Xy,{omit:["defaultValue"]});class Hh extends Jr{constructor(e){super(e,pf)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,a,h){const g=this.layout.get(e).evaluate(n,{},a,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||jt(y.value)||!g?g:function(v,S){return S.replace(/{([^{}]+)}/g,(k,C)=>v&&C in v?String(v[C]):"")}(n.properties,g)}createBucket(e){return new ul(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of pf.paint.overridableProperties){if(!Hh.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new Xy(n),h=new Jo(a,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new io("source",h):new Va("composite",h,n.value.zoomStops),this.paint._values[e]=new Yr(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Hh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),h=pf.paint.properties[n];let g=!1;const y=v=>{for(const S of v)if(h.overrides&&h.overrides.hasOverride(S))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Sr)y(a.value.value.sections);else if(a.value.kind==="source"){const v=k=>{g||(k instanceof ps&&yi(k.value)===An?y(k.value.sections):k instanceof Na?y(k.sections):k.eachChild(v))},S=a.value;S._styleExpression&&v(S._styleExpression.expression)}return g}}let Yy;var Yw={get paint(){return Yy=Yy||new ur({"background-color":new Ye(ye.paint_background["background-color"]),"background-pattern":new bu(ye.paint_background["background-pattern"]),"background-opacity":new Ye(ye.paint_background["background-opacity"])})}};class Jw extends Jr{constructor(e){super(e,Yw)}}let Jy;var Qw={get paint(){return Jy=Jy||new ur({"raster-opacity":new Ye(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(ye.paint_raster["raster-saturation"]),"raster-contrast":new Ye(ye.paint_raster["raster-contrast"]),"raster-resampling":new Ye(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(ye.paint_raster["raster-fade-duration"])})}};class eb extends Jr{constructor(e){super(e,Qw)}}class tb extends Jr{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ib{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ff=63710088e-1;class _o{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _o(Je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,h=e.lat*n,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return ff*Math.acos(Math.min(g,1))}static convert(e){if(e instanceof _o)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new _o(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new _o(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qy=2*Math.PI*ff;function e_(r){return Qy*Math.cos(r*Math.PI/180)}function t_(r){return(180+r)/360}function i_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function r_(r,e){return r/e_(e)}function mf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Gh{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=_o.convert(e);return new Gh(t_(a.lng),i_(a.lat),r_(n,a.lat))}toLngLat(){return new _o(360*this.x-180,mf(this.y))}toAltitude(){return this.z*e_(mf(this.y))}meterInMercatorCoordinateUnits(){return 1/Qy*(e=mf(this.y),1/Math.cos(e*Math.PI/180));var e}}function n_(r,e,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class gf{constructor(e,n,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=a,this.key=Ku(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,a){const h=(y=this.y,v=this.z,S=n_(256*(g=this.x),256*(y=Math.pow(2,v)-y-1),v),k=n_(256*(g+1),256*(y+1),v),S[0]+","+S[1]+","+k[0]+","+k[1]);var g,y,v,S,k;const C=function(P,D,R){let B,V="";for(let W=P;W>0;W--)B=1<<W-1,V+=(D&B?1:0)+(R&B?2:0);return V}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new H((e.x*n-this.x)*wt,(e.y*n-this.y)*wt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class s_{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Ku(e,n.z,n.z,n.x,n.y)}}class rn{constructor(e,n,a,h,g){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=n,this.canonical=new gf(a,+h,+g),this.key=Ku(n,e,a,h,g)}clone(){return new rn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new rn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Ku(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Ku(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new rn(n,this.wrap,n,a,h),new rn(n,this.wrap,n,a+1,h),new rn(n,this.wrap,n,a,h+1),new rn(n,this.wrap,n,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new s_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Gh(e.x-this.wrap,e.y))}}function Ku(r,e,n,a,h){(r*=2)<0&&(r=-1*r-1);const g=1<<n;return(g*g*r+g*h+a).toString(36)+n.toString(36)+e.toString(36)}$e("CanonicalTileID",gf),$e("OverscaledTileID",rn,{omit:["posMatrix"]});class o_{constructor(e,n,a,h=1,g=1,y=1,v=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void si(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<S;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(S,k)]=this.data[this._idx(S-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,S)]=this.data[this._idx(k,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<S;k++)for(let C=0;C<S;C++){const P=this.get(k,C);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,n){const a=new Uint8Array(this.data.buffer),h=4*this._idx(e,n);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,a){return e*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new tn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}const S=-n*this.dim,k=-a*this.dim;for(let C=y;C<v;C++)for(let P=h;P<g;P++)this.data[this._idx(P,C)]=e.data[this._idx(P+S,C+k)]}}$e("DEMData",o_);class a_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class l_{constructor(e,n,a,h,g){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=a,e._y=h,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class u_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zn(wt,16,0),this.grid3D=new zn(wt,16,0),this.featureIndexArray=new I,this.promoteId=n}insert(e,n,a,h,g,y){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const S=y?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const C=n[k],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<C.length;D++){const R=C[D];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<wt&&P[1]<wt&&P[2]>=0&&P[3]>=0&&S.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new mo.VectorTile(new nf(this.rawTileData)).layers,this.sourceLayerCoder=new a_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,a,h){this.loadVTLayers();const g=e.params||{},y=wt/e.tileSize/e.scale,v=$a(g.filter),S=e.queryGeometry,k=e.queryPadding*y,C=h_(S),P=this.grid.query(C.minX-k,C.minY-k,C.maxX+k,C.maxY+k),D=h_(e.cameraQueryGeometry),R=this.grid3D.query(D.minX-k,D.minY-k,D.maxX+k,D.maxY+k,(W,Y,ce,J)=>function(se,ve,Se,Ve,We){for(const Oe of se)if(ve<=Oe.x&&Se<=Oe.y&&Ve>=Oe.x&&We>=Oe.y)return!0;const Ne=[new H(ve,Se),new H(ve,We),new H(Ve,We),new H(Ve,Se)];if(se.length>2){for(const Oe of Ne)if(il(se,Oe))return!0}for(let Oe=0;Oe<se.length-1;Oe++)if(L1(se[Oe],se[Oe+1],Ne))return!0;return!1}(e.cameraQueryGeometry,W-k,Y-k,ce+k,J+k));for(const W of R)P.push(W);P.sort(rb);const B={};let V;for(let W=0;W<P.length;W++){const Y=P[W];if(Y===V)continue;V=Y;const ce=this.featureIndexArray.get(Y);let J=null;this.loadMatchingFeature(B,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,v,g.layers,g.availableImages,n,a,h,(se,ve,Se)=>(J||(J=Es(se)),ve.queryIntersectsFeature(S,se,Se,J,this.z,e.transform,y,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,n,a,h,g,y,v,S,k,C,P){const D=this.bucketLayerIDs[n];if(y&&!function(W,Y){for(let ce=0;ce<W.length;ce++)if(Y.indexOf(W[ce])>=0)return!0;return!1}(y,D))return;const R=this.sourceLayerCoder.decode(a),B=this.vtLayers[R].feature(h);if(g.needGeometry){const W=ks(B,!0);if(!g.filter(new Gt(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!g.filter(new Gt(this.tileID.overscaledZ),B))return;const V=this.getId(B,R);for(let W=0;W<D.length;W++){const Y=D[W];if(y&&y.indexOf(Y)<0)continue;const ce=S[Y];if(!ce)continue;let J={};V&&C&&(J=C.getState(ce.sourceLayer||"_geojsonTileLayer",V));const se=Ge({},k[Y]);se.paint=c_(se.paint,ce.paint,B,J,v),se.layout=c_(se.layout,ce.layout,B,J,v);const ve=!P||P(B,ce,J);if(!ve)continue;const Se=new l_(B,this.z,this.x,this.y,V);Se.layer=se;let Ve=e[Y];Ve===void 0&&(Ve=e[Y]=[]),Ve.push({featureIndex:h,feature:Se,intersectionZ:ve})}}lookupSymbolFeatures(e,n,a,h,g,y,v,S){const k={};this.loadVTLayers();const C=$a(g);for(const P of e)this.loadMatchingFeature(k,a,h,P,C,y,v,S,n);return k}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof a=="boolean"&&(a=Number(a))),a}}function c_(r,e,n,a,h){return Rt(r,(g,y)=>{const v=e instanceof ra?e.get(y):null;return v&&v.evaluate?v.evaluate(n,a,h):v})}function h_(r){let e=1/0,n=1/0,a=-1/0,h=-1/0;for(const g of r)e=Math.min(e,g.x),n=Math.min(n,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:e,minY:n,maxX:a,maxY:h}}function rb(r,e){return e-r}function d_(r,e,n,a,h){const g=[];for(let y=0;y<r.length;y++){const v=r[y];let S;for(let k=0;k<v.length-1;k++){let C=v[k],P=v[k+1];C.x<e&&P.x<e||(C.x<e?C=new H(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<e&&(P=new H(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<n&&P.y<n||(C.y<n?C=new H(C.x+(n-C.y)/(P.y-C.y)*(P.x-C.x),n)._round():P.y<n&&(P=new H(C.x+(n-C.y)/(P.y-C.y)*(P.x-C.x),n)._round()),C.x>=a&&P.x>=a||(C.x>=a?C=new H(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=a&&(P=new H(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=h&&P.y>=h||(C.y>=h?C=new H(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round():P.y>=h&&(P=new H(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round()),S&&C.equals(S[S.length-1])||(S=[C],g.push(S)),S.push(P)))))}}return g}$e("FeatureIndex",u_,{omit:["rawTileData","sourceLayerCoder"]});class vo extends H{constructor(e,n,a,h){super(e,n),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new vo(this.x,this.y,this.angle,this.segment)}}function p_(r,e,n,a,h){if(e.segment===void 0||n===0)return!0;let g=e,y=e.segment+1,v=0;for(;v>-n/2;){if(y--,y<0)return!1;v-=r[y].dist(g),g=r[y]}v+=r[y].dist(r[y+1]),y++;const S=[];let k=0;for(;v<n/2;){const C=r[y],P=r[y+1];if(!P)return!1;let D=r[y-1].angleTo(C)-C.angleTo(P);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:D}),k+=D;v-S[0].distance>a;)k-=S.shift().angleDelta;if(k>h)return!1;y++,v+=C.dist(P)}return!0}function f_(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function m_(r,e,n){return r?.6*e*n:0}function g_(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function nb(r,e,n,a,h,g){const y=m_(n,h,g),v=g_(n,a)*g;let S=0;const k=f_(r)/2;for(let C=0;C<r.length-1;C++){const P=r[C],D=r[C+1],R=P.dist(D);if(S+R>k){const B=(k-S)/R,V=Er.number(P.x,D.x,B),W=Er.number(P.y,D.y,B),Y=new vo(V,W,D.angleTo(P),C);return Y._round(),!y||p_(r,Y,v,y,e)?Y:void 0}S+=R}}function sb(r,e,n,a,h,g,y,v,S){const k=m_(a,g,y),C=g_(a,h),P=C*y,D=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return e-P<e/4&&(e=P+e/4),y_(r,D?e/2*v%e:(C/2+2*g)*y*v%e,e,k,n,P,D,!1,S)}function y_(r,e,n,a,h,g,y,v,S){const k=g/2,C=f_(r);let P=0,D=e-n,R=[];for(let B=0;B<r.length-1;B++){const V=r[B],W=r[B+1],Y=V.dist(W),ce=W.angleTo(V);for(;D+n<P+Y;){D+=n;const J=(D-P)/Y,se=Er.number(V.x,W.x,J),ve=Er.number(V.y,W.y,J);if(se>=0&&se<S&&ve>=0&&ve<S&&D-k>=0&&D+k<=C){const Se=new vo(se,ve,ce,B);Se._round(),a&&!p_(r,Se,g,a,h)||R.push(Se)}}P+=Y}return v||R.length||y||(R=y_(r,P/2,n,a,h,g,y,!0,S)),R}$e("Anchor",vo);const cl=Cr;function __(r,e,n,a){const h=[],g=r.image,y=g.pixelRatio,v=g.paddedRect.w-2*cl,S=g.paddedRect.h-2*cl,k=r.right-r.left,C=r.bottom-r.top,P=g.stretchX||[[0,v]],D=g.stretchY||[[0,S]],R=(De,He)=>De+He[1]-He[0],B=P.reduce(R,0),V=D.reduce(R,0),W=v-B,Y=S-V;let ce=0,J=B,se=0,ve=V,Se=0,Ve=W,We=0,Ne=Y;if(g.content&&a){const De=g.content;ce=Wh(P,0,De[0]),se=Wh(D,0,De[1]),J=Wh(P,De[0],De[2]),ve=Wh(D,De[1],De[3]),Se=De[0]-ce,We=De[1]-se,Ve=De[2]-De[0]-J,Ne=De[3]-De[1]-ve}const Oe=(De,He,Be,Ae)=>{const tt=Kh(De.stretch-ce,J,k,r.left),Xe=Xh(De.fixed-Se,Ve,De.stretch,B),vt=Kh(He.stretch-se,ve,C,r.top),Kt=Xh(He.fixed-We,Ne,He.stretch,V),Yt=Kh(Be.stretch-ce,J,k,r.left),Si=Xh(Be.fixed-Se,Ve,Be.stretch,B),jr=Kh(Ae.stretch-se,ve,C,r.top),dr=Xh(Ae.fixed-We,Ne,Ae.stretch,V),vi=new H(tt,vt),Oi=new H(Yt,vt),Hi=new H(Yt,jr),pr=new H(tt,jr),fr=new H(Xe/y,Kt/y),Ti=new H(Si/y,dr/y),Ei=e*Math.PI/180;if(Ei){const Qi=Math.sin(Ei),Pr=Math.cos(Ei),Ar=[Pr,-Qi,Qi,Pr];vi._matMult(Ar),Oi._matMult(Ar),pr._matMult(Ar),Hi._matMult(Ar)}const Ji=De.stretch+De.fixed,mr=He.stretch+He.fixed;return{tl:vi,tr:Oi,bl:pr,br:Hi,tex:{x:g.paddedRect.x+cl+Ji,y:g.paddedRect.y+cl+mr,w:Be.stretch+Be.fixed-Ji,h:Ae.stretch+Ae.fixed-mr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fr,pixelOffsetBR:Ti,minFontScaleX:Ve/y/k,minFontScaleY:Ne/y/C,isSDF:n}};if(a&&(g.stretchX||g.stretchY)){const De=v_(P,W,B),He=v_(D,Y,V);for(let Be=0;Be<De.length-1;Be++){const Ae=De[Be],tt=De[Be+1];for(let Xe=0;Xe<He.length-1;Xe++)h.push(Oe(Ae,He[Xe],tt,He[Xe+1]))}}else h.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:S+1}));return h}function Wh(r,e,n){let a=0;for(const h of r)a+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return a}function v_(r,e,n){const a=[{fixed:-cl,stretch:0}];for(const[h,g]of r){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:e+cl,stretch:n}),a}function Kh(r,e,n,a){return r/e*n+a}function Xh(r,e,n,a){return r-e*n/a}class Yh{constructor(e,n,a,h,g,y,v,S,k,C){if(this.boxStartIndex=e.length,k){let P=y.top,D=y.bottom;const R=y.collisionPadding;R&&(P-=R[1],D+=R[3]);let B=D-P;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let P=y.top*v-S[0],D=y.bottom*v+S[2],R=y.left*v-S[3],B=y.right*v+S[1];const V=y.collisionPadding;if(V&&(R-=V[0]*v,P-=V[1]*v,B+=V[2]*v,D+=V[3]*v),C){const W=new H(R,P),Y=new H(B,P),ce=new H(R,D),J=new H(B,D),se=C*Math.PI/180;W._rotate(se),Y._rotate(se),ce._rotate(se),J._rotate(se),R=Math.min(W.x,Y.x,ce.x,J.x),B=Math.max(W.x,Y.x,ce.x,J.x),P=Math.min(W.y,Y.y,ce.y,J.y),D=Math.max(W.y,Y.y,ce.y,J.y)}e.emplaceBack(n.x,n.y,R,P,B,D,a,h,g)}this.boxEndIndex=e.length}}class ob{constructor(e=[],n=ab){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:a}=this,h=n[e];for(;e>0;){const g=e-1>>1,y=n[g];if(a(h,y)>=0)break;n[e]=y,e=g}n[e]=h}_down(e){const{data:n,compare:a}=this,h=this.length>>1,g=n[e];for(;e<h;){let y=1+(e<<1),v=n[y];const S=y+1;if(S<this.length&&a(n[S],v)<0&&(y=S,v=n[S]),a(v,g)>=0)break;n[e]=v,e=y}n[e]=g}}function ab(r,e){return r<e?-1:r>e?1:0}function lb(r,e=1,n=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0;const v=r[0];for(let R=0;R<v.length;R++){const B=v[R];(!R||B.x<a)&&(a=B.x),(!R||B.y<h)&&(h=B.y),(!R||B.x>g)&&(g=B.x),(!R||B.y>y)&&(y=B.y)}const S=Math.min(g-a,y-h);let k=S/2;const C=new ob([],ub);if(S===0)return new H(a,h);for(let R=a;R<g;R+=S)for(let B=h;B<y;B+=S)C.push(new hl(R+k,B+k,k,r));let P=function(R){let B=0,V=0,W=0;const Y=R[0];for(let ce=0,J=Y.length,se=J-1;ce<J;se=ce++){const ve=Y[ce],Se=Y[se],Ve=ve.x*Se.y-Se.x*ve.y;V+=(ve.x+Se.x)*Ve,W+=(ve.y+Se.y)*Ve,B+=3*Ve}return new hl(V/B,W/B,0,R)}(r),D=C.length;for(;C.length;){const R=C.pop();(R.d>P.d||!P.d)&&(P=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,D)),R.max-P.d<=e||(k=R.h/2,C.push(new hl(R.p.x-k,R.p.y-k,k,r)),C.push(new hl(R.p.x+k,R.p.y-k,k,r)),C.push(new hl(R.p.x-k,R.p.y+k,k,r)),C.push(new hl(R.p.x+k,R.p.y+k,k,r)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${P.d}`)),P.p}function ub(r,e){return e.max-r.max}function hl(r,e,n,a){this.p=new H(r,e),this.h=n,this.d=function(h,g){let y=!1,v=1/0;for(let S=0;S<g.length;S++){const k=g[S];for(let C=0,P=k.length,D=P-1;C<P;D=C++){const R=k[C],B=k[D];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),v=Math.min(v,iy(h,R,B))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Zi;x.ap=void 0,(Zi=x.ap||(x.ap={}))[Zi.center=1]="center",Zi[Zi.left=2]="left",Zi[Zi.right=3]="right",Zi[Zi.top=4]="top",Zi[Zi.bottom=5]="bottom",Zi[Zi["top-left"]=6]="top-left",Zi[Zi["top-right"]=7]="top-right",Zi[Zi["bottom-left"]=8]="bottom-left",Zi[Zi["bottom-right"]=9]="bottom-right";const xo=7,yf=Number.POSITIVE_INFINITY;function x_(r,e){return e[1]!==yf?function(n,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),n){case"top-right":case"top-left":case"top":y=h-xo;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+xo}switch(n){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(r,e[0],e[1]):function(n,a){let h=0,g=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(n){case"top-right":case"top-left":g=y-xo;break;case"bottom-right":case"bottom-left":g=-y+xo;break;case"bottom":g=-a+xo;break;case"top":g=a-xo}switch(n){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(r,e[0])}function w_(r,e,n){var a;const h=r.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},n);if(g){const v=g.values,S=[];for(let k=0;k<v.length;k+=2){const C=S[k]=v[k],P=v[k+1].map(D=>D*bi);C.startsWith("top")?P[1]-=xo:C.startsWith("bottom")&&(P[1]+=xo),S[k+1]=P}return new $i(S)}const y=h.get("text-variable-anchor");if(y){let v;v=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},n)*bi,yf]:h.get("text-offset").evaluate(e,{},n).map(k=>k*bi);const S=[];for(const k of y)S.push(k,x_(k,v));return new $i(S)}return null}function _f(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cb(r,e,n,a,h,g,y,v,S,k,C){let P=g.textMaxSize.evaluate(e,{});P===void 0&&(P=y);const D=r.layers[0].layout,R=D.get("icon-offset").evaluate(e,{},C),B=S_(n.horizontal),V=y/24,W=r.tilePixelRatio*V,Y=r.tilePixelRatio*P/24,ce=r.tilePixelRatio*v,J=r.tilePixelRatio*D.get("symbol-spacing"),se=D.get("text-padding")*r.tilePixelRatio,ve=function(Ae,tt,Xe,vt=1){const Kt=Ae.get("icon-padding").evaluate(tt,{},Xe),Yt=Kt&&Kt.values;return[Yt[0]*vt,Yt[1]*vt,Yt[2]*vt,Yt[3]*vt]}(D,e,C,r.tilePixelRatio),Se=D.get("text-max-angle")/180*Math.PI,Ve=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",We=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Ne=D.get("symbol-placement"),Oe=J/2,De=D.get("icon-text-fit");let He;a&&De!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(He=Hy(a,n.vertical,De,D.get("icon-text-fit-padding"),R,V)),B&&(a=Hy(a,B,De,D.get("icon-text-fit-padding"),R,V)));const Be=(Ae,tt)=>{tt.x<0||tt.x>=wt||tt.y<0||tt.y>=wt||function(Xe,vt,Kt,Yt,Si,jr,dr,vi,Oi,Hi,pr,fr,Ti,Ei,Ji,mr,Qi,Pr,Ar,ki,St,er,Gi,Ii,xn){const Dn=Xe.addToLineVertexArray(vt,Kt);let Ln,Ps,wn,nn,zr=0,As=0,Ju=0,I_=0,kf=-1,If=-1;const zs={};let C_=_t("");if(Xe.allowVerticalPlacement&&Yt.vertical){const tr=vi.layout.get("text-rotate").evaluate(St,{},Ii)+90;wn=new Yh(Oi,vt,Hi,pr,fr,Yt.vertical,Ti,Ei,Ji,tr),dr&&(nn=new Yh(Oi,vt,Hi,pr,fr,dr,Qi,Pr,Ji,tr))}if(Si){const tr=vi.layout.get("icon-rotate").evaluate(St,{}),sn=vi.layout.get("icon-text-fit")!=="none",ha=__(Si,tr,Gi,sn),Fn=dr?__(dr,tr,Gi,sn):void 0;Ps=new Yh(Oi,vt,Hi,pr,fr,Si,Qi,Pr,!1,tr),zr=4*ha.length;const da=Xe.iconSizeData;let ts=null;da.kind==="source"?(ts=[es*vi.layout.get("icon-size").evaluate(St,{})],ts[0]>yo&&si(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Wu}. Reduce your "icon-size".`)):da.kind==="composite"&&(ts=[es*er.compositeIconSizes[0].evaluate(St,{},Ii),es*er.compositeIconSizes[1].evaluate(St,{},Ii)],(ts[0]>yo||ts[1]>yo)&&si(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Wu}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,ha,ts,ki,Ar,St,x.ah.none,vt,Dn.lineStartIndex,Dn.lineLength,-1,Ii),kf=Xe.icon.placedSymbolArray.length-1,Fn&&(As=4*Fn.length,Xe.addSymbols(Xe.icon,Fn,ts,ki,Ar,St,x.ah.vertical,vt,Dn.lineStartIndex,Dn.lineLength,-1,Ii),If=Xe.icon.placedSymbolArray.length-1)}const P_=Object.keys(Yt.horizontal);for(const tr of P_){const sn=Yt.horizontal[tr];if(!Ln){C_=_t(sn.text);const Fn=vi.layout.get("text-rotate").evaluate(St,{},Ii);Ln=new Yh(Oi,vt,Hi,pr,fr,sn,Ti,Ei,Ji,Fn)}const ha=sn.positionedLines.length===1;if(Ju+=b_(Xe,vt,sn,jr,vi,Ji,St,mr,Dn,Yt.vertical?x.ah.horizontal:x.ah.horizontalOnly,ha?P_:[tr],zs,kf,er,Ii),ha)break}Yt.vertical&&(I_+=b_(Xe,vt,Yt.vertical,jr,vi,Ji,St,mr,Dn,x.ah.vertical,["vertical"],zs,If,er,Ii));const pb=Ln?Ln.boxStartIndex:Xe.collisionBoxArray.length,fb=Ln?Ln.boxEndIndex:Xe.collisionBoxArray.length,mb=wn?wn.boxStartIndex:Xe.collisionBoxArray.length,gb=wn?wn.boxEndIndex:Xe.collisionBoxArray.length,yb=Ps?Ps.boxStartIndex:Xe.collisionBoxArray.length,_b=Ps?Ps.boxEndIndex:Xe.collisionBoxArray.length,vb=nn?nn.boxStartIndex:Xe.collisionBoxArray.length,xb=nn?nn.boxEndIndex:Xe.collisionBoxArray.length;let Rn=-1;const Qh=(tr,sn)=>tr&&tr.circleDiameter?Math.max(tr.circleDiameter,sn):sn;Rn=Qh(Ln,Rn),Rn=Qh(wn,Rn),Rn=Qh(Ps,Rn),Rn=Qh(nn,Rn);const A_=Rn>-1?1:0;A_&&(Rn*=xn/bi),Xe.glyphOffsetArray.length>=ul.MAX_GLYPHS&&si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),St.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,St.sortKey);const wb=w_(vi,St,Ii),[bb,Sb]=function(tr,sn){const ha=tr.length,Fn=sn==null?void 0:sn.values;if((Fn==null?void 0:Fn.length)>0)for(let da=0;da<Fn.length;da+=2){const ts=Fn[da+1];tr.emplaceBack(x.ap[Fn[da]],ts[0],ts[1])}return[ha,tr.length]}(Xe.textAnchorOffsets,wb);Xe.symbolInstances.emplaceBack(vt.x,vt.y,zs.right>=0?zs.right:-1,zs.center>=0?zs.center:-1,zs.left>=0?zs.left:-1,zs.vertical||-1,kf,If,C_,pb,fb,mb,gb,yb,_b,vb,xb,Hi,Ju,I_,zr,As,A_,0,Ti,Rn,bb,Sb)}(r,tt,Ae,n,a,h,He,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,W,[se,se,se,se],Ve,S,ce,ve,We,R,e,g,k,C,y)};if(Ne==="line")for(const Ae of d_(e.geometry,0,0,wt,wt)){const tt=sb(Ae,J,Se,n.vertical||B,a,24,Y,r.overscaling,wt);for(const Xe of tt)B&&hb(r,B.text,Oe,Xe)||Be(Ae,Xe)}else if(Ne==="line-center"){for(const Ae of e.geometry)if(Ae.length>1){const tt=nb(Ae,Se,n.vertical||B,a,24,Y);tt&&Be(Ae,tt)}}else if(e.type==="Polygon")for(const Ae of Kp(e.geometry,0)){const tt=lb(Ae,16);Be(Ae[0],new vo(tt.x,tt.y,0))}else if(e.type==="LineString")for(const Ae of e.geometry)Be(Ae,new vo(Ae[0].x,Ae[0].y,0));else if(e.type==="Point")for(const Ae of e.geometry)for(const tt of Ae)Be([tt],new vo(tt.x,tt.y,0))}function b_(r,e,n,a,h,g,y,v,S,k,C,P,D,R,B){const V=function(ce,J,se,ve,Se,Ve,We,Ne){const Oe=ve.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,De=[];for(const He of J.positionedLines)for(const Be of He.positionedGlyphs){if(!Be.rect)continue;const Ae=Be.rect||{};let tt=Ny+1,Xe=!0,vt=1,Kt=0;const Yt=(Se||Ne)&&Be.vertical,Si=Be.metrics.advance*Be.scale/2;if(Ne&&J.verticalizable&&(Kt=He.lineOffset/2-(Be.imageName?-(bi-Be.metrics.width*Be.scale)/2:(Be.scale-1)*bi)),Be.imageName){const ki=We[Be.imageName];Xe=ki.sdf,vt=ki.pixelRatio,tt=Cr/vt}const jr=Se?[Be.x+Si,Be.y]:[0,0];let dr=Se?[0,0]:[Be.x+Si+se[0],Be.y+se[1]-Kt],vi=[0,0];Yt&&(vi=dr,dr=[0,0]);const Oi=Be.metrics.isDoubleResolution?2:1,Hi=(Be.metrics.left-tt)*Be.scale-Si+dr[0],pr=(-Be.metrics.top-tt)*Be.scale+dr[1],fr=Hi+Ae.w/Oi*Be.scale/vt,Ti=pr+Ae.h/Oi*Be.scale/vt,Ei=new H(Hi,pr),Ji=new H(fr,pr),mr=new H(Hi,Ti),Qi=new H(fr,Ti);if(Yt){const ki=new H(-Si,Si-Hu),St=-Math.PI/2,er=bi/2-Si,Gi=new H(5-Hu-er,-(Be.imageName?er:0)),Ii=new H(...vi);Ei._rotateAround(St,ki)._add(Gi)._add(Ii),Ji._rotateAround(St,ki)._add(Gi)._add(Ii),mr._rotateAround(St,ki)._add(Gi)._add(Ii),Qi._rotateAround(St,ki)._add(Gi)._add(Ii)}if(Oe){const ki=Math.sin(Oe),St=Math.cos(Oe),er=[St,-ki,ki,St];Ei._matMult(er),Ji._matMult(er),mr._matMult(er),Qi._matMult(er)}const Pr=new H(0,0),Ar=new H(0,0);De.push({tl:Ei,tr:Ji,bl:mr,br:Qi,tex:Ae,writingMode:J.writingMode,glyphOffset:jr,sectionIndex:Be.sectionIndex,isSDF:Xe,pixelOffsetTL:Pr,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}return De}(0,n,v,h,g,y,a,r.allowVerticalPlacement),W=r.textSizeData;let Y=null;W.kind==="source"?(Y=[es*h.layout.get("text-size").evaluate(y,{})],Y[0]>yo&&si(`${r.layerIds[0]}: Value for "text-size" is >= ${Wu}. Reduce your "text-size".`)):W.kind==="composite"&&(Y=[es*R.compositeTextSizes[0].evaluate(y,{},B),es*R.compositeTextSizes[1].evaluate(y,{},B)],(Y[0]>yo||Y[1]>yo)&&si(`${r.layerIds[0]}: Value for "text-size" is >= ${Wu}. Reduce your "text-size".`)),r.addSymbols(r.text,V,Y,v,g,y,k,e,S.lineStartIndex,S.lineLength,D,B);for(const ce of C)P[ce]=r.text.placedSymbolArray.length-1;return 4*V.length}function S_(r){for(const e in r)return r[e];return null}function hb(r,e,n,a){const h=r.compareText;if(e in h){const g=h[e];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<n)return!0}else h[e]=[];return h[e].push(a),!1}const T_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=T_[15&a];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new vf(v,y,g,e)}constructor(e,n=64,a=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=T_.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return xf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:v}=this,S=[0,g.length-1,0],k=[];for(;S.length;){const C=S.pop()||0,P=S.pop()||0,D=S.pop()||0;if(P-D<=v){for(let W=D;W<=P;W++){const Y=y[2*W],ce=y[2*W+1];Y>=e&&Y<=a&&ce>=n&&ce<=h&&k.push(g[W])}continue}const R=D+P>>1,B=y[2*R],V=y[2*R+1];B>=e&&B<=a&&V>=n&&V<=h&&k.push(g[R]),(C===0?e<=B:n<=V)&&(S.push(D),S.push(R-1),S.push(1-C)),(C===0?a>=B:h>=V)&&(S.push(R+1),S.push(P),S.push(1-C))}return k}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,v=[0,h.length-1,0],S=[],k=a*a;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,D=v.pop()||0;if(P-D<=y){for(let W=D;W<=P;W++)k_(g[2*W],g[2*W+1],e,n)<=k&&S.push(h[W]);continue}const R=D+P>>1,B=g[2*R],V=g[2*R+1];k_(B,V,e,n)<=k&&S.push(h[R]),(C===0?e-a<=B:n-a<=V)&&(v.push(D),v.push(R-1),v.push(1-C)),(C===0?e+a>=B:n+a>=V)&&(v.push(R+1),v.push(P),v.push(1-C))}return S}}function xf(r,e,n,a,h,g){if(h-a<=n)return;const y=a+h>>1;E_(r,e,y,a,h,g),xf(r,e,n,a,y-1,1-g),xf(r,e,n,y+1,h,1-g)}function E_(r,e,n,a,h,g){for(;h>a;){if(h-a>600){const k=h-a+1,C=n-a+1,P=Math.log(k),D=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*D*(k-D)/k)*(C-k/2<0?-1:1);E_(r,e,n,Math.max(a,Math.floor(n-C*D/k+R)),Math.min(h,Math.floor(n+(k-C)*D/k+R)),g)}const y=e[2*n+g];let v=a,S=h;for(Xu(r,e,a,n),e[2*h+g]>y&&Xu(r,e,a,h);v<S;){for(Xu(r,e,v,S),v++,S--;e[2*v+g]<y;)v++;for(;e[2*S+g]>y;)S--}e[2*a+g]===y?Xu(r,e,a,S):(S++,Xu(r,e,S,h)),S<=n&&(a=S+1),n<=S&&(h=S-1)}}function Xu(r,e,n,a){wf(r,n,a),wf(e,2*n,2*a),wf(e,2*n+1,2*a+1)}function wf(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}function k_(r,e,n,a){const h=r-n,g=e-a;return h*h+g*g}var bf;x.bd=void 0,(bf=x.bd||(x.bd={})).create="create",bf.load="load",bf.fullLoad="fullLoad";let Jh=null,Yu=[];const Sf=1e3/60,Tf="loadTime",Ef="fullLoadTime",db={mark(r){performance.mark(r)},frame(r){const e=r;Jh!=null&&Yu.push(e-Jh),Jh=e},clearMetrics(){Jh=null,Yu=[],performance.clearMeasures(Tf),performance.clearMeasures(Ef);for(const r in x.bd)performance.clearMarks(x.bd[r])},getPerformanceMetrics(){performance.measure(Tf,x.bd.create,x.bd.load),performance.measure(Ef,x.bd.create,x.bd.fullLoad);const r=performance.getEntriesByName(Tf)[0].duration,e=performance.getEntriesByName(Ef)[0].duration,n=Yu.length,a=1/(Yu.reduce((g,y)=>g+y,0)/n/1e3),h=Yu.filter(g=>g>Sf).reduce((g,y)=>g+(y-Sf)/Sf,0);return{loadTime:r,fullLoadTime:e,fps:a,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};x.$=Ie,x.A=rl,x.B=function(r){if(dn==null){const e=r.navigator?r.navigator.userAgent:null;dn=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return dn},x.C=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ib(()=>this.process()),this.subscription=function(n,a,h,g){return n.addEventListener(a,h,!1),{unsubscribe:()=>{n.removeEventListener(a,h,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=xr(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}sendAsync(r,e){return new Promise((n,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:n,reject:a},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],y=Object.assign(Object.assign({},r),{id:h,sourceMapId:this.mapId,origin:location.origin,data:vs(r.data,g)});this.target.postMessage(y,{transfer:g})})}receive(r){const e=r.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const a=this.abortControllers[n];return delete this.abortControllers[n],void(a&&a.abort())}if(xr(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return d(this,void 0,void 0,function*(){if(e.type==="<response>"){const h=this.resolveRejects[r];return delete this.resolveRejects[r],h?void(e.error?h.reject(uo(e.error)):h.resolve(uo(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=uo(e.data),a=new AbortController;this.abortControllers[r]=a;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,n,a);this.completeTask(r,null,h)}catch(h){this.completeTask(r,h)}})}completeTask(r,e,n){const a=[];delete this.abortControllers[r];const h={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?vs(e):null,data:vs(n,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.D=Ye,x.E=us,x.F=function(){var r=new rl(16);return rl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},x.G=Ui,x.H=function(r,e,n){var a,h,g,y,v,S,k,C,P,D,R,B,V=n[0],W=n[1],Y=n[2];return e===r?(r[12]=e[0]*V+e[4]*W+e[8]*Y+e[12],r[13]=e[1]*V+e[5]*W+e[9]*Y+e[13],r[14]=e[2]*V+e[6]*W+e[10]*Y+e[14],r[15]=e[3]*V+e[7]*W+e[11]*Y+e[15]):(h=e[1],g=e[2],y=e[3],v=e[4],S=e[5],k=e[6],C=e[7],P=e[8],D=e[9],R=e[10],B=e[11],r[0]=a=e[0],r[1]=h,r[2]=g,r[3]=y,r[4]=v,r[5]=S,r[6]=k,r[7]=C,r[8]=P,r[9]=D,r[10]=R,r[11]=B,r[12]=a*V+v*W+P*Y+e[12],r[13]=h*V+S*W+D*Y+e[13],r[14]=g*V+k*W+R*Y+e[14],r[15]=y*V+C*W+B*Y+e[15]),r},x.I=of,x.J=function(r,e,n){var a=n[0],h=n[1],g=n[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*g,r[9]=e[9]*g,r[10]=e[10]*g,r[11]=e[11]*g,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},x.K=oy,x.L=function(r,e){const n={};for(let a=0;a<e.length;a++){const h=e[a];h in r&&(n[h]=r[h])}return n},x.M=_o,x.N=t_,x.O=i_,x.P=H,x.Q=rn,x.R=tn,x.S=ae,x.T=xu,x.U=ie,x.V=ht,x.W=wt,x.X=di,x.Y=Gh,x.Z=class extends Jn{},x._=d,x.a=Wr,x.a$=function(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r},x.a0=gf,x.a1=Le,x.a2=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const a of r){const h=window.document.createElement("source");Ia(a)||(e.crossOrigin="Anonymous"),h.src=a,e.appendChild(h)}})},x.a3=function(){return et++},x.a4=Ph,x.a5=ul,x.a6=$a,x.a7=ks,x.a8=Gt,x.a9=l_,x.aA=Zt,x.aB=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Tt(r.version,e.version))return[{command:"setStyle",args:[e]}];Tt(r.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Tt(r.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Tt(r.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Tt(r.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Tt(r.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Tt(r.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Tt(r.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Tt(r.light,e.light)||n.push({command:"setLight",args:[e.light]}),Tt(r.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Tt(r.sky,e.sky)||n.push({command:"setSky",args:[e.sky]});const a={},h=[];(function(y,v,S,k){let C;for(C in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,C)&&(Object.prototype.hasOwnProperty.call(v,C)||qs(C,S,k));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(y,C)?Tt(y[C],v[C])||(y[C].type==="geojson"&&v[C].type==="geojson"&&Hs(y,v,C)?Fi(S,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):Zs(C,v,S,k)):pn(C,v,S))})(r.sources,e.sources,h,a);const g=[];r.layers&&r.layers.forEach(y=>{"source"in y&&a[y.source]?n.push({command:"removeLayer",args:[y.id]}):g.push(y)}),n=n.concat(h),function(y,v,S){v=v||[];const k=(y=y||[]).map(Gs),C=v.map(Gs),P=y.reduce($o,{}),D=v.reduce($o,{}),R=k.slice(),B=Object.create(null);let V,W,Y,ce,J;for(let se=0,ve=0;se<k.length;se++)V=k[se],Object.prototype.hasOwnProperty.call(D,V)?ve++:(Fi(S,{command:"removeLayer",args:[V]}),R.splice(R.indexOf(V,ve),1));for(let se=0,ve=0;se<C.length;se++)V=C[C.length-1-se],R[R.length-1-se]!==V&&(Object.prototype.hasOwnProperty.call(P,V)?(Fi(S,{command:"removeLayer",args:[V]}),R.splice(R.lastIndexOf(V,R.length-ve),1)):ve++,ce=R[R.length-se],Fi(S,{command:"addLayer",args:[D[V],ce]}),R.splice(R.length-se,0,V),B[V]=!0);for(let se=0;se<C.length;se++)if(V=C[se],W=P[V],Y=D[V],!B[V]&&!Tt(W,Y))if(Tt(W.source,Y.source)&&Tt(W["source-layer"],Y["source-layer"])&&Tt(W.type,Y.type)){for(J in hs(W.layout,Y.layout,S,V,null,"setLayoutProperty"),hs(W.paint,Y.paint,S,V,null,"setPaintProperty"),Tt(W.filter,Y.filter)||Fi(S,{command:"setFilter",args:[V,Y.filter]}),Tt(W.minzoom,Y.minzoom)&&Tt(W.maxzoom,Y.maxzoom)||Fi(S,{command:"setLayerZoomRange",args:[V,Y.minzoom,Y.maxzoom]}),W)Object.prototype.hasOwnProperty.call(W,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?hs(W[J],Y[J],S,V,J.slice(6),"setPaintProperty"):Tt(W[J],Y[J])||Fi(S,{command:"setLayerProperty",args:[V,J,Y[J]]}));for(J in Y)Object.prototype.hasOwnProperty.call(Y,J)&&!Object.prototype.hasOwnProperty.call(W,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?hs(W[J],Y[J],S,V,J.slice(6),"setPaintProperty"):Tt(W[J],Y[J])||Fi(S,{command:"setLayerProperty",args:[V,J,Y[J]]}))}else Fi(S,{command:"removeLayer",args:[V]}),ce=R[R.lastIndexOf(V)+1],Fi(S,{command:"addLayer",args:[Y,ce]})}(g,e.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:"setStyle",args:[e]}]}return n},x.aC=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},x.aD=function r(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let a=0;a<e.length;a++)if(!r(e[a],n[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const a in e)if(!r(e[a],n[a]))return!1;return!0}return e===n},x.aE=Rt,x.aF=xt,x.aG=class extends $t{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},x.aH=qi,x.aI=class extends $t{constructor(r,e){super(r,e),this.current=Ss}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},x.aJ=Qr,x.aK=class extends $t{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},x.aL=class extends $t{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},x.aM=_n,x.aN=function(r,e,n,a,h,g,y){var v=1/(e-n),S=1/(a-h),k=1/(g-y);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+n)*v,r[13]=(h+a)*S,r[14]=(y+g)*k,r[15]=1,r},x.aO=Ft,x.aP=F1,x.aQ=class extends aa{},x.aR=Aw,x.aS=class extends ho{},x.aT=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},x.aU=hy,x.aV=A,x.aW=class extends Au{},x.aX=me,x.aY=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},x.aZ=function(r,e){var n=r[0],a=r[1],h=r[2],g=r[3],y=r[4],v=r[5],S=r[6],k=r[7],C=r[8],P=r[9],D=r[10],R=r[11],B=r[12],V=r[13],W=r[14],Y=r[15],ce=e[0],J=e[1],se=e[2],ve=e[3],Se=e[4],Ve=e[5],We=e[6],Ne=e[7],Oe=e[8],De=e[9],He=e[10],Be=e[11],Ae=e[12],tt=e[13],Xe=e[14],vt=e[15];return Math.abs(n-ce)<=hr*Math.max(1,Math.abs(n),Math.abs(ce))&&Math.abs(a-J)<=hr*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(h-se)<=hr*Math.max(1,Math.abs(h),Math.abs(se))&&Math.abs(g-ve)<=hr*Math.max(1,Math.abs(g),Math.abs(ve))&&Math.abs(y-Se)<=hr*Math.max(1,Math.abs(y),Math.abs(Se))&&Math.abs(v-Ve)<=hr*Math.max(1,Math.abs(v),Math.abs(Ve))&&Math.abs(S-We)<=hr*Math.max(1,Math.abs(S),Math.abs(We))&&Math.abs(k-Ne)<=hr*Math.max(1,Math.abs(k),Math.abs(Ne))&&Math.abs(C-Oe)<=hr*Math.max(1,Math.abs(C),Math.abs(Oe))&&Math.abs(P-De)<=hr*Math.max(1,Math.abs(P),Math.abs(De))&&Math.abs(D-He)<=hr*Math.max(1,Math.abs(D),Math.abs(He))&&Math.abs(R-Be)<=hr*Math.max(1,Math.abs(R),Math.abs(Be))&&Math.abs(B-Ae)<=hr*Math.max(1,Math.abs(B),Math.abs(Ae))&&Math.abs(V-tt)<=hr*Math.max(1,Math.abs(V),Math.abs(tt))&&Math.abs(W-Xe)<=hr*Math.max(1,Math.abs(W),Math.abs(Xe))&&Math.abs(Y-vt)<=hr*Math.max(1,Math.abs(Y),Math.abs(vt))},x.a_=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},x.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,h,g)=>{const y=h||g;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},x.ab=function(r,e){const n=[];for(const a in r)a in e||n.push(a);return n},x.ac=qe,x.ad=function(r,e,n){var a=Math.sin(n),h=Math.cos(n),g=e[0],y=e[1],v=e[2],S=e[3],k=e[4],C=e[5],P=e[6],D=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*h+k*a,r[1]=y*h+C*a,r[2]=v*h+P*a,r[3]=S*h+D*a,r[4]=k*h-g*a,r[5]=C*h-y*a,r[6]=P*h-v*a,r[7]=D*h-S*a,r},x.ae=function(r){var e=new rl(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},x.af=Fh,x.ag=function(r,e){let n=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=r,v=h?qe(Yi.interpolationFactor(h,e,g,y),0,1):0;r.kind==="camera"?a=Er.number(r.minSize,r.maxSize,v):n=v}return{uSizeT:n,uSize:a}},x.ai=function(r,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/es:r.kind==="composite"?Er.number(a/es,h/es,n):e},x.aj=cf,x.ak=function(r,e,n,a){const h=e.y-r.y,g=e.x-r.x,y=a.y-n.y,v=a.x-n.x,S=y*g-v*h;if(S===0)return null;const k=(v*(r.y-n.y)-y*(r.x-n.x))/S;return new H(r.x+k*g,r.y+k*h)},x.al=d_,x.am=Is,x.an=jp,x.ao=bi,x.aq=uf,x.ar=function(r,e){var n=e[0],a=e[1],h=e[2],g=e[3],y=e[4],v=e[5],S=e[6],k=e[7],C=e[8],P=e[9],D=e[10],R=e[11],B=e[12],V=e[13],W=e[14],Y=e[15],ce=n*v-a*y,J=n*S-h*y,se=n*k-g*y,ve=a*S-h*v,Se=a*k-g*v,Ve=h*k-g*S,We=C*V-P*B,Ne=C*W-D*B,Oe=C*Y-R*B,De=P*W-D*V,He=P*Y-R*V,Be=D*Y-R*W,Ae=ce*Be-J*He+se*De+ve*Oe-Se*Ne+Ve*We;return Ae?(r[0]=(v*Be-S*He+k*De)*(Ae=1/Ae),r[1]=(h*He-a*Be-g*De)*Ae,r[2]=(V*Ve-W*Se+Y*ve)*Ae,r[3]=(D*Se-P*Ve-R*ve)*Ae,r[4]=(S*Oe-y*Be-k*Ne)*Ae,r[5]=(n*Be-h*Oe+g*Ne)*Ae,r[6]=(W*se-B*Ve-Y*J)*Ae,r[7]=(C*Ve-D*se+R*J)*Ae,r[8]=(y*He-v*Oe+k*We)*Ae,r[9]=(a*Oe-n*He-g*We)*Ae,r[10]=(B*Se-V*se+Y*ce)*Ae,r[11]=(P*se-C*Se-R*ce)*Ae,r[12]=(v*Ne-y*De-S*We)*Ae,r[13]=(n*De-a*Ne+h*We)*Ae,r[14]=(V*J-B*ve-W*ce)*Ae,r[15]=(C*ve-P*J+D*ce)*Ae,r):null},x.as=_f,x.at=lf,x.au=vf,x.av=function(){const r={},e=ye.$version;for(const n in ye.$root){const a=ye.$root[n];if(a.required){let h=null;h=n==="version"?e:a.type==="array"?[]:{},h!=null&&(r[n]=h)}}return r},x.aw=gu,x.ax=$s,x.ay=function(r){r=r.slice();const e=Object.create(null);for(let n=0;n<r.length;n++)e[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=jo(r[n],e[r[n].ref]));return r},x.az=function(r){if(r.type==="custom")return new tb(r);switch(r.type){case"background":return new Jw(r);case"circle":return new B1(r);case"fill":return new rw(r);case"fill-extrusion":return new _w(r);case"heatmap":return new N1(r);case"hillshade":return new U1(r);case"line":return new kw(r);case"raster":return new eb(r);case"symbol":return new Hh(r)}},x.b=Ze,x.b0=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},x.b1=Je,x.b2=s_,x.b3=r_,x.b4=function(r,e,n,a,h){var g,y=1/Math.tan(e/2);return r[0]=y/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+a)*(g=1/(a-h)),r[14]=2*h*a*g):(r[10]=-1,r[14]=-2*a),r},x.b5=function(r,e,n){var a=Math.sin(n),h=Math.cos(n),g=e[4],y=e[5],v=e[6],S=e[7],k=e[8],C=e[9],P=e[10],D=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=g*h+k*a,r[5]=y*h+C*a,r[6]=v*h+P*a,r[7]=S*h+D*a,r[8]=k*h-g*a,r[9]=C*h-y*a,r[10]=P*h-v*a,r[11]=D*h-S*a,r},x.b6=ue,x.b7=ke,x.b8=function(r){return r*Math.PI/180},x.b9=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},x.bA=xs,x.ba=class extends Xa{},x.bb=ff,x.bc=db,x.be=Kr,x.bf=function(r,e){Wr.REGISTERED_PROTOCOLS[r]=e},x.bg=function(r){delete Wr.REGISTERED_PROTOCOLS[r]},x.bh=function(r,e){const n={};for(let h=0;h<r.length;h++){const g=e&&e[r[h].id]||Np(r[h]);e&&(e[r[h].id]=g);let y=n[g];y||(y=n[g]=[]),y.push(r[h])}const a=[];for(const h in n)a.push(n[h]);return a},x.bi=$e,x.bj=a_,x.bk=u_,x.bl=Uy,x.bm=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=wt/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],n=e.layout,a=e._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Gt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:C}=r.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Gt(k),r.canonical),a["text-size"].possiblyEvaluate(new Gt(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:C}=r.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Gt(k),r.canonical),a["icon-size"].possiblyEvaluate(new Gt(C),r.canonical)]}const g=n.get("text-line-height")*bi,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),S=n.get("text-size");for(const k of r.bucket.features){const C=n.get("text-font").evaluate(k,{},r.canonical).join(","),P=S.evaluate(k,{},r.canonical),D=h.layoutTextSize.evaluate(k,{},r.canonical),R=h.layoutIconSize.evaluate(k,{},r.canonical),B={horizontal:{},vertical:void 0},V=k.text;let W,Y=[0,0];if(V){const se=V.toString(),ve=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*bi,Se=Ha(se)?ve:0,Ve=n.get("text-anchor").evaluate(k,{},r.canonical),We=w_(e,k,r.canonical);if(!We){const Be=n.get("text-radial-offset").evaluate(k,{},r.canonical);Y=Be?x_(Ve,[Be*bi,yf]):n.get("text-offset").evaluate(k,{},r.canonical).map(Ae=>Ae*bi)}let Ne=y?"center":n.get("text-justify").evaluate(k,{},r.canonical);const Oe=n.get("symbol-placement"),De=Oe==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*bi:0,He=()=>{r.bucket.allowVerticalPlacement&&ia(se)&&(B.vertical=$h(V,r.glyphMap,r.glyphPositions,r.imagePositions,C,De,g,Ve,"left",Se,Y,x.ah.vertical,!0,Oe,D,P))};if(!y&&We){const Be=new Set;if(Ne==="auto")for(let tt=0;tt<We.values.length;tt+=2)Be.add(_f(We.values[tt]));else Be.add(Ne);let Ae=!1;for(const tt of Be)if(!B.horizontal[tt])if(Ae)B.horizontal[tt]=B.horizontal[0];else{const Xe=$h(V,r.glyphMap,r.glyphPositions,r.imagePositions,C,De,g,"center",tt,Se,Y,x.ah.horizontal,!1,Oe,D,P);Xe&&(B.horizontal[tt]=Xe,Ae=Xe.positionedLines.length===1)}He()}else{Ne==="auto"&&(Ne=_f(Ve));const Be=$h(V,r.glyphMap,r.glyphPositions,r.imagePositions,C,De,g,Ve,Ne,Se,Y,x.ah.horizontal,!1,Oe,D,P);Be&&(B.horizontal[Ne]=Be),He(),ia(se)&&y&&v&&(B.vertical=$h(V,r.glyphMap,r.glyphPositions,r.imagePositions,C,De,g,Ve,Ne,Se,Y,x.ah.vertical,!1,Oe,D,P))}}let ce=!1;if(k.icon&&k.icon.name){const se=r.imageMap[k.icon.name];se&&(W=Gw(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),ce=!!se.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ce:r.bucket.sdfIcons!==ce&&si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const J=S_(B.horizontal)||B.vertical;r.bucket.iconsInText=!!J&&J.iconsInText,(J||W)&&cb(r.bucket,k,B,W,r.imageMap,h,D,R,Y,ce,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},x.bn=tf,x.bo=Jp,x.bp=ef,x.bq=mo,x.br=nf,x.bs=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},x.bt=function(r,e,n,a,h){return d(this,void 0,void 0,function*(){if(ie())try{return yield ht(r,e,n,a,h)}catch{}return function(g,y,v,S,k){const C=g.width,P=g.height;It&&zt||(It=new OffscreenCanvas(C,P),zt=It.getContext("2d",{willReadFrequently:!0})),It.width=C,It.height=P,zt.drawImage(g,0,0,C,P);const D=zt.getImageData(y,v,S,k);return zt.clearRect(0,0,C,P),D.data}(r,e,n,a,h)})},x.bu=o_,x.bv=U,x.bw=ee,x.bx=My,x.by=Vt,x.bz=function(r){return r.message===Br},x.c=Pi,x.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=Ge,x.f=r=>new Promise((e,n)=>{const a=new Image;a.onload=()=>{e(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=ct})},a.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(r)],{type:"image/png"});a.src=r.byteLength?URL.createObjectURL(h):ct}),x.g=Ri,x.h=(r,e)=>qn(Ge(r,{type:"json"}),e),x.i=xr,x.j=wi,x.k=Gn,x.l=(r,e)=>qn(Ge(r,{type:"arrayBuffer"}),e),x.m=qn,x.n=function(r){return new nf(r).readFields(Uw,[])},x.o=Ou,x.p=Vy,x.q=ur,x.r=pu,x.s=Ia,x.t=bh,x.u=Ue,x.v=ye,x.w=si,x.x=lo,x.y=function([r,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(n),y:r*Math.sin(e)*Math.sin(n),z:r*Math.cos(n)}},x.z=Er}),_("worker",["./shared"],function(x){class d{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,L){for(const j of M){this._layerConfigs[j.id]=j;const re=this._layers[j.id]=x.az(j);re._featureFilter=x.a6(re.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(const j of L)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};const O=x.bh(Object.values(this._layerConfigs),this.keyCache);for(const j of O){const re=j.map(_e=>this._layers[_e.id]),ne=re[0];if(ne.visibility==="none")continue;const le=ne.source||"";let Q=this.familiesBySource[le];Q||(Q=this.familiesBySource[le]={});const he=ne.sourceLayer||"_geojsonTileLayer";let Ee=Q[he];Ee||(Ee=Q[he]=[]),Ee.push(re)}}}class U{constructor(M){const L={},O=[];for(const le in M){const Q=M[le],he=L[le]={};for(const Ee in Q){const _e=Q[+Ee];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const be={x:0,y:0,w:_e.bitmap.width+2,h:_e.bitmap.height+2};O.push(be),he[Ee]={rect:be,metrics:_e.metrics}}}const{w:j,h:re}=x.p(O),ne=new x.o({width:j||1,height:re||1});for(const le in M){const Q=M[le];for(const he in Q){const Ee=Q[+he];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const _e=L[le][he].rect;x.o.copy(Ee.bitmap,ne,{x:0,y:0},{x:_e.x+1,y:_e.y+1},Ee.bitmap)}}this.image=ne,this.positions=L}}x.bi("GlyphAtlas",U);class ee{constructor(M){this.tileID=new x.Q(M.tileID.overscaledZ,M.tileID.wrap,M.tileID.canonical.z,M.tileID.canonical.x,M.tileID.canonical.y),this.uid=M.uid,this.zoom=M.zoom,this.pixelRatio=M.pixelRatio,this.tileSize=M.tileSize,this.source=M.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=M.showCollisionBoxes,this.collectResourceTiming=!!M.collectResourceTiming,this.returnDependencies=!!M.returnDependencies,this.promoteId=M.promoteId,this.inFlightDependencies=[]}parse(M,L,O,j){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=M,this.collisionBoxArray=new x.a4;const re=new x.bj(Object.keys(M.layers).sort()),ne=new x.bk(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const le={},Q={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},he=L.familiesBySource[this.source];for(const ft in he){const ei=M.layers[ft];if(!ei)continue;ei.version===1&&x.w(`Vector tile source "${this.source}" layer "${ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ai=re.encode(ft),ar=[];for(let ji=0;ji<ei.length;ji++){const Xi=ei.feature(ji),br=ne.getId(Xi,ft);ar.push({feature:Xi,id:br,index:ji,sourceLayerIndex:Ai})}for(const ji of he[ft]){const Xi=ji[0];Xi.source!==this.source&&x.w(`layer.source = ${Xi.source} does not equal this.source = ${this.source}`),Xi.minzoom&&this.zoom<Math.floor(Xi.minzoom)||Xi.maxzoom&&this.zoom>=Xi.maxzoom||Xi.visibility!=="none"&&(de(ji,this.zoom,O),(le[Xi.id]=Xi.createBucket({index:ne.bucketLayerIDs.length,layers:ji,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ai,sourceID:this.source})).populate(ar,Q,this.tileID.canonical),ne.bucketLayerIDs.push(ji.map(br=>br.id)))}}const Ee=x.aE(Q.glyphDependencies,ft=>Object.keys(ft).map(Number));this.inFlightDependencies.forEach(ft=>ft==null?void 0:ft.abort()),this.inFlightDependencies=[];let _e=Promise.resolve({});if(Object.keys(Ee).length){const ft=new AbortController;this.inFlightDependencies.push(ft),_e=j.sendAsync({type:"getGlyphs",data:{stacks:Ee,source:this.source,tileID:this.tileID,type:"glyphs"}},ft)}const be=Object.keys(Q.iconDependencies);let Ke=Promise.resolve({});if(be.length){const ft=new AbortController;this.inFlightDependencies.push(ft),Ke=j.sendAsync({type:"getImages",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},ft)}const st=Object.keys(Q.patternDependencies);let rt=Promise.resolve({});if(st.length){const ft=new AbortController;this.inFlightDependencies.push(ft),rt=j.sendAsync({type:"getImages",data:{icons:st,source:this.source,tileID:this.tileID,type:"patterns"}},ft)}const[Et,lt,Ht]=yield Promise.all([_e,Ke,rt]),Nt=new U(Et),ci=new x.bl(lt,Ht);for(const ft in le){const ei=le[ft];ei instanceof x.a5?(de(ei.layers,this.zoom,O),x.bm({bucket:ei,glyphMap:Et,glyphPositions:Nt.positions,imageMap:lt,imagePositions:ci.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ei.hasPattern&&(ei instanceof x.bn||ei instanceof x.bo||ei instanceof x.bp)&&(de(ei.layers,this.zoom,O),ei.addFeatures(Q,this.tileID.canonical,ci.patternPositions))}return this.status="done",{buckets:Object.values(le).filter(ft=>!ft.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nt.image,imageAtlas:ci,glyphMap:this.returnDependencies?Et:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?Nt.positions:null}})}}function de(q,M,L){const O=new x.a8(M);for(const j of q)j.recalculate(O,L)}class H{constructor(M,L,O){this.actor=M,this.layerIndex=L,this.availableImages=O,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(M,L){return x._(this,void 0,void 0,function*(){const O=yield x.l(M.request,L);try{return{vectorTile:new x.bq.VectorTile(new x.br(O.data)),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(j){const re=new Uint8Array(O.data);let ne=`Unable to parse the tile at ${M.request.url}, `;throw ne+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${j.messge}`,new Error(ne)}})}loadTile(M){return x._(this,void 0,void 0,function*(){const L=M.uid,O=!!(M&&M.request&&M.request.collectResourceTiming)&&new x.bs(M.request),j=new ee(M);this.loading[L]=j;const re=new AbortController;j.abort=re;try{const ne=yield this.loadVectorTile(M,re);if(delete this.loading[L],!ne)return null;const le=ne.rawData,Q={};ne.expires&&(Q.expires=ne.expires),ne.cacheControl&&(Q.cacheControl=ne.cacheControl);const he={};if(O){const _e=O.finish();_e&&(he.resourceTiming=JSON.parse(JSON.stringify(_e)))}j.vectorTile=ne.vectorTile;const Ee=j.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=j,this.fetching[L]={rawTileData:le,cacheControl:Q,resourceTiming:he};try{const _e=yield Ee;return x.e({rawTileData:le.slice(0)},_e,Q,he)}finally{delete this.fetching[L]}}catch(ne){throw delete this.loading[L],j.status="done",this.loaded[L]=j,ne}})}reloadTile(M){return x._(this,void 0,void 0,function*(){const L=M.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const O=this.loaded[L];if(O.showCollisionBoxes=M.showCollisionBoxes,O.status==="parsing"){const j=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor);let re;if(this.fetching[L]){const{rawTileData:ne,cacheControl:le,resourceTiming:Q}=this.fetching[L];delete this.fetching[L],re=x.e({rawTileData:ne.slice(0)},j,le,Q)}else re=j;return re}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(M){return x._(this,void 0,void 0,function*(){const L=this.loading,O=M.uid;L&&L[O]&&L[O].abort&&(L[O].abort.abort(),delete L[O])})}removeTile(M){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[M.uid]&&delete this.loaded[M.uid]})}}class G{constructor(){this.loaded={}}loadTile(M){return x._(this,void 0,void 0,function*(){const{uid:L,encoding:O,rawImageData:j,redFactor:re,greenFactor:ne,blueFactor:le,baseShift:Q}=M,he=j.width+2,Ee=j.height+2,_e=x.b(j)?new x.R({width:he,height:Ee},yield x.bt(j,-1,-1,he,Ee)):j,be=new x.bu(L,_e,O,re,ne,le,Q);return this.loaded=this.loaded||{},this.loaded[L]=be,be})}removeTile(M){const L=this.loaded,O=M.uid;L&&L[O]&&delete L[O]}}function Me(q,M){if(q.length!==0){xe(q[0],M);for(var L=1;L<q.length;L++)xe(q[L],!M)}}function xe(q,M){for(var L=0,O=0,j=0,re=q.length,ne=re-1;j<re;ne=j++){var le=(q[j][0]-q[ne][0])*(q[ne][1]+q[j][1]),Q=L+le;O+=Math.abs(L)>=Math.abs(le)?L-Q+le:le-Q+L,L=Q}L+O>=0!=!!M&&q.reverse()}var we=x.bv(function q(M,L){var O,j=M&&M.type;if(j==="FeatureCollection")for(O=0;O<M.features.length;O++)q(M.features[O],L);else if(j==="GeometryCollection")for(O=0;O<M.geometries.length;O++)q(M.geometries[O],L);else if(j==="Feature")q(M.geometry,L);else if(j==="Polygon")Me(M.coordinates,L);else if(j==="MultiPolygon")for(O=0;O<M.coordinates.length;O++)Me(M.coordinates[O],L);return M});const at=x.bq.VectorTileFeature.prototype.toGeoJSON;var ae={exports:{}},ie=x.bw,ue=x.bq.VectorTileFeature,ke=qe;function qe(q,M){this.options=M||{},this.features=q,this.length=q.length}function Je(q,M){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=M||4096}qe.prototype.feature=function(q){return new Je(this.features[q],this.options.extent)},Je.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var M=0;M<q.length;M++){for(var L=q[M],O=[],j=0;j<L.length;j++)O.push(new ie(L[j][0],L[j][1]));this.geometry.push(O)}return this.geometry},Je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,M=1/0,L=-1/0,O=1/0,j=-1/0,re=0;re<q.length;re++)for(var ne=q[re],le=0;le<ne.length;le++){var Q=ne[le];M=Math.min(M,Q.x),L=Math.max(L,Q.x),O=Math.min(O,Q.y),j=Math.max(j,Q.y)}return[M,O,L,j]},Je.prototype.toGeoJSON=ue.prototype.toGeoJSON;var Ge=x.bx,et=ke;function Rt(q){var M=new Ge;return function(L,O){for(var j in L.layers)O.writeMessage(3,xt,L.layers[j])}(q,M),M.finish()}function xt(q,M){var L;M.writeVarintField(15,q.version||1),M.writeStringField(1,q.name||""),M.writeVarintField(5,q.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<q.length;L++)O.feature=q.feature(L),M.writeMessage(2,Zt,O);var j=O.keys;for(L=0;L<j.length;L++)M.writeStringField(3,j[L]);var re=O.values;for(L=0;L<re.length;L++)M.writeMessage(4,xr,re[L])}function Zt(q,M){var L=q.feature;L.id!==void 0&&M.writeVarintField(1,L.id),M.writeMessage(2,Ot,q),M.writeVarintField(3,L.type),M.writeMessage(4,Pn,L)}function Ot(q,M){var L=q.feature,O=q.keys,j=q.values,re=q.keycache,ne=q.valuecache;for(var le in L.properties){var Q=L.properties[le],he=re[le];if(Q!==null){he===void 0&&(O.push(le),re[le]=he=O.length-1),M.writeVarint(he);var Ee=typeof Q;Ee!=="string"&&Ee!=="boolean"&&Ee!=="number"&&(Q=JSON.stringify(Q));var _e=Ee+":"+Q,be=ne[_e];be===void 0&&(j.push(Q),ne[_e]=be=j.length-1),M.writeVarint(be)}}}function si(q,M){return(M<<3)+(7&q)}function sr(q){return q<<1^q>>31}function Pn(q,M){for(var L=q.loadGeometry(),O=q.type,j=0,re=0,ne=L.length,le=0;le<ne;le++){var Q=L[le],he=1;O===1&&(he=Q.length),M.writeVarint(si(1,he));for(var Ee=O===3?Q.length-1:Q.length,_e=0;_e<Ee;_e++){_e===1&&O!==1&&M.writeVarint(si(2,Ee-1));var be=Q[_e].x-j,Ke=Q[_e].y-re;M.writeVarint(sr(be)),M.writeVarint(sr(Ke)),j+=be,re+=Ke}O===3&&M.writeVarint(si(7,1))}}function xr(q,M){var L=typeof q;L==="string"?M.writeStringField(1,q):L==="boolean"?M.writeBooleanField(7,q):L==="number"&&(q%1!=0?M.writeDoubleField(3,q):q<0?M.writeSVarintField(6,q):M.writeVarintField(5,q))}ae.exports=Rt,ae.exports.fromVectorTileJs=Rt,ae.exports.fromGeojsonVt=function(q,M){M=M||{};var L={};for(var O in q)L[O]=new et(q[O].features,M),L[O].name=O,L[O].version=M.version,L[O].extent=M.extent;return Rt({layers:L})},ae.exports.GeoJSONWrapper=et;var dn=x.bv(ae.exports);const Ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:q=>q},ct=Math.fround||(ht=new Float32Array(1),q=>(ht[0]=+q,ht[0]));var ht;const It=3,zt=5,Br=6;class Pi{constructor(M){this.options=Object.assign(Object.create(Ze),M),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(M){const{log:L,minZoom:O,maxZoom:j}=this.options;L&&console.time("total time");const re=`prepare ${M.length} points`;L&&console.time(re),this.points=M;const ne=[];for(let Q=0;Q<M.length;Q++){const he=M[Q];if(!he.geometry)continue;const[Ee,_e]=he.geometry.coordinates,be=ct(Ui(Ee)),Ke=ct(Kr(_e));ne.push(be,Ke,1/0,Q,-1,1),this.options.reduce&&ne.push(0)}let le=this.trees[j+1]=this._createTree(ne);L&&console.timeEnd(re);for(let Q=j;Q>=O;Q--){const he=+Date.now();le=this.trees[Q]=this._createTree(this._cluster(le,Q)),L&&console.log("z%d: %d clusters in %dms",Q,le.numItems,+Date.now()-he)}return L&&console.timeEnd("total time"),this}getClusters(M,L){let O=((M[0]+180)%360+360)%360-180;const j=Math.max(-90,Math.min(90,M[1]));let re=M[2]===180?180:((M[2]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)O=-180,re=180;else if(O>re){const _e=this.getClusters([O,j,180,ne],L),be=this.getClusters([-180,j,re,ne],L);return _e.concat(be)}const le=this.trees[this._limitZoom(L)],Q=le.range(Ui(O),Kr(ne),Ui(re),Kr(j)),he=le.data,Ee=[];for(const _e of Q){const be=this.stride*_e;Ee.push(he[be+zt]>1?Wr(he,be,this.clusterProps):this.points[he[be+It]])}return Ee}getChildren(M){const L=this._getOriginId(M),O=this._getOriginZoom(M),j="No cluster with the specified id.",re=this.trees[O];if(!re)throw new Error(j);const ne=re.data;if(L*this.stride>=ne.length)throw new Error(j);const le=this.options.radius/(this.options.extent*Math.pow(2,O-1)),Q=re.within(ne[L*this.stride],ne[L*this.stride+1],le),he=[];for(const Ee of Q){const _e=Ee*this.stride;ne[_e+4]===M&&he.push(ne[_e+zt]>1?Wr(ne,_e,this.clusterProps):this.points[ne[_e+It]])}if(he.length===0)throw new Error(j);return he}getLeaves(M,L,O){const j=[];return this._appendLeaves(j,M,L=L||10,O=O||0,0),j}getTile(M,L,O){const j=this.trees[this._limitZoom(M)],re=Math.pow(2,M),{extent:ne,radius:le}=this.options,Q=le/ne,he=(O-Q)/re,Ee=(O+1+Q)/re,_e={features:[]};return this._addTileFeatures(j.range((L-Q)/re,he,(L+1+Q)/re,Ee),j.data,L,O,re,_e),L===0&&this._addTileFeatures(j.range(1-Q/re,he,1,Ee),j.data,re,O,re,_e),L===re-1&&this._addTileFeatures(j.range(0,he,Q/re,Ee),j.data,-1,O,re,_e),_e.features.length?_e:null}getClusterExpansionZoom(M){let L=this._getOriginZoom(M)-1;for(;L<=this.options.maxZoom;){const O=this.getChildren(M);if(L++,O.length!==1)break;M=O[0].properties.cluster_id}return L}_appendLeaves(M,L,O,j,re){const ne=this.getChildren(L);for(const le of ne){const Q=le.properties;if(Q&&Q.cluster?re+Q.point_count<=j?re+=Q.point_count:re=this._appendLeaves(M,Q.cluster_id,O,j,re):re<j?re++:M.push(le),M.length===O)break}return re}_createTree(M){const L=new x.au(M.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<M.length;O+=this.stride)L.add(M[O],M[O+1]);return L.finish(),L.data=M,L}_addTileFeatures(M,L,O,j,re,ne){for(const le of M){const Q=le*this.stride,he=L[Q+zt]>1;let Ee,_e,be;if(he)Ee=Ri(L,Q,this.clusterProps),_e=L[Q],be=L[Q+1];else{const rt=this.points[L[Q+It]];Ee=rt.properties;const[Et,lt]=rt.geometry.coordinates;_e=Ui(Et),be=Kr(lt)}const Ke={type:1,geometry:[[Math.round(this.options.extent*(_e*re-O)),Math.round(this.options.extent*(be*re-j))]],tags:Ee};let st;st=he||this.options.generateId?L[Q+It]:this.points[L[Q+It]].id,st!==void 0&&(Ke.id=st),ne.features.push(Ke)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(Math.floor(+M),this.options.maxZoom+1))}_cluster(M,L){const{radius:O,extent:j,reduce:re,minPoints:ne}=this.options,le=O/(j*Math.pow(2,L)),Q=M.data,he=[],Ee=this.stride;for(let _e=0;_e<Q.length;_e+=Ee){if(Q[_e+2]<=L)continue;Q[_e+2]=L;const be=Q[_e],Ke=Q[_e+1],st=M.within(Q[_e],Q[_e+1],le),rt=Q[_e+zt];let Et=rt;for(const lt of st){const Ht=lt*Ee;Q[Ht+2]>L&&(Et+=Q[Ht+zt])}if(Et>rt&&Et>=ne){let lt,Ht=be*rt,Nt=Ke*rt,ci=-1;const ft=((_e/Ee|0)<<5)+(L+1)+this.points.length;for(const ei of st){const Ai=ei*Ee;if(Q[Ai+2]<=L)continue;Q[Ai+2]=L;const ar=Q[Ai+zt];Ht+=Q[Ai]*ar,Nt+=Q[Ai+1]*ar,Q[Ai+4]=ft,re&&(lt||(lt=this._map(Q,_e,!0),ci=this.clusterProps.length,this.clusterProps.push(lt)),re(lt,this._map(Q,Ai)))}Q[_e+4]=ft,he.push(Ht/Et,Nt/Et,1/0,ft,-1,Et),re&&he.push(ci)}else{for(let lt=0;lt<Ee;lt++)he.push(Q[_e+lt]);if(Et>1)for(const lt of st){const Ht=lt*Ee;if(!(Q[Ht+2]<=L)){Q[Ht+2]=L;for(let Nt=0;Nt<Ee;Nt++)he.push(Q[Ht+Nt])}}}}return he}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,L,O){if(M[L+zt]>1){const ne=this.clusterProps[M[L+Br]];return O?Object.assign({},ne):ne}const j=this.points[M[L+It]].properties,re=this.options.map(j);return O&&re===j?Object.assign({},re):re}}function Wr(q,M,L){return{type:"Feature",id:q[M+It],properties:Ri(q,M,L),geometry:{type:"Point",coordinates:[(O=q[M],360*(O-.5)),$s(q[M+1])]}};var O}function Ri(q,M,L){const O=q[M+zt],j=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,re=q[M+Br],ne=re===-1?{}:Object.assign({},L[re]);return Object.assign(ne,{cluster:!0,cluster_id:q[M+It],point_count:O,point_count_abbreviated:j})}function Ui(q){return q/360+.5}function Kr(q){const M=Math.sin(q*Math.PI/180),L=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return L<0?0:L>1?1:L}function $s(q){const M=(180-360*q)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function qn(q,M,L,O){for(var j,re=O,ne=L-M>>1,le=L-M,Q=q[M],he=q[M+1],Ee=q[L],_e=q[L+1],be=M+3;be<L;be+=3){var Ke=Ia(q[be],q[be+1],Q,he,Ee,_e);if(Ke>re)j=be,re=Ke;else if(Ke===re){var st=Math.abs(be-ne);st<le&&(j=be,le=st)}}re>O&&(j-M>3&&qn(q,M,j,O),q[j+2]=re,L-j>3&&qn(q,j,L,O))}function Ia(q,M,L,O,j,re){var ne=j-L,le=re-O;if(ne!==0||le!==0){var Q=((q-L)*ne+(M-O)*le)/(ne*ne+le*le);Q>1?(L=j,O=re):Q>0&&(L+=ne*Q,O+=le*Q)}return(ne=q-L)*ne+(le=M-O)*le}function Zn(q,M,L,O){var j={id:q===void 0?null:q,type:M,geometry:L,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(re){var ne=re.geometry,le=re.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")Hn(re,ne);else if(le==="Polygon"||le==="MultiLineString")for(var Q=0;Q<ne.length;Q++)Hn(re,ne[Q]);else if(le==="MultiPolygon")for(Q=0;Q<ne.length;Q++)for(var he=0;he<ne[Q].length;he++)Hn(re,ne[Q][he])}(j),j}function Hn(q,M){for(var L=0;L<M.length;L+=3)q.minX=Math.min(q.minX,M[L]),q.minY=Math.min(q.minY,M[L+1]),q.maxX=Math.max(q.maxX,M[L]),q.maxY=Math.max(q.maxY,M[L+1])}function Gn(q,M,L,O){if(M.geometry){var j=M.geometry.coordinates,re=M.geometry.type,ne=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),le=[],Q=M.id;if(L.promoteId?Q=M.properties[L.promoteId]:L.generateId&&(Q=O||0),re==="Point")wi(j,le);else if(re==="MultiPoint")for(var he=0;he<j.length;he++)wi(j[he],le);else if(re==="LineString")us(j,le,ne,!1);else if(re==="MultiLineString"){if(L.lineMetrics){for(he=0;he<j.length;he++)us(j[he],le=[],ne,!1),q.push(Zn(Q,"LineString",le,M.properties));return}ye(j,le,ne,!1)}else if(re==="Polygon")ye(j,le,ne,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(he=0;he<M.geometry.geometries.length;he++)Gn(q,{id:Q,geometry:M.geometry.geometries[he],properties:M.properties},L,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(he=0;he<j.length;he++){var Ee=[];ye(j[he],Ee,ne,!0),le.push(Ee)}}q.push(Zn(Q,re,le,M.properties))}}function wi(q,M){M.push(cs(q[0])),M.push(jo(q[1])),M.push(0)}function us(q,M,L,O){for(var j,re,ne=0,le=0;le<q.length;le++){var Q=cs(q[le][0]),he=jo(q[le][1]);M.push(Q),M.push(he),M.push(0),le>0&&(ne+=O?(j*he-Q*re)/2:Math.sqrt(Math.pow(Q-j,2)+Math.pow(he-re,2))),j=Q,re=he}var Ee=M.length-3;M[2]=1,qn(M,0,Ee,L),M[Ee+2]=1,M.size=Math.abs(ne),M.start=0,M.end=M.size}function ye(q,M,L,O){for(var j=0;j<q.length;j++){var re=[];us(q[j],re,L,O),M.push(re)}}function cs(q){return q/360+.5}function jo(q){var M=Math.sin(q*Math.PI/180),L=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return L<0?0:L>1?1:L}function Tt(q,M,L,O,j,re,ne,le){if(O/=M,re>=(L/=M)&&ne<O)return q;if(ne<L||re>=O)return null;for(var Q=[],he=0;he<q.length;he++){var Ee=q[he],_e=Ee.geometry,be=Ee.type,Ke=j===0?Ee.minX:Ee.minY,st=j===0?Ee.maxX:Ee.maxY;if(Ke>=L&&st<O)Q.push(Ee);else if(!(st<L||Ke>=O)){var rt=[];if(be==="Point"||be==="MultiPoint")Fi(_e,rt,L,O,j);else if(be==="LineString")pn(_e,rt,L,O,j,!1,le.lineMetrics);else if(be==="MultiLineString")Zs(_e,rt,L,O,j,!1);else if(be==="Polygon")Zs(_e,rt,L,O,j,!0);else if(be==="MultiPolygon")for(var Et=0;Et<_e.length;Et++){var lt=[];Zs(_e[Et],lt,L,O,j,!0),lt.length&&rt.push(lt)}if(rt.length){if(le.lineMetrics&&be==="LineString"){for(Et=0;Et<rt.length;Et++)Q.push(Zn(Ee.id,be,rt[Et],Ee.tags));continue}be!=="LineString"&&be!=="MultiLineString"||(rt.length===1?(be="LineString",rt=rt[0]):be="MultiLineString"),be!=="Point"&&be!=="MultiPoint"||(be=rt.length===3?"Point":"MultiPoint"),Q.push(Zn(Ee.id,be,rt,Ee.tags))}}}return Q.length?Q:null}function Fi(q,M,L,O,j){for(var re=0;re<q.length;re+=3){var ne=q[re+j];ne>=L&&ne<=O&&(M.push(q[re]),M.push(q[re+1]),M.push(q[re+2]))}}function pn(q,M,L,O,j,re,ne){for(var le,Q,he=qs(q),Ee=j===0?hs:Gs,_e=q.start,be=0;be<q.length-3;be+=3){var Ke=q[be],st=q[be+1],rt=q[be+2],Et=q[be+3],lt=q[be+4],Ht=j===0?Ke:st,Nt=j===0?Et:lt,ci=!1;ne&&(le=Math.sqrt(Math.pow(Ke-Et,2)+Math.pow(st-lt,2))),Ht<L?Nt>L&&(Q=Ee(he,Ke,st,Et,lt,L),ne&&(he.start=_e+le*Q)):Ht>O?Nt<O&&(Q=Ee(he,Ke,st,Et,lt,O),ne&&(he.start=_e+le*Q)):Hs(he,Ke,st,rt),Nt<L&&Ht>=L&&(Q=Ee(he,Ke,st,Et,lt,L),ci=!0),Nt>O&&Ht<=O&&(Q=Ee(he,Ke,st,Et,lt,O),ci=!0),!re&&ci&&(ne&&(he.end=_e+le*Q),M.push(he),he=qs(q)),ne&&(_e+=le)}var ft=q.length-3;Ke=q[ft],st=q[ft+1],rt=q[ft+2],(Ht=j===0?Ke:st)>=L&&Ht<=O&&Hs(he,Ke,st,rt),ft=he.length-3,re&&ft>=3&&(he[ft]!==he[0]||he[ft+1]!==he[1])&&Hs(he,he[0],he[1],he[2]),he.length&&M.push(he)}function qs(q){var M=[];return M.size=q.size,M.start=q.start,M.end=q.end,M}function Zs(q,M,L,O,j,re){for(var ne=0;ne<q.length;ne++)pn(q[ne],M,L,O,j,re,!1)}function Hs(q,M,L,O){q.push(M),q.push(L),q.push(O)}function hs(q,M,L,O,j,re){var ne=(re-M)/(O-M);return q.push(re),q.push(L+(j-L)*ne),q.push(1),ne}function Gs(q,M,L,O,j,re){var ne=(re-L)/(j-L);return q.push(M+(O-M)*ne),q.push(re),q.push(1),ne}function $o(q,M){for(var L=[],O=0;O<q.length;O++){var j,re=q[O],ne=re.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")j=Le(re.geometry,M);else if(ne==="MultiLineString"||ne==="Polygon"){j=[];for(var le=0;le<re.geometry.length;le++)j.push(Le(re.geometry[le],M))}else if(ne==="MultiPolygon")for(j=[],le=0;le<re.geometry.length;le++){for(var Q=[],he=0;he<re.geometry[le].length;he++)Q.push(Le(re.geometry[le][he],M));j.push(Q)}L.push(Zn(re.id,ne,j,re.tags))}return L}function Le(q,M){var L=[];L.size=q.size,q.start!==void 0&&(L.start=q.start,L.end=q.end);for(var O=0;O<q.length;O+=3)L.push(q[O]+M,q[O+1],q[O+2]);return L}function wr(q,M){if(q.transformed)return q;var L,O,j,re=1<<q.z,ne=q.x,le=q.y;for(L=0;L<q.features.length;L++){var Q=q.features[L],he=Q.geometry,Ee=Q.type;if(Q.geometry=[],Ee===1)for(O=0;O<he.length;O+=2)Q.geometry.push(or(he[O],he[O+1],M,re,ne,le));else for(O=0;O<he.length;O++){var _e=[];for(j=0;j<he[O].length;j+=2)_e.push(or(he[O][j],he[O][j+1],M,re,ne,le));Q.geometry.push(_e)}}return q.transformed=!0,q}function or(q,M,L,O,j,re){return[Math.round(L*(q*O-j)),Math.round(L*(M*O-re))]}function qo(q,M,L,O,j){for(var re=M===j.maxZoom?0:j.tolerance/((1<<M)*j.extent),ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:O,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},le=0;le<q.length;le++){ne.numFeatures++,ds(ne,q[le],re,j);var Q=q[le].minX,he=q[le].minY,Ee=q[le].maxX,_e=q[le].maxY;Q<ne.minX&&(ne.minX=Q),he<ne.minY&&(ne.minY=he),Ee>ne.maxX&&(ne.maxX=Ee),_e>ne.maxY&&(ne.maxY=_e)}return ne}function ds(q,M,L,O){var j=M.geometry,re=M.type,ne=[];if(re==="Point"||re==="MultiPoint")for(var le=0;le<j.length;le+=3)ne.push(j[le]),ne.push(j[le+1]),q.numPoints++,q.numSimplified++;else if(re==="LineString")ze(ne,j,q,L,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(le=0;le<j.length;le++)ze(ne,j[le],q,L,re==="Polygon",le===0);else if(re==="MultiPolygon")for(var Q=0;Q<j.length;Q++){var he=j[Q];for(le=0;le<he.length;le++)ze(ne,he[le],q,L,!0,le===0)}if(ne.length){var Ee=M.tags||null;if(re==="LineString"&&O.lineMetrics){for(var _e in Ee={},M.tags)Ee[_e]=M.tags[_e];Ee.mapbox_clip_start=j.start/j.size,Ee.mapbox_clip_end=j.end/j.size}var be={geometry:ne,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:Ee};M.id!==null&&(be.id=M.id),q.features.push(be)}}function ze(q,M,L,O,j,re){var ne=O*O;if(O>0&&M.size<(j?ne:O))L.numPoints+=M.length/3;else{for(var le=[],Q=0;Q<M.length;Q+=3)(O===0||M[Q+2]>ne)&&(L.numSimplified++,le.push(M[Q]),le.push(M[Q+1])),L.numPoints++;j&&function(he,Ee){for(var _e=0,be=0,Ke=he.length,st=Ke-2;be<Ke;st=be,be+=2)_e+=(he[be]-he[st])*(he[be+1]+he[st+1]);if(_e>0===Ee)for(be=0,Ke=he.length;be<Ke/2;be+=2){var rt=he[be],Et=he[be+1];he[be]=he[Ke-2-be],he[be+1]=he[Ke-1-be],he[Ke-2-be]=rt,he[Ke-1-be]=Et}}(le,re),q.push(le)}}function gt(q,M){var L=(M=this.options=function(j,re){for(var ne in re)j[ne]=re[ne];return j}(Object.create(this.options),M)).debug;if(L&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var O=function(j,re){var ne=[];if(j.type==="FeatureCollection")for(var le=0;le<j.features.length;le++)Gn(ne,j.features[le],re,le);else Gn(ne,j.type==="Feature"?j:{geometry:j},re);return ne}(q,M);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),O=function(j,re){var ne=re.buffer/re.extent,le=j,Q=Tt(j,1,-1-ne,ne,0,-1,2,re),he=Tt(j,1,1-ne,2+ne,0,-1,2,re);return(Q||he)&&(le=Tt(j,1,-ne,1+ne,0,-1,2,re)||[],Q&&(le=$o(Q,1).concat(le)),he&&(le=le.concat($o(he,-1)))),le}(O,M),O.length&&this.splitTile(O,0,0,0),L&&(O.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function dt(q,M,L){return 32*((1<<q)*L+M)+q}function Bi(q,M){return M?q.properties[M]:q.id}function Or(q,M){if(q==null)return!0;if(q.type==="Feature")return Bi(q,M)!=null;if(q.type==="FeatureCollection"){const L=new Set;for(const O of q.features){const j=Bi(O,M);if(j==null||L.has(j))return!1;L.add(j)}return!0}return!1}function pt(q,M){const L=new Map;if(q!=null)if(q.type==="Feature")L.set(Bi(q,M),q);else for(const O of q.features)L.set(Bi(O,M),O);return L}gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(q,M,L,O,j,re,ne){for(var le=[q,M,L,O],Q=this.options,he=Q.debug;le.length;){O=le.pop(),L=le.pop(),M=le.pop(),q=le.pop();var Ee=1<<M,_e=dt(M,L,O),be=this.tiles[_e];if(!be&&(he>1&&console.time("creation"),be=this.tiles[_e]=qo(q,M,L,O,Q),this.tileCoords.push({z:M,x:L,y:O}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,L,O,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));var Ke="z"+M;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(be.source=q,j){if(M===Q.maxZoom||M===j)continue;var st=1<<j-M;if(L!==Math.floor(re/st)||O!==Math.floor(ne/st))continue}else if(M===Q.indexMaxZoom||be.numPoints<=Q.indexMaxPoints)continue;if(be.source=null,q.length!==0){he>1&&console.time("clipping");var rt,Et,lt,Ht,Nt,ci,ft=.5*Q.buffer/Q.extent,ei=.5-ft,Ai=.5+ft,ar=1+ft;rt=Et=lt=Ht=null,Nt=Tt(q,Ee,L-ft,L+Ai,0,be.minX,be.maxX,Q),ci=Tt(q,Ee,L+ei,L+ar,0,be.minX,be.maxX,Q),q=null,Nt&&(rt=Tt(Nt,Ee,O-ft,O+Ai,1,be.minY,be.maxY,Q),Et=Tt(Nt,Ee,O+ei,O+ar,1,be.minY,be.maxY,Q),Nt=null),ci&&(lt=Tt(ci,Ee,O-ft,O+Ai,1,be.minY,be.maxY,Q),Ht=Tt(ci,Ee,O+ei,O+ar,1,be.minY,be.maxY,Q),ci=null),he>1&&console.timeEnd("clipping"),le.push(rt||[],M+1,2*L,2*O),le.push(Et||[],M+1,2*L,2*O+1),le.push(lt||[],M+1,2*L+1,2*O),le.push(Ht||[],M+1,2*L+1,2*O+1)}}},gt.prototype.getTile=function(q,M,L){var O=this.options,j=O.extent,re=O.debug;if(q<0||q>24)return null;var ne=1<<q,le=dt(q,M=(M%ne+ne)%ne,L);if(this.tiles[le])return wr(this.tiles[le],j);re>1&&console.log("drilling down to z%d-%d-%d",q,M,L);for(var Q,he=q,Ee=M,_e=L;!Q&&he>0;)he--,Ee=Math.floor(Ee/2),_e=Math.floor(_e/2),Q=this.tiles[dt(he,Ee,_e)];return Q&&Q.source?(re>1&&console.log("found parent tile z%d-%d-%d",he,Ee,_e),re>1&&console.time("drilling down"),this.splitTile(Q.source,he,Ee,_e,q,M,L),re>1&&console.timeEnd("drilling down"),this.tiles[le]?wr(this.tiles[le],j):null):null};class Wn extends H{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(M,L){return x._(this,void 0,void 0,function*(){const O=M.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const j=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!j)return null;const re=new class{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.W,this.length=le.length,this._features=le}feature(le){return new class{constructor(Q){this._feature=Q,this.extent=x.W,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const he of this._feature.geometry)Q.push([new x.P(he[0],he[1])]);return Q}{const Q=[];for(const he of this._feature.geometry){const Ee=[];for(const _e of he)Ee.push(new x.P(_e[0],_e[1]));Q.push(Ee)}return Q}}toGeoJSON(Q,he,Ee){return at.call(this,Q,he,Ee)}}(this._features[le])}}(j.features);let ne=dn(re);return ne.byteOffset===0&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),{vectorTile:re,rawData:ne.buffer}})}loadData(M){return x._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const O=!!(M&&M.request&&M.request.collectResourceTiming)&&new x.bs(M.request);this._pendingRequest=new AbortController;try{let j=yield this.loadGeoJSON(M,this._pendingRequest);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`);if(we(j,!0),M.filter){const ne=x.by(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(Q=>`${Q.key}: ${Q.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(Q=>ne.value.evaluate({zoom:0},Q))}}this._geoJSONIndex=M.cluster?new Pi(function({superclusterOptions:ne,clusterProperties:le}){if(!le||!ne)return ne;const Q={},he={},Ee={accumulated:null,zoom:0},_e={properties:null},be=Object.keys(le);for(const Ke of be){const[st,rt]=le[Ke],Et=x.by(rt),lt=x.by(typeof st=="string"?[st,["accumulated"],["get",Ke]]:st);Q[Ke]=Et.value,he[Ke]=lt.value}return ne.map=Ke=>{_e.properties=Ke;const st={};for(const rt of be)st[rt]=Q[rt].evaluate(Ee,_e);return st},ne.reduce=(Ke,st)=>{_e.properties=st;for(const rt of be)Ee.accumulated=Ke[rt],Ke[rt]=he[rt].evaluate(Ee,_e)},ne}(M)).load(j.features):function(ne,le){return new gt(ne,le)}(j,M.geojsonVtOptions),this.loaded={};const re={};if(O){const ne=O.finish();ne&&(re.resourceTiming={},re.resourceTiming[M.source]=JSON.parse(JSON.stringify(ne)))}return re}catch(j){if(delete this._pendingRequest,x.bz(j))return{abandoned:!0};throw j}})}reloadTile(M){const L=this.loaded;return L&&L[M.uid]?super.reloadTile(M):this.loadTile(M)}loadGeoJSON(M,L){return x._(this,void 0,void 0,function*(){const{promoteId:O}=M;if(M.request){const j=yield x.h(M.request,L);return this._dataUpdateable=Or(j.data,O)?pt(j.data,O):void 0,j.data}if(typeof M.data=="string")try{const j=JSON.parse(M.data);return this._dataUpdateable=Or(j,O)?pt(j,O):void 0,j}catch{throw new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`)}if(!M.dataDiff)throw new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${M.source}`);return function(j,re,ne){var le,Q,he,Ee;if(re.removeAll&&j.clear(),re.remove)for(const _e of re.remove)j.delete(_e);if(re.add)for(const _e of re.add){const be=Bi(_e,ne);be!=null&&j.set(be,_e)}if(re.update)for(const _e of re.update){let be=j.get(_e.id);if(be==null)continue;const Ke=!_e.removeAllProperties&&(((le=_e.removeProperties)===null||le===void 0?void 0:le.length)>0||((Q=_e.addOrUpdateProperties)===null||Q===void 0?void 0:Q.length)>0);if((_e.newGeometry||_e.removeAllProperties||Ke)&&(be=Object.assign({},be),j.set(_e.id,be),Ke&&(be.properties=Object.assign({},be.properties))),_e.newGeometry&&(be.geometry=_e.newGeometry),_e.removeAllProperties)be.properties={};else if(((he=_e.removeProperties)===null||he===void 0?void 0:he.length)>0)for(const st of _e.removeProperties)Object.prototype.hasOwnProperty.call(be.properties,st)&&delete be.properties[st];if(((Ee=_e.addOrUpdateProperties)===null||Ee===void 0?void 0:Ee.length)>0)for(const{key:st,value:rt}of _e.addOrUpdateProperties)be.properties[st]=rt}}(this._dataUpdateable,M.dataDiff,O),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(M){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(M){return this._geoJSONIndex.getClusterExpansionZoom(M.clusterId)}getClusterChildren(M){return this._geoJSONIndex.getChildren(M.clusterId)}getClusterLeaves(M){return this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset)}}class An{constructor(M){this.self=M,this.actor=new x.C(M),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,O)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=O},this.self.addProtocol=x.bf,this.self.removeProtocol=x.bg,this.self.registerRTLTextPlugin=L=>{if(x.bA.isParsed())throw new Error("RTL text plugin already registered.");x.bA.setMethods(L)},this.actor.registerMessageHandler("loadDEMTile",(L,O)=>this._getDEMWorkerSource(L,O.source).loadTile(O)),this.actor.registerMessageHandler("removeDEMTile",(L,O)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,O.source).removeTile(O)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(L,O)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(L,O.type,O.source).getClusterExpansionZoom(O)})),this.actor.registerMessageHandler("getClusterChildren",(L,O)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(L,O.type,O.source).getClusterChildren(O)})),this.actor.registerMessageHandler("getClusterLeaves",(L,O)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(L,O.type,O.source).getClusterLeaves(O)})),this.actor.registerMessageHandler("loadData",(L,O)=>this._getWorkerSource(L,O.type,O.source).loadData(O)),this.actor.registerMessageHandler("loadTile",(L,O)=>this._getWorkerSource(L,O.type,O.source).loadTile(O)),this.actor.registerMessageHandler("reloadTile",(L,O)=>this._getWorkerSource(L,O.type,O.source).reloadTile(O)),this.actor.registerMessageHandler("abortTile",(L,O)=>this._getWorkerSource(L,O.type,O.source).abortTile(O)),this.actor.registerMessageHandler("removeTile",(L,O)=>this._getWorkerSource(L,O.type,O.source).removeTile(O)),this.actor.registerMessageHandler("removeSource",(L,O)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][O.type]||!this.workerSources[L][O.type][O.source])return;const j=this.workerSources[L][O.type][O.source];delete this.workerSources[L][O.type][O.source],j.removeSource!==void 0&&j.removeSource(O)})),this.actor.registerMessageHandler("removeMap",L=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("setReferrer",(L,O)=>x._(this,void 0,void 0,function*(){this.referrer=O})),this.actor.registerMessageHandler("syncRTLPluginState",(L,O)=>this._syncRTLPluginState(L,O)),this.actor.registerMessageHandler("importScript",(L,O)=>x._(this,void 0,void 0,function*(){this.self.importScripts(O)})),this.actor.registerMessageHandler("setImages",(L,O)=>this._setImages(L,O)),this.actor.registerMessageHandler("updateLayers",(L,O)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(O.layers,O.removedIds)})),this.actor.registerMessageHandler("setLayers",(L,O)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(O)}))}_setImages(M,L){return x._(this,void 0,void 0,function*(){this.availableImages[M]=L;for(const O in this.workerSources[M]){const j=this.workerSources[M][O];for(const re in j)j[re].availableImages=L}})}_syncRTLPluginState(M,L){return x._(this,void 0,void 0,function*(){if(x.bA.isParsed())return x.bA.getState();if(L.pluginStatus!=="loading")return x.bA.setState(L),L;const O=L.pluginURL;if(this.self.importScripts(O),x.bA.isParsed()){const j={pluginStatus:"loaded",pluginURL:O};return x.bA.setState(j),j}throw x.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${O}`)})}_getAvailableImages(M){let L=this.availableImages[M];return L||(L=[]),L}_getLayerIndex(M){let L=this.layerIndexes[M];return L||(L=this.layerIndexes[M]=new d),L}_getWorkerSource(M,L,O){if(this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][L]||(this.workerSources[M][L]={}),!this.workerSources[M][L][O]){const j={sendAsync:(re,ne)=>(re.targetMapId=M,this.actor.sendAsync(re,ne))};switch(L){case"vector":this.workerSources[M][L][O]=new H(j,this._getLayerIndex(M),this._getAvailableImages(M));break;case"geojson":this.workerSources[M][L][O]=new Wn(j,this._getLayerIndex(M),this._getAvailableImages(M));break;default:this.workerSources[M][L][O]=new this.externalWorkerSourceTypes[L](j,this._getLayerIndex(M),this._getAvailableImages(M))}}return this.workerSources[M][L][O]}_getDEMWorkerSource(M,L){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][L]||(this.demWorkerSources[M][L]=new G),this.demWorkerSources[M][L]}}return x.i(self)&&(self.worker=new An(self)),An}),_("index",["exports","./shared"],function(x,d){var U="4.1.2";let ee,de;const H={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,o)=>{const u=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(d.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),o=t.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,o.drawImage(p,0,0,p.width,p.height),o},resolveURL:p=>(ee||(ee=document.createElement("a")),ee.href=p,ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}};class G{static testProp(t){if(!G.docStyle)return t[0];for(let o=0;o<t.length;o++)if(t[o]in G.docStyle)return t[o];return t[0]}static create(t,o,u){const c=window.document.createElement(t);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}static createNS(t,o){return window.document.createElementNS(t,o)}static disableDrag(){G.docStyle&&G.selectProp&&(G.userSelect=G.docStyle[G.selectProp],G.docStyle[G.selectProp]="none")}static enableDrag(){G.docStyle&&G.selectProp&&(G.docStyle[G.selectProp]=G.userSelect)}static setTransform(t,o){t.style[G.transformProp]=o}static addEventListener(t,o,u,c={}){t.addEventListener(o,u,"passive"in c?c:c.capture)}static removeEventListener(t,o,u,c={}){t.removeEventListener(o,u,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",G.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",G.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",G.suppressClickInternal,!0)},0)}static getScale(t){const o=t.getBoundingClientRect();return{x:o.width/t.offsetWidth||1,y:o.height/t.offsetHeight||1,boundingClientRect:o}}static getPoint(t,o,u){const c=o.boundingClientRect;return new d.P((u.clientX-c.left)/o.x-t.clientLeft,(u.clientY-c.top)/o.y-t.clientTop)}static mousePos(t,o){const u=G.getScale(t);return G.getPoint(t,u,o)}static touchPos(t,o){const u=[],c=G.getScale(t);for(let m=0;m<o.length;m++)u.push(G.getPoint(t,c,o[m]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}G.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,G.selectProp=G.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),G.transformProp=G.testProp(["transform","WebkitTransform"]);const Me={supported:!1,testSupport:function(p){!at&&we&&(ae?ie(p):xe=p)}};let xe,we,at=!1,ae=!1;function ie(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,we),p.isContextLost())return;Me.supported=!0}catch{}p.deleteTexture(t),at=!0}var ue,ke;typeof document<"u"&&(we=document.createElement("img"),we.onload=function(){xe&&ie(xe),xe=null,ae=!0},we.onerror=function(){at=!0,xe=null},we.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,o,u,c;p.resetRequestQueue=()=>{t=[],o=0,u=0,c={}},p.addThrottleControl=E=>{const I=u++;return c[I]=E,I},p.removeThrottleControl=E=>{delete c[E],w()},p.getImage=(E,I,A=!0)=>new Promise((z,F)=>{Me.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),d.e(E,{type:"image"}),t.push({abortController:I,requestParameters:E,supportImageRefresh:A,state:"queued",onError:Z=>{F(Z)},onSuccess:Z=>{z(Z)}}),w()});const m=E=>d._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:I,supportImageRefresh:A,onError:z,onSuccess:F,abortController:Z}=E,$=A===!1&&!d.i(self)&&!d.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((te,pe)=>te&&pe==="accept",!0));o++;const K=$?b(I,Z):d.m(I,Z);try{const te=yield K;delete E.abortController,E.state="completed",te.data instanceof HTMLImageElement||d.b(te.data)?F(te):te.data&&F({data:yield(N=te.data,typeof createImageBitmap=="function"?d.d(N):d.f(N)),cacheControl:te.cacheControl,expires:te.expires})}catch(te){delete E.abortController,z(te)}finally{o--,w()}var N}),w=()=>{const E=(()=>{for(const I of Object.keys(c))if(c[I]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=o;I<E&&t.length>0;I++){const A=t.shift();A.abortController.signal.aborted?I--:m(A)}},b=(E,I)=>new Promise((A,z)=>{const F=new Image,Z=E.url,$=E.credentials;$&&$==="include"?F.crossOrigin="use-credentials":($&&$==="same-origin"||!d.s(Z))&&(F.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{F.src="",z(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,A({data:F})},F.onerror=()=>{F.onerror=F.onload=null,I.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=Z})}(ue||(ue={})),ue.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(ke||(ke={}));class qe{constructor(t){this._transformRequestFn=t}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeSpriteURL(t,o,u){const c=function(m){const w=m.match(Je);if(!w)throw new Error(`Unable to parse URL "${m}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(t);return c.path+=`${o}${u}`,function(m){const w=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${w}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const Je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ge(p){var t=new d.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var et,Rt=function(p,t,o){return p[0]=t[0]-o[0],p[1]=t[1]-o[1],p[2]=t[2]-o[2],p};et=new d.A(3),d.A!=Float32Array&&(et[0]=0,et[1]=0,et[2]=0);var xt=function(p){var t=p[0],o=p[1];return t*t+o*o};function Zt(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const o=[];for(const{id:u,url:c}of p){const m=`${u}${c}`;o.indexOf(m)===-1&&(o.push(m),t.push({id:u,url:c}))}}return t}(function(){var p=new d.A(2);d.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Ot{constructor(t,o,u,c){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,c)}update(t,o,u){const{width:c,height:m}=t,w=!(this.size&&this.size[0]===c&&this.size[1]===m||u),{context:b}=this,{gl:E}=b;if(this.useMipmap=!!(o&&o.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!o||o.premultiply!==!1)),w)this.size=[c,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,c,m,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:I,y:A}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?E.texSubImage2D(E.TEXTURE_2D,0,I,A,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,I,A,c,m,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,o,u){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),u!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function si(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class sr extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(t){const o=this.images[t];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(t,o){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let u=!0;const c=o.data||o.spriteData;return this._validateStretch(o.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,o){if(!t)return!0;let u=0;for(const c of t){if(c[0]<u||c[1]<c[0]||o<c[1])return!1;u=c[1]}return!0}_validateContent(t,o){if(!t)return!0;if(t.length!==4)return!1;const u=o.spriteData,c=u&&u.width||o.data.width,m=u&&u.height||o.data.height;return!(t[0]<0||c<t[0]||t[1]<0||m<t[1]||t[2]<0||c<t[2]||t[3]<0||m<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,o,u=!0){const c=this.getImage(t);if(u&&(c.data.width!==o.data.width||c.data.height!==o.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=c.version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((o,u)=>{let c=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(c=!1);this.isLoaded()||c?o(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:o})})}_getImagesForIds(t){const o={};for(const u of t){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?o[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],u=this.getImage(t);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},m=new d.I(c,u);this.patterns[t]={bin:c,position:m}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ot(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const m in this.patterns)t.push(this.patterns[m].bin);const{w:o,h:u}=d.p(t),c=this.atlasImage;c.resize({width:o||1,height:u||1});for(const m in this.patterns){const{bin:w}=this.patterns[m],b=w.x+1,E=w.y+1,I=this.getImage(m).data,A=I.width,z=I.height;d.R.copy(I,c,{x:0,y:0},{x:b,y:E},{width:A,height:z}),d.R.copy(I,c,{x:0,y:z-1},{x:b,y:E-1},{width:A,height:1}),d.R.copy(I,c,{x:0,y:0},{x:b,y:E+z},{width:A,height:1}),d.R.copy(I,c,{x:A-1,y:0},{x:b-1,y:E},{width:1,height:z}),d.R.copy(I,c,{x:0,y:0},{x:b+A,y:E},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||d.w(`Image with ID: "${o}" was not found`),si(u)&&this.updateImage(o,u)}}}const Pn=1e20;function xr(p,t,o,u,c,m,w,b,E){for(let I=t;I<t+u;I++)dn(p,o*m+I,m,c,w,b,E);for(let I=o;I<o+c;I++)dn(p,I*m+t,1,u,w,b,E)}function dn(p,t,o,u,c,m,w){m[0]=0,w[0]=-Pn,w[1]=Pn,c[0]=p[t];for(let b=1,E=0,I=0;b<u;b++){c[b]=p[t+b*o];const A=b*b;do{const z=m[E];I=(c[b]-c[z]+A-z*z)/(b-z)/2}while(I<=w[E]&&--E>-1);E++,m[E]=b,w[E]=I,w[E+1]=Pn}for(let b=0,E=0;b<u;b++){for(;w[E+1]<b;)E++;const I=m[E],A=b-I;p[t+b*o]=c[I]+A*A}}class Ze{constructor(t,o){this.requestManager=t,this.localIdeographFontFamily=o,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,function*(){const o=[];for(const m in t)for(const w of t[m])o.push(this._getAndCacheGlyphsPromise(m,w));const u=yield Promise.all(o),c={};for(const{stack:m,id:w,glyph:b}of u)c[m]||(c[m]={}),c[m][w]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(t,o){return d._(this,void 0,void 0,function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[o];if(c!==void 0)return{stack:t,id:o,glyph:c};if(c=this._tinySDF(u,t,o),c)return u.glyphs[o]=c,{stack:t,id:o,glyph:c};const m=Math.floor(o/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[m])return{stack:t,id:o,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[m]){const b=Ze.loadGlyphRange(t,m,this.url,this.requestManager);u.requests[m]=b}const w=yield u.requests[m];for(const b in w)this._doesCharSupportLocalGlyph(+b)||(u.glyphs[+b]=w[+b]);return u.ranges[m]=!0,{stack:t,id:o,glyph:w[o]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(d.u["CJK Unified Ideographs"](t)||d.u["Hangul Syllables"](t)||d.u.Hiragana(t)||d.u.Katakana(t))}_tinySDF(t,o,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let m=t.tinySDF;if(!m){let b="400";/bold/i.test(o)?b="900":/medium/i.test(o)?b="500":/light/i.test(o)&&(b="200"),m=t.tinySDF=new Ze.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const w=m.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ze.loadGlyphRange=function(p,t,o,u){return d._(this,void 0,void 0,function*(){const c=256*t,m=c+255,w=u.transformRequest(o.replace("{fontstack}",p).replace("{range}",`${c}-${m}`),ke.Glyphs),b=yield d.l(w,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${c}-${m}`);const E={};for(const I of d.n(b.data))E[I.id]=I;return E})},Ze.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:o=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=o;const b=this.size=p+4*t,E=this._createCanvas(b),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${w} ${m} ${p}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(p),w=Math.ceil(o),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),E=Math.min(this.size-this.buffer,w+Math.ceil(u)),I=b+2*this.buffer,A=E+2*this.buffer,z=Math.max(I*A,0),F=new Uint8ClampedArray(z),Z={data:F,width:I,height:A,glyphWidth:b,glyphHeight:E,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(b===0||E===0)return Z;const{ctx:$,buffer:K,gridInner:N,gridOuter:te}=this;$.clearRect(K,K,b,E),$.fillText(p,K,K+w);const pe=$.getImageData(K,K,b,E);te.fill(Pn,0,z),N.fill(0,0,z);for(let X=0;X<E;X++)for(let oe=0;oe<b;oe++){const fe=pe.data[4*(X*b+oe)+3]/255;if(fe===0)continue;const me=(X+K)*I+oe+K;if(fe===1)te[me]=0,N[me]=Pn;else{const ge=.5-fe;te[me]=ge>0?ge*ge:0,N[me]=ge<0?ge*ge:0}}xr(te,0,0,I,A,I,this.f,this.v,this.z),xr(N,K,K,b,E,I,this.f,this.v,this.z);for(let X=0;X<z;X++){const oe=Math.sqrt(te[X])-Math.sqrt(N[X]);F[X]=Math.round(255-255*(oe/this.radius+this.cutoff))}return Z}};class ct{constructor(){this.specification=d.v.light.position}possiblyEvaluate(t,o){return d.y(t.expression.evaluate(o))}interpolate(t,o,u){return{x:d.z.number(t.x,o.x,u),y:d.z.number(t.y,o.y,u),z:d.z.number(t.z,o.z,u)}}}let ht;class It extends d.E{constructor(t){super(),ht=ht||new d.q({anchor:new d.D(d.v.light.anchor),position:new ct,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ht),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(d.r,t,o))for(const u in t){const c=t[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,u){return(!u||u.validate!==!1)&&d.t(this,t.call(d.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}class zt{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,o){const u=t.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,o)),this.dashEntry[u]}getDashRanges(t,o,u){const c=[];let m=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,b=!0;c.push({left:m,right:w,isDash:b,zeroLength:t[0]===0});let E=t[0];for(let I=1;I<t.length;I++){b=!b;const A=t[I];m=E*u,E+=A,w=E*u,c.push({left:m,right:w,isDash:b,zeroLength:A===0})}return c}addRoundDash(t,o,u){const c=o/2;for(let m=-u;m<=u;m++){const w=this.width*(this.nextRow+u+m);let b=0,E=t[b];for(let I=0;I<this.width;I++){I/E.right>1&&(E=t[++b]);const A=Math.abs(I-E.left),z=Math.abs(I-E.right),F=Math.min(A,z);let Z;const $=m/u*(c+1);if(E.isDash){const K=c-Math.abs($);Z=Math.sqrt(F*F+K*K)}else Z=c-Math.sqrt(F*F+$*$);this.data[w+I]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const E=t[b],I=t[b+1];E.zeroLength?t.splice(b,1):I&&I.isDash===E.isDash&&(I.left=E.left,t.splice(b,1))}const o=t[0],u=t[t.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const c=this.width*this.nextRow;let m=0,w=t[m];for(let b=0;b<this.width;b++){b/w.right>1&&(w=t[++m]);const E=Math.abs(b-w.left),I=Math.abs(b-w.right),A=Math.min(E,I);this.data[c+b]=Math.max(0,Math.min(255,(w.isDash?A:-A)+128))}}addDash(t,o){const u=o?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<t.length;b++)m+=t[b];if(m!==0){const b=this.width/m,E=this.getDashRanges(t,this.width,b);o?this.addRoundDash(E,b,u):this.addRegularDash(E)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:m};return this.nextRow+=c,this.dirty=!0,w}bind(t){const o=t.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Br="maplibre_preloaded_worker_pool";class Pi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Pi.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Br]}numActive(){return Object.keys(this.active).length}}const Wr=Math.floor(H.hardwareConcurrency/2);let Ri,Ui;function Kr(){return Ri||(Ri=new Pi),Ri}Pi.workerCount=d.B(globalThis)?Math.max(Math.min(Wr,3),1):1;class $s{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let c=0;c<u.length;c++){const m=new d.C(u[c],o);m.name=`Worker ${c}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,o){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:t,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,o){for(const u of this.actors)u.registerMessageHandler(t,o)}}function qn(){return Ui||(Ui=new $s(Kr(),d.G),Ui.registerMessageHandler("getResource",(p,t,o)=>d.m(t,o))),Ui}function Ia(p,t){const o=d.F();return d.H(o,o,[1,1,0]),d.J(o,o,[.5*p.width,.5*p.height,1]),d.K(o,o,p.calculatePosMatrix(t.toUnwrapped()))}function Zn(p,t,o,u,c,m){const w=function(z,F,Z){if(z)for(const $ of z){const K=F[$];if(K&&K.source===Z&&K.type==="fill-extrusion")return!0}else for(const $ in F){const K=F[$];if(K.source===Z&&K.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,p.id),b=m.maxPitchScaleFactor(),E=p.tilesIn(u,b,w);E.sort(Hn);const I=[];for(const z of E)I.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,o,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,c,m,b,Ia(p.transform,z.tileID))});const A=function(z){const F={},Z={};for(const $ of z){const K=$.queryResults,N=$.wrappedTileID,te=Z[N]=Z[N]||{};for(const pe in K){const X=K[pe],oe=te[pe]=te[pe]||{},fe=F[pe]=F[pe]||[];for(const me of X)oe[me.featureIndex]||(oe[me.featureIndex]=!0,fe.push(me))}}return F}(I);for(const z in A)A[z].forEach(F=>{const Z=F.feature,$=p.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=$});return A}function Hn(p,t){const o=p.tileID,u=t.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Gn(p,t,o){return d._(this,void 0,void 0,function*(){let u=p;if(p.url?u=(yield d.h(t.transformRequest(p.url,ke.Source),o)).data:yield H.frameAsync(o),!u)return null;const c=d.L(d.e(u,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(m=>m.id)),c})}class wi{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}extend(t){const o=this._sw,u=this._ne;let c,m;if(t instanceof d.M)c=t,m=t;else{if(!(t instanceof wi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(wi.convert(t)):this.extend(d.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.M.convert(t)):this;if(c=t._sw,m=t._ne,!c||!m)return this}return o||u?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new d.M(c.lng,c.lat),this._ne=new d.M(m.lng,m.lat)),this}getCenter(){return new d.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.M(this.getWest(),this.getNorth())}getSouthEast(){return new d.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:u}=d.M.convert(t);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(t){return t instanceof wi?t:t&&new wi(t)}static fromLngLat(t,o=0){const u=360*o/40075017,c=u/Math.cos(Math.PI/180*t.lat);return new wi(new d.M(t.lng-c,t.lat-u),new d.M(t.lng+c,t.lat+u))}}class us{constructor(t,o,u){this.bounds=wi.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),u=Math.floor(d.N(this.bounds.getWest())*o),c=Math.floor(d.O(this.bounds.getNorth())*o),m=Math.ceil(d.N(this.bounds.getEast())*o),w=Math.ceil(d.O(this.bounds.getSouth())*o);return t.x>=u&&t.x<m&&t.y>=c&&t.y<w}}class ye extends d.E{constructor(t,o,u,c){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.L(o,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Gn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new us(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,ke.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="reloadTile";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((m,w)=>{t.reloadPromise={resolve:m,reject:w}})}else t.actor=this.dispatcher.getActor(),c="loadTile";t.abortController=new AbortController;try{const m=yield t.actor.sendAsync({type:c,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,m)}catch(m){if(delete t.abortController,t.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,o){if(o&&o.resourceTiming&&(t.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&t.setExpiryData(o),t.loadVectorData(o,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"abortTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class cs extends d.E{constructor(t,o,u,c){super(),this.id=t,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},o),d.e(this,d.L(o,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Gn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(d.e(this,t),t.bounds&&(this.tileBounds=new us(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield ue.getImage(this.map._requestManager.transformRequest(o,ke.Tile),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,m=c.gl,w=u.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new Ot(c,w,m.RGBA,{useMipmap:!0}),t.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),c.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class jo extends cs{constructor(t,o,u,c){super(t,o,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(t){return d._(this,void 0,void 0,function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,ke.Tile);t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const c=yield ue.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){const m=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const w=d.b(m)&&d.S()?m:yield this.readImageNow(m),b={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const E=yield t.actor.sendAsync({type:"loadDEMTile",data:b});t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}readImageNow(t){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.U()){const o=t.width+2,u=t.height+2;try{return new d.R({width:o,height:u},yield d.V(t,-1,-1,o,u))}catch{}}return H.getImageData(t,1)})}_getNeighboringTiles(t){const o=t.canonical,u=Math.pow(2,o.z),c=(o.x-1+u)%u,m=o.x===0?t.wrap-1:t.wrap,w=(o.x+1+u)%u,b=o.x+1===u?t.wrap+1:t.wrap,E={};return E[new d.Q(t.overscaledZ,m,o.z,c,o.y).key]={backfilled:!1},E[new d.Q(t.overscaledZ,b,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(E[new d.Q(t.overscaledZ,m,o.z,c,o.y-1).key]={backfilled:!1},E[new d.Q(t.overscaledZ,t.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},E[new d.Q(t.overscaledZ,b,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<u&&(E[new d.Q(t.overscaledZ,m,o.z,c,o.y+1).key]={backfilled:!1},E[new d.Q(t.overscaledZ,t.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},E[new d.Q(t.overscaledZ,b,o.z,w,o.y+1).key]={backfilled:!1}),E}unloadTile(t){return d._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Tt extends d.E{constructor(t,o,u,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=o.data,this._options=d.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const m=d.W/this.tileSize;this.workerOptions=d.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*m,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*m,extent:d.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.W,radius:(o.clusterRadius||50)*m,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,o,u){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:t,limit:o,offset:u}})}_updateWorkerData(t){return d._(this,void 0,void 0,function*(){const o=d.e({type:this.type},this.workerOptions);t?o.dataDiff=t:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(H.resolveURL(this._data),ke.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"loadData",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(m,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(t){return d._(this,void 0,void 0,function*(){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const c=yield this.actor.sendAsync({type:o,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(c,this.map.painter,o==="reloadTile")})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Fi=d.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class pn extends d.E{constructor(t,o,u,c){super(),this.id=t,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=o}load(t){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ue.getImage(this.map._requestManager.transformRequest(this.url,ke.Image),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,t&&(this.coordinates=t),this._finishLoading())}catch(o){this._request=null,this.fire(new d.j(o))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const o=t.map(d.Y.fromLngLat);this.tileID=function(c){let m=1/0,w=1/0,b=-1/0,E=-1/0;for(const F of c)m=Math.min(m,F.x),w=Math.min(w,F.y),b=Math.max(b,F.x),E=Math.max(E,F.y);const I=Math.max(b-m,E-w),A=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),z=Math.pow(2,A);return new d.a0(A,Math.floor((m+b)/2*z),Math.floor((w+E)/2*z))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.Z,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.W,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.W),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.W,d.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,o=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Fi.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ot(t,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class qs extends pn{constructor(t,o,u,c){super(t,o,u,c),this.roundZoom=!0,this.type="video",this.options=o}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const o of t.urls)this.urls.push(this.map._requestManager.transformRequest(o,ke.Source).url);try{const o=yield d.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new d.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const o=this.video.seekable;t<o.start(0)||t>o.end(0)?this.fire(new d.j(new d.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,o=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Fi.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Ot(t,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Zs extends pn{constructor(t,o,u,c){super(t,o,u,c),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(w=>typeof w!="number"))||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new d.j(new d.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Fi.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ot(o,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const m in this.tiles){const w=this.tiles[m];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Hs={},hs=p=>{switch(p){case"geojson":return Tt;case"image":return pn;case"raster":return cs;case"raster-dem":return jo;case"vector":return ye;case"video":return qs;case"canvas":return Zs}return Hs[p]},Gs="RTLPluginLoaded";class $o extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=H.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Gs))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Le=null;function wr(){return Le||(Le=new $o),Le}class or{constructor(t,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=d.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const o=t+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,m){const w={};if(!m)return w;for(const b of c){const E=b.layerIds.map(I=>m.getLayer(I)).filter(Boolean);if(E.length!==0){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(I=>E.filter(A=>A.id===I)[0]));for(const I of E)w[I.id]=b}}return w}(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const m=this.buckets[c];if(m instanceof d.a5){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const m=this.buckets[c];if(m instanceof d.a5&&m.hasRTLText){this.hasRTLText=!0,wr().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const m=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(c).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new d.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(t)}const o=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ot(t,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ot(t,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,o,u,c,m,w,b,E,I,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:m,scale:w,tileSize:this.tileSize,pixelPosMatrix:A,transform:E,params:b,queryPadding:this.queryPadding*I},t,o,u):{}}querySourceFeatures(t,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),m=o&&o.sourceLayer?o.sourceLayer:"",w=c._geojsonTileLayer||c[m];if(!w)return;const b=d.a6(o&&o.filter),{z:E,x:I,y:A}=this.tileID.canonical,z={z:E,x:I,y:A};for(let F=0;F<w.length;F++){const Z=w.feature(F);if(b.needGeometry){const N=d.a7(Z,!0);if(!b.filter(new d.a8(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!b.filter(new d.a8(this.tileID.overscaledZ),Z))continue;const $=u.getId(Z,m),K=new d.a9(Z,E,I,A,$);K.tile=z,t.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const u=d.aa(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const m=this.expirationTime-o;m?this.expirationTime=u+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!o.style.hasLayer(c))continue;const m=this.buckets[c],w=m.layers[0].sourceLayer||"_geojsonTileLayer",b=u[w],E=t[w];if(!b||!E||Object.keys(E).length===0)continue;m.update(E,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=o&&o.style&&o.style.getLayer(c);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<H.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=H.now()+t}setDependencies(t,o){const u={};for(const c of o)u[c]=!0;this.dependencies[t]=u}hasDependency(t,o){for(const u of t){const c=this.dependencies[u];if(c){for(const m of o)if(c[m])return!0}}return!1}}class qo{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,u){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const m={value:o,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},u)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const u=t.wrapped().key,c=o===void 0?0:this.data[u].indexOf(o),m=this.data[u][c];return this.data[u].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const u in this.data)for(const c of this.data[u])t(c.value)||o.push(c);for(const u of o)this.remove(u.value.tileID,u)}}class ds{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,u){const c=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},d.e(this.stateChanges[t][c],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==c&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const m in this.state[t][c])u[m]||(this.deletedStates[t][c][m]=null)}else for(const m in u)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][m]===null&&delete this.deletedStates[t][c][m]}removeFeatureState(t,o,u){if(this.deletedStates[t]===null)return;const c=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(u in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][u]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,o){const u=String(o),c=d.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const m=this.deletedStates[t][o];if(m===null)return{};for(const w in m)delete c[w]}return c}initializeTileState(t,o){t.setFeatureState(this.state,o)}coalesceChanges(t,o){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const m={};for(const w in this.stateChanges[c])this.state[c][w]||(this.state[c][w]={}),d.e(this.state[c][w],this.stateChanges[c][w]),m[w]=this.state[c][w];u[c]=m}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const m={};if(this.deletedStates[c]===null)for(const w in this.state[c])m[w]={},this.state[c][w]={};else for(const w in this.deletedStates[c]){if(this.deletedStates[c][w]===null)this.state[c][w]={};else for(const b of Object.keys(this.deletedStates[c][w]))delete this.state[c][w][b];m[w]=this.state[c][w]}u[c]=u[c]||{},d.e(u[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in t)t[c].setFeatureState(u,o)}}class ze extends d.E{constructor(t,o,u){super(),this.id=t,this.dispatcher=u,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,m,w,b)=>{const E=new(hs(m.type))(c,m,w,b);if(E.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${E.id}`);return E})(t,o,u,this),this._tiles={},this._cache=new qo(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ds,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,o,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,o,u)}catch(c){t.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(gt).map(t=>t.key)}getRenderableIds(t){const o=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&o.push(this._tiles[u]);return t?o.sort((u,c)=>{const m=u.tileID,w=c.tileID,b=new d.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new d.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-w.overscaledZ||E.y-b.y||E.x-b.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(gt).map(u=>u.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,o){return d._(this,void 0,void 0,function*(){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,t,o))})}_tileLoaded(t,o,u){t.timeAdded=H.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const m=o[c];if(t.neighboringTiles&&t.neighboringTiles[m]){const w=this.getTileByID(m);u(t,w),u(w,t)}}function u(c,m){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let w=m.tileID.canonical.x-c.tileID.canonical.x;const b=m.tileID.canonical.y-c.tileID.canonical.y,E=Math.pow(2,c.tileID.canonical.z),I=m.tileID.key;w===0&&b===0||Math.abs(b)>1||(Math.abs(w)>1&&(Math.abs(w+E)===1?w+=E:Math.abs(w-E)===1&&(w-=E)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,w,b),c.neighboringTiles&&c.neighboringTiles[I]&&(c.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,u,c){for(const m in this._tiles){let w=this._tiles[m];if(c[m]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>u)continue;let b=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const I=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[I.key],w&&w.hasData()&&(b=I)}let E=b;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){c[b.key]=b;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=t.overscaledZ-1;u>=o;u--){const c=t.scaledTo(u),m=this._getLoadedTile(c);if(m)return m}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const o=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(m)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const u={};for(const c in this._tiles){const m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),u[m.tileID.key]=m}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,o){if(this.transform=t,this.terrain=o,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.Q(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(A=>this._source.hasTile(A)))):u=[];const c=t.coveringZoomLevel(this._source),m=Math.max(c-ze.maxOverzooming,this._source.minzoom),w=Math.max(c+ze.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const z of u)if(z.canonical.z>this._source.minzoom){const F=z.scaledTo(z.canonical.z-1);A[F.key]=F;const Z=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));A[Z.key]=Z}u=u.concat(Object.values(A))}const b=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(u,c);if(dt(this._source.type)){const A={},z={},F=Object.keys(E),Z=H.now();for(const $ of F){const K=E[$],N=this._tiles[$];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=Z)continue;const te=this.findLoadedParent(K,m);te&&(this._addTile(te.tileID),A[te.tileID.key]=te.tileID),z[$]=K}this._retainLoadedChildren(z,c,w,E);for(const $ in A)E[$]||(this._coveredTiles[$]=!0,E[$]=A[$]);if(o){const $={},K={};for(const N of u)this._tiles[N.key].hasData()?$[N.key]=N:K[N.key]=N;for(const N in K){const te=K[N].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&($[te[0].key]=E[te[0].key]=te[0],$[te[1].key]=E[te[1].key]=te[1],$[te[2].key]=E[te[2].key]=te[2],$[te[3].key]=E[te[3].key]=te[3],delete K[N])}for(const N in K){const te=this.findLoadedParent(K[N],this._source.minzoom);if(te){$[te.tileID.key]=E[te.tileID.key]=te.tileID;for(const pe in $)$[pe].isChildOf(te.tileID)&&delete $[pe]}}for(const N in this._tiles)$[N]||(this._coveredTiles[N]=!0)}}for(const A in E)this._tiles[A].clearFadeHold();const I=d.ab(this._tiles,E);for(const A of I){const z=this._tiles[A];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,o){const u={},c={},m=Math.max(o-ze.maxOverzooming,this._source.minzoom),w=Math.max(o+ze.maxUnderzooming,this._source.minzoom),b={};for(const E of t){const I=this._addTile(E);u[E.key]=E,I.hasData()||o<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,o,w,u);for(const E of t){let I=this._tiles[E.key];if(I.hasData())continue;if(o+1>this._source.maxzoom){const z=E.children(this._source.maxzoom)[0],F=this.getTile(z);if(F&&F.hasData()){u[z.key]=z;continue}}else{const z=E.children(this._source.maxzoom);if(u[z[0].key]&&u[z[1].key]&&u[z[2].key]&&u[z[3].key])continue}let A=I.wasRequested();for(let z=E.overscaledZ-1;z>=m;--z){const F=E.scaledTo(z);if(c[F.key])break;if(c[F.key]=!0,I=this.getTile(F),!I&&A&&(I=this._addTile(F)),I){const Z=I.hasData();if((A||Z)&&(u[F.key]=F),A=I.wasRequested(),Z)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let u,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}o.push(c.key);const m=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;c=m}for(const m of o)this._loadedParentTiles[m]=u}}_addTile(t){let o=this._tiles[t.key];if(o)return o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const u=o;return o||(o=new or(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(o,t.key,o.state)),o.uses++,this._tiles[t.key]=o,u||this._source.fire(new d.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=o.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,o,u){const c=[],m=this.transform;if(!m)return c;const w=u?m.getCameraQueryGeometry(t):t,b=t.map($=>m.pointCoordinate($,this.terrain)),E=w.map($=>m.pointCoordinate($,this.terrain)),I=this.getIds();let A=1/0,z=1/0,F=-1/0,Z=-1/0;for(const $ of E)A=Math.min(A,$.x),z=Math.min(z,$.y),F=Math.max(F,$.x),Z=Math.max(Z,$.y);for(let $=0;$<I.length;$++){const K=this._tiles[I[$]];if(K.holdingForFade())continue;const N=K.tileID,te=Math.pow(2,m.zoom-K.tileID.overscaledZ),pe=o*K.queryPadding*d.W/K.tileSize/te,X=[N.getTilePoint(new d.Y(A,z)),N.getTilePoint(new d.Y(F,Z))];if(X[0].x-pe<d.W&&X[0].y-pe<d.W&&X[1].x+pe>=0&&X[1].y+pe>=0){const oe=b.map(me=>N.getTilePoint(me)),fe=E.map(me=>N.getTilePoint(me));c.push({tile:K,tileID:N,queryGeometry:oe,cameraQueryGeometry:fe,scale:te})}}return c}getVisibleCoordinates(t){const o=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(dt(this._source.type)){const t=H.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=t)return!0}return!1}setFeatureState(t,o,u){this._state.updateState(t=t||"_geojsonTileLayer",o,u)}removeFeatureState(t,o,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,u)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,u){const c=this._tiles[t];c&&c.setDependencies(o,u)}reloadTilesForDependencies(t,o){for(const u in this._tiles)this._tiles[u].hasDependency(t,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,o))}}function gt(p,t){const o=Math.abs(2*p.wrap)-+(p.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||u-o||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function dt(p){return p==="raster"||p==="image"||p==="video"}ze.maxOverzooming=10,ze.maxUnderzooming=3;class Bi{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ac(t,0,1);let o=1,u=this._distances[o];const c=t*this.paddedLength+this.padding;for(;u<c&&o<this._distances.length;)u=this._distances[++o];const m=o-1,w=this._distances[m],b=u-w,E=b>0?(c-w)/b:0;return this.points[m].mult(1-E).add(this.points[o].mult(E))}}function Or(p,t){let o=!0;return p==="always"||p!=="never"&&t!=="never"||(o=!1),o}class pt{constructor(t,o,u){const c=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(o/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)c.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,u,c,m){this._forEachCell(o,u,c,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m)}insertCircle(t,o,u,c){this._forEachCell(o-c,u-c,o+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(u),this.circles.push(c)}_insertBoxCell(t,o,u,c,m,w){this.boxCells[m].push(w)}_insertCircleCell(t,o,u,c,m,w){this.circleCells[m].push(w)}_query(t,o,u,c,m,w,b){if(u<0||t>this.width||c<0||o>this.height)return[];const E=[];if(t<=0&&o<=0&&this.width<=u&&this.height<=c){if(m)return[{key:null,x1:t,y1:o,x2:u,y2:c}];for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const A=this.circles[3*I],z=this.circles[3*I+1],F=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:A-F,y1:z-F,x2:A+F,y2:z+F})}}else this._forEachCell(t,o,u,c,this._queryCell,E,{hitTest:m,overlapMode:w,seenUids:{box:{},circle:{}}},b);return E}query(t,o,u,c){return this._query(t,o,u,c,!1,null)}hitTest(t,o,u,c,m,w){return this._query(t,o,u,c,!0,m,w).length>0}hitTestCircle(t,o,u,c,m){const w=t-u,b=t+u,E=o-u,I=o+u;if(b<0||w>this.width||I<0||E>this.height)return!1;const A=[];return this._forEachCell(w,E,b,I,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:t,y:o,radius:u},seenUids:{box:{},circle:{}}},m),A.length>0}_queryCell(t,o,u,c,m,w,b,E){const{seenUids:I,hitTest:A,overlapMode:z}=b,F=this.boxCells[m];if(F!==null){const $=this.bboxes;for(const K of F)if(!I.box[K]){I.box[K]=!0;const N=4*K,te=this.boxKeys[K];if(t<=$[N+2]&&o<=$[N+3]&&u>=$[N+0]&&c>=$[N+1]&&(!E||E(te))&&(!A||!Or(z,te.overlapMode))&&(w.push({key:te,x1:$[N],y1:$[N+1],x2:$[N+2],y2:$[N+3]}),A))return!0}}const Z=this.circleCells[m];if(Z!==null){const $=this.circles;for(const K of Z)if(!I.circle[K]){I.circle[K]=!0;const N=3*K,te=this.circleKeys[K];if(this._circleAndRectCollide($[N],$[N+1],$[N+2],t,o,u,c)&&(!E||E(te))&&(!A||!Or(z,te.overlapMode))){const pe=$[N],X=$[N+1],oe=$[N+2];if(w.push({key:te,x1:pe-oe,y1:X-oe,x2:pe+oe,y2:X+oe}),A)return!0}}}return!1}_queryCellCircle(t,o,u,c,m,w,b,E){const{circle:I,seenUids:A,overlapMode:z}=b,F=this.boxCells[m];if(F!==null){const $=this.bboxes;for(const K of F)if(!A.box[K]){A.box[K]=!0;const N=4*K,te=this.boxKeys[K];if(this._circleAndRectCollide(I.x,I.y,I.radius,$[N+0],$[N+1],$[N+2],$[N+3])&&(!E||E(te))&&!Or(z,te.overlapMode))return w.push(!0),!0}}const Z=this.circleCells[m];if(Z!==null){const $=this.circles;for(const K of Z)if(!A.circle[K]){A.circle[K]=!0;const N=3*K,te=this.circleKeys[K];if(this._circlesCollide($[N],$[N+1],$[N+2],I.x,I.y,I.radius)&&(!E||E(te))&&!Or(z,te.overlapMode))return w.push(!0),!0}}}_forEachCell(t,o,u,c,m,w,b,E){const I=this._convertToXCellCoord(t),A=this._convertToYCellCoord(o),z=this._convertToXCellCoord(u),F=this._convertToYCellCoord(c);for(let Z=I;Z<=z;Z++)for(let $=A;$<=F;$++)if(m.call(this,t,o,u,c,this.xCellCount*$+Z,w,b,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,u,c,m,w){const b=c-t,E=m-o,I=u+w;return I*I>b*b+E*E}_circleAndRectCollide(t,o,u,c,m,w,b){const E=(w-c)/2,I=Math.abs(t-(c+E));if(I>E+u)return!1;const A=(b-m)/2,z=Math.abs(o-(m+A));if(z>A+u)return!1;if(I<=E||z<=A)return!0;const F=I-E,Z=z-A;return F*F+Z*Z<=u*u}}function Wn(p,t,o,u,c){const m=d.F();return t?(d.J(m,m,[1/c,1/c,1]),o||d.ad(m,m,u.angle)):d.K(m,u.labelPlaneMatrix,p),m}function An(p,t,o,u,c){if(t){const m=d.ae(p);return d.J(m,m,[c,c,1]),o||d.ad(m,m,-u.angle),m}return u.glCoordMatrix}function q(p,t,o){let u;o?(u=[p.x,p.y,o(p.x,p.y),1],d.af(u,u,t)):(u=[p.x,p.y,0,1],st(u,u,t));const c=u[3];return{point:new d.P(u[0]/c,u[1]/c),signedDistanceFromCamera:c}}function M(p,t){return .5+p/t*.5}function L(p,t){const o=p[0]/p[3],u=p[1]/p[3];return o>=-t[0]&&o<=t[0]&&u>=-t[1]&&u<=t[1]}function O(p,t,o,u,c,m,w,b,E,I){const A=u?p.textSizeData:p.iconSizeData,z=d.ag(A,o.transform.zoom),F=[256/o.width*2+1,256/o.height*2+1],Z=u?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Z.clear();const $=p.lineVertexArray,K=u?p.text.placedSymbolArray:p.icon.placedSymbolArray,N=o.transform.width/o.transform.height;let te=!1;for(let pe=0;pe<K.length;pe++){const X=K.get(pe);if(X.hidden||X.writingMode===d.ah.vertical&&!te){Ke(X.numGlyphs,Z);continue}let oe;if(te=!1,I?(oe=[X.anchorX,X.anchorY,I(X.anchorX,X.anchorY),1],d.af(oe,oe,t)):(oe=[X.anchorX,X.anchorY,0,1],st(oe,oe,t)),!L(oe,F)){Ke(X.numGlyphs,Z);continue}const fe=M(o.transform.cameraToCenterDistance,oe[3]),me=d.ai(A,z,X),ge=w?me/fe:me*fe,Pe=new d.P(X.anchorX,X.anchorY),Te=q(Pe,c,I).point,Ie={projections:{},offsets:{}},je=ne(X,ge,!1,b,t,c,m,p.glyphOffsetArray,$,Z,Te,Pe,Ie,N,E,I);te=je.useVertical,(je.notEnoughRoom||te||je.needsFlipping&&ne(X,ge,!0,b,t,c,m,p.glyphOffsetArray,$,Z,Te,Pe,Ie,N,E,I).notEnoughRoom)&&Ke(X.numGlyphs,Z)}u?p.text.dynamicLayoutVertexBuffer.updateData(Z):p.icon.dynamicLayoutVertexBuffer.updateData(Z)}function j(p,t,o,u,c,m,w,b,E,I,A,z,F){const Z=b.glyphStartIndex+b.numGlyphs,$=b.lineStartIndex,K=b.lineStartIndex+b.lineLength,N=t.getoffsetX(b.glyphStartIndex),te=t.getoffsetX(Z-1),pe=_e(p*N,o,u,c,m,w,b.segment,$,K,E,I,A,z,F);if(!pe)return null;const X=_e(p*te,o,u,c,m,w,b.segment,$,K,E,I,A,z,F);return X?{first:pe,last:X}:null}function re(p,t,o,u){return p===d.ah.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*u?{useVertical:!0}:(p===d.ah.vertical?t.y<o.y:t.x>o.x)?{needsFlipping:!0}:null}function ne(p,t,o,u,c,m,w,b,E,I,A,z,F,Z,$,K){const N=t/24,te=p.lineOffsetX*N,pe=p.lineOffsetY*N;let X;if(p.numGlyphs>1){const oe=p.glyphStartIndex+p.numGlyphs,fe=p.lineStartIndex,me=p.lineStartIndex+p.lineLength,ge=j(N,b,te,pe,o,A,z,p,E,m,F,$,K);if(!ge)return{notEnoughRoom:!0};const Pe=q(ge.first.point,w,K).point,Te=q(ge.last.point,w,K).point;if(u&&!o){const Ie=re(p.writingMode,Pe,Te,Z);if(Ie)return Ie}X=[ge.first];for(let Ie=p.glyphStartIndex+1;Ie<oe-1;Ie++)X.push(_e(N*b.getoffsetX(Ie),te,pe,o,A,z,p.segment,fe,me,E,m,F,$,K));X.push(ge.last)}else{if(u&&!o){const fe=q(z,c,K).point,me=p.lineStartIndex+p.segment+1,ge=new d.P(E.getx(me),E.gety(me)),Pe=q(ge,c,K),Te=Pe.signedDistanceFromCamera>0?Pe.point:le(z,ge,fe,1,c,K),Ie=re(p.writingMode,fe,Te,Z);if(Ie)return Ie}const oe=_e(N*b.getoffsetX(p.glyphStartIndex),te,pe,o,A,z,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,E,m,F,$,K);if(!oe)return{notEnoughRoom:!0};X=[oe]}for(const oe of X)d.aj(I,oe.point,oe.angle);return{}}function le(p,t,o,u,c,m){const w=q(p.add(p.sub(t)._unit()),c,m).point,b=o.sub(w);return o.add(b._mult(u/b.mag()))}function Q(p,t){const{projectionCache:o,lineVertexArray:u,labelPlaneMatrix:c,tileAnchorPoint:m,distanceFromAnchor:w,getElevation:b,previousVertex:E,direction:I,absOffsetX:A}=t;if(o.projections[p])return o.projections[p];const z=new d.P(u.getx(p),u.gety(p)),F=q(z,c,b);if(F.signedDistanceFromCamera>0)return o.projections[p]=F.point,F.point;const Z=p-I;return le(w===0?m:new d.P(u.getx(Z),u.gety(Z)),z,E,A-w+1,c,b)}function he(p,t,o){return p._unit()._perp()._mult(t*o)}function Ee(p,t,o,u,c,m,w,b){const{projectionCache:E,direction:I}=b;if(E.offsets[p])return E.offsets[p];const A=o.add(t);if(p+I<u||p+I>=c)return E.offsets[p]=A,A;const z=Q(p+I,b),F=he(z.sub(o),w,I),Z=o.add(F),$=z.add(F);return E.offsets[p]=d.ak(m,A,Z,$)||A,E.offsets[p]}function _e(p,t,o,u,c,m,w,b,E,I,A,z,F,Z){const $=u?p-t:p+t;let K=$>0?1:-1,N=0;u&&(K*=-1,N=Math.PI),K<0&&(N+=Math.PI);let te,pe,X=K>0?b+w:b+w+1,oe=c,fe=c,me=0,ge=0;const Pe=Math.abs($),Te=[];let Ie;for(;me+ge<=Pe;){if(X+=K,X<b||X>=E)return null;me+=ge,fe=oe,pe=te;const Fe={projectionCache:z,lineVertexArray:I,labelPlaneMatrix:A,tileAnchorPoint:m,distanceFromAnchor:me,getElevation:Z,previousVertex:fe,direction:K,absOffsetX:Pe};if(oe=Q(X,Fe),o===0)Te.push(fe),Ie=oe.sub(fe);else{let nt;const mt=oe.sub(fe);nt=mt.mag()===0?he(Q(X+K,Fe).sub(oe),o,K):he(mt,o,K),pe||(pe=fe.add(nt)),te=Ee(X,nt,oe,b,E,pe,o,Fe),Te.push(pe),Ie=te.sub(pe)}ge=Ie.mag()}const je=Ie._mult((Pe-me)/ge)._add(pe||fe),ut=N+Math.atan2(oe.y-fe.y,oe.x-fe.x);return Te.push(je),{point:je,angle:F?ut:0,path:Te}}const be=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ke(p,t){for(let o=0;o<p;o++){const u=t.length;t.resize(u+4),t.float32.set(be,3*u)}}function st(p,t,o){const u=t[0],c=t[1];return p[0]=o[0]*u+o[4]*c+o[12],p[1]=o[1]*u+o[5]*c+o[13],p[3]=o[3]*u+o[7]*c+o[15],p}const rt=100;class Et{constructor(t,o=new pt(t.width+200,t.height+200,25),u=new pt(t.width+200,t.height+200,25)){this.transform=t,this.grid=o,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+rt,this.screenBottomBoundary=t.height+rt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,o,u,c,m,w){const b=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,w),E=u*b.perspectiveRatio,I=t.x1*E+b.point.x,A=t.y1*E+b.point.y,z=t.x2*E+b.point.x,F=t.y2*E+b.point.y;return!this.isInsideGrid(I,A,z,F)||o!=="always"&&this.grid.hitTest(I,A,z,F,o,m)||b.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,A,z,F],offscreen:this.isOffscreen(I,A,z,F)}}placeCollisionCircles(t,o,u,c,m,w,b,E,I,A,z,F,Z,$){const K=[],N=new d.P(o.anchorX,o.anchorY),te=q(N,w,$),pe=M(this.transform.cameraToCenterDistance,te.signedDistanceFromCamera),X=(A?m/pe:m*pe)/d.ao,oe=q(N,b,$).point,fe=j(X,c,o.lineOffsetX*X,o.lineOffsetY*X,!1,oe,N,o,u,b,{projections:{},offsets:{}},!1,$);let me=!1,ge=!1,Pe=!0;if(fe){const Te=.5*F*pe+Z,Ie=new d.P(-100,-100),je=new d.P(this.screenRightBoundary,this.screenBottomBoundary),ut=new Bi,Fe=fe.first,nt=fe.last;let mt=[];for(let yt=Fe.path.length-1;yt>=1;yt--)mt.push(Fe.path[yt]);for(let yt=1;yt<nt.path.length;yt++)mt.push(nt.path[yt]);const bt=2.5*Te;if(E){const yt=mt.map(_t=>q(_t,E,$));mt=yt.some(_t=>_t.signedDistanceFromCamera<=0)?[]:yt.map(_t=>_t.point)}let ot=[];if(mt.length>0){const yt=mt[0].clone(),_t=mt[0].clone();for(let Jt=1;Jt<mt.length;Jt++)yt.x=Math.min(yt.x,mt[Jt].x),yt.y=Math.min(yt.y,mt[Jt].y),_t.x=Math.max(_t.x,mt[Jt].x),_t.y=Math.max(_t.y,mt[Jt].y);ot=yt.x>=Ie.x&&_t.x<=je.x&&yt.y>=Ie.y&&_t.y<=je.y?[mt]:_t.x<Ie.x||yt.x>je.x||_t.y<Ie.y||yt.y>je.y?[]:d.al([mt],Ie.x,Ie.y,je.x,je.y)}for(const yt of ot){ut.reset(yt,.25*Te);let _t=0;_t=ut.length<=.5*Te?1:Math.ceil(ut.paddedLength/bt)+1;for(let Jt=0;Jt<_t;Jt++){const Ut=Jt/Math.max(_t-1,1),cr=ut.lerp(Ut),_i=cr.x+rt,$t=cr.y+rt;K.push(_i,$t,Te,0);const qi=_i-Te,Qr=$t-Te,_n=_i+Te,Ss=$t+Te;if(Pe=Pe&&this.isOffscreen(qi,Qr,_n,Ss),ge=ge||this.isInsideGrid(qi,Qr,_n,Ss),t!=="always"&&this.grid.hitTestCircle(_i,$t,Te,t,z)&&(me=!0,!I))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!I&&me||!ge||pe<this.perspectiveRatioCutoff?[]:K,offscreen:Pe,collisionDetected:me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,c=1/0,m=-1/0,w=-1/0;for(const A of t){const z=new d.P(A.x+rt,A.y+rt);u=Math.min(u,z.x),c=Math.min(c,z.y),m=Math.max(m,z.x),w=Math.max(w,z.y),o.push(z)}const b=this.grid.query(u,c,m,w).concat(this.ignoredGrid.query(u,c,m,w)),E={},I={};for(const A of b){const z=A.key;if(E[z.bucketInstanceId]===void 0&&(E[z.bucketInstanceId]={}),E[z.bucketInstanceId][z.featureIndex])continue;const F=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(o,F)&&(E[z.bucketInstanceId][z.featureIndex]=!0,I[z.bucketInstanceId]===void 0&&(I[z.bucketInstanceId]=[]),I[z.bucketInstanceId].push(z.featureIndex))}return I}insertCollisionBox(t,o,u,c,m,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:w,overlapMode:o},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,u,c,m,w){const b=u?this.ignoredGrid:this.grid,E={bucketInstanceId:c,featureIndex:m,collisionGroupID:w,overlapMode:o};for(let I=0;I<t.length;I+=4)b.insertCircle(E,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,o,u,c){let m;return c?(m=[o,u,c(o,u),1],d.af(m,m,t)):(m=[o,u,0,1],st(m,m,t)),{point:new d.P((m[0]/m[3]+1)/2*this.transform.width+rt,(-m[1]/m[3]+1)/2*this.transform.height+rt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(t,o,u,c){return u<rt||t>=this.screenRightBoundary||c<rt||o>this.screenBottomBoundary}isInsideGrid(t,o,u,c){return u>=0&&t<this.gridRightBoundary&&c>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=d.an([]);return d.H(t,t,[-100,-100,0]),t}}function lt(p,t,o){return t*(d.W/(p.tileSize*Math.pow(2,o-p.tileID.overscaledZ)))}class Ht{constructor(t,o,u,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Nt{constructor(t,o,u,c,m){this.text=new Ht(t?t.text:null,o,u,m),this.icon=new Ht(t?t.icon:null,o,c,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ci{constructor(t,o,u){this.text=t,this.icon=o,this.skipFade=u}}class ft{constructor(){this.invProjMatrix=d.F(),this.viewportMatrix=d.F(),this.circles=[]}}class ei{constructor(t,o,u,c,m){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=m}}class Ai{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[t]}}function ar(p,t,o,u,c){const{horizontalAlign:m,verticalAlign:w}=d.at(p);return new d.P(-(m-.5)*t+u[0]*c,-(w-.5)*o+u[1]*c)}function ji(p,t,o,u,c,m){const{x1:w,x2:b,y1:E,y2:I,anchorPointX:A,anchorPointY:z}=p,F=new d.P(t,o);return u&&F._rotate(c?m:-m),{x1:w+F.x,y1:E+F.y,x2:b+F.x,y2:I+F.y,anchorPointX:A,anchorPointY:z}}class Xi{constructor(t,o,u,c,m){this.transform=t.clone(),this.terrain=o,this.collisionIndex=new Et(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ai(c),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,u,c){const m=u.getBucket(o),w=u.latestFeatureIndex;if(!m||!w||o.id!==m.layerIds[0])return;const b=u.collisionBoxArray,E=m.layers[0].layout,I=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),A=u.tileSize/d.W,z=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),F=E.get("text-pitch-alignment")==="map",Z=E.get("text-rotation-alignment")==="map",$=lt(u,1,this.transform.zoom),K=Wn(z,F,Z,this.transform,$);let N=null;if(F){const pe=An(z,F,Z,this.transform,$);N=d.K([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[m.bucketInstanceId]=new ei(m.bucketInstanceId,w,m.sourceLayerIndex,m.index,u.tileID);const te={bucket:m,layout:E,posMatrix:z,textLabelPlaneMatrix:K,labelToScreenMatrix:N,scale:I,textPixelRatio:A,holdingForFade:u.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ag(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(c)for(const pe of m.sortKeyRanges){const{sortKey:X,symbolInstanceStart:oe,symbolInstanceEnd:fe}=pe;t.push({sortKey:X,symbolInstanceStart:oe,symbolInstanceEnd:fe,parameters:te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:te})}attemptAnchorPlacement(t,o,u,c,m,w,b,E,I,A,z,F,Z,$,K,N){const te=d.ap[t.textAnchor],pe=[t.textOffset0,t.textOffset1],X=ar(te,u,c,pe,m),oe=this.collisionIndex.placeCollisionBox(ji(o,X.x,X.y,w,b,this.transform.angle),z,E,I,A.predicate,N);if((!K||this.collisionIndex.placeCollisionBox(ji(K,X.x,X.y,w,b,this.transform.angle),z,E,I,A.predicate,N).box.length!==0)&&oe.box.length>0){let fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:pe,width:u,height:c,anchor:te,textBoxScale:m,prevAnchor:fe},this.markUsedJustification(Z,te,F,$),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,$,F),this.placedOrientations[F.crossTileID]=$),{shift:X,placedGlyphBoxes:oe}}}placeLayerBucketPart(t,o,u){const{bucket:c,layout:m,posMatrix:w,textLabelPlaneMatrix:b,labelToScreenMatrix:E,textPixelRatio:I,holdingForFade:A,collisionBoxArray:z,partiallyEvaluatedTextSize:F,collisionGroup:Z}=t.parameters,$=m.get("text-optional"),K=m.get("icon-optional"),N=d.aq(m,"text-overlap","text-allow-overlap"),te=N==="always",pe=d.aq(m,"icon-overlap","icon-allow-overlap"),X=pe==="always",oe=m.get("text-rotation-alignment")==="map",fe=m.get("text-pitch-alignment")==="map",me=m.get("icon-text-fit")!=="none",ge=m.get("symbol-z-order")==="viewport-y",Pe=te&&(X||!c.hasIconData()||K),Te=X&&(te||!c.hasTextData()||$);!c.collisionArrays&&z&&c.deserializeCollisionBoxes(z);const Ie=this.retainedQueryData[c.bucketInstanceId].tileID,je=this.terrain?(Fe,nt)=>this.terrain.getElevation(Ie,Fe,nt):null,ut=(Fe,nt)=>{var mt,bt;if(o[Fe.crossTileID])return;if(A)return void(this.placements[Fe.crossTileID]=new ci(!1,!1,!1));let ot=!1,yt=!1,_t=!0,Jt=null,Ut={box:null,offscreen:null},cr={box:null,offscreen:null},_i=null,$t=null,qi=null,Qr=0,_n=0,Ss=0;nt.textFeatureIndex?Qr=nt.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(Qr=Fe.featureIndex),nt.verticalTextFeatureIndex&&(_n=nt.verticalTextFeatureIndex);const Ts=nt.textBox;if(Ts){const ii=Xt=>{let Mi=d.ah.horizontal;if(c.allowVerticalPlacement&&!Xt&&this.prevPlacement){const Ir=this.prevPlacement.placedOrientations[Fe.crossTileID];Ir&&(this.placedOrientations[Fe.crossTileID]=Ir,Mi=Ir,this.markUsedOrientation(c,Mi,Fe))}return Mi},Wt=(Xt,Mi)=>{if(c.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&nt.verticalTextBox){for(const Ir of c.writingModes)if(Ir===d.ah.vertical?(Ut=Mi(),cr=Ut):Ut=Xt(),Ut&&Ut.box&&Ut.box.length)break}else Ut=Xt()},li=Fe.textAnchorOffsetStartIndex,fo=Fe.textAnchorOffsetEndIndex;if(fo===li){const Xt=(Mi,Ir)=>{const wt=this.collisionIndex.placeCollisionBox(Mi,N,I,w,Z.predicate,je);return wt&&wt.box&&wt.box.length&&(this.markUsedOrientation(c,Ir,Fe),this.placedOrientations[Fe.crossTileID]=Ir),wt};Wt(()=>Xt(Ts,d.ah.horizontal),()=>{const Mi=nt.verticalTextBox;return c.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&Mi?Xt(Mi,d.ah.vertical):{box:null,offscreen:null}}),ii(Ut&&Ut.box&&Ut.box.length)}else{let Xt=d.ap[(bt=(mt=this.prevPlacement)===null||mt===void 0?void 0:mt.variableOffsets[Fe.crossTileID])===null||bt===void 0?void 0:bt.anchor];const Mi=(wt,Du,Ah)=>{const Es=wt.x2-wt.x1,ks=wt.y2-wt.y1,tl=Fe.textBoxScale,Lu=me&&pe==="never"?Du:null;let Is={box:[],offscreen:!1},zh=N==="never"?1:2,Ru="never";Xt&&zh++;for(let Mh=0;Mh<zh;Mh++){for(let la=li;la<fo;la++){const Dh=c.textAnchorOffsets.get(la);if(Xt&&Dh.textAnchor!==Xt)continue;const ua=this.attemptAnchorPlacement(Dh,wt,Es,ks,tl,oe,fe,I,w,Z,Ru,Fe,c,Ah,Lu,je);if(ua&&(Is=ua.placedGlyphBoxes,Is&&Is.box&&Is.box.length))return ot=!0,Jt=ua.shift,Is}Xt?Xt=null:Ru=N}return Is};Wt(()=>Mi(Ts,nt.iconBox,d.ah.horizontal),()=>{const wt=nt.verticalTextBox;return c.allowVerticalPlacement&&!(Ut&&Ut.box&&Ut.box.length)&&Fe.numVerticalGlyphVertices>0&&wt?Mi(wt,nt.verticalIconBox,d.ah.vertical):{box:null,offscreen:null}}),Ut&&(ot=Ut.box,_t=Ut.offscreen);const Ir=ii(Ut&&Ut.box);if(!ot&&this.prevPlacement){const wt=this.prevPlacement.variableOffsets[Fe.crossTileID];wt&&(this.variableOffsets[Fe.crossTileID]=wt,this.markUsedJustification(c,wt.anchor,Fe,Ir))}}}if(_i=Ut,ot=_i&&_i.box&&_i.box.length>0,_t=_i&&_i.offscreen,Fe.useRuntimeCollisionCircles){const ii=c.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex),Wt=d.ai(c.textSizeData,F,ii),li=m.get("text-padding");$t=this.collisionIndex.placeCollisionCircles(N,ii,c.lineVertexArray,c.glyphOffsetArray,Wt,w,b,E,u,fe,Z.predicate,Fe.collisionCircleDiameter,li,je),$t.circles.length&&$t.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),ot=te||$t.circles.length>0&&!$t.collisionDetected,_t=_t&&$t.offscreen}if(nt.iconFeatureIndex&&(Ss=nt.iconFeatureIndex),nt.iconBox){const ii=Wt=>{const li=me&&Jt?ji(Wt,Jt.x,Jt.y,oe,fe,this.transform.angle):Wt;return this.collisionIndex.placeCollisionBox(li,pe,I,w,Z.predicate,je)};cr&&cr.box&&cr.box.length&&nt.verticalIconBox?(qi=ii(nt.verticalIconBox),yt=qi.box.length>0):(qi=ii(nt.iconBox),yt=qi.box.length>0),_t=_t&&qi.offscreen}const vn=$||Fe.numHorizontalGlyphVertices===0&&Fe.numVerticalGlyphVertices===0,en=K||Fe.numIconVertices===0;if(vn||en?en?vn||(yt=yt&&ot):ot=yt&&ot:yt=ot=yt&&ot,ot&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,N,m.get("text-ignore-placement"),c.bucketInstanceId,cr&&cr.box&&_n?_n:Qr,Z.ID),yt&&qi&&this.collisionIndex.insertCollisionBox(qi.box,pe,m.get("icon-ignore-placement"),c.bucketInstanceId,Ss,Z.ID),$t&&(ot&&this.collisionIndex.insertCollisionCircles($t.circles,N,m.get("text-ignore-placement"),c.bucketInstanceId,Qr,Z.ID),u)){const ii=c.bucketInstanceId;let Wt=this.collisionCircleArrays[ii];Wt===void 0&&(Wt=this.collisionCircleArrays[ii]=new ft);for(let li=0;li<$t.circles.length;li+=4)Wt.circles.push($t.circles[li+0]),Wt.circles.push($t.circles[li+1]),Wt.circles.push($t.circles[li+2]),Wt.circles.push($t.collisionDetected?1:0)}if(Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fe.crossTileID]=new ci(ot||Pe,yt||Te,_t||c.justReloaded),o[Fe.crossTileID]=!0};if(ge){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fe=c.getSortedSymbolIndexes(this.transform.angle);for(let nt=Fe.length-1;nt>=0;--nt){const mt=Fe[nt];ut(c.symbolInstances.get(mt),c.collisionArrays[mt])}}else for(let Fe=t.symbolInstanceStart;Fe<t.symbolInstanceEnd;Fe++)ut(c.symbolInstances.get(Fe),c.collisionArrays[Fe]);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[c.bucketInstanceId];d.ar(Fe.invProjMatrix,w),Fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,o,u,c){let m;m=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.as(o)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const b of w)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:u.crossTileID)}markUsedOrientation(t,o,u){const c=o===d.ah.horizontal||o===d.ah.horizontalOnly?o:0,m=o===d.ah.vertical?o:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const b of w)t.text.placedSymbolArray.get(b).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const c=o?o.symbolFadeChange(t):1,m=o?o.opacities:{},w=o?o.variableOffsets:{},b=o?o.placedOrientations:{};for(const E in this.placements){const I=this.placements[E],A=m[E];A?(this.opacities[E]=new Nt(A,c,I.text,I.icon),u=u||I.text!==A.text.placed||I.icon!==A.icon.placed):(this.opacities[E]=new Nt(null,c,I.text,I.icon,I.skipFade),u=u||I.text||I.icon)}for(const E in m){const I=m[E];if(!this.opacities[E]){const A=new Nt(I,c,!1,!1);A.isHidden()||(this.opacities[E]=A,u=u||I.text.placed||I.icon.placed)}}for(const E in w)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=w[E]);for(const E in b)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=b[E]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const u={};for(const c of o){const m=c.getBucket(t);m&&c.latestFeatureIndex&&t.id===m.layerIds[0]&&this.updateBucketOpacities(m,u,c.collisionBoxArray)}}updateBucketOpacities(t,o,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],m=c.layout,w=new Nt(null,0,!1,!1,!0),b=m.get("text-allow-overlap"),E=m.get("icon-allow-overlap"),I=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=m.get("text-rotation-alignment")==="map",z=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",Z=new Nt(null,0,b&&(E||!t.hasIconData()||m.get("icon-optional")),E&&(b||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const $=(K,N,te)=>{for(let pe=0;pe<N/4;pe++)K.opacityVertexArray.emplaceBack(te);K.hasVisibleVertices=K.hasVisibleVertices||te!==$i};for(let K=0;K<t.symbolInstances.length;K++){const N=t.symbolInstances.get(K),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:pe,crossTileID:X}=N;let oe=this.opacities[X];o[X]?oe=w:oe||(oe=Z,this.opacities[X]=oe),o[X]=!0;const fe=N.numIconVertices>0,me=this.placedOrientations[N.crossTileID],ge=me===d.ah.vertical,Pe=me===d.ah.horizontal||me===d.ah.horizontalOnly;if(te>0||pe>0){const Te=Gc(oe.text);$(t.text,te,ge?$i:Te),$(t.text,pe,Pe?$i:Te);const Ie=oe.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(Fe=>{Fe>=0&&(t.text.placedSymbolArray.get(Fe).hidden=Ie||ge?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=Ie||Pe?1:0);const je=this.variableOffsets[N.crossTileID];je&&this.markUsedJustification(t,je.anchor,N,me);const ut=this.placedOrientations[N.crossTileID];ut&&(this.markUsedJustification(t,"left",N,ut),this.markUsedOrientation(t,ut,N))}if(fe){const Te=Gc(oe.icon),Ie=!(F&&N.verticalPlacedIconSymbolIndex&&ge);N.placedIconSymbolIndex>=0&&($(t.icon,N.numIconVertices,Ie?Te:$i),t.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=oe.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&($(t.icon,N.numVerticalIconVertices,Ie?$i:Te),t.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Te=t.collisionArrays[K];if(Te){let Ie=new d.P(0,0);if(Te.textBox||Te.verticalTextBox){let ut=!0;if(I){const Fe=this.variableOffsets[X];Fe?(Ie=ar(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale),A&&Ie._rotate(z?this.transform.angle:-this.transform.angle)):ut=!1}Te.textBox&&br(t.textCollisionBox.collisionVertexArray,oe.text.placed,!ut||ge,Ie.x,Ie.y),Te.verticalTextBox&&br(t.textCollisionBox.collisionVertexArray,oe.text.placed,!ut||Pe,Ie.x,Ie.y)}const je=!!(!Pe&&Te.verticalIconBox);Te.iconBox&&br(t.iconCollisionBox.collisionVertexArray,oe.icon.placed,je,F?Ie.x:0,F?Ie.y:0),Te.verticalIconBox&&br(t.iconCollisionBox.collisionVertexArray,oe.icon.placed,!je,F?Ie.x:0,F?Ie.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=K.invProjMatrix,t.placementViewportMatrix=K.viewportMatrix,t.collisionCircleArray=K.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function br(p,t,o,u,c){p.emplaceBack(t?1:0,o?1:0,u||0,c||0),p.emplaceBack(t?1:0,o?1:0,u||0,c||0),p.emplaceBack(t?1:0,o?1:0,u||0,c||0),p.emplaceBack(t?1:0,o?1:0,u||0,c||0)}const Hc=Math.pow(2,25),Tp=Math.pow(2,24),Ft=Math.pow(2,17),ql=Math.pow(2,16),Zl=Math.pow(2,9),Sr=Math.pow(2,8),Tr=Math.pow(2,1);function Gc(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,o=Math.floor(127*p.opacity);return o*Hc+t*Tp+o*Ft+t*ql+o*Zl+t*Sr+o*Tr+t}const $i=0;class Nr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,u,c,m){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(w,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((b,E)=>b.sortKey-E.sortKey));this._currentPartIndex<w.length;)if(o.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,m())return!0;return!1}}class Wc{constructor(t,o,u,c,m,w,b,E){this.placement=new Xi(t,o,w,b,E),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,o,u){const c=H.now(),m=()=>!this._forceFullPlacement&&H.now()-c>2;for(;this._currentPlacementIndex>=0;){const w=o[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=b)&&(!w.maxzoom||w.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Nr(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Kn=512/d.W/2;class yi{constructor(t,o,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let m=0;m<o.length;m++){const w=o.get(m),b=w.key,E=c.get(b);E?E.push(w):c.set(b,[w])}for(const[m,w]of c){const b={positions:w.map(E=>({x:Math.floor(E.anchorX*Kn),y:Math.floor(E.anchorY*Kn)})),crossTileIDs:w.map(E=>E.crossTileID)};if(b.positions.length>128){const E=new d.au(b.positions.length,16,Uint16Array);for(const{x:I,y:A}of b.positions)E.add(I,A);E.finish(),delete b.positions,b.index=E}this._symbolsByKey[m]=b}}getScaledCoordinates(t,o){const{x:u,y:c,z:m}=this.tileID.canonical,{x:w,y:b,z:E}=o.canonical,I=Kn/Math.pow(2,E-m),A=(b*d.W+t.anchorY)*I,z=c*d.W*Kn;return{x:Math.floor((w*d.W+t.anchorX)*I-u*d.W*Kn),y:Math.floor(A-z)}}findMatches(t,o,u){const c=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let m=0;m<t.length;m++){const w=t.get(m);if(w.crossTileID)continue;const b=this._symbolsByKey[w.key];if(!b)continue;const E=this.getScaledCoordinates(w,o);if(b.index){const I=b.index.range(E.x-c,E.y-c,E.x+c,E.y+c).sort();for(const A of I){const z=b.crossTileIDs[A];if(!u[z]){u[z]=!0,w.crossTileID=z;break}}}else if(b.positions)for(let I=0;I<b.positions.length;I++){const A=b.positions[I],z=b.crossTileIDs[I];if(Math.abs(A.x-E.x)<=c&&Math.abs(A.y-E.y)<=c&&!u[z]){u[z]=!0,w.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Zo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ps{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const u in this.indexes){const c=this.indexes[u],m={};for(const w in c){const b=c[w];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+o),m[b.tileID.key]=b}this.indexes[u]=m}this.lng=t}addBucket(t,o,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<o.symbolInstances.length;m++)o.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const w=this.indexes[m];if(Number(m)>t.overscaledZ)for(const b in w){const E=w[b];E.tileID.isChildOf(t)&&E.findMatches(o.symbolInstances,t,c)}else{const b=w[t.scaledTo(Number(m)).key];b&&b.findMatches(o.symbolInstances,t,c)}}for(let m=0;m<o.symbolInstances.length;m++){const w=o.symbolInstances.get(m);w.crossTileID||(w.crossTileID=u.generate(),c[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new yi(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const u of o.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let o=!1;for(const u in this.indexes){const c=this.indexes[u];for(const m in c)t[c[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[m]),delete c[m],o=!0)}return o}}class oi{constructor(){this.layerIndexes={},this.crossTileIDs=new Zo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,u){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new ps);let m=!1;const w={};c.handleWrapJump(u);for(const b of o){const E=b.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,E,this.crossTileIDs)&&(m=!0),w[E.bucketInstanceId]=!0)}return c.removeStaleBuckets(w)&&(m=!0),m}pruneUnusedLayers(t){const o={};t.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const fs=(p,t)=>d.t(p,t&&t.filter(o=>o.identifier!=="source.canvas")),Xr=d.av();class Ca extends d.E{constructor(t,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=t,this.dispatcher=new $s(Kr(),t._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("getImages",(u,c)=>this.getImages(u,c)),this.imageManager=new sr,this.imageManager.setEventedParent(this),this.glyphManager=new Ze(t._requestManager,o.localIdeographFontFamily),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new oi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.ax()),wr().on(Gs,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const m=c.getSource();if(m&&m.vectorLayerIds)for(const w in this._layers){const b=this._layers[w];b.source===m.id&&this._validateLayer(b)}})}loadURL(t,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const c=this.map._requestManager.transformRequest(t,ke.Style);this._loadStyleRequest=new AbortController,d.h(c,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,o,u)}).catch(m=>{this._loadStyleRequest=null,m&&this.fire(new d.j(m))})}loadJSON(t,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,H.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(t,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Xr,{validate:!1})}_load(t,o,u){var c;const m=o.transformStyle?o.transformStyle(u,t):t;if(!o.validate||!fs(this,d.x(m))){this._loaded=!0,this.stylesheet=m;for(const w in m.sources)this.addSource(w,m.sources[w],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new It(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const t=d.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of t){const u=d.az(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(t,o=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,w,b,E){return d._(this,void 0,void 0,function*(){const I=Zt(m),A=b>1?"@2x":"",z={},F={};for(const{id:Z,url:$}of I){const K=w.transformRequest(w.normalizeSpriteURL($,A,".json"),ke.SpriteJSON);z[Z]=d.h(K,E);const N=w.transformRequest(w.normalizeSpriteURL($,A,".png"),ke.SpriteImage);F[Z]=ue.getImage(N,E)}return yield Promise.all([...Object.values(z),...Object.values(F)]),function(Z,$){return d._(this,void 0,void 0,function*(){const K={};for(const N in Z){K[N]={};const te=H.getImageCanvasContext((yield $[N]).data),pe=(yield Z[N]).data;for(const X in pe){const{width:oe,height:fe,x:me,y:ge,sdf:Pe,pixelRatio:Te,stretchX:Ie,stretchY:je,content:ut}=pe[X];K[N][X]={data:null,pixelRatio:Te,sdf:Pe,stretchX:Ie,stretchY:je,content:ut,spriteData:{width:oe,height:fe,x:me,y:ge,context:te}}}}return K})}(z,F)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const w in m){this._spritesImagesIds[w]=[];const b=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(E=>!(E in m)):[];for(const E of b)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in m[w]){const I=w==="default"?E:`${w}:${E}`;this._spritesImagesIds[w].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,m[w][E],!1):this.imageManager.addImage(I,m[w][E]),o&&(this._changedImages[I]=!0)}}}).catch(m=>{this._spriteRequest=null,c=m,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(t){const o=this.sourceCaches[t.source];if(!o)return;const u=t.sourceLayer;if(!u)return;const c=o.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const o=this._serializedAllLayers();if(!t||t.length===0)return Object.values(o);const u=[];for(const c of t)o[c]&&u.push(o[c]);return u}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const c=this._layers[u];c.type!=="custom"&&(t[u]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const o=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(c.length||m.length)&&this._updateWorkerLayers(c,m);for(const w in this._updatedSources){const b=this._updatedSources[w];if(b==="reload")this._reloadSource(w);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const m=this.sourceCaches[c];u[c]=m.used,m.used=!1}for(const c of this._order){const m=this._layers[c];m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const c in u){const m=this.sourceCaches[c];u[c]!==m.used&&m.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,o&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,o={}){var u;this._checkLoaded();const c=this.serialize();if(t=o.transformStyle?o.transformStyle(c,t):t,((u=o.validate)===null||u===void 0||u)&&fs(this,d.x(t)))return!1;(t=d.aA(t)).layers=d.ay(t.layers);const m=d.aB(c,t),w=this._getOperationsToPerform(m);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const b of w.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const o=[],u=[];for(const c of t)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":o.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":o.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":o.push(()=>{});break;default:u.push(c.command)}return{operations:o,unimplemented:u}}addImage(t,o){if(this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,o),this._afterImageUpdated(t)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,o,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(d.x.source,`sources.${t}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const c=this.sourceCaches[t]=new ze(t,o,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new d.j(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],o.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,o){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,o,u={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let m;if(t.type==="custom"){if(fs(this,d.aC(t)))return;m=d.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=d.aA(t),t=d.e(t,{source:c})),this._validate(d.x.layer,`layers.${c}`,t,{arrayIndex:-1},u))return;m=d.az(t),this._validateLayer(m),m.setEventedParent(this,{layer:{id:c}})}const w=o?this._order.indexOf(o):this._order.length;if(o&&w===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${o}".`)));else{if(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._layers[c]=m,this._removedLayers[c]&&m.source&&m.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const u=this._order.indexOf(t);this._order.splice(u,1);const c=o?this._order.indexOf(o):this._order.length;o&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${t}" before non-existing layer "${o}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${t}".`)));o.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,o,u){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===o&&c.maxzoom===u||(o!=null&&(c.minzoom=o),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,o,u={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!d.aD(c.filter,o))return o==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.x.filter,`layers.${c.id}.filter`,o,null,u)||(c.filter=d.aA(o),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.aA(this.getLayer(t).filter)}setLayoutProperty(t,o,u,c={}){this._checkLoaded();const m=this.getLayer(t);m?d.aD(m.getLayoutProperty(o),u)||(m.setLayoutProperty(o,u,c),this._updateLayer(m)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,o){const u=this.getLayer(t);if(u)return u.getLayoutProperty(o);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,o,u,c={}){this._checkLoaded();const m=this.getLayer(t);m?d.aD(m.getPaintProperty(o),u)||(m.setPaintProperty(o,u,c)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,o){return this.getLayer(t).getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const u=t.source,c=t.sourceLayer,m=this.sourceCaches[u];if(m===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const w=m.getSource().type;w==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||c?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(c,t.id,o)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,o){this._checkLoaded();const u=t.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const m=c.getSource().type,w=m==="vector"?t.sourceLayer:void 0;m!=="vector"||w?o&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(w,t.id,o):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const o=t.source,u=t.sourceLayer,c=this.sourceCaches[o];if(c!==void 0)return c.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,t.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.aE(this.sourceCaches,m=>m.serialize()),o=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aF({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:o,terrain:u},m=>m!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const o=w=>this._layers[w].type==="fill-extrusion",u={},c=[];for(let w=this._order.length-1;w>=0;w--){const b=this._order[w];if(o(b)){u[b]=w;for(const E of t){const I=E[b];if(I)for(const A of I)c.push(A)}}}c.sort((w,b)=>b.intersectionZ-w.intersectionZ);const m=[];for(let w=this._order.length-1;w>=0;w--){const b=this._order[w];if(o(b))for(let E=c.length-1;E>=0;E--){const I=c[E].feature;if(u[I.layer.id]<w)break;m.push(I),c.pop()}else for(const E of t){const I=E[b];if(I)for(const A of I)m.push(A.feature)}}return m}queryRenderedFeatures(t,o,u){o&&o.filter&&this._validate(d.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const c={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const b of o.layers){const E=this._layers[b];if(!E)return this.fire(new d.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];c[E.source]=!0}}const m=[];o.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const b in this.sourceCaches)o.layers&&!c[b]||m.push(Zn(this.sourceCaches[b],this._layers,w,t,o,u));return this.placement&&m.push(function(b,E,I,A,z,F,Z){const $={},K=F.queryRenderedSymbols(A),N=[];for(const te of Object.keys(K).map(Number))N.push(Z[te]);N.sort(Hn);for(const te of N){const pe=te.featureIndex.lookupSymbolFeatures(K[te.bucketInstanceId],E,te.bucketIndex,te.sourceLayerIndex,z.filter,z.layers,z.availableImages,b);for(const X in pe){const oe=$[X]=$[X]||[],fe=pe[X];fe.sort((me,ge)=>{const Pe=te.featureSortOrder;if(Pe){const Te=Pe.indexOf(me.featureIndex);return Pe.indexOf(ge.featureIndex)-Te}return ge.featureIndex-me.featureIndex});for(const me of fe)oe.push(me)}}for(const te in $)$[te].forEach(pe=>{const X=pe.feature,oe=I[b[te].source].getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=oe});return $}(this._layers,w,this.sourceCaches,t,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,o){o&&o.filter&&this._validate(d.x.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[t];return u?function(c,m){const w=c.getRenderableIds().map(I=>c.getTileByID(I)),b=[],E={};for(let I=0;I<w.length;I++){const A=w[I],z=A.tileID.canonical.key;E[z]||(E[z]=!0,A.querySourceFeatures(b,m))}return b}(u,o):[]}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const w in t)if(!d.aD(t[w],u[w])){c=!0;break}if(!c)return;const m={now:H.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(m)}_validate(t,o,u,c,m={}){return(!m||m.validate!==!1)&&fs(this,t.call(d.x,d.e({key:o,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wr().off(Gs,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const o in this.sourceCaches)this.sourceCaches[o].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,o,u,c,m=!1){let w=!1,b=!1;const E={};for(const I of this._order){const A=this._layers[I];if(A.type!=="symbol")continue;if(!E[A.source]){const F=this.sourceCaches[A.source];E[A.source]=F.getRenderableIds(!0).map(Z=>F.getTileByID(Z)).sort((Z,$)=>$.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan($.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(A,E[A.source],t.center.lng);w=w||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(H.now(),t.zoom))&&(this.pauseablePlacement=new Wc(t,this.map.terrain,this._order,m,o,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(H.now()),b=!0),w&&this.pauseablePlacement.placement.setStale()),b||w)for(const I of this._order){const A=this._layers[I];A.type==="symbol"&&this.placement.updateLayerOpacities(A,E[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(H.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(t,o){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,o={}){this._checkLoaded(),t&&this._validate(d.x.glyphs,"glyphs",t,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,o,u={},c){this._checkLoaded();const m=[{id:t,url:o}],w=[...Zt(this.stylesheet.sprite),...m];this._validate(d.x.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(m,!0,c))}removeSprite(t){this._checkLoaded();const o=Zt(this.stylesheet.sprite);if(o.find(u=>u.id===t)){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===t),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Zt(this.stylesheet.sprite)}setSprite(t,o={},u){this._checkLoaded(),t&&this._validate(d.x.sprite,"sprite",t,null,o)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}}var fn=d.X([{name:"a_pos",type:"Int16",components:2}]),Hl="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ws={prelude:Mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Hl),terrainDepth:Mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Hl),terrainCoords:Mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Hl)};function Mt(p,t){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=m?m.concat(c):c,b={};return{fragmentSource:p=p.replace(o,(E,I,A,z,F)=>(b[F]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${z} ${F};
#else
uniform ${A} ${z} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${z} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(o,(E,I,A,z,F)=>{const Z=z==="float"?"vec2":"vec4",$=F.match(/color/)?"color":Z;return b[F]?I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${Z} a_${F};
varying ${A} ${z} ${F};
#else
uniform ${A} ${z} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${A} ${z} ${F} = u_${F};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${Z} a_${F};
#else
uniform ${A} ${z} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${z} ${F} = a_${F};
#else
    ${A} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${z} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${A} ${z} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Pa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,u,c,m,w,b,E,I){this.context=t;let A=this.boundPaintVertexBuffers.length!==c.length;for(let z=0;!A&&z<c.length;z++)this.boundPaintVertexBuffers[z]!==c[z]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==I?this.freshBind(o,u,c,m,w,b,E,I):(t.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),E&&E.bind(),I&&I.bind())}freshBind(t,o,u,c,m,w,b,E){const I=t.numAttributes,A=this.context,z=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=E,o.enableAttributes(z,t);for(const F of u)F.enableAttributes(z,t);w&&w.enableAttributes(z,t),b&&b.enableAttributes(z,t),E&&E.enableAttributes(z,t),o.bind(),o.setVertexAttribPointers(z,t,m);for(const F of u)F.bind(),F.setVertexAttribPointers(z,t,m);w&&(w.bind(),w.setVertexAttribPointers(z,t,m)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,t,m)),E&&(E.bind(),E.setVertexAttribPointers(z,t,m)),A.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function mn(p){const t=[];for(let o=0;o<p.length;o++){if(p[o]===null)continue;const u=p[o].split(" ");t.push(u.pop())}return t}class Gl{constructor(t,o,u,c,m,w){const b=t.gl;this.program=b.createProgram();const E=mn(o.staticAttributes),I=u?u.getBinderAttributes():[],A=E.concat(I),z=Ws.prelude.staticUniforms?mn(Ws.prelude.staticUniforms):[],F=o.staticUniforms?mn(o.staticUniforms):[],Z=u?u.getBinderUniforms():[],$=z.concat(F).concat(Z),K=[];for(const me of $)K.indexOf(me)<0&&K.push(me);const N=u?u.defines():[];m&&N.push("#define OVERDRAW_INSPECTOR;"),w&&N.push("#define TERRAIN3D;");const te=N.concat(Ws.prelude.fragmentSource,o.fragmentSource).join(`
`),pe=N.concat(Ws.prelude.vertexSource,o.vertexSource).join(`
`),X=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(X,te),b.compileShader(X),!b.getShaderParameter(X,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(X)}`);b.attachShader(this.program,X);const oe=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(oe,pe),b.compileShader(oe),!b.getShaderParameter(oe,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(oe)}`);b.attachShader(this.program,oe),this.attributes={};const fe={};this.numAttributes=A.length;for(let me=0;me<this.numAttributes;me++)A[me]&&(b.bindAttribLocation(this.program,me,A[me]),this.attributes[A[me]]=me);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(oe),b.deleteShader(X);for(let me=0;me<K.length;me++){const ge=K[me];if(ge&&!fe[ge]){const Pe=b.getUniformLocation(this.program,ge);Pe&&(fe[ge]=Pe)}}this.fixedUniforms=c(t,fe),this.terrainUniforms=((me,ge)=>({u_depth:new d.aG(me,ge.u_depth),u_terrain:new d.aG(me,ge.u_terrain),u_terrain_dim:new d.aH(me,ge.u_terrain_dim),u_terrain_matrix:new d.aI(me,ge.u_terrain_matrix),u_terrain_unpack:new d.aJ(me,ge.u_terrain_unpack),u_terrain_exaggeration:new d.aH(me,ge.u_terrain_exaggeration)}))(t,fe),this.binderUniforms=u?u.getUniforms(t,fe):[]}draw(t,o,u,c,m,w,b,E,I,A,z,F,Z,$,K,N,te,pe){const X=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(c),t.setColorMode(m),t.setCullFace(w),E){t.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,E.depthTexture),t.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,E.texture);for(const fe in this.terrainUniforms)this.terrainUniforms[fe].set(E[fe])}for(const fe in this.fixedUniforms)this.fixedUniforms[fe].set(b[fe]);K&&K.setUniforms(t,this.binderUniforms,Z,{zoom:$});let oe=0;switch(o){case X.LINES:oe=2;break;case X.TRIANGLES:oe=3;break;case X.LINE_STRIP:oe=1}for(const fe of F.get()){const me=fe.vaos||(fe.vaos={});(me[I]||(me[I]=new Pa)).bind(t,this,A,K?K.getPaintVertexBuffers():[],z,fe.vertexOffset,N,te,pe),X.drawElements(o,fe.primitiveLength*oe,X.UNSIGNED_SHORT,fe.primitiveOffset*oe*2)}}}function Ho(p,t,o){const u=1/lt(o,1,t.transform.tileZoom),c=Math.pow(2,o.tileID.overscaledZ),m=o.tileSize*Math.pow(2,t.transform.tileZoom)/c,w=m*(o.tileID.canonical.x+o.tileID.wrap*c),b=m*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[w>>16,b>>16],u_pixel_coord_lower:[65535&w,65535&b]}}const Kc=(p,t,o,u)=>{const c=t.style.light,m=c.properties.get("position"),w=[m.x,m.y,m.z],b=function(){var I=new d.A(9);return d.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();c.properties.get("anchor")==="viewport"&&function(I,A){var z=Math.sin(A),F=Math.cos(A);I[0]=F,I[1]=z,I[2]=0,I[3]=-z,I[4]=F,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(b,-t.transform.angle),function(I,A,z){var F=A[0],Z=A[1],$=A[2];I[0]=F*z[0]+Z*z[3]+$*z[6],I[1]=F*z[1]+Z*z[4]+$*z[7],I[2]=F*z[2]+Z*z[5]+$*z[8]}(w,w,b);const E=c.properties.get("color");return{u_matrix:p,u_lightpos:w,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+o,u_opacity:u}},Ep=(p,t,o,u,c,m,w)=>d.e(Kc(p,t,o,u),Ho(m,t,w),{u_height_factor:-Math.pow(2,c.overscaledZ)/w.tileSize/8}),Aa=p=>({u_matrix:p}),Xc=(p,t,o,u)=>d.e(Aa(p),Ho(o,t,u)),Yc=(p,t)=>({u_matrix:p,u_world:t}),kp=(p,t,o,u,c)=>d.e(Xc(p,t,o,u),{u_world:c}),Jc=(p,t,o,u)=>{const c=p.transform;let m,w;if(u.paint.get("circle-pitch-alignment")==="map"){const b=lt(o,1,c.zoom);m=!0,w=[b,b]}else m=!1,w=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:w}},Ip=(p,t,o)=>{const u=lt(o,1,t.zoom),c=Math.pow(2,t.zoom-o.tileID.overscaledZ),m=o.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*c),t.pixelsToGLUnits[1]/(u*c)],u_overscale_factor:m}},za=(p,t,o=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:o}),Wl=p=>({u_matrix:p}),Qc=(p,t,o,u)=>({u_matrix:p,u_extrude_scale:lt(t,1,o),u_intensity:u});function eh(p,t){const o=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new d.Y(0,u/o).toLngLat().lat,new d.Y(0,(u+1)/o).toLngLat().lat]}const Ma=(p,t,o,u)=>{const c=p.transform;return{u_matrix:Wo(p,t,o,u),u_ratio:1/lt(t,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ms=(p,t,o,u,c)=>d.e(Ma(p,t,o,c),{u_image:0,u_image_height:u}),Da=(p,t,o,u,c)=>{const m=p.transform,w=Go(t,m);return{u_matrix:Wo(p,t,o,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/lt(t,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Vr=(p,t,o,u,c,m)=>{const w=p.lineAtlas,b=Go(t,p.transform),E=o.layout.get("line-cap")==="round",I=w.getDash(u.from,E),A=w.getDash(u.to,E),z=I.width*c.fromScale,F=A.width*c.toScale;return d.e(Ma(p,t,o,m),{u_patternscale_a:[b/z,-I.height/2],u_patternscale_b:[b/F,-A.height/2],u_sdfgamma:w.width/(256*Math.min(z,F)*p.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:A.y,u_mix:c.t})};function Go(p,t){return 1/lt(p,1,t.tileZoom)}function Wo(p,t,o,u){return p.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Ko=(p,t,o,u,c)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(m=c.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:La(c.paint.get("raster-hue-rotate"))};var m,w};function La(p){p*=Math.PI/180;const t=Math.sin(p),o=Math.cos(p);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Xo=(p,t,o,u,c,m,w,b,E,I)=>{const A=c.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:A.width/A.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:w,u_coord_matrix:b,u_is_text:+E,u_pitch_with_map:+u,u_texsize:I,u_texture:0}},Ks=(p,t,o,u,c,m,w,b,E,I,A)=>{const z=c.transform;return d.e(Xo(p,t,o,u,c,m,w,b,E,I),{u_gamma_scale:u?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+A})},Cp=(p,t,o,u,c,m,w,b,E,I)=>d.e(Ks(p,t,o,u,c,m,w,b,!0,E,!0),{u_texsize_icon:I,u_texture_icon:1}),Pp=(p,t,o)=>({u_matrix:p,u_opacity:t,u_color:o}),th=(p,t,o,u,c,m)=>d.e(function(w,b,E,I){const A=E.imageManager.getPattern(w.from.toString()),z=E.imageManager.getPattern(w.to.toString()),{width:F,height:Z}=E.imageManager.getPixelSize(),$=Math.pow(2,I.tileID.overscaledZ),K=I.tileSize*Math.pow(2,E.transform.tileZoom)/$,N=K*(I.tileID.canonical.x+I.tileID.wrap*$),te=K*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,Z],u_mix:b.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/lt(I,1,E.transform.tileZoom),u_pixel_coord_upper:[N>>16,te>>16],u_pixel_coord_lower:[65535&N,65535&te]}}(u,m,o,c),{u_matrix:p,u_opacity:t}),Ap={fillExtrusion:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_lightpos:new d.aK(p,t.u_lightpos),u_lightintensity:new d.aH(p,t.u_lightintensity),u_lightcolor:new d.aK(p,t.u_lightcolor),u_vertical_gradient:new d.aH(p,t.u_vertical_gradient),u_opacity:new d.aH(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_lightpos:new d.aK(p,t.u_lightpos),u_lightintensity:new d.aH(p,t.u_lightintensity),u_lightcolor:new d.aK(p,t.u_lightcolor),u_vertical_gradient:new d.aH(p,t.u_vertical_gradient),u_height_factor:new d.aH(p,t.u_height_factor),u_image:new d.aG(p,t.u_image),u_texsize:new d.aL(p,t.u_texsize),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade),u_opacity:new d.aH(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_image:new d.aG(p,t.u_image),u_texsize:new d.aL(p,t.u_texsize),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_world:new d.aL(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_world:new d.aL(p,t.u_world),u_image:new d.aG(p,t.u_image),u_texsize:new d.aL(p,t.u_texsize),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_scale_with_map:new d.aG(p,t.u_scale_with_map),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_extrude_scale:new d.aL(p,t.u_extrude_scale),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_matrix:new d.aI(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new d.aH(p,t.u_pixels_to_tile_units),u_extrude_scale:new d.aL(p,t.u_extrude_scale),u_overscale_factor:new d.aH(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_inv_matrix:new d.aI(p,t.u_inv_matrix),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_viewport_size:new d.aL(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new d.aM(p,t.u_color),u_matrix:new d.aI(p,t.u_matrix),u_overlay:new d.aG(p,t.u_overlay),u_overlay_scale:new d.aH(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new d.aH(p,t.u_extrude_scale),u_intensity:new d.aH(p,t.u_intensity),u_matrix:new d.aI(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_world:new d.aL(p,t.u_world),u_image:new d.aG(p,t.u_image),u_color_ramp:new d.aG(p,t.u_color_ramp),u_opacity:new d.aH(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_image:new d.aG(p,t.u_image),u_latrange:new d.aL(p,t.u_latrange),u_light:new d.aL(p,t.u_light),u_shadow:new d.aM(p,t.u_shadow),u_highlight:new d.aM(p,t.u_highlight),u_accent:new d.aM(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_image:new d.aG(p,t.u_image),u_dimension:new d.aL(p,t.u_dimension),u_zoom:new d.aH(p,t.u_zoom),u_unpack:new d.aJ(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels),u_image:new d.aG(p,t.u_image),u_image_height:new d.aH(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_texsize:new d.aL(p,t.u_texsize),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_image:new d.aG(p,t.u_image),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels),u_patternscale_a:new d.aL(p,t.u_patternscale_a),u_patternscale_b:new d.aL(p,t.u_patternscale_b),u_sdfgamma:new d.aH(p,t.u_sdfgamma),u_image:new d.aG(p,t.u_image),u_tex_y_a:new d.aH(p,t.u_tex_y_a),u_tex_y_b:new d.aH(p,t.u_tex_y_b),u_mix:new d.aH(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_tl_parent:new d.aL(p,t.u_tl_parent),u_scale_parent:new d.aH(p,t.u_scale_parent),u_buffer_scale:new d.aH(p,t.u_buffer_scale),u_fade_t:new d.aH(p,t.u_fade_t),u_opacity:new d.aH(p,t.u_opacity),u_image0:new d.aG(p,t.u_image0),u_image1:new d.aG(p,t.u_image1),u_brightness_low:new d.aH(p,t.u_brightness_low),u_brightness_high:new d.aH(p,t.u_brightness_high),u_saturation_factor:new d.aH(p,t.u_saturation_factor),u_contrast_factor:new d.aH(p,t.u_contrast_factor),u_spin_weights:new d.aK(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new d.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aG(p,t.u_is_size_feature_constant),u_size_t:new d.aH(p,t.u_size_t),u_size:new d.aH(p,t.u_size),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pitch:new d.aH(p,t.u_pitch),u_rotate_symbol:new d.aG(p,t.u_rotate_symbol),u_aspect_ratio:new d.aH(p,t.u_aspect_ratio),u_fade_change:new d.aH(p,t.u_fade_change),u_matrix:new d.aI(p,t.u_matrix),u_label_plane_matrix:new d.aI(p,t.u_label_plane_matrix),u_coord_matrix:new d.aI(p,t.u_coord_matrix),u_is_text:new d.aG(p,t.u_is_text),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_texsize:new d.aL(p,t.u_texsize),u_texture:new d.aG(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new d.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aG(p,t.u_is_size_feature_constant),u_size_t:new d.aH(p,t.u_size_t),u_size:new d.aH(p,t.u_size),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pitch:new d.aH(p,t.u_pitch),u_rotate_symbol:new d.aG(p,t.u_rotate_symbol),u_aspect_ratio:new d.aH(p,t.u_aspect_ratio),u_fade_change:new d.aH(p,t.u_fade_change),u_matrix:new d.aI(p,t.u_matrix),u_label_plane_matrix:new d.aI(p,t.u_label_plane_matrix),u_coord_matrix:new d.aI(p,t.u_coord_matrix),u_is_text:new d.aG(p,t.u_is_text),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_texsize:new d.aL(p,t.u_texsize),u_texture:new d.aG(p,t.u_texture),u_gamma_scale:new d.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_is_halo:new d.aG(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new d.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aG(p,t.u_is_size_feature_constant),u_size_t:new d.aH(p,t.u_size_t),u_size:new d.aH(p,t.u_size),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pitch:new d.aH(p,t.u_pitch),u_rotate_symbol:new d.aG(p,t.u_rotate_symbol),u_aspect_ratio:new d.aH(p,t.u_aspect_ratio),u_fade_change:new d.aH(p,t.u_fade_change),u_matrix:new d.aI(p,t.u_matrix),u_label_plane_matrix:new d.aI(p,t.u_label_plane_matrix),u_coord_matrix:new d.aI(p,t.u_coord_matrix),u_is_text:new d.aG(p,t.u_is_text),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_texsize:new d.aL(p,t.u_texsize),u_texsize_icon:new d.aL(p,t.u_texsize_icon),u_texture:new d.aG(p,t.u_texture),u_texture_icon:new d.aG(p,t.u_texture_icon),u_gamma_scale:new d.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_is_halo:new d.aG(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_opacity:new d.aH(p,t.u_opacity),u_color:new d.aM(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_opacity:new d.aH(p,t.u_opacity),u_image:new d.aG(p,t.u_image),u_pattern_tl_a:new d.aL(p,t.u_pattern_tl_a),u_pattern_br_a:new d.aL(p,t.u_pattern_br_a),u_pattern_tl_b:new d.aL(p,t.u_pattern_tl_b),u_pattern_br_b:new d.aL(p,t.u_pattern_br_b),u_texsize:new d.aL(p,t.u_texsize),u_mix:new d.aH(p,t.u_mix),u_pattern_size_a:new d.aL(p,t.u_pattern_size_a),u_pattern_size_b:new d.aL(p,t.u_pattern_size_b),u_scale_a:new d.aH(p,t.u_scale_a),u_scale_b:new d.aH(p,t.u_scale_b),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aH(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_texture:new d.aG(p,t.u_texture),u_ele_delta:new d.aH(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ele_delta:new d.aH(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_texture:new d.aG(p,t.u_texture),u_terrain_coords_id:new d.aH(p,t.u_terrain_coords_id),u_ele_delta:new d.aH(p,t.u_ele_delta)})};class gs{constructor(t,o,u){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Er{constructor(t,o,u,c){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=c,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),t.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let u=0;u<this.attributes.length;u++){const c=o.attributes[this.attributes[u].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,o,u){for(let c=0;c<this.attributes.length;c++){const m=this.attributes[c],w=o.attributes[m.name];w!==void 0&&t.vertexAttribPointer(w,m.components,t[Ra[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yi=new WeakMap;function Xs(p){var t;if(Yi.has(p))return Yi.get(p);{const o=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Yi.set(p,o),o}}class Ct{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fa extends Ct{getDefault(){return d.aO.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Kl extends Ct{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Xl extends Ct{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ba extends Ct{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Yl extends Ct{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Jl extends Ct{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Oa extends Ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ih extends Ct{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rh extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ys extends Ct{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class zp extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class Mp extends Ct{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Dp extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Lp extends Ct{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Rp extends Ct{getDefault(){return d.aO.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fp extends Ct{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ql extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Na extends Ct{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class eu extends Ct{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class tu extends Ct{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Js extends Ct{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class nh extends Ct{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class sh extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class iu extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ys extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class oh extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Qs extends Ct{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class eo extends Ct{getDefault(){return null}set(t){var o;if(t===this.current&&!this.dirty)return;const u=this.gl;Xs(u)?u.bindVertexArray(t):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ah extends Ct{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ru extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Pt extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class to extends Ct{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Bp extends to{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class lh extends to{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yo extends to{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Op{constructor(t,o,u,c,m){this.context=t,this.width=o,this.height=u;const w=t.gl,b=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Bp(t,b),c)this.depthAttachment=m?new Yo(t,b):new lh(t,b);else if(m)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class hi{constructor(t,o,u){this.blendFunction=t,this.blendColor=o,this.mask=u}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,d.aO.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,d.aO.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],d.aO.transparent,[!0,!0,!0,!0]);class uh{constructor(t){var o,u;if(this.gl=t,this.clearColor=new Fa(this),this.clearDepth=new Kl(this),this.clearStencil=new Xl(this),this.colorMask=new Ba(this),this.depthMask=new Yl(this),this.stencilMask=new Jl(this),this.stencilFunc=new Oa(this),this.stencilOp=new ih(this),this.stencilTest=new rh(this),this.depthRange=new Ys(this),this.depthTest=new zp(this),this.depthFunc=new Mp(this),this.blend=new Dp(this),this.blendFunc=new Lp(this),this.blendColor=new Rp(this),this.blendEquation=new Fp(this),this.cullFace=new Ql(this),this.cullFaceSide=new Na(this),this.frontFace=new eu(this),this.program=new tu(this),this.activeTexture=new Js(this),this.viewport=new nh(this),this.bindFramebuffer=new sh(this),this.bindRenderbuffer=new iu(this),this.bindTexture=new ys(this),this.bindVertexBuffer=new oh(this),this.bindElementBuffer=new Qs(this),this.bindVertexArray=new eo(this),this.pixelStoreUnpack=new ah(this),this.pixelStoreUnpackPremultiplyAlpha=new ru(this),this.pixelStoreUnpackFlipY=new Pt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Xs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=t.RGBA16F)!==null&&o!==void 0?o:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new gs(this,t,o)}createVertexBuffer(t,o,u){return new Er(this,t,o,u)}createRenderbuffer(t,o,u){const c=this.gl,m=c.createRenderbuffer();return this.bindRenderbuffer.set(m),c.renderbufferStorage(c.RENDERBUFFER,t,o,u),this.bindRenderbuffer.set(null),m}createFramebuffer(t,o,u,c){return new Op(this,t,o,u,c)}clear({color:t,depth:o,stencil:u}){const c=this.gl;let m=0;t&&(m|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(m|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(m|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.aD(t.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Xs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var o;return Xs(this.gl)?this.gl.deleteVertexArray(t):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class kt{constructor(t,o,u){this.func=t,this.mask=o,this.range=u}}kt.ReadOnly=!1,kt.ReadWrite=!0,kt.disabled=new kt(519,kt.ReadOnly,[0,1]);const Jo=7680;class jt{constructor(t,o,u,c,m,w){this.test=t,this.ref=o,this.mask=u,this.fail=c,this.depthFail=m,this.pass=w}}jt.disabled=new jt({func:519,mask:0},0,0,Jo,Jo,Jo);class Vt{constructor(t,o,u){this.enable=t,this.mode=o,this.frontFace=u}}let io;function Va(p,t,o,u,c,m,w){const b=p.context,E=b.gl,I=p.useProgram("collisionBox"),A=[];let z=0,F=0;for(let X=0;X<u.length;X++){const oe=u[X],fe=t.getTile(oe),me=fe.getBucket(o);if(!me)continue;let ge=oe.posMatrix;c[0]===0&&c[1]===0||(ge=p.translatePosMatrix(oe.posMatrix,fe,c,m));const Pe=w?me.textCollisionBox:me.iconCollisionBox,Te=me.collisionCircleArray;if(Te.length>0){const Ie=d.F(),je=ge;d.aP(Ie,me.placementInvProjMatrix,p.transform.glCoordMatrix),d.aP(Ie,Ie,me.placementViewportMatrix),A.push({circleArray:Te,circleOffset:F,transform:je,invTransform:Ie,coord:oe}),z+=Te.length/4,F=z}Pe&&I.draw(b,E.LINES,kt.disabled,jt.disabled,p.colorModeForRenderPass(),Vt.disabled,Ip(ge,p.transform,fe),p.style.map.terrain&&p.style.map.terrain.getTerrainData(oe),o.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,null,p.transform.zoom,null,null,Pe.collisionVertexBuffer)}if(!w||!A.length)return;const Z=p.useProgram("collisionCircle"),$=new d.aQ;$.resize(4*z),$._trim();let K=0;for(const X of A)for(let oe=0;oe<X.circleArray.length/4;oe++){const fe=4*oe,me=X.circleArray[fe+0],ge=X.circleArray[fe+1],Pe=X.circleArray[fe+2],Te=X.circleArray[fe+3];$.emplace(K++,me,ge,Pe,Te,0),$.emplace(K++,me,ge,Pe,Te,1),$.emplace(K++,me,ge,Pe,Te,2),$.emplace(K++,me,ge,Pe,Te,3)}(!io||io.length<2*z)&&(io=function(X){const oe=2*X,fe=new d.aS;fe.resize(oe),fe._trim();for(let me=0;me<oe;me++){const ge=6*me;fe.uint16[ge+0]=4*me+0,fe.uint16[ge+1]=4*me+1,fe.uint16[ge+2]=4*me+2,fe.uint16[ge+3]=4*me+2,fe.uint16[ge+4]=4*me+3,fe.uint16[ge+5]=4*me+0}return fe}(z));const N=b.createIndexBuffer(io,!0),te=b.createVertexBuffer($,d.aR.members,!0);for(const X of A){const oe={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(pe=p.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};Z.draw(b,E.TRIANGLES,kt.disabled,jt.disabled,p.colorModeForRenderPass(),Vt.disabled,oe,p.style.map.terrain&&p.style.map.terrain.getTerrainData(X.coord),o.id,te,N,d.$.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,p.transform.zoom,null,null,null)}var pe;te.destroy(),N.destroy()}Vt.disabled=new Vt(!1,1029,2305),Vt.backCCW=new Vt(!0,1029,2305);const ch=d.an(new Float32Array(16));function Ua(p,t,o,u,c,m){const{horizontalAlign:w,verticalAlign:b}=d.at(p);return new d.P((-(w-.5)*t/c+u[0])*m,(-(b-.5)*o/c+u[1])*m)}function ja(p,t,o,u,c,m,w,b,E,I,A){const z=p.text.placedSymbolArray,F=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,$={};F.clear();for(let K=0;K<z.length;K++){const N=z.get(K),te=N.hidden||!N.crossTileID||p.allowVerticalPlacement&&!N.placedOrientation?null:u[N.crossTileID];if(te){const pe=new d.P(N.anchorX,N.anchorY),X=q(pe,o?w:m,A),oe=M(c.cameraToCenterDistance,X.signedDistanceFromCamera);let fe=d.ai(p.textSizeData,E,N)*oe/d.ao;o&&(fe*=p.tilePixelRatio/b);const{width:me,height:ge,anchor:Pe,textOffset:Te,textBoxScale:Ie}=te,je=Ua(Pe,me,ge,Te,Ie,fe),ut=o?q(pe.add(je),m,A).point:X.point.add(t?je.rotate(-c.angle):je),Fe=p.allowVerticalPlacement&&N.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let nt=0;nt<N.numGlyphs;nt++)d.aj(F,ut,Fe);I&&N.associatedIconIndex>=0&&($[N.associatedIconIndex]={shiftedAnchor:ut,angle:Fe})}else Ke(N.numGlyphs,F)}if(I){Z.clear();const K=p.icon.placedSymbolArray;for(let N=0;N<K.length;N++){const te=K.get(N);if(te.hidden)Ke(te.numGlyphs,Z);else{const pe=$[N];if(pe)for(let X=0;X<te.numGlyphs;X++)d.aj(Z,pe.shiftedAnchor,pe.angle);else Ke(te.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(F)}function nu(p,t,o){return o.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function hh(p,t,o,u,c,m,w,b,E,I,A,z){const F=p.context,Z=F.gl,$=p.transform,K=b==="map",N=E==="map",te=b!=="viewport"&&o.layout.get("symbol-placement")!=="point",pe=K&&!N&&!te,X=!o.layout.get("symbol-sort-key").isConstant();let oe=!1;const fe=p.depthModeForSublayer(0,kt.ReadOnly),me=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ge=[];for(const Pe of u){const Te=t.getTile(Pe),Ie=Te.getBucket(o);if(!Ie)continue;const je=c?Ie.text:Ie.icon;if(!je||!je.segments.get().length||!je.hasVisibleVertices)continue;const ut=je.programConfigurations.get(o.id),Fe=c||Ie.sdfIcons,nt=c?Ie.textSizeData:Ie.iconSizeData,mt=N||$.pitch!==0,bt=p.useProgram(nu(Fe,c,Ie),ut),ot=d.ag(nt,$.zoom),yt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Pe);let _t,Jt,Ut,cr,_i=[0,0],$t=null;if(c)Jt=Te.glyphAtlasTexture,Ut=Z.LINEAR,_t=Te.glyphAtlasTexture.size,Ie.iconsInText&&(_i=Te.imageAtlasTexture.size,$t=Te.imageAtlasTexture,cr=mt||p.options.rotating||p.options.zooming||nt.kind==="composite"||nt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Xt=o.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;Jt=Te.imageAtlasTexture,Ut=Fe||p.options.rotating||p.options.zooming||Xt||mt?Z.LINEAR:Z.NEAREST,_t=Te.imageAtlasTexture.size}const qi=lt(Te,1,p.transform.zoom),Qr=Wn(Pe.posMatrix,N,K,p.transform,qi),_n=An(Pe.posMatrix,N,K,p.transform,qi),Ss=me&&Ie.hasTextData(),Ts=o.layout.get("icon-text-fit")!=="none"&&Ss&&Ie.hasIconData();if(te){const Xt=p.style.map.terrain?(Ir,wt)=>p.style.map.terrain.getElevation(Pe,Ir,wt):null,Mi=o.layout.get("text-rotation-alignment")==="map";O(Ie,Pe.posMatrix,p,c,Qr,_n,N,I,Mi,Xt)}const vn=p.translatePosMatrix(Pe.posMatrix,Te,m,w),en=te||c&&me||Ts?ch:Qr,ii=p.translatePosMatrix(_n,Te,m,w,!0),Wt=Fe&&o.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let li;li=Fe?Ie.iconsInText?Cp(nt.kind,ot,pe,N,p,vn,en,ii,_t,_i):Ks(nt.kind,ot,pe,N,p,vn,en,ii,c,_t,!0):Xo(nt.kind,ot,pe,N,p,vn,en,ii,c,_t);const fo={program:bt,buffers:je,uniformValues:li,atlasTexture:Jt,atlasTextureIcon:$t,atlasInterpolation:Ut,atlasInterpolationIcon:cr,isSDF:Fe,hasHalo:Wt};if(X&&Ie.canOverlap){oe=!0;const Xt=je.segments.get();for(const Mi of Xt)ge.push({segments:new d.$([Mi]),sortKey:Mi.sortKey,state:fo,terrainData:yt})}else ge.push({segments:je.segments,sortKey:0,state:fo,terrainData:yt})}oe&&ge.sort((Pe,Te)=>Pe.sortKey-Te.sortKey);for(const Pe of ge){const Te=Pe.state;if(F.activeTexture.set(Z.TEXTURE0),Te.atlasTexture.bind(Te.atlasInterpolation,Z.CLAMP_TO_EDGE),Te.atlasTextureIcon&&(F.activeTexture.set(Z.TEXTURE1),Te.atlasTextureIcon&&Te.atlasTextureIcon.bind(Te.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Te.isSDF){const Ie=Te.uniformValues;Te.hasHalo&&(Ie.u_is_halo=1,$a(Te.buffers,Pe.segments,o,p,Te.program,fe,A,z,Ie,Pe.terrainData)),Ie.u_is_halo=0}$a(Te.buffers,Pe.segments,o,p,Te.program,fe,A,z,Te.uniformValues,Pe.terrainData)}}function $a(p,t,o,u,c,m,w,b,E,I){const A=u.context;c.draw(A,A.gl.TRIANGLES,m,w,b,Vt.disabled,E,I,o.id,p.layoutVertexBuffer,p.indexBuffer,t,o.paint,u.transform.zoom,p.programConfigurations.get(o.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function dh(p,t,o,u,c){if(!o||!u||!u.imageAtlas)return;const m=u.imageAtlas.patternPositions;let w=m[o.to.toString()],b=m[o.from.toString()];if(!w&&b&&(w=b),!b&&w&&(b=w),!w||!b){const E=c.getPaintProperty(t);w=m[E],b=m[E]}w&&b&&p.setConstantPatternPositions(w,b)}function su(p,t,o,u,c,m,w){const b=p.context.gl,E="fill-pattern",I=o.paint.get(E),A=I&&I.constantOr(1),z=o.getCrossfadeParameters();let F,Z,$,K,N;w?(Z=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=b.LINES):(Z=A?"fillPattern":"fill",F=b.TRIANGLES);const te=I.constantOr(null);for(const pe of u){const X=t.getTile(pe);if(A&&!X.patternsLoaded())continue;const oe=X.getBucket(o);if(!oe)continue;const fe=oe.programConfigurations.get(o.id),me=p.useProgram(Z,fe),ge=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe);A&&(p.context.activeTexture.set(b.TEXTURE0),X.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),fe.updatePaintBuffers(z)),dh(fe,E,te,X,o);const Pe=ge?pe:null,Te=p.translatePosMatrix(Pe?Pe.posMatrix:pe.posMatrix,X,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(w){K=oe.indexBuffer2,N=oe.segments2;const Ie=[b.drawingBufferWidth,b.drawingBufferHeight];$=Z==="fillOutlinePattern"&&A?kp(Te,p,z,X,Ie):Yc(Te,Ie)}else K=oe.indexBuffer,N=oe.segments,$=A?Xc(Te,p,z,X):Aa(Te);me.draw(p.context,F,c,p.stencilModeForClipping(pe),m,Vt.disabled,$,ge,o.id,oe.layoutVertexBuffer,K,N,o.paint,p.transform.zoom,fe)}}function ro(p,t,o,u,c,m,w){const b=p.context,E=b.gl,I="fill-extrusion-pattern",A=o.paint.get(I),z=A.constantOr(1),F=o.getCrossfadeParameters(),Z=o.paint.get("fill-extrusion-opacity"),$=A.constantOr(null);for(const K of u){const N=t.getTile(K),te=N.getBucket(o);if(!te)continue;const pe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(K),X=te.programConfigurations.get(o.id),oe=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",X);z&&(p.context.activeTexture.set(E.TEXTURE0),N.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),X.updatePaintBuffers(F)),dh(X,I,$,N,o);const fe=p.translatePosMatrix(K.posMatrix,N,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),me=o.paint.get("fill-extrusion-vertical-gradient"),ge=z?Ep(fe,p,me,Z,K,F,N):Kc(fe,p,me,Z);oe.draw(b,b.gl.TRIANGLES,c,m,w,Vt.backCCW,ge,pe,o.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,o.paint,p.transform.zoom,X,p.style.map.terrain&&te.centroidVertexBuffer)}}function ou(p,t,o,u,c,m,w){const b=p.context,E=b.gl,I=o.fbo;if(!I)return;const A=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment.get()),A.draw(b,E.TRIANGLES,c,m,w,Vt.disabled,((F,Z,$,K)=>{const N=$.paint.get("hillshade-shadow-color"),te=$.paint.get("hillshade-highlight-color"),pe=$.paint.get("hillshade-accent-color");let X=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=F.transform.angle);const oe=!F.options.moving;return{u_matrix:K?K.posMatrix:F.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),oe),u_image:0,u_latrange:eh(0,Z.tileID),u_light:[$.paint.get("hillshade-exaggeration"),X],u_shadow:N,u_highlight:te,u_accent:pe}})(p,o,u,z?t:null),z,u.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function ph(p,t,o,u,c,m){const w=p.context,b=w.gl,E=t.dem;if(E&&E.data){const I=E.dim,A=E.stride,z=E.getPixels();if(w.activeTexture.set(b.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(A),t.demTexture){const Z=t.demTexture;Z.update(z,{premultiply:!1}),Z.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else t.demTexture=new Ot(w,z,b.RGBA,{premultiply:!1}),t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);w.activeTexture.set(b.TEXTURE0);let F=t.fbo;if(!F){const Z=new Ot(w,{width:I,height:I,data:null},b.RGBA);Z.bind(b.LINEAR,b.CLAMP_TO_EDGE),F=t.fbo=w.createFramebuffer(I,I,!0,!1),F.colorAttachment.set(Z.texture)}w.bindFramebuffer.set(F.framebuffer),w.viewport.set([0,0,I,I]),p.useProgram("hillshadePrepare").draw(w,b.TRIANGLES,u,c,m,Vt.disabled,((Z,$)=>{const K=$.stride,N=d.F();return d.aN(N,0,d.W,-d.W,0,0,1),d.H(N,N,[0,-d.W,0]),{u_matrix:N,u_image:1,u_dimension:[K,K],u_zoom:Z.overscaledZ,u_unpack:$.getUnpackVector()}})(t.tileID,E),null,o.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function fh(p,t,o,u,c,m){const w=u.paint.get("raster-fade-duration");if(!m&&w>0){const b=H.now(),E=(b-p.timeAdded)/w,I=t?(b-t.timeAdded)/w:-1,A=o.getSource(),z=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),Z=F&&p.refreshedUponExpiration?1:d.ac(F?E:1-I,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const qa=new d.aO(1,0,0,1),au=new d.aO(0,1,0,1),Np=new d.aO(0,0,1,1),mh=new d.aO(1,0,1,1),ai=new d.aO(0,1,1,1);function Xn(p,t,o,u){no(p,0,t+o/2,p.transform.width,o,u)}function kr(p,t,o,u){no(p,t-o/2,0,o,p.transform.height,u)}function no(p,t,o,u,c,m){const w=p.context,b=w.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*p.pixelRatio,o*p.pixelRatio,u*p.pixelRatio,c*p.pixelRatio),w.clear({color:m}),b.disable(b.SCISSOR_TEST)}function lu(p,t,o){const u=p.context,c=u.gl,m=o.posMatrix,w=p.useProgram("debug"),b=kt.disabled,E=jt.disabled,I=p.colorModeForRenderPass(),A="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(o);u.activeTexture.set(c.TEXTURE0);const F=t.getTileByID(o.key).latestRawTileData,Z=Math.floor((F&&F.byteLength||0)/1024),$=t.getTile(o).tileSize,K=512/Math.min($,512)*(o.overscaledZ/p.transform.zoom)*.5;let N=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(N+=` => ${o.overscaledZ}`),function(te,pe){te.initDebugOverlayCanvas();const X=te.debugOverlayCanvas,oe=te.context.gl,fe=te.debugOverlayCanvas.getContext("2d");fe.clearRect(0,0,X.width,X.height),fe.shadowColor="white",fe.shadowBlur=2,fe.lineWidth=1.5,fe.strokeStyle="white",fe.textBaseline="top",fe.font="bold 36px Open Sans, sans-serif",fe.fillText(pe,5,5),fe.strokeText(pe,5,5),te.debugOverlayTexture.update(X),te.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(p,`${N} ${Z}kB`),w.draw(u,c.TRIANGLES,b,E,hi.alphaBlended,Vt.disabled,za(m,d.aO.transparent,K),null,A,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),w.draw(u,c.LINE_STRIP,b,E,I,Vt.disabled,za(m,d.aO.red),z,A,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function uu(p,t,o){const u=p.context,c=u.gl,m=p.colorModeForRenderPass(),w=new kt(c.LEQUAL,kt.ReadWrite,p.depthRangeFor3D),b=p.useProgram("terrain"),E=t.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,p.width,p.height]);for(const I of o){const A=p.renderToTexture.getTexture(I),z=t.getTerrainData(I.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const F={u_matrix:p.transform.calculatePosMatrix(I.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};b.draw(u,c.TRIANGLES,w,jt.disabled,m,Vt.backCCW,F,z,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class so{constructor(t,o){this.context=new uh(t),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ze.maxUnderzooming+ze.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new oi}resize(t,o,u){if(this.width=Math.floor(t*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,o=new d.aV;o.emplaceBack(0,0),o.emplaceBack(d.W,0),o.emplaceBack(0,d.W),o.emplaceBack(d.W,d.W),this.tileExtentBuffer=t.createVertexBuffer(o,fn.members),this.tileExtentSegments=d.$.simpleSegment(0,0,4,2);const u=new d.aV;u.emplaceBack(0,0),u.emplaceBack(d.W,0),u.emplaceBack(0,d.W),u.emplaceBack(d.W,d.W),this.debugBuffer=t.createVertexBuffer(u,fn.members),this.debugSegments=d.$.simpleSegment(0,0,4,5);const c=new d.Z;c.emplaceBack(0,0,0,0),c.emplaceBack(d.W,0,d.W,0),c.emplaceBack(0,d.W,0,d.W),c.emplaceBack(d.W,d.W,d.W,d.W),this.rasterBoundsBuffer=t.createVertexBuffer(c,Fi.members),this.rasterBoundsSegments=d.$.simpleSegment(0,0,4,2);const m=new d.aV;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,fn.members),this.viewportSegments=d.$.simpleSegment(0,0,4,2);const w=new d.aW;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const b=new d.aX;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const E=this.context.gl;this.stencilClearMode=new jt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.F();d.aN(u,0,this.width,this.height,0,0,1),d.J(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,o.TRIANGLES,kt.disabled,this.stencilClearMode,hi.disabled,Vt.disabled,Wl(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,o){if(this.currentStencilSource===t.source||!t.isTileClipped()||!o||!o.length)return;this.currentStencilSource=t.source;const u=this.context,c=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(hi.disabled),u.setDepthMode(kt.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of o){const b=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);m.draw(u,c.TRIANGLES,kt.disabled,new jt({func:c.ALWAYS,mask:0},b,255,c.KEEP,c.KEEP,c.REPLACE),hi.disabled,Vt.disabled,Wl(w.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new jt({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){const o=this.context.gl;return new jt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,u=t.sort((w,b)=>b.overscaledZ-w.overscaledZ),c=u[u.length-1].overscaledZ,m=u[0].overscaledZ-c+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const w={};for(let b=0;b<m;b++)w[b+c]=new jt({func:o.GEQUAL,mask:255},b+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=m,[w,u]}return[{[c]:jt.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new hi([t.CONSTANT_COLOR,t.ONE],new d.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}depthModeForSublayer(t,o,u){if(!this.opaquePassEnabledForLayer())return kt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new kt(u||this.context.gl.LEQUAL,o,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(H.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,m={},w={},b={};for(const E in c){const I=c[E];I.used&&I.prepare(this.context),m[E]=I.getVisibleCoordinates(),w[E]=m[E].slice().reverse(),b[E]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<u.length;E++)if(this.style._layers[u[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of u){const I=this.style._layers[E];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const A=w[I.source];(I.type==="custom"||A.length)&&this.renderLayer(this,c[I.source],I,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?d.aO.black:d.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[u[this.currentLayer]],I=c[E.source],A=m[E.source];this._renderTileClippingMasks(E,A),this.renderLayer(this,I,E,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const E=this.style._layers[u[this.currentLayer]],I=c[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const A=(E.type==="symbol"?b:w)[E.source];this._renderTileClippingMasks(E,m[E.source]),this.renderLayer(this,I,E,A)}if(this.options.showTileBoundaries){const E=function(I,A){let z=null;const F=Object.values(I._layers).flatMap(N=>N.source&&!N.isHidden(A)?[I.sourceCaches[N.source]]:[]),Z=F.filter(N=>N.getSource().type==="vector"),$=F.filter(N=>N.getSource().type!=="vector"),K=N=>{(!z||z.getSource().maxzoom<N.getSource().maxzoom)&&(z=N)};return Z.forEach(N=>K(N)),z||$.forEach(N=>K(N)),z}(this.style,this.transform.zoom);E&&function(I,A,z){for(let F=0;F<z.length;F++)lu(I,A,z[F])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const I=E.transform.padding;Xn(E,E.transform.height-(I.top||0),3,qa),Xn(E,I.bottom||0,3,au),kr(E,I.left||0,3,Np),kr(E,E.transform.width-(I.right||0),3,mh);const A=E.transform.centerPoint;(function(z,F,Z,$){no(z,F-1,Z-10,2,20,$),no(z,F-10,Z-1,20,2,$)})(E,A.x,E.transform.height-A.y,ai)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.projMatrix;let c=this.terrainFacilitator.dirty;c||(c=t?!d.aY(o,u):!d.aZ(o,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.a_(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,w){const b=m.context,E=b.gl,I=hi.unblended,A=new kt(E.LEQUAL,kt.ReadWrite,[0,1]),z=w.getTerrainMesh(),F=w.sourceCache.getRenderableTiles(),Z=m.useProgram("terrainDepth");b.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.aO.transparent,depth:1});for(const $ of F){const K=w.getTerrainData($.tileID),N={u_matrix:m.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(m.transform.zoom)};Z.draw(b,E.TRIANGLES,A,jt.disabled,I,Vt.backCCW,N,K,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,w){const b=m.context,E=b.gl,I=hi.unblended,A=new kt(E.LEQUAL,kt.ReadWrite,[0,1]),z=w.getTerrainMesh(),F=w.getCoordsTexture(),Z=w.sourceCache.getRenderableTiles(),$=m.useProgram("terrainCoords");b.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.aO.transparent,depth:1}),w.coordsIndex=[];for(const K of Z){const N=w.getTerrainData(K.tileID);b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,F.texture);const te={u_matrix:m.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(m.transform.zoom)};$.draw(b,E.TRIANGLES,A,jt.disabled,I,Vt.backCCW,te,N,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),w.coordsIndex.push(K.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(t,o,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(m,w,b,E,I){if(m.renderPass!=="translucent")return;const A=jt.disabled,z=m.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,Z,$,K,N,te,pe){const X=Z.transform,oe=N==="map",fe=te==="map";for(const me of F){const ge=K.getTile(me),Pe=ge.getBucket($);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;const Te=d.ag(Pe.textSizeData,X.zoom),Ie=lt(ge,1,Z.transform.zoom),je=Wn(me.posMatrix,fe,oe,Z.transform,Ie),ut=$.layout.get("icon-text-fit")!=="none"&&Pe.hasIconData();if(Te){const Fe=Math.pow(2,X.zoom-ge.tileID.overscaledZ);ja(Pe,oe,fe,pe,X,je,me.posMatrix,Fe,Te,ut,Z.style.map.terrain?(nt,mt)=>Z.style.map.terrain.getElevation(me,nt,mt):null)}}}(E,m,b,w,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),I),b.paint.get("icon-opacity").constantOr(1)!==0&&hh(m,w,b,E,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),A,z),b.paint.get("text-opacity").constantOr(1)!==0&&hh(m,w,b,E,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),A,z),w.map.showCollisionBoxes&&(Va(m,w,b,E,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),!0),Va(m,w,b,E,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),!1))})(t,o,u,c,this.style.placement.variableOffsets);break;case"circle":(function(m,w,b,E){if(m.renderPass!=="translucent")return;const I=b.paint.get("circle-opacity"),A=b.paint.get("circle-stroke-width"),z=b.paint.get("circle-stroke-opacity"),F=!b.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(A.constantOr(1)===0||z.constantOr(1)===0))return;const Z=m.context,$=Z.gl,K=m.depthModeForSublayer(0,kt.ReadOnly),N=jt.disabled,te=m.colorModeForRenderPass(),pe=[];for(let X=0;X<E.length;X++){const oe=E[X],fe=w.getTile(oe),me=fe.getBucket(b);if(!me)continue;const ge=me.programConfigurations.get(b.id),Pe=m.useProgram("circle",ge),Te=me.layoutVertexBuffer,Ie=me.indexBuffer,je=m.style.map.terrain&&m.style.map.terrain.getTerrainData(oe),ut={programConfiguration:ge,program:Pe,layoutVertexBuffer:Te,indexBuffer:Ie,uniformValues:Jc(m,oe,fe,b),terrainData:je};if(F){const Fe=me.segments.get();for(const nt of Fe)pe.push({segments:new d.$([nt]),sortKey:nt.sortKey,state:ut})}else pe.push({segments:me.segments,sortKey:0,state:ut})}F&&pe.sort((X,oe)=>X.sortKey-oe.sortKey);for(const X of pe){const{programConfiguration:oe,program:fe,layoutVertexBuffer:me,indexBuffer:ge,uniformValues:Pe,terrainData:Te}=X.state;fe.draw(Z,$.TRIANGLES,K,N,te,Vt.disabled,Pe,Te,b.id,me,ge,X.segments,b.paint,m.transform.zoom,oe)}})(t,o,u,c);break;case"heatmap":(function(m,w,b,E){if(b.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const I=m.context,A=I.gl,z=jt.disabled,F=new hi([A.ONE,A.ONE],d.aO.transparent,[!0,!0,!0,!0]);(function(Z,$,K){const N=Z.gl;Z.activeTexture.set(N.TEXTURE1),Z.viewport.set([0,0,$.width/4,$.height/4]);let te=K.heatmapFbo;if(te)N.bindTexture(N.TEXTURE_2D,te.colorAttachment.get()),Z.bindFramebuffer.set(te.framebuffer);else{const pe=N.createTexture();N.bindTexture(N.TEXTURE_2D,pe),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),te=K.heatmapFbo=Z.createFramebuffer($.width/4,$.height/4,!1,!1),function(X,oe,fe,me){var ge,Pe;const Te=X.gl,Ie=(ge=X.HALF_FLOAT)!==null&&ge!==void 0?ge:Te.UNSIGNED_BYTE,je=(Pe=X.RGBA16F)!==null&&Pe!==void 0?Pe:Te.RGBA;Te.texImage2D(Te.TEXTURE_2D,0,je,oe.width/4,oe.height/4,0,Te.RGBA,Ie,null),me.colorAttachment.set(fe)}(Z,$,pe,te)}})(I,m,b),I.clear({color:d.aO.transparent});for(let Z=0;Z<E.length;Z++){const $=E[Z];if(w.hasRenderableParent($))continue;const K=w.getTile($),N=K.getBucket(b);if(!N)continue;const te=N.programConfigurations.get(b.id),pe=m.useProgram("heatmap",te),{zoom:X}=m.transform;pe.draw(I,A.TRIANGLES,kt.disabled,z,F,Vt.disabled,Qc($.posMatrix,K,X,b.paint.get("heatmap-intensity")),null,b.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,b.paint,m.transform.zoom,te)}I.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(I,A){const z=I.context,F=z.gl,Z=A.heatmapFbo;if(!Z)return;z.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,Z.colorAttachment.get()),z.activeTexture.set(F.TEXTURE1);let $=A.colorRampTexture;$||($=A.colorRampTexture=new Ot(z,A.colorRamp,F.RGBA)),$.bind(F.LINEAR,F.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(z,F.TRIANGLES,kt.disabled,jt.disabled,I.colorModeForRenderPass(),Vt.disabled,((K,N,te,pe)=>{const X=d.F();d.aN(X,0,K.width,K.height,0,0,1);const oe=K.context.gl;return{u_matrix:X,u_world:[oe.drawingBufferWidth,oe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(I,A),null,A.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,A.paint,I.transform.zoom)}(m,b))})(t,o,u,c);break;case"line":(function(m,w,b,E){if(m.renderPass!=="translucent")return;const I=b.paint.get("line-opacity"),A=b.paint.get("line-width");if(I.constantOr(1)===0||A.constantOr(1)===0)return;const z=m.depthModeForSublayer(0,kt.ReadOnly),F=m.colorModeForRenderPass(),Z=b.paint.get("line-dasharray"),$=b.paint.get("line-pattern"),K=$.constantOr(1),N=b.paint.get("line-gradient"),te=b.getCrossfadeParameters(),pe=K?"linePattern":Z?"lineSDF":N?"lineGradient":"line",X=m.context,oe=X.gl;let fe=!0;for(const me of E){const ge=w.getTile(me);if(K&&!ge.patternsLoaded())continue;const Pe=ge.getBucket(b);if(!Pe)continue;const Te=Pe.programConfigurations.get(b.id),Ie=m.context.program.get(),je=m.useProgram(pe,Te),ut=fe||je.program!==Ie,Fe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(me),nt=$.constantOr(null);if(nt&&ge.imageAtlas){const ot=ge.imageAtlas,yt=ot.patternPositions[nt.to.toString()],_t=ot.patternPositions[nt.from.toString()];yt&&_t&&Te.setConstantPatternPositions(yt,_t)}const mt=Fe?me:null,bt=K?Da(m,ge,b,te,mt):Z?Vr(m,ge,b,Z,te,mt):N?ms(m,ge,b,Pe.lineClipsArray.length,mt):Ma(m,ge,b,mt);if(K)X.activeTexture.set(oe.TEXTURE0),ge.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Te.updatePaintBuffers(te);else if(Z&&(ut||m.lineAtlas.dirty))X.activeTexture.set(oe.TEXTURE0),m.lineAtlas.bind(X);else if(N){const ot=Pe.gradients[b.id];let yt=ot.texture;if(b.gradientVersion!==ot.version){let _t=256;if(b.stepInterpolant){const Jt=w.getSource().maxzoom,Ut=me.canonical.z===Jt?Math.ceil(1<<m.transform.maxZoom-me.canonical.z):1;_t=d.ac(d.aT(Pe.maxLineLength/d.W*1024*Ut),256,X.maxTextureSize)}ot.gradient=d.aU({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:ot.gradient||void 0,clips:Pe.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new Ot(X,ot.gradient,oe.RGBA),ot.version=b.gradientVersion,yt=ot.texture}X.activeTexture.set(oe.TEXTURE0),yt.bind(b.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}je.draw(X,oe.TRIANGLES,z,m.stencilModeForClipping(me),F,Vt.disabled,bt,Fe,b.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,b.paint,m.transform.zoom,Te,Pe.layoutVertexBuffer2),fe=!1}})(t,o,u,c);break;case"fill":(function(m,w,b,E){const I=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const z=m.colorModeForRenderPass(),F=b.paint.get("fill-pattern"),Z=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&I.constantOr(d.aO.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===Z){const $=m.depthModeForSublayer(1,m.renderPass==="opaque"?kt.ReadWrite:kt.ReadOnly);su(m,w,b,E,$,z,!1)}if(m.renderPass==="translucent"&&b.paint.get("fill-antialias")){const $=m.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,kt.ReadOnly);su(m,w,b,E,$,z,!0)}})(t,o,u,c);break;case"fill-extrusion":(function(m,w,b,E){const I=b.paint.get("fill-extrusion-opacity");if(I!==0&&m.renderPass==="translucent"){const A=new kt(m.context.gl.LEQUAL,kt.ReadWrite,m.depthRangeFor3D);if(I!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))ro(m,w,b,E,A,jt.disabled,hi.disabled),ro(m,w,b,E,A,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const z=m.colorModeForRenderPass();ro(m,w,b,E,A,jt.disabled,z)}}})(t,o,u,c);break;case"hillshade":(function(m,w,b,E){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const I=m.context,A=m.depthModeForSublayer(0,kt.ReadOnly),z=m.colorModeForRenderPass(),[F,Z]=m.renderPass==="translucent"?m.stencilConfigForOverlap(E):[{},E];for(const $ of Z){const K=w.getTile($);K.needsHillshadePrepare!==void 0&&K.needsHillshadePrepare&&m.renderPass==="offscreen"?ph(m,K,b,A,jt.disabled,z):m.renderPass==="translucent"&&ou(m,$,K,b,A,F[$.overscaledZ],z)}I.viewport.set([0,0,m.width,m.height])})(t,o,u,c);break;case"raster":(function(m,w,b,E){if(m.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!E.length)return;const I=m.context,A=I.gl,z=w.getSource(),F=m.useProgram("raster"),Z=m.colorModeForRenderPass(),[$,K]=z instanceof pn?[{},E]:m.stencilConfigForOverlap(E),N=K[K.length-1].overscaledZ,te=!m.options.moving;for(const pe of K){const X=m.depthModeForSublayer(pe.overscaledZ-N,b.paint.get("raster-opacity")===1?kt.ReadWrite:kt.ReadOnly,A.LESS),oe=w.getTile(pe);oe.registerFadeDuration(b.paint.get("raster-fade-duration"));const fe=w.findLoadedParent(pe,0),me=fh(oe,fe,w,b,m.transform,m.style.map.terrain);let ge,Pe;const Te=b.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),oe.texture.bind(Te,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(A.TEXTURE1),fe?(fe.texture.bind(Te,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ge=Math.pow(2,fe.tileID.overscaledZ-oe.tileID.overscaledZ),Pe=[oe.tileID.canonical.x*ge%1,oe.tileID.canonical.y*ge%1]):oe.texture.bind(Te,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const Ie=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pe),je=Ie?pe:null,ut=je?je.posMatrix:m.transform.calculatePosMatrix(pe.toUnwrapped(),te),Fe=Ko(ut,Pe||[0,0],ge||1,me,b);z instanceof pn?F.draw(I,A.TRIANGLES,X,jt.disabled,Z,Vt.disabled,Fe,Ie,b.id,z.boundsBuffer,m.quadTriangleIndexBuffer,z.boundsSegments):F.draw(I,A.TRIANGLES,X,$[pe.overscaledZ],Z,Vt.disabled,Fe,Ie,b.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(t,o,u,c);break;case"background":(function(m,w,b,E){const I=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const z=m.context,F=z.gl,Z=m.transform,$=Z.tileSize,K=b.paint.get("background-pattern");if(m.isPatternMissing(K))return;const N=!K&&I.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==N)return;const te=jt.disabled,pe=m.depthModeForSublayer(0,N==="opaque"?kt.ReadWrite:kt.ReadOnly),X=m.colorModeForRenderPass(),oe=m.useProgram(K?"backgroundPattern":"background"),fe=E||Z.coveringTiles({tileSize:$,terrain:m.style.map.terrain});K&&(z.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context));const me=b.getCrossfadeParameters();for(const ge of fe){const Pe=E?ge.posMatrix:m.transform.calculatePosMatrix(ge.toUnwrapped()),Te=K?th(Pe,A,m,K,{tileID:ge,tileSize:$},me):Pp(Pe,A,I),Ie=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge);oe.draw(z,F.TRIANGLES,pe,te,X,Vt.disabled,Te,Ie,b.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(t,0,u,c);break;case"custom":(function(m,w,b){const E=m.context,I=b.implementation;if(m.renderPass==="offscreen"){const A=I.prerender;A&&(m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),A.call(I,E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),E.setStencilMode(jt.disabled);const A=I.renderingMode==="3d"?new kt(m.context.gl.LEQUAL,kt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,kt.ReadOnly);E.setDepthMode(A),I.render(E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState(),E.bindFramebuffer.set(null)}})(t,0,u)}}translatePosMatrix(t,o,u,c,m){if(!u[0]&&!u[1])return t;const w=m?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(w){const I=Math.sin(w),A=Math.cos(w);u=[u[0]*A-u[1]*I,u[0]*I+u[1]*A]}const b=[m?u[0]:lt(o,u[0],this.transform.zoom),m?u[1]:lt(o,u[1],this.transform.zoom),0],E=new Float32Array(16);return d.H(E,t,b),E}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!o||!u}useProgram(t,o){this.cache=this.cache||{};const u=t+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Gl(this.context,Ws[t],o,Ap[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ot(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:o}=this.context.gl;return this.width!==t||this.height!==o}}class _s{constructor(t,o){this.points=t,this.planes=o}static fromInvProjectionMatrix(t,o,u){const c=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const E=1/(b=d.af([],b,t))[3]/o*c;return d.a$(b,b,[E,E,1/b[3],E])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const E=function(F,Z){var $=Z[0],K=Z[1],N=Z[2],te=$*$+K*K+N*N;return te>0&&(te=1/Math.sqrt(te)),F[0]=Z[0]*te,F[1]=Z[1]*te,F[2]=Z[2]*te,F}([],function(F,Z,$){var K=Z[0],N=Z[1],te=Z[2],pe=$[0],X=$[1],oe=$[2];return F[0]=N*oe-te*X,F[1]=te*pe-K*oe,F[2]=K*X-N*pe,F}([],Rt([],m[b[0]],m[b[1]]),Rt([],m[b[2]],m[b[1]]))),I=-((A=E)[0]*(z=m[b[1]])[0]+A[1]*z[1]+A[2]*z[2]);var A,z;return E.concat(I)});return new _s(m,w)}}class oo{constructor(t,o){this.min=t,this.max=o,this.center=function(u,c,m){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,m){return u[0]=c[0]+m[0],u[1]=c[1]+m[1],u[2]=c[2]+m[2],u}([],this.min,this.max))}quadrant(t){const o=[t%2==0,t<2],u=Ge(this.min),c=Ge(this.max);for(let m=0;m<o.length;m++)u[m]=o[m]?this.min[m]:this.center[m],c[m]=o[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new oo(u,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<t.planes.length;c++){const m=t.planes[c];let w=0;for(let b=0;b<o.length;b++)d.b0(m,o[b])>=0&&w++;if(w===0)return 0;w!==o.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let m=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const E=t.points[b][c]-this.min[c];m=Math.min(m,E),w=Math.max(w,E)}if(w<0||m>this.max[c]-this.min[c])return 0}return 1}}class Qo{constructor(t=0,o=0,u=0,c=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=u,this.right=c}interpolate(t,o,u){return o.top!=null&&t.top!=null&&(this.top=d.z.number(t.top,o.top,u)),o.bottom!=null&&t.bottom!=null&&(this.bottom=d.z.number(t.bottom,o.bottom,u)),o.left!=null&&t.left!=null&&(this.left=d.z.number(t.left,o.left,u)),o.right!=null&&t.right!=null&&(this.right=d.z.number(t.right,o.right,u)),this}getCenter(t,o){const u=d.ac((this.left+t-this.right)/2,0,t),c=d.ac((this.top+o-this.bottom)/2,0,o);return new d.P(u,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Qo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const cu=85.051129;class Za{constructor(t,o,u,c,m){this.tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new Za(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const o=-d.b1(t,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,m){var w=c[0],b=c[1],E=c[2],I=c[3],A=Math.sin(m),z=Math.cos(m);u[0]=w*z+E*A,u[1]=b*z+I*A,u[2]=w*-A+E*z,u[3]=b*-A+I*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=d.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,u){this._unmodified=!1,this._edgeInsets.interpolate(t,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new d.b2(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),m=this.pointCoordinate(new d.P(this.width,this.height)),w=this.pointCoordinate(new d.P(0,this.height)),b=Math.floor(Math.min(u.x,c.x,m.x,w.x)),E=Math.floor(Math.max(u.x,c.x,m.x,w.x)),I=1;for(let A=b-I;A<=E+I;A++)A!==0&&o.push(new d.b2(A,t))}return o}coveringTiles(t){var o,u;let c=this.coveringZoomLevel(t);const m=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),b=d.Y.fromLngLat(this.center),E=Math.pow(2,c),I=[E*w.x,E*w.y,0],A=[E*b.x,E*b.y,0],z=_s.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let F=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);const Z=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,$=X=>({aabb:new oo([X*E,0,0],[(X+1)*E,E,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),K=[],N=[],te=c,pe=t.reparseOverscaled?m:c;if(this._renderWorldCopies)for(let X=1;X<=3;X++)K.push($(-X)),K.push($(X));for(K.push($(0));K.length>0;){const X=K.pop(),oe=X.x,fe=X.y;let me=X.fullyVisible;if(!me){const je=X.aabb.intersects(z);if(je===0)continue;me=je===2}const ge=t.terrain?I:A,Pe=X.aabb.distanceX(ge),Te=X.aabb.distanceY(ge),Ie=Math.max(Math.abs(Pe),Math.abs(Te));if(X.zoom===te||Ie>Z+(1<<te-X.zoom)-2&&X.zoom>=F){const je=te-X.zoom,ut=I[0]-.5-(oe<<je),Fe=I[1]-.5-(fe<<je);N.push({tileID:new d.Q(X.zoom===te?pe:X.zoom,X.wrap,X.zoom,oe,fe),distanceSq:xt([A[0]-.5-oe,A[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(ut*ut+Fe*Fe)})}else for(let je=0;je<4;je++){const ut=(oe<<1)+je%2,Fe=(fe<<1)+(je>>1),nt=X.zoom+1;let mt=X.aabb.quadrant(je);if(t.terrain){const bt=new d.Q(nt,X.wrap,nt,ut,Fe),ot=t.terrain.getMinMaxElevation(bt),yt=(o=ot.minElevation)!==null&&o!==void 0?o:this.elevation,_t=(u=ot.maxElevation)!==null&&u!==void 0?u:this.elevation;mt=new oo([mt.min[0],mt.min[1],yt],[mt.max[0],mt.max[1],_t])}K.push({aabb:mt,zoom:nt,x:ut,y:Fe,wrap:X.wrap,fullyVisible:me})}}return N.sort((X,oe)=>X.distanceSq-oe.distanceSq).map(X=>X.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=d.ac(t.lat,-85.051129,cu);return new d.P(d.N(t.lng)*this.worldSize,d.O(o)*this.worldSize)}unproject(t){return new d.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,t),m=t.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-m))return;const w=u+o-m,b=Math.cos(this._pitch)*this.cameraToCenterDistance/w/d.b3(1,c.lat),E=this.scaleZoom(b/this.tileSize);this._elevation=m,this._center=c,this.zoom=E}setLocationAtPoint(t,o){const u=this.pointCoordinate(o),c=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(t),w=new d.Y(m.x-(u.x-c.x),m.y-(u.y-c.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,o){return o?this.coordinatePoint(this.locationCoordinate(t),o.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,o){return this.coordinateLocation(this.pointCoordinate(t,o))}locationCoordinate(t){return d.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,o){if(o){const F=o.pointCoordinate(t);if(F!=null)return F}const u=[t.x,t.y,0,1],c=[t.x,t.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const m=u[3],w=c[3],b=u[1]/m,E=c[1]/w,I=u[2]/m,A=c[2]/w,z=I===A?0:(0-I)/(A-I);return new d.Y(d.z.number(u[0]/m,c[0]/w,z)/this.worldSize,d.z.number(b,E,z)/this.worldSize)}coordinatePoint(t,o=0,u=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,o,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new wi().extend(this.pointLocation(new d.P(0,t))).extend(this.pointLocation(new d.P(this.width,t))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new wi([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,cu])}calculatePosMatrix(t,o=!1){const u=t.key,c=o?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const m=t.canonical,w=this.worldSize/this.zoomScale(m.z),b=m.x+Math.pow(2,m.z)*t.wrap,E=d.an(new Float64Array(16));return d.H(E,E,[b*w,m.y*w,0]),d.J(E,E,[w/d.W,w/d.W,1]),d.K(E,o?this.alignedProjMatrix:this.projMatrix,E),c[u]=new Float32Array(E),c[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,o){o=d.ac(+o,this.minZoom,this.maxZoom);const u={center:new d.M(t.lng,t.lat),zoom:o};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const X=179.9999999999;c=[-X,X]}const m=this.tileSize*this.zoomScale(u.zoom);let w=0,b=m,E=0,I=m,A=0,z=0;const{x:F,y:Z}=this.size;if(this.latRange){const X=this.latRange;w=d.O(X[1])*m,b=d.O(X[0])*m,b-w<Z&&(A=Z/(b-w))}c&&(E=d.b1(d.N(c[0])*m,0,m),I=d.b1(d.N(c[1])*m,0,m),I<E&&(I+=m),I-E<F&&(z=F/(I-E)));const{x:$,y:K}=this.project.call({worldSize:m},t);let N,te;const pe=Math.max(z||0,A||0);if(pe){const X=new d.P(z?(I+E)/2:$,A?(b+w)/2:K);return u.center=this.unproject.call({worldSize:m},X).wrap(),u.zoom+=this.scaleZoom(pe),u}if(this.latRange){const X=Z/2;K-X<w&&(te=w+X),K+X>b&&(te=b-X)}if(c){const X=(E+I)/2;let oe=$;this._renderWorldCopies&&(oe=d.b1($,X-m/2,X+m/2));const fe=F/2;oe-fe<E&&(N=E+fe),oe+fe>I&&(N=I-fe)}if(N!==void 0||te!==void 0){const X=new d.P(N??$,te??K);u.center=this.unproject.call({worldSize:m},X).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b3(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.J(c,c,[this.width/2,-this.height/2,1]),d.H(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.J(c,c,[1,-1,1]),d.H(c,c,[-1,-1,0]),d.J(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),b=m-w*this._pixelPerMeter/Math.cos(this._pitch),E=w<0?b:m,I=Math.PI/2+this._pitch,A=this._fov*(.5+t.y/this.height),z=Math.sin(A)*E/Math.sin(d.ac(Math.PI-I-A,.01,Math.PI-.01)),F=this.getHorizon(),Z=2*Math.atan(F/this.cameraToCenterDistance)*(.5+t.y/(2*F)),$=Math.sin(Z)*E/Math.sin(d.ac(Math.PI-I-Z,.01,Math.PI-.01)),K=Math.min(z,$),N=1.01*(Math.cos(Math.PI/2-this._pitch)*K+E),te=this.height/50;c=new Float64Array(16),d.b4(c,this._fov,this.width/this.height,te,N),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,d.J(c,c,[1,-1,1]),d.H(c,c,[0,0,-this.cameraToCenterDistance]),d.b5(c,c,this._pitch),d.ad(c,c,this.angle),d.H(c,c,[-o,-u,0]),this.mercatorMatrix=d.J([],c,[this.worldSize,this.worldSize,this.worldSize]),d.J(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.K(new Float64Array(16),this.labelPlaneMatrix,c),d.H(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=d.ar([],c),this.pixelMatrix3D=d.K(new Float64Array(16),this.labelPlaneMatrix,c);const pe=this.width%2/2,X=this.height%2/2,oe=Math.cos(this.angle),fe=Math.sin(this.angle),me=o-Math.round(o)+oe*pe+fe*X,ge=u-Math.round(u)+oe*X+fe*pe,Pe=new Float64Array(c);if(d.H(Pe,Pe,[me>.5?me-1:me,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=Pe,c=d.ar(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new d.P(0,0)),o=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,t))}getCameraQueryGeometry(t){const o=this.getCameraPoint();if(t.length===1)return[t[0],o];{let u=o.x,c=o.y,m=o.x,w=o.y;for(const b of t)u=Math.min(u,b.x),c=Math.min(c,b.y),m=Math.max(m,b.x),w=Math.max(w,b.y);return[new d.P(u,c),new d.P(m,c),new d.P(m,w),new d.P(u,w),new d.P(u,c)]}}lngLatToCameraDepth(t,o){const u=this.locationCoordinate(t),c=[u.x*this.worldSize,u.y*this.worldSize,o,1];return d.af(c,c,this.projMatrix),c[2]/c[3]}}function hu(p,t){let o,u=!1,c=null,m=null;const w=()=>{c=null,u&&(p.apply(m,o),c=setTimeout(w,t),u=!1)};return(...b)=>(u=!0,m=this,o=b,c||w(),c)}class du{constructor(t){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=hu(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,c),w=Math.round(o.lng*m)/m,b=Math.round(o.lat*m)/m,E=this._map.getBearing(),I=this._map.getPitch();let A="";if(A+=t?`/${w}/${b}/${u}`:`${u}/${b}/${w}`,(E||I)&&(A+="/"+Math.round(10*E)/10),I&&(A+=`/${Math.round(I)}`),this._hashName){const z=this._hashName;let F=!1;const Z=window.location.hash.slice(1).split("&").map($=>{const K=$.split("=")[0];return K===z?(F=!0,`${K}=${A}`):$}).filter($=>$);return F||Z.push(`${z}=${A}`),`#${Z.join("&")}`}return`#${A}`}}const gn={linearity:.3,easing:d.b6(0,0,.3,1)},gh=d.e({deceleration:2500,maxSpeed:1400},gn),yh=d.e({deceleration:20,maxSpeed:1400},gn),_h=d.e({deceleration:1e3,maxSpeed:360},gn),vh=d.e({deceleration:1e3,maxSpeed:90},gn);class xh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:H.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=H.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)o.zoom+=m.zoomDelta||0,o.bearing+=m.bearingDelta||0,o.pitch+=m.pitchDelta||0,m.panDelta&&o.pan._add(m.panDelta),m.around&&(o.around=m.around),m.pinchAround&&(o.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(o.pan.mag()){const m=ta(o.pan.mag(),u,d.e({},gh,t||{}));c.offset=o.pan.mult(m.amount/o.pan.mag()),c.center=this._map.transform.center,ea(c,m)}if(o.zoom){const m=ta(o.zoom,u,yh);c.zoom=this._map.transform.zoom+m.amount,ea(c,m)}if(o.bearing){const m=ta(o.bearing,u,_h);c.bearing=this._map.transform.bearing+d.ac(m.amount,-179,179),ea(c,m)}if(o.pitch){const m=ta(o.pitch,u,vh);c.pitch=this._map.transform.pitch+m.amount,ea(c,m)}if(c.zoom||c.bearing){const m=o.pinchAround===void 0?o.around:o.pinchAround;c.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function ea(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function ta(p,t,o){const{maxSpeed:u,linearity:c,deceleration:m}=o,w=d.ac(p*c/(t/1e3),-u,u),b=Math.abs(w)/(m*c);return{easing:o.easing,duration:1e3*b,amount:w*(b/2)}}class zi extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u,c={}){const m=G.mousePos(o.getCanvas(),u),w=o.unproject(m);super(t,d.e({point:m,lngLat:w,originalEvent:u},c)),this._defaultPrevented=!1,this.target=o}}class ao extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u){const c=t==="touchend"?u.changedTouches:u.touches,m=G.touchPos(o.getCanvasContainer(),c),w=m.map(E=>o.unproject(E)),b=m.reduce((E,I,A,z)=>E.add(I.div(z.length)),new d.P(0,0));super(t,{points:m,point:b,lngLats:w,lngLat:o.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Ur extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class yn{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ur(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new zi(t.type,this._map,t))}mouseup(t){this._map.fire(new zi(t.type,this._map,t))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new zi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new zi(t.type,this._map,t))}mouseover(t){this._map.fire(new zi(t.type,this._map,t))}mouseout(t){this._map.fire(new zi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ao(t.type,this._map,t))}touchmove(t){this._map.fire(new ao(t.type,this._map,t))}touchend(t){this._map.fire(new ao(t.type,this._map,t))}touchcancel(t){this._map.fire(new ao(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new zi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new zi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(d.P.convert(t),this._map.terrain)}}class lo{constructor(t,o){this._map=t,this._tr=new lr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(G.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=G.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const m=Math.min(c.x,u.x),w=Math.max(c.x,u.x),b=Math.min(c.y,u.y),E=Math.max(c.y,u.y);G.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=w-m+"px",this._box.style.height=E-b+"px"}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const u=this._startPos,c=o;if(this.reset(),G.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new d.k(t,{originalEvent:o}))}}function pu(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const o={};for(let u=0;u<p.length;u++)o[p[u].identifier]=t[u];return o}class Vp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const m=new d.P(0,0);for(const w of c)m._add(w);return m.div(c.length)}(o),this.touches=pu(u,o)))}touchmove(t,o,u){if(this.aborted||!this.centroid)return;const c=pu(u,o);for(const m in this.touches){const w=c[m];(!w||w.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,o,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class fu{constructor(t){this.singleTap=new Vp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,o,u){this.singleTap.touchstart(t,o,u)}touchmove(t,o,u){this.singleTap.touchmove(t,o,u)}touchend(t,o,u){const c=this.singleTap.touchend(t,o,u);if(c){const m=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(c)<30;if(m&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class bh{constructor(t){this._tr=new lr(t),this._zoomIn=new fu({numTouches:1,numTaps:2}),this._zoomOut=new fu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,u){this._zoomIn.touchstart(t,o,u),this._zoomOut.touchstart(t,o,u)}touchmove(t,o,u){this._zoomIn.touchmove(t,o,u),this._zoomOut.touchmove(t,o,u)}touchend(t,o,u){const c=this._zoomIn.touchend(t,o,u),m=this._zoomOut.touchend(t,o,u),w=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(c)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const o=this._moveFunction(...t);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(t,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=o.length?o[0]:o;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&G.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Yn={0:1,2:2};class $e{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const o=G.mouseButton(t);this._eventButton=o}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(o,u){const c=Yn[u];return o.buttons===void 0||(o.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return G.mouseButton(t)===this._eventButton}}class mu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const vs=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},uo=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:o=.8})=>{const u=new $e({checkCorrectEvent:c=>G.mouseButton(c)===0&&c.ctrlKey||G.mouseButton(c)===2});return new zn({clickTolerance:t,move:(c,m)=>({bearingDelta:(m.x-c.x)*o}),moveStateManager:u,enable:p,assignEvents:vs})},gu=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new $e({checkCorrectEvent:c=>G.mouseButton(c)===0&&c.ctrlKey||G.mouseButton(c)===2});return new zn({clickTolerance:t,move:(c,m)=>({pitchDelta:(m.y-c.y)*o}),moveStateManager:u,enable:p,assignEvents:vs})};class Ue{constructor(t,o){this._clickTolerance=t.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,o,u){return this._calculateTransform(t,o,u)}touchmove(t,o,u){if(this._active&&!(u.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,o,u)}touchend(t,o,u){this._calculateTransform(t,o,u),this._active&&u.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,u){u.length>0&&(this._active=!0);const c=pu(u,o),m=new d.P(0,0),w=new d.P(0,0);let b=0;for(const I in c){const A=c[I],z=this._touches[I];z&&(m._add(A),w._add(A.sub(z)),b++,c[I]=A)}if(this._touches=c,b<this.minTouchs()||!w.mag())return;const E=w.div(b);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ia{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,u){if(!this._firstTwoTouches)return;t.preventDefault();const[c,m]=this._firstTwoTouches,w=Ha(u,o,c),b=Ha(u,o,m);if(!w||!b)return;const E=this._aroundCenter?null:w.add(b).div(2);return this._move([w,b],E,t)}touchend(t,o,u){if(!this._firstTwoTouches)return;const[c,m]=this._firstTwoTouches,w=Ha(u,o,c),b=Ha(u,o,m);w&&b||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ha(p,t,o){for(let u=0;u<p.length;u++)if(p[u].identifier===o)return t[u]}function Sh(p,t){return Math.log(p/t)/Math.LN2}class Ga extends ia{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Sh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sh(this._distance,u),pinchAround:o}}}function yu(p,t){return 180*p.angleWith(t)/Math.PI}class _u extends ia{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o,u){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:yu(this._vector,c),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,u=yu(t,this._startVector);return Math.abs(u)<o}}function vu(p){return Math.abs(p.y)>Math.abs(p.x)}class Th extends ia{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,o,u){super.touchstart(t,o,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,vu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),m=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,m,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(t,o,u){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,m=o.mag()>=2;if(!c&&!m)return;if(!c||!m)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=t.y>0==o.y>0;return vu(t)&&vu(o)&&w}}const xs={panStep:100,bearingStep:15,pitchStep:10};class Gt{constructor(t){this._tr=new lr(t);const o=xs;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,u=0,c=0,m=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:b=>{const E=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Wa,zoom:o?Math.round(E.zoom)+o*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+u*this._bearingStep,pitch:E.pitch+c*this._pitchStep,offset:[-m*this._panStep,-w*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wa(p){return p*(2-p)}const Ka=4.000244140625;class xu{constructor(t,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new lr(t),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=H.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ka==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=G.mousePos(this._map.getCanvas(),t),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?d.M.convert(this._aroundCenter?u.center:u.unproject(o)):d.M.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Ka?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&E!==0&&(E=1/E);const I=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(I*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,c=this._easing;let m,w=!1;if(this._type==="wheel"&&u&&c){const b=Math.min((H.now()-this._lastWheelEventTime)/200,1),E=c(b);m=d.z.number(u,o,E),b<1?this._frameId||(this._frameId=!0):w=!0}else m=o,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:m-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=d.b7;if(this._prevEase){const u=this._prevEase,c=(H.now()-u.start)/u.duration,m=u.easing(c+.01)-u.easing(c),w=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-w*w);o=d.b6(w,b,.25,1)}return this._prevEase={start:H.now(),duration:t,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class wu{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Eh{constructor(t){this._tr=new lr(t),this.reset()}reset(){this._active=!1}dblclick(t,o){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Up{constructor(){this._tap=new fu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,o,u){if(!this._swipePoint)if(this._tapTime){const c=o[0],m=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(c)<30;m&&w?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,o,u)}touchmove(t,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=o[0],m=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,o,u)}touchend(t,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(t,o,u);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yr{constructor(t,o,u){this._el=t,this._mousePan=o,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ra{constructor(t,o,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ye{constructor(t,o,u,c){this._el=t,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class it{constructor(t,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=G.create("div","maplibregl-cooperative-gesture-screen",t);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=o,this._container.appendChild(c);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=u,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(G.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ws=p=>p.zoom||p.drag||p.pitch||p.rotate;class bu extends d.k{}function na(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ur{constructor(t,o){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,m)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},E={},I={},A=c.touches,z=A?this._getMapTouches(A):void 0,F=z?G.touchPos(this._map.getCanvas(),z):G.mousePos(this._map.getCanvas(),c);for(const{handlerName:K,handler:N,allowed:te}of this._handlers){if(!N.isEnabled())continue;let pe;this._blockedByActive(I,te,K)?N.reset():N[m||c.type]&&(pe=N[m||c.type](c,F,z),this.mergeHandlerResult(b,E,pe,K,w),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||N.isActive())&&(I[K]=N)}const Z={};for(const K in this._previousActiveHandlers)I[K]||(Z[K]=w);this._previousActiveHandlers=I,(Object.keys(Z).length||na(b))&&(this._changes.push([b,E,Z]),this._triggerRenderFrame()),(Object.keys(I).length||na(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=b;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xh(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,m,w]of this._listeners)G.addEventListener(c,m,c===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,o,u]of this._listeners)G.removeEventListener(t,o,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new yn(o,t));const c=o.boxZoom=new lo(o,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const m=o.cooperativeGestures=new it(o,t.cooperativeGestures);this._add("cooperativeGestures",m),t.cooperativeGestures&&m.enable();const w=new bh(o),b=new Eh(o);o.doubleClickZoom=new wu(b,w),this._add("tapZoom",w),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&o.doubleClickZoom.enable();const E=new Up;this._add("tapDragZoom",E);const I=o.touchPitch=new Th(o);this._add("touchPitch",I),t.interactive&&t.touchPitch&&o.touchPitch.enable(t.touchPitch);const A=uo(t),z=gu(t);o.dragRotate=new ra(t,A,z),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),t.interactive&&t.dragRotate&&o.dragRotate.enable();const F=(({enable:pe,clickTolerance:X})=>{const oe=new $e({checkCorrectEvent:fe=>G.mouseButton(fe)===0&&!fe.ctrlKey});return new zn({clickTolerance:X,move:(fe,me)=>({around:me,panDelta:me.sub(fe)}),activateOnStart:!0,moveStateManager:oe,enable:pe,assignEvents:vs})})(t),Z=new Ue(t,o);o.dragPan=new Yr(u,F,Z),this._add("mousePan",F),this._add("touchPan",Z,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&o.dragPan.enable(t.dragPan);const $=new _u,K=new Ga;o.touchZoomRotate=new Ye(u,K,$,E),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&o.touchZoomRotate.enable(t.touchZoomRotate);const N=o.scrollZoom=new xu(o,()=>this._triggerRenderFrame());this._add("scrollZoom",N,["mousePan"]),t.interactive&&t.scrollZoom&&o.scrollZoom.enable(t.scrollZoom);const te=o.keyboard=new Gt(o);this._add("keyboard",te),t.interactive&&t.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new wh(o))}_add(t,o,u){this._handlers.push({handlerName:t,handler:o,allowed:u}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ws(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,u){for(const c in t)if(c!==u&&(!o||o.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const o=[];for(const u of t)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(t,o,u,c,m){if(!u)return;d.e(t,u);const w={handlerName:c,originalEvent:u.originalEvent||m};u.zoomDelta!==void 0&&(o.zoom=w),u.panDelta!==void 0&&(o.drag=w),u.pitchDelta!==void 0&&(o.pitch=w),u.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const t={},o={},u={};for(const[c,m,w]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),d.e(o,m),d.e(u,w);this._updateMapTransform(t,o,u),this._changes=[]}_updateMapTransform(t,o,u){const c=this._map,m=c._getTransformForUpdate(),w=c.terrain;if(!(na(t)||w&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:b,zoomDelta:E,bearingDelta:I,pitchDelta:A,around:z,pinchAround:F}=t;F!==void 0&&(z=F),c._stop(!0),z=z||c.transform.centerPoint;const Z=m.pointLocation(b?z.sub(b):z);I&&(m.bearing+=I),A&&(m.pitch+=A),E&&(m.zoom+=E),w?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(b)):m.setLocationAtPoint(Z,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(Z,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,m.recalculateZoom(c.terrain)})):m.setLocationAtPoint(Z,z),c._applyUpdatedTransform(m),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,u,!0)}_fireEvents(t,o,u){const c=ws(this._eventsInProgress),m=ws(t),w={};for(const A in t){const{originalEvent:z}=t[A];this._eventsInProgress[A]||(w[`${A}start`]=z),this._eventsInProgress[A]=t[A]}!c&&m&&this._fireEvent("movestart",m.originalEvent);for(const A in w)this._fireEvent(A,w[A]);m&&this._fireEvent("move",m.originalEvent);for(const A in t){const{originalEvent:z}=t[A];this._fireEvent(A,z)}const b={};let E;for(const A in this._eventsInProgress){const{handlerName:z,originalEvent:F}=this._eventsInProgress[A];this._handlersById[z].isActive()||(delete this._eventsInProgress[A],E=o[z]||F,b[`${A}end`]=E)}for(const A in b)this._fireEvent(A,b[A]);const I=ws(this._eventsInProgress);if(u&&(c||m)&&!I){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!A||!A.essential&&H.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:E})),z(this._map.getBearing())&&this._map.resetNorth()):(z(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new d.k(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new bu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class kh extends d.E{constructor(t,o){super(),this._renderFrameCallback=()=>{const u=Math.min((H.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,u){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},o),u)}panTo(t,o,u){return this.easeTo(d.e({center:t},o),u)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,u){return this.easeTo(d.e({zoom:t},o),u)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,u){return this.easeTo(d.e({bearing:t},o),u)}resetNorth(t,o){return this.rotateTo(0,d.e({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=wi.convert(t);const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,o)}_cameraForBoxAndBearing(t,o,u,c){const m={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const je=c.padding;c.padding={top:je,bottom:je,right:je,left:je}}c.padding=d.e(m,c.padding);const w=this.transform,b=w.padding,E=new wi(t,o),I=w.project(E.getNorthWest()),A=w.project(E.getNorthEast()),z=w.project(E.getSouthEast()),F=w.project(E.getSouthWest()),Z=d.b8(-u),$=I.rotate(Z),K=A.rotate(Z),N=z.rotate(Z),te=F.rotate(Z),pe=new d.P(Math.max($.x,K.x,te.x,N.x),Math.max($.y,K.y,te.y,N.y)),X=new d.P(Math.min($.x,K.x,te.x,N.x),Math.min($.y,K.y,te.y,N.y)),oe=pe.sub(X),fe=(w.width-(b.left+b.right+c.padding.left+c.padding.right))/oe.x,me=(w.height-(b.top+b.bottom+c.padding.top+c.padding.bottom))/oe.y;if(me<0||fe<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(w.scaleZoom(w.scale*Math.min(fe,me)),c.maxZoom),Pe=d.P.convert(c.offset),Te=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.b8(u)),Ie=Pe.add(Te).mult(w.scale/w.zoomScale(ge));return{center:w.unproject(I.add(z).div(2).sub(Ie)),zoom:ge,bearing:u}}fitBounds(t,o,u){return this._fitInternal(this.cameraForBounds(t,o),o,u)}fitScreenCoordinates(t,o,u,c,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(t)),this.transform.pointLocation(d.P.convert(o)),u,c),c,m)}_fitInternal(t,o,u){return t?(delete(o=d.e(t,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(t,o){this.stop();const u=this._getTransformForUpdate();let c=!1,m=!1,w=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(c=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=d.M.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(m=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(w=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",o)).fire(new d.k("move",o)),c&&this.fire(new d.k("zoomstart",o)).fire(new d.k("zoom",o)).fire(new d.k("zoomend",o)),m&&this.fire(new d.k("rotatestart",o)).fire(new d.k("rotate",o)).fire(new d.k("rotateend",o)),w&&this.fire(new d.k("pitchstart",o)).fire(new d.k("pitch",o)).fire(new d.k("pitchend",o)),this.fire(new d.k("moveend",o))}calculateCameraOptionsFromTo(t,o,u,c=0){const m=d.Y.fromLngLat(t,o),w=d.Y.fromLngLat(u,c),b=w.x-m.x,E=w.y-m.y,I=w.z-m.z,A=Math.hypot(b,E,I);if(A===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(b,E),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),Z=180*Math.atan2(b,-E)/Math.PI;let $=180*Math.acos(z/A)/Math.PI;return $=I<0?90-$:90+$,{center:w.toLngLat(),zoom:F,pitch:$,bearing:Z}}easeTo(t,o){var u;this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.b7},t)).animate===!1||!t.essential&&H.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),m=this.getZoom(),w=this.getBearing(),b=this.getPitch(),E=this.getPadding(),I="bearing"in t?this._normalizeBearing(t.bearing,w):w,A="pitch"in t?+t.pitch:b,z="padding"in t?t.padding:c.padding,F=d.P.convert(t.offset);let Z=c.centerPoint.add(F);const $=c.pointLocation(Z),{center:K,zoom:N}=c.getConstrained(d.M.convert(t.center||$),(u=t.zoom)!==null&&u!==void 0?u:m);this._normalizeCenter(K);const te=c.project($),pe=c.project(K).sub(te),X=c.zoomScale(N-m);let oe,fe;t.around&&(oe=d.M.convert(t.around),fe=c.locationPoint(oe));const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==m,this._rotating=this._rotating||w!==I,this._pitching=this._pitching||A!==b,this._padding=!c.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,me),this.terrain&&this._prepareElevation(K),this._ease(ge=>{if(this._zooming&&(c.zoom=d.z.number(m,N,ge)),this._rotating&&(c.bearing=d.z.number(w,I,ge)),this._pitching&&(c.pitch=d.z.number(b,A,ge)),this._padding&&(c.interpolatePadding(E,z,ge),Z=c.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(ge),oe)c.setLocationAtPoint(oe,fe);else{const Pe=c.zoomScale(c.zoom-m),Te=N>m?Math.min(2,X):Math.max(.5,X),Ie=Math.pow(Te,1-ge),je=c.unproject(te.add(pe.mult(ge*Ie)).mult(Pe));c.setLocationAtPoint(c.renderWorldCopies?je.wrap():je,Z)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},ge=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,ge)},t),this}_prepareEase(t,o,u={}){this._moving=!0,o||u.moving||this.fire(new d.k("movestart",t)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(o-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=o}this.transform.elevation=d.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const o=t.clone(),{center:u,zoom:c,pitch:m,bearing:w,elevation:b}=this.transformCameraUpdate(o);u&&(o.center=u),c!==void 0&&(o.zoom=c),m!==void 0&&(o.pitch=m),w!==void 0&&(o.bearing=w),b!==void 0&&(o.elevation=b),this.transform.apply(o)}_fireMoveEvents(t){this.fire(new d.k("move",t)),this._zooming&&this.fire(new d.k("zoom",t)),this._rotating&&this.fire(new d.k("rotate",t)),this._pitching&&this.fire(new d.k("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,c=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",t)),c&&this.fire(new d.k("rotateend",t)),m&&this.fire(new d.k("pitchend",t)),this.fire(new d.k("moveend",t))}flyTo(t,o){var u;if(!t.essential&&H.prefersReducedMotion){const bt=d.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(bt,o)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b7},t);const c=this._getTransformForUpdate(),m=this.getZoom(),w=this.getBearing(),b=this.getPitch(),E=this.getPadding(),I="bearing"in t?this._normalizeBearing(t.bearing,w):w,A="pitch"in t?+t.pitch:b,z="padding"in t?t.padding:c.padding,F=d.P.convert(t.offset);let Z=c.centerPoint.add(F);const $=c.pointLocation(Z),{center:K,zoom:N}=c.getConstrained(d.M.convert(t.center||$),(u=t.zoom)!==null&&u!==void 0?u:m);this._normalizeCenter(K);const te=c.zoomScale(N-m),pe=c.project($),X=c.project(K).sub(pe);let oe=t.curve;const fe=Math.max(c.width,c.height),me=fe/te,ge=X.mag();if("minZoom"in t){const bt=d.ac(Math.min(t.minZoom,m,N),c.minZoom,c.maxZoom),ot=fe/c.zoomScale(bt-m);oe=Math.sqrt(ot/ge*2)}const Pe=oe*oe;function Te(bt){const ot=(me*me-fe*fe+(bt?-1:1)*Pe*Pe*ge*ge)/(2*(bt?me:fe)*Pe*ge);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Ie(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function je(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const ut=Te(!1);let Fe=function(bt){return je(ut)/je(ut+oe*bt)},nt=function(bt){return fe*((je(ut)*(Ie(ot=ut+oe*bt)/je(ot))-Ie(ut))/Pe)/ge;var ot},mt=(Te(!0)-ut)/oe;if(Math.abs(ge)<1e-6||!isFinite(mt)){if(Math.abs(fe-me)<1e-6)return this.easeTo(t,o);const bt=me<fe?-1:1;mt=Math.abs(Math.log(me/fe))/oe,nt=function(){return 0},Fe=function(ot){return Math.exp(bt*oe*ot)}}return t.duration="duration"in t?+t.duration:1e3*mt/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=w!==I,this._pitching=A!==b,this._padding=!c.isPaddingEqual(z),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(K),this._ease(bt=>{const ot=bt*mt,yt=1/Fe(ot);c.zoom=bt===1?N:m+c.scaleZoom(yt),this._rotating&&(c.bearing=d.z.number(w,I,bt)),this._pitching&&(c.pitch=d.z.number(b,A,bt)),this._padding&&(c.interpolatePadding(E,z,bt),Z=c.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(bt);const _t=bt===1?K:c.unproject(pe.add(X.mult(nt(ot))).mult(yt));c.setLocationAtPoint(c.renderWorldCopies?_t.wrap():_t,Z),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,o)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,o,u){u.animate===!1||u.duration===0?(t(1),o()):(this._easeStart=H.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,o){t=d.b1(t,-180,180);const u=Math.abs(t-o);return Math.abs(t-360-o)<u&&(t-=360),Math.abs(t+360-o)<u&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const u=t.lng-o.center.lng;t.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(d.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Jr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ih{constructor(t=Jr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=G.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=G.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const u=this._map._getUIString(`AttributionControl.${o}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const o=this._map.style.sourceCaches;for(const c in o){const m=o[c];if(m.used||m.usedForTerrain){const w=m.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,m)=>c.length-m.length),t=t.filter((c,m)=>{for(let w=m+1;w<t.length;w++)if(t[w].indexOf(c)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class co{constructor(t={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=G.create("div","maplibregl-ctrl");const o=G.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){G.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const c of u)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var di=d.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ch extends d.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,o){this.sourceCache.update(t,o),this._renderableTilesKeys=[];const u={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aN(c.posMatrix,0,d.W,0,d.W,0,1),this._tiles[c.key]=new or(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(t){for(const o in this._tiles){const u=this._tiles[o];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const o={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16),d.aN(m.posMatrix,0,d.W,0,d.W,0,1),o[u]=m}else if(c.canonical.isChildOf(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const w=c.canonical.z-t.canonical.z,b=c.canonical.x-(c.canonical.x>>w<<w),E=c.canonical.y-(c.canonical.y>>w<<w),I=d.W>>w;d.aN(m.posMatrix,0,I,0,I,0,1),d.H(m.posMatrix,m.posMatrix,[-b*I,-E*I,0]),o[u]=m}else if(t.canonical.isChildOf(c.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const w=t.canonical.z-c.canonical.z,b=t.canonical.x-(t.canonical.x>>w<<w),E=t.canonical.y-(t.canonical.y>>w<<w),I=d.W>>w;d.aN(m.posMatrix,0,d.W,0,d.W,0,1),d.H(m.posMatrix,m.posMatrix,[b*I,E*I,0]),d.J(m.posMatrix,m.posMatrix,[1/2**w,1/2**w,0]),o[u]=m}}return o}getSourceTile(t,o){const u=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!m||!m.dem)&&o)for(;c>=u.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(t.scaledTo(c--).key);return m}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=t)}}class sa{constructor(t,o,u){this.painter=t,this.sourceCache=new Ch(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,o,u,c=d.W){var m;if(!(o>=0&&o<c&&u>=0&&u<c))return 0;const w=this.getTerrainData(t),b=(m=w.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const E=function($,K,N){var te=K[0],pe=K[1];return $[0]=N[0]*te+N[4]*pe+N[12],$[1]=N[1]*te+N[5]*pe+N[13],$}([],[o/c*d.W,u/c*d.W],w.u_terrain_matrix),I=[E[0]*b.dim,E[1]*b.dim],A=Math.floor(I[0]),z=Math.floor(I[1]),F=I[0]-A,Z=I[1]-z;return b.get(A,z)*(1-F)*(1-Z)+b.get(A+1,z)*F*(1-Z)+b.get(A,z+1)*(1-F)*Z+b.get(A+1,z+1)*F*Z}getElevationForLngLatZoom(t,o){const{tileID:u,mercatorX:c,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(t,o);return this.getElevation(u,c%d.W,m%d.W,d.W)}getElevation(t,o,u,c=d.W){return this.getDEMElevation(t,o,u,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,m=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ot(c,m,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ot(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const o=this.sourceCache.getSourceTile(t,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const c=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Ot(c,o.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),o.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let m=t.canonical.z-o.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?m=t.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>m<<m),b=t.canonical.y-(t.canonical.y>>m<<m),E=d.b9(new Float64Array(16),[1/(d.W<<m),1/(d.W<<m),0]);d.H(E,E,[w*d.W,b*d.W,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(t){const o=this.painter,u=o.width/devicePixelRatio,c=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ot(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ot(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,w=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,w+=4)o[w+0]=255&b,o[w+1]=255&m,o[w+2]=b>>8<<4|m>>8,o[w+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),c=new Ot(t,u,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,c=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const m=o[0]+(o[2]>>4<<8),w=o[1]+((15&o[2])<<8),b=this.coordsIndex[255-o[3]],E=b&&this.sourceCache.getTileByID(b);if(!E)return null;const I=this._coordsTextureSize,A=(1<<E.tileID.canonical.z)*I;return new d.Y((E.tileID.canonical.x*I+m)/A+E.tileID.wrap,(E.tileID.canonical.y*I+w)/A,this.getElevation(E.tileID,m,w,I))}depthAtPoint(t){const o=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,o=new d.ba,u=new d.aX,c=this.meshSize,m=d.W/c,w=c*c;for(let z=0;z<=c;z++)for(let F=0;F<=c;F++)o.emplaceBack(F*m,z*m,0);for(let z=0;z<w;z+=c+1)for(let F=0;F<c;F++)u.emplaceBack(F+z,c+F+z+1,c+F+z+2),u.emplaceBack(F+z,c+F+z+2,F+z+1);const b=o.length,E=b+2*(c+1);for(const z of[0,1])for(let F=0;F<=c;F++)for(const Z of[0,1])o.emplaceBack(F*m,z*d.W,Z);for(let z=0;z<2*c;z+=2)u.emplaceBack(E+z,E+z+1,E+z+3),u.emplaceBack(E+z,E+z+3,E+z+2),u.emplaceBack(b+z,b+z+3,b+z+1),u.emplaceBack(b+z,b+z+2,b+z+3);const I=o.length,A=I+2*(c+1);for(const z of[0,1])for(let F=0;F<=c;F++)for(const Z of[0,1])o.emplaceBack(z*d.W,F*m,Z);for(let z=0;z<2*c;z+=2)u.emplaceBack(I+z,I+z+1,I+z+3),u.emplaceBack(I+z,I+z+3,I+z+2),u.emplaceBack(A+z,A+z+3,A+z+1),u.emplaceBack(A+z,A+z+2,A+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(o,di.members),segments:d.$.simpleSegment(0,0,o.length,u.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*d.bb/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,o){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,o);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const o=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,o){const u=d.Y.fromLngLat(t.wrap()),c=(1<<o)*d.W,m=u.x*c,w=u.y*c,b=Math.floor(m/d.W),E=Math.floor(w/d.W);return{tileID:new d.Q(o,0,o,b,E),mercatorX:m,mercatorY:w}}}class Xa{constructor(t,o,u){this._context=t,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new Ot(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:t,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>t.id!==o),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Jn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Su{constructor(t,o){this.painter=t,this.terrain=o,this.pool=new Xa(t.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(u=>!t._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const c=t.sourceCaches[u].getVisibleCoordinates();for(const m of c){const w=this.terrain.sourceCache.getTerrainCoords(m);for(const b in w)this._coordsDescendingInv[u][b]||(this._coordsDescendingInv[u][b]=[]),this._coordsDescendingInv[u][b].push(w[b])}}this._coordsDescendingInvStr={};for(const u of t._order){const c=t._layers[u],m=c.source;if(Jn[c.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const w in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][w]=this._coordsDescendingInv[m][w].map(b=>b.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[c][u.tileID.key];m&&m!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const o=t.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Jn[o]&&(this._prevType&&Jn[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(Jn[this._prevType]||Jn[o]&&c){this._prevType=o;const m=this._stacks.length-1,w=this._stacks[m]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(uu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[m]){const I=this.pool.getObjectForId(b.rtt[m].id);if(I.stamp===b.rtt[m].stamp){this.pool.useObject(I);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),b.rtt[m]={id:E.id,stamp:E.stamp},u.context.bindFramebuffer.set(E.fbo.framebuffer),u.context.clear({color:d.aO.transparent,stencil:0}),u.currentStencilSource=void 0;for(let I=0;I<w.length;I++){const A=u.style._layers[w[I]],z=A.source?this._coordsDescendingInv[A.source][b.tileID.key]:[b.tileID];u.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),u._renderTileClippingMasks(A,z),u.renderLayer(u,u.style.sourceCaches[A.source],A,z),A.source&&(b.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][b.tileID.key])}}return uu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Jn[o]}return!1}}const Tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},oa=U,Eu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Jr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ya=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},ku={showCompass:!0,showZoom:!0,visualizePitch:!1};class Iu{constructor(t,o,u=!1){this.mousedown=w=>{this.startMouse(d.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),G.mousePos(this.element,w)),G.addEventListener(window,"mousemove",this.mousemove),G.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,G.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),G.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),m=t.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=uo({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:b,bearingDegreesPerPixelMoved:E=.8})=>{const I=new mu;return new zn({clickTolerance:b,move:(A,z)=>({bearingDelta:(z.x-A.x)*E}),moveStateManager:I,enable:w,assignEvents:Ya})})({clickTolerance:c,enable:!0}),this.map=t,u&&(this.mousePitch=gu({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:b,pitchDegreesPerPixelMoved:E=-.5})=>{const I=new mu;return new zn({clickTolerance:b,move:(A,z)=>({pitchDelta:(z.y-A.y)*E}),moveStateManager:I,enable:w,assignEvents:Ya})})({clickTolerance:m,enable:!0})),G.addEventListener(o,"mousedown",this.mousedown),G.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(o,"touchcancel",this.reset)}startMouse(t,o){this.mouseRotate.dragStart(t,o),this.mousePitch&&this.mousePitch.dragStart(t,o),G.disableDrag()}startTouch(t,o){this.touchRotate.dragStart(t,o),this.touchPitch&&this.touchPitch.dragStart(t,o),G.disableDrag()}moveMouse(t,o){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(t,o)||{};m&&u.setPitch(u.getPitch()+m)}}moveTouch(t,o){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(t,o)||{};m&&u.setPitch(u.getPitch()+m)}}off(){const t=this.element;G.removeEventListener(t,"mousedown",this.mousedown),G.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend),G.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),G.removeEventListener(window,"mousemove",this.mousemove),G.removeEventListener(window,"mouseup",this.mouseup),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend)}}let Mn;function Ja(p,t,o){const u=new d.M(p.lng,p.lat);if(p=new d.M(p.lng,p.lat),t){const c=new d.M(p.lng-360,p.lat),m=new d.M(p.lng+360,p.lat),w=o.locationPoint(p).distSqr(t);o.locationPoint(c).distSqr(t)<w?p=c:o.locationPoint(m).distSqr(t)<w&&(p=m)}for(;Math.abs(p.lng-o.center.lng)>180;){const c=o.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;p.lng>o.center.lng?p.lng-=360:p.lng+=360}return p.lng!==u.lng&&o.locationPoint(p).y>o.height/2-o.getHorizon()?p:u}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qa(p,t,o){const u=p.classList;for(const c in aa)u.remove(`maplibregl-${o}-anchor-${c}`);u.add(`maplibregl-${o}-anchor-${t}`)}class ho extends d.E{constructor(t){if(super(),this._onKeyPress=o=>{const u=o.code,c=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ja(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,`${aa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${m}`),H.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");const o=G.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${c}px`),o.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const m=G.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const w=G.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const b=G.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const te of E){const pe=G.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",te.rx),pe.setAttributeNS(null,"ry",te.ry),b.appendChild(pe)}const I=G.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const A=G.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(A);const z=G.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const F=G.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(F);const Z=G.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const $=G.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=G.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const N=G.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#FFFFFF"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962"),$.appendChild(K),$.appendChild(N),w.appendChild(b),w.appendChild(I),w.appendChild(z),w.appendChild(Z),w.appendChild($),o.appendChild(w),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(o),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Qa(this._element,this._anchor,"marker"),t&&t.className)for(const o of t.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,m=c.terrain.depthAtPoint(this._pos),w=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,w)-m<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/c.transform._pixelPerMeter,E=Math.sin(c.getPitch()*Math.PI/180)*b,I=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=c.transform.lngLatToCameraDepth(this._lngLat,w+E)-I>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,o){return t===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Cu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let po=0,Qn=!1;const Pu={maxWidth:100,unit:"metric"};function el(p,t,o){const u=o&&o.maxWidth||100,c=p._container.clientHeight/2,m=p.unproject([0,c]),w=p.unproject([u,c]),b=m.distanceTo(w);if(o&&o.unit==="imperial"){const E=3.2808*b;E>5280?bs(t,u,E/5280,p._getUIString("ScaleControl.Miles")):bs(t,u,E,p._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?bs(t,u,b/1852,p._getUIString("ScaleControl.NauticalMiles")):b>=1e3?bs(t,u,b/1e3,p._getUIString("ScaleControl.Kilometers")):bs(t,u,b,p._getUIString("ScaleControl.Meters"))}function bs(p,t,o,u){const c=function(m){const w=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/w;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(E){const I=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*I)/I}(b),w*b}(o);p.style.width=t*(c/o)+"px",p.innerHTML=`${c}&nbsp;${u}`}const Au={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},zu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mu(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,p),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-p),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(p,0),right:new d.P(-p,0)}}if(p instanceof d.P||Array.isArray(p)){const t=d.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(p.center||[0,0]),top:d.P.convert(p.top||[0,0]),"top-left":d.P.convert(p["top-left"]||[0,0]),"top-right":d.P.convert(p["top-right"]||[0,0]),bottom:d.P.convert(p.bottom||[0,0]),"bottom-left":d.P.convert(p["bottom-left"]||[0,0]),"bottom-right":d.P.convert(p["bottom-right"]||[0,0]),left:d.P.convert(p.left||[0,0]),right:d.P.convert(p.right||[0,0])}}return Mu(new d.P(0,0))}const Ph=U;x.AJAXError=d.be,x.Evented=d.E,x.LngLat=d.M,x.MercatorCoordinate=d.Y,x.Point=d.P,x.addProtocol=d.bf,x.config=d.a,x.removeProtocol=d.bg,x.AttributionControl=Ih,x.BoxZoomHandler=lo,x.CanvasSource=Zs,x.CooperativeGesturesHandler=it,x.DoubleClickZoomHandler=wu,x.DragPanHandler=Yr,x.DragRotateHandler=ra,x.EdgeInsets=Qo,x.FullscreenControl=class extends d.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=o==null?void 0:o.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){G.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=G.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);G.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=Tt,x.GeolocateControl=class extends d.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const o=new d.M(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,c=this._map.getBearing(),m=d.e({bearing:c},this.options.fitBoundsOptions),w=wi.fromLngLat(o,u);this._map.fitBounds(w,m,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const o=new d.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Qn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=G.create("button","maplibregl-ctrl-geolocate",this._container),G.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ho({element:this._dotElement}),this._circleElement=G.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ho({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")))})}},this.options=d.e({},Cu,p)}onAdd(p){return this._map=p,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return d._(this,arguments,void 0,function*(t=!1){if(Mn!==void 0&&!t)return Mn;if(window.navigator.permissions===void 0)return Mn=!!window.navigator.geolocation,Mn;try{Mn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Mn=!!window.navigator.geolocation}return Mn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,po=0,Qn=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),o=p.coords;return t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),o=p.getNorthEast(),u=t.distanceTo(o),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":po--,Qn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),po++,po>1?(p={maximumAge:6e5,timeout:0},Qn=!0):(p=this.options.positionOptions,Qn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=du,x.ImageSource=pn,x.KeyboardHandler=Gt,x.LngLatBounds=wi,x.LogoControl=co,x.Map=class extends kh{constructor(p){if(d.bc.mark(d.bd.create),(p=d.e({},Eu,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Za(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new ti,this._controls=[],this._mapId=d.a3(),this._locale=d.e({},Tu,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new qe(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const o=hu(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{t?o(u):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ur(this,p),this._hash=p.hash&&new du(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Ih(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new co,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new d.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new d.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new d.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=p.onAdd(this);this._controls.push(p);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,o,u)}resize(p){var t;const o=this._containerDimensions(),u=o[0],c=o[1],m=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,m),this.painter.resize(u,c,m),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const E=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,E),this.painter.resize(u,c,E)}this.transform.resize(u,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(u,c);const w=!this._moving;return w&&(this.stop(),this.fire(new d.k("movestart",p)).fire(new d.k("move",p))),this.fire(new d.k("resize",p)),w&&this.fire(new d.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:o,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),m=p*c,w=t*c;return Math.min(m>o?o/m:1,w>u?u/w:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(wi.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(d.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(d.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,o){if(p==="mouseenter"||p==="mouseover"){let u=!1;return{layer:t,listener:o,delegates:{mousemove:m=>{const w=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];w.length?u||(u=!0,o.call(this,new zi(p,this,m.originalEvent,{features:w}))):u=!1},mouseout:()=>{u=!1}}}}if(p==="mouseleave"||p==="mouseout"){let u=!1;return{layer:t,listener:o,delegates:{mousemove:w=>{(this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,o.call(this,new zi(p,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,o.call(this,new zi(p,this,w.originalEvent)))}}}}{const u=c=>{const m=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];m.length&&(c.features=m,o.call(this,c),delete c.features)};return{layer:t,listener:o,delegates:{[p]:u}}}}on(p,t,o){if(o===void 0)return super.on(p,t);const u=this._createDelegatedListener(p,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(p,t,o){if(o===void 0)return super.once(p,t);const u=this._createDelegatedListener(p,t,o);for(const c in u.delegates)this.once(c,u.delegates[c]);return this}off(p,t,o){return o===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(u=>{const c=this._delegatedListeners[p];for(let m=0;m<c.length;m++){const w=c[m];if(w.layer===t&&w.listener===o){for(const b in w.delegates)this.off(b,w.delegates[b]);return c.splice(m,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let o;const u=p instanceof d.P||Array.isArray(p),c=u?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:p)||{},c instanceof d.P||typeof c[0]=="number")o=[d.P.convert(c)];else{const m=d.P.convert(c[0]),w=d.P.convert(c[1]);o=[m,new d.P(w.x,m.y),w,new d.P(m.x,w.y),m]}return this.style.queryRenderedFeatures(o,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const o=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,o):this.style.loadJSON(p,t,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const o=this._requestManager.transformRequest(p,ke.Style);d.h(o,new AbortController).then(u=>{this._updateDiff(u.data,t)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(o){d.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new d.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===p.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new sa(this.painter,t,p),this.painter.renderToTexture=new Su(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const o=p[t]._tiles;for(const u in o){const c=o[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,o={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:m,stretchY:w,content:b}=o;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:I,data:A}=t,z=t;return this.style.addImage(p,{data:new d.R({width:E,height:I},new Uint8Array(A)),pixelRatio:u,stretchX:m,stretchY:w,content:b,sdf:c,version:0,userImage:z}),z.onAdd&&z.onAdd(this,p),this}}{const{width:E,height:I,data:A}=H.getImageData(t);this.style.addImage(p,{data:new d.R({width:E,height:I},A),pixelRatio:u,stretchX:m,stretchY:w,content:b,sdf:c,version:0})}}updateImage(p,t){const o=this.style.getImage(p);if(!o)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||d.b(t)?H.getImageData(t):t,{width:c,height:m,data:w}=u;if(c===void 0||m===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==o.data.width||m!==o.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||d.b(t));return o.data.replace(w,b),this.style.updateImage(p,o),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return ue.getImage(this._requestManager.transformRequest(p,ke.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,o){return this.style.setLayerZoomRange(p,t,o),this._update(!0)}setFilter(p,t,o={}){return this.style.setFilter(p,t,o),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,o,u={}){return this.style.setPaintProperty(p,t,o,u),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,o,u={}){return this.style.setLayoutProperty(p,t,o,u),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,o,u=>{u||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,o=>{o||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=G.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=G.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const c=this._controlContainer=G.create("div","maplibregl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{m[w]=G.create("div",`maplibregl-ctrl-${w} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,o){this._canvas.width=Math.floor(o*p),this._canvas.height=Math.floor(o*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{t={requestedAttributes:p},u&&(t.statusMessage=u.statusMessage,t.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!o){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new so(o,this.transform),Me.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,m=H.now();this.style.zoomHistory.update(c,m);const w=new d.a8(c,{now:m,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=w.crossFadingFactor();b===1&&b===this._crossFadingFactor||(o=!0,this._crossFadingFactor=b),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bc.mark(d.bd.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bc.mark(d.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),G.remove(this._canvasContainer),G.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bc.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,H.frameAsync(this._frameRequest).then(p=>{d.bc.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return oa}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=zi,x.MapTouchEvent=ao,x.MapWheelEvent=Ur,x.Marker=ho,x.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),o=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);t.title=u,t.setAttribute("aria-label",u)},this.options=d.e({},ku,p),this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),G.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),G.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=G.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Iu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const o=G.create("button",p,this._container);return o.type="button",o.addEventListener("click",t),o}},x.Popup=class extends d.E{constructor(p){super(),this.remove=()=>(this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=G.create("div","maplibregl-popup",this._map.getContainer()),this._tip=G.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ja(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!t)return;const u=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const m=Mu(this.options.offset);if(!c){const b=this._container.offsetWidth,E=this._container.offsetHeight;let I;I=u.y+m.bottom.y<E?["top"]:u.y>this._map.transform.height-E?["bottom"]:[],u.x<b/2?I.push("left"):u.x>this._map.transform.width-b/2&&I.push("right"),c=I.length===0?"bottom":I.join("-")}let w=u.add(m[c]);this.options.subpixelPositioning||(w=w.round()),G.setTransform(this._container,`${aa[c]} translate(${w.x}px,${w.y}px)`),Qa(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Au),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=d.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=p;u=o.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(zu);p&&p.focus()}},x.RasterDEMTileSource=jo,x.RasterTileSource=cs,x.ScaleControl=class{constructor(p){this._onMove=()=>{el(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,el(this._map,this._container,this.options)},this.options=d.e({},Pu,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=xu,x.Style=Ca,x.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=G.create("button","maplibregl-ctrl-terrain",this._container),G.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){G.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=Th,x.TwoFingersTouchRotateHandler=_u,x.TwoFingersTouchZoomHandler=Ga,x.TwoFingersTouchZoomRotateHandler=Ye,x.VectorTileSource=ye,x.VideoSource=qs,x.addSourceType=(p,t)=>d._(void 0,void 0,void 0,function*(){if(hs(p))throw new Error(`A source type called "${p}" already exists.`);((o,u)=>{Hs[o]=u})(p,t)}),x.clearPrewarmedResources=function(){const p=Ri;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Br),Ri=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return wr().getRTLTextPluginStatus()},x.getVersion=function(){return Ph},x.getWorkerCount=function(){return Pi.workerCount},x.getWorkerUrl=function(){return d.a.WORKER_URL},x.importScriptInWorkers=function(p){return qn().broadcast("importScript",p)},x.prewarm=function(){Kr().acquire(Br)},x.setMaxParallelImageRequests=function(p){d.a.MAX_PARALLEL_IMAGE_REQUESTS=p},x.setRTLTextPlugin=function(p,t){return wr().setRTLTextPlugin(p,t)},x.setWorkerCount=function(p){Pi.workerCount=p},x.setWorkerUrl=function(p){d.a.WORKER_URL=p}});var T=l;return T})})(M1);var Y0=M1.exports;const fE=({lat:i,lng:s})=>(zl.useEffect(()=>{if(i&&s){const l=new Y0.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=DGXtYZdwpkrkweWeGr5U",center:[s,i],zoom:8});new Y0.Marker().setLngLat([s,i]).addTo(l)}}),Mr.jsx("div",{id:"map",className:"flex-1 min-w-[40rem] border-4 w-full h-[40rem] border-primary-color"})),mE=()=>{const[i,s]=zl.useState({});return zl.useEffect(()=>{(async()=>{try{const{data:f}=await Li.get("https://ipapi.co/json/");s(f)}catch(f){console.log("Error fetch data: ",f)}})()},[]),Mr.jsxs(Mr.Fragment,{children:[Mr.jsx("h1",{className:"mt-24 font-bold text-center underline mb-80 text-8xl font-pacifico text-primary-color",children:"IP Address Finder"}),Mr.jsxs("div",{className:"flex flex-wrap items-center gap-16 w-[80rem] max-w-[88%] mx-auto",children:[Mr.jsxs("div",{className:"font-bold",children:[Mr.jsx("h4",{className:"my-10",children:"What is my IPv6 address?"}),Mr.jsx("p",{className:"my-8 text-4xl text-primary-color",children:i.ip}),Mr.jsx("h4",{className:"my-10",children:"Approximate location:"}),Mr.jsxs("p",{className:"my-8 text-2xl text-primary-color",children:[i.city,", ",i.region,", ",i.country_name]}),Mr.jsx("h4",{className:"my-10",children:"Internet Service Provider (ISP):"}),Mr.jsx("p",{className:"my-8 text-2xl text-primary-color",children:i.org})]}),Mr.jsx(fE,{lat:i.latitude,lng:i.longitude})]})]})};nm.createRoot(document.getElementById("root")).render(Mr.jsx(Ub.StrictMode,{children:Mr.jsx(mE,{})}));
